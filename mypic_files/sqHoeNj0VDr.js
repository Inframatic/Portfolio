/*!CK:2868672890!*//*1375846302,178146351*/

if (self.CavalryLogger) { CavalryLogger.start_js(["7SdGf"]); }

__d("CLoggerX",["Banzai","DOM","debounce","Event","ge","Parent","Keys"],function(a,b,c,d,e,f){var g=b('Banzai'),h=b('DOM'),i=b('debounce'),j=b('Event'),k=b('ge'),l=b('Parent'),m=10*60*1000,n=b('Keys').RETURN,o={},p=function(s){var t=(s.target||s.srcElement).id,u=(s.target||s.srcElement).value.trim().length,v=q.getTracker(t);if(!v)return;if(u>5&&!v.submitted){g.post('censorlogger',{cl_impid:v.impid,clearcounter:v.clearcounter,instrument:v.type,elementid:t,parent_fbid:(v.parent_fbid=='unknown'?null:v.parent_fbid),version:"x"},g.VITAL);q.setSubmitted(t,true);}else if(u===0&&v.submitted&&s.which!=n){o[t]=r(t);o[t]();}else if(u>0&&v.submitted)if(o[t])o[t].reset();},q={init:function(){this.trackedElements=this.trackedElements||{};this.feedbackForms=this.feedbackForms||{};},setImpressionID:function(s){this.init();this.impressionID=s;this.clean();},setComposerTargetData:function(s){this.cTargetID=s.targetID||'unknown';this.cTargetFBType=s.targetType||'unknown';},clean:function(){for(var s in this.trackedElements){if(o[s]){o[s].reset();delete o[s];}delete this.trackedElements[s];}},trackComposer:function(s,t,u){this.setComposerTargetData(u);this.startTracking(s,'composer',this.cTargetID,this.cTargetFBType,t);},trackFeedbackForm:function(s,t,u){this.init();this.impressionID=this.impressionID||u;var v,w,x;v=h.getID(s);w=t?t.targetID||'unknown':'unknown';x=t?t.targetType||'unknown':'unknown';this.feedbackForms[v]={parent_fbid:w,parent_type:x};},trackMentionsInput:function(s,t){this.init();var u,v,w;if(!s)return;u=l.byTag(s,'form');if(!u)return;v=h.getID(u);w=this.feedbackForms[v];if(!w)return;var x=t||w.parent_fbid,y=t?416:w.parent_type;this.startTracking(s,'comment',x,y,u);},startTracking:function(s,t,u,v,w){this.init();var x=h.getID(s);if(this.getTracker(x))return;var y=h.getID(w);j.listen(s,'keyup',p.bind(this));this.trackedElements[x]={submitted:false,clearcounter:0,type:t,impid:this.impressionID,parent_fbid:u,parent_type:v,parentElID:y};this.addJoinTableInfoToForm(w,x);},getTracker:function(s){return (this.trackedElements?this.trackedElements[s]:null);},setSubmitted:function(s,t){if(this.trackedElements[s])this.trackedElements[s].submitted=t;},incrementClearCounter:function(s){var t=this.getTracker(s);if(!t)return;t.clearcounter++;t.submitted=false;var u=h.scry(k(t.parentElID),'input[name="clp"]')[0];if(u)u.value=this.getJSONRepForTrackerID(s);this.trackedElements[s]=t;},addJoinTableInfoToForm:function(s,t){var u=this.getTracker(t);if(!u)return;var v=h.scry(s,'input[name="clp"]')[0];if(!v)h.prependContent(s,h.create('input',{type:'hidden',name:'clp',value:this.getJSONRepForTrackerID(t)}));},getCLParamsForTarget:function(s,t){if(!s)return "";var u=h.getID(s);return this.getJSONRepForTrackerID(u,t);},getJSONRepForTrackerID:function(s,t){var u=this.getTracker(s);if(!u)return "";return JSON.stringify({cl_impid:u.impid,clearcounter:u.clearcounter,elementid:s,version:"x",parent_fbid:t||u.parent_fbid});}},r=function(s){return i(function(){q.incrementClearCounter(s);},m,q);};e.exports=q;});
__d("ClickTTIIdentifiers",[],function(a,b,c,d,e,f){var g={types:{TIMELINE_SEE_LIKERS:'timeline:seelikes'},getUserActionID:function(h){return '{"ua_id":"'+h+'"}';}};e.exports=g;});
__d("ClientIDs",["randomInt"],function(a,b,c,d,e,f){var g=b('randomInt'),h={},i={getNewClientID:function(){var j=Date.now(),k=j+':'+(g(0,4294967295)+1);h[k]=true;return k;},isExistingClientID:function(j){return !!h[j];}};e.exports=i;});
__d("UFIConstants",[],function(a,b,c,d,e,f){var g={COMMENT_LIKE:'fa-type:comment-like',COMMENT_SET_SPAM:'fa-type:mark-spam',DELETE_COMMENT:'fa-type:delete-comment',LIVE_DELETE_COMMENT:'fa-type:live-delete-comment',LIKE_ACTION:'fa-type:like',REMOVE_PREVIEW:'fa-type:remove-preview',CONFIRM_COMMENT_REMOVAL:'fa-type:confirm-remove',TRANSLATE_COMMENT:'fa-type:translate-comment',SUBSCRIBE_ACTION:'fa-type:subscribe',GIFT_SUGGESTION:'fa-type:gift-suggestion',UNDO_DELETE_COMMENT:'fa-type:undo-delete-comment'},h={DELETED:'status:deleted',SPAM:'status:spam',SPAM_DISPLAY:'status:spam-display',LIVE_DELETED:'status:live-deleted',FAILED_ADD:'status:failed-add',FAILED_EDIT:'status:failed-edit',PENDING_EDIT:'status:pending-edit',PENDING_UNDO_DELETE:'status:pending-undo-delete'},i={MOBILE:1,SMS:3,EMAIL:4},j={PROFILE:0,NEWS_FEED:1,OBJECT:2,MOBILE:3,EMAIL:4,PROFILE_APROVAL:10,TICKER:12,NONE:13,INTERN:14,ADS:15,PHOTOS_SNOWLIFT:17},k={UNKNOWN:0,INITIAL_SERVER:1,LIVE_SEND:2,USER_ACTION:3,COLLAPSED_UFI:4,ENDPOINT_LIKE:10,ENDPOINT_COMMENT_LIKE:11,ENDPOINT_ADD_COMMENT:12,ENDPOINT_EDIT_COMMENT:13,ENDPOINT_DELETE_COMMENT:14,ENDPOINT_UNDO_DELETE_COMMENT:15,ENDPOINT_COMMENT_SPAM:16,ENDPOINT_REMOVE_PREVIEW:17,ENDPOINT_ID_COMMENT_FETCH:18,ENDPOINT_COMMENT_FETCH:19,ENDPOINT_TRANSLATE_COMMENT:20,ENDPOINT_BAN:21,ENDPOINT_SUBSCRIBE:22},l={CHRONOLOGICAL:'chronological',RANKED_THREADED:'ranked_threaded',TOPLEVEL:'toplevel',RECENT_ACTIVITY:'recent_activity'},m=50,n=.6,o=420,p=5,q=80,r=2;e.exports={UFIActionType:g,UFIStatus:h,UFISourceType:i,UFIFeedbackSourceType:j,UFIPayloadSourceType:k,UFICommentOrderingMode:l,defaultPageSize:m,commentTruncationLength:o,commentTruncationPercent:n,commentTruncationMaxLines:p,attachmentTruncationLength:q,minCommentsForOrderingModeSelector:r};});
__d("UFICentralUpdates",["Arbiter","ChannelConstants","LiveTimer","ShortProfiles","UFIConstants","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('LiveTimer'),j=b('ShortProfiles'),k=b('UFIConstants'),l=b('copyProperties'),m=b('tx'),n=0,o={},p={},q={},r={},s=[];g.subscribe(h.getArbiterType('live-data'),function(x,y){if(y&&y.obj){var z=y.obj,aa=z.comments||[];aa.forEach(function(ba){ba.timestamp.text="a few seconds ago";});w.handleUpdate(k.UFIPayloadSourceType.LIVE_SEND,z);}});function t(){if(!n){var x=q,y=o,z=p,aa=r;q={};o={};p={};r={};if(Object.keys(x).length)v('feedback-id-changed',x);if(Object.keys(y).length)v('feedback-updated',y);if(Object.keys(z).length)v('comments-updated',z);if(Object.keys(aa).length)v('instance-updated',aa);s.pop();}}function u(){if(s.length){return s[s.length-1];}else return k.UFIPayloadSourceType.UNKNOWN;}function v(event,x){w.inform(event,{updates:x,payloadSource:u()});}var w=l(new g(),{handleUpdate:function(x,y){if(Object.keys(y).length)this.synchronizeInforms(function(){s.push(x);var z=l({payloadsource:u()},y);this.inform('update-feedback',z);this.inform('update-comment-lists',z);this.inform('update-comments',z);this.inform('update-actions',z);(y.profiles||[]).forEach(function(aa){j.set(aa.id,aa);});if(y.servertime)i.restart(y.servertime);}.bind(this));},didUpdateFeedback:function(x){o[x]=true;t();},didUpdateComment:function(x){p[x]=true;t();},didUpdateFeedbackID:function(x,y){q[x]=y;t();},didUpdateInstanceState:function(x,y){if(!r[x])r[x]={};r[x][y]=true;t();},synchronizeInforms:function(x){n++;try{x();}catch(y){throw y;}finally{n--;t();}}});e.exports=w;});
__d("UFIFeedbackTargets",["ClientIDs","KeyedCallbackManager","UFICentralUpdates","UFIConstants","copyProperties"],function(a,b,c,d,e,f){var g=b('ClientIDs'),h=b('KeyedCallbackManager'),i=b('UFICentralUpdates'),j=b('UFIConstants'),k=b('copyProperties'),l=new h();function m(v){var w={};v.forEach(function(x){var y=k({},x);delete y.commentlist;delete y.commentcount;w[x.entidentifier]=y;i.didUpdateFeedback(x.entidentifier);});l.addResourcesAndExecute(w);}function n(v){for(var w=0;w<v.length;w++){var x=v[w];switch(x.actiontype){case j.UFIActionType.LIKE_ACTION:p(x);break;case j.UFIActionType.SUBSCRIBE_ACTION:q(x);break;case j.UFIActionType.GIFT_SUGGESTION:r(x);break;}}}function o(v){for(var w=0;w<v.length;w++){var x=v[w];if(x.orig_ftentidentifier)t(x.orig_ftentidentifier,x.ftentidentifier);}}function p(v){var w=s(v);if(w){v.hasviewerliked=!!v.hasviewerliked;if(v.clientid&&g.isExistingClientID(v.clientid)&&v.hasviewerliked!=w.hasviewerliked)return;w.likecount=v.likecount||0;w.likesentences=v.likesentences;if(v.actorid==w.actorforpost){w.hasviewerliked=v.hasviewerliked;}else if(v.hasviewerliked!=w.hasviewerliked){w.likesentences={current:v.likesentences.alternate,alternate:v.likesentences.current};if(w.hasviewerliked){w.likecount++;}else w.likecount--;}if(v.actorid!=w.actorforpost)w.likesentences.isunseen=true;m([w]);}}function q(v){var w=s(v);if(w){v.hasviewersubscribed=!!v.hasviewersubscribed;if(v.clientid&&g.isExistingClientID(v.clientid)&&v.hasviewersubscribed!=w.hasviewersubscribed)return;if(v.actorid==w.actorforpost)w.hasviewersubscribed=v.hasviewersubscribed;m([w]);}}function r(v){var w=s(v);if(!w)return;if(v.clientid&&g.isExistingClientID(v.clientid)&&v.hasviewerliked!=w.hasviewerliked)return;w.giftdata=v.giftdata;m([w]);}function s(v){if(v.orig_entidentifier)t(v.orig_entidentifier,v.entidentifier);return l.getResource(v.entidentifier);}function t(v,w){var x=l.getResource(v);if(x){l.setResource(v,null);x.entidentifier=w;l.setResource(w,x);i.didUpdateFeedbackID(v,w);}}var u={getFeedbackTarget:function(v,w){var x=l.executeOrEnqueue(v,w),y=l.getUnavailableResources(x);y.length;return x;},unsubscribe:function(v){l.unsubscribe(v);}};i.subscribe('update-feedback',function(v,w){var x=w.feedbacktargets;if(x&&x.length)m(x);});i.subscribe('update-actions',function(v,w){if(w.actions&&w.actions.length)n(w.actions);});i.subscribe('update-comments',function(v,w){if(w.comments&&w.comments.length)o(w.comments);});e.exports=u;});
__d("TrackingNodes",[],function(a,b,c,d,e,f){var g={types:{USER_NAME:2,LIKE_LINK:5,UNLIKE_LINK:6,ATTACHMENT:15,SHARE_LINK:17,USER_MESSAGE:18,SOURCE:21,BLINGBOX:22,VIEW_ALL_COMMENTS:24,COMMENT:25,COMMENT_LINK:26,SMALL_ACTOR_PHOTO:27,XBUTTON:29,HIDE_LINK:30,REPORT_SPAM_LINK:31,HIDE_ALL_LINK:32,ADD_COMMENT_BOX:34,UFI:36,DROPDOWN_BUTTON:55,UNHIDE_LINK:71,RELATED_SHARE:73},BASE_CODE_START:58,BASE_CODE_END:126,BASE_CODE_SIZE:69,PREFIX_CODE_START:42,PREFIX_CODE_END:47,PREFIX_CODE_SIZE:6,encodeTrackingInfo:function(h,i){var j=(h-1)%g.BASE_CODE_SIZE,k=parseInt((h-1)/g.BASE_CODE_SIZE,10);if(h<1||k>g.PREFIX_CODE_SIZE)throw Error('Invalid tracking node: '+h);var l="";if(k>0)l+=String.fromCharCode(k-1+g.PREFIX_CODE_START);l+=String.fromCharCode(j+g.BASE_CODE_START);if(typeof i!="undefined"&&i>0)l+=String.fromCharCode(48+Math.min(i,10)-1);return l;},decodeTN:function(h){if(h.length===0)return [0];var i=h.charCodeAt(0),j=1,k,l;if(i>=g.PREFIX_CODE_START&&i<=g.PREFIX_CODE_END){if(h.length==1)return [0];l=i-g.PREFIX_CODE_START+1;k=h.charCodeAt(1);j=2;}else{l=0;k=i;}if(k<g.BASE_CODE_START||k>g.BASE_CODE_END)return [0];var m=l*g.BASE_CODE_SIZE+(k-g.BASE_CODE_START)+1;if(h.length>j&&(h.charAt(j)>='0'&&h.charAt(j)<='9'))return [j+1,[m,parseInt(h.charAt(j),10)+1]];return [j,[m]];},parseTrackingNodeString:function(h){var i=[];while(h.length>0){var j=g.decodeTN(h);if(j.length==1)return [];i.push(j[1]);h=h.substring(j[0]);}return i;},getTrackingInfo:function(h,i){return '{"tn":"'+g.encodeTrackingInfo(h,i)+'"}';}};e.exports=g;});
__d("NumberFormat",["Env"],function(a,b,c,d,e,f){var g=b('Env'),h=/(\d{3})(?=\d)/g,i=10000,j=function(l){return (''+l).split('').reverse().join('');},k={formatIntegerWithDelimiter:function(l,m){if((g.locale=='nb_NO'||g.locale=='nn_NO')&&(Math.abs(l)<i))return l.toString();var n=j(l);return j(n.replace(h,'$1'+m));}};e.exports=k;});
__d("UFIBlingItem.react",["React","NumberFormat","cx","joinClasses"],function(a,b,c,d,e,f){var g=b('React'),h=b('NumberFormat'),i=b('cx'),j=b('joinClasses'),k=g.createClass({displayName:'UFIBlingItem',render:function(){var l=j(this.props.className,this.props.iconClassName,"UFIBlingBoxSprite"),m=h.formatIntegerWithDelimiter(this.props.count,this.props.contextArgs.numberdelimiter||',');return (g.DOM.span(null,g.DOM.i({className:l}),g.DOM.span({className:"UFIBlingBoxText"},m)));}});e.exports=k;});
__d("UFIBlingBox.react",["React","UFIBlingItem.react","UFIConstants","cx","tx"],function(a,b,c,d,e,f){var g=b('React'),h=b('UFIBlingItem.react'),i=b('UFIConstants'),j=b('cx'),k=b('tx'),l=g.createClass({displayName:'UFIBlingBox',render:function(){var m=[],n='';if(this.props.likes){m.push(h({count:this.props.likes,className:((m.length>0?"mls":'')),iconClassName:"UFIBlingBoxLikeIcon",contextArgs:this.props.contextArgs}));n+=(this.props.likes==1)?"1 like":k._("{count} likes",{count:this.props.likes});n+=' ';}if(this.props.comments){m.push(h({count:this.props.comments,className:((m.length>0?"mls":'')),iconClassName:"UFIBlingBoxCommentIcon",contextArgs:this.props.contextArgs}));n+=(this.props.comments==1)?"1 comment":k._("{count} comments",{count:this.props.comments});n+=' ';}if(this.props.reshares){m.push(h({count:this.props.reshares,className:((m.length>0?"mls":'')),iconClassName:"UFIBlingBoxReshareIcon",contextArgs:this.props.contextArgs}));n+=(this.props.reshares==1)?"1 share":k._("{count} shares",{count:this.props.reshares});}var o=g.DOM.a({className:"UFIBlingBox uiBlingBox feedbackBling",href:this.props.permalink,'data-ft':this.props['data-ft'],'aria-label':n},m);if(this.props.comments<i.defaultPageSize){o.props.onClick=this.props.onClick;o.props.rel='ignore';}return o;}});e.exports=l;});
__d("ImmutableObject",["invariant","merge","mergeInto","mergeHelpers"],function(a,b,c,d,e,f){var g=b('invariant'),h=b('merge'),i=b('mergeInto'),j=b('mergeHelpers'),k=j.checkMergeObjectArgs,l=j.isTerminal,m;function n(p){g(p instanceof m);}m=function p(q){i(this,q);};m.set=function(p,q){n(p);var r=new m(p);i(r,q);return r;};m.setField=function(p,q,r){var s={};s[q]=r;return m.set(p,s);};m.setDeep=function(p,q){n(p);return o(p,q);};function o(p,q){k(p,q);var r={},s=Object.keys(p);for(var t=0;t<s.length;t++){var u=s[t];if(!q.hasOwnProperty(u)){r[u]=p[u];}else if(l(p[u])||l(q[u])){r[u]=q[u];}else r[u]=o(p[u],q[u]);}var v=Object.keys(q);for(t=0;t<v.length;t++){var w=v[t];if(p.hasOwnProperty(w))continue;r[w]=q[w];}return (p instanceof m||q instanceof m)?new m(r):r;}e.exports=m;});
__d("UFIInstanceState",["UFICentralUpdates"],function(a,b,c,d,e,f){var g=b('UFICentralUpdates'),h={};function i(k){if(!h[k])h[k]={};}var j={getKeyForInstance:function(k,l){i(k);return h[k][l];},updateState:function(k,l,m){i(k);h[k][l]=m;g.didUpdateInstanceState(k,l);},updateStateField:function(k,l,m,n){var o=this.getKeyForInstance(k,l)||{};o[m]=n;this.updateState(k,l,o);}};e.exports=j;});
__d("UFIComments",["ClientIDs","ImmutableObject","JSLogger","KeyedCallbackManager","MercuryServerDispatcher","UFICentralUpdates","UFIConstants","UFIFeedbackTargets","UFIInstanceState","URI","invariant","merge","randomInt"],function(a,b,c,d,e,f){var g=b('ClientIDs'),h=b('ImmutableObject'),i=b('JSLogger'),j=b('KeyedCallbackManager'),k=b('MercuryServerDispatcher'),l=b('UFICentralUpdates'),m=b('UFIConstants'),n=b('UFIFeedbackTargets'),o=b('UFIInstanceState'),p=b('URI'),q=b('invariant'),r=b('merge'),s=b('randomInt'),t=i.create('UFIComments'),u={},v={},w={},x={},y={},z={},aa='unavailable_comment_key';function ba(ya){return ya in z?z[ya]:ya;}function ca(ya,za){if(!v[ya])v[ya]={};if(!v[ya][za])v[ya][za]=new j();return v[ya][za];}function da(ya){var za=[];if(v[ya])for(var ab in v[ya])za.push(v[ya][ab]);return za;}function ea(ya){if(!w[ya])w[ya]=new j();return w[ya];}function fa(ya){var za=da(ya);za.forEach(function(ab){ab.reset();});}function ga(ya,za){ya.forEach(function(ab){var bb=ab.ftentidentifier,cb=ab.parentcommentid||bb;n.getFeedbackTarget(bb,function(db){var eb=m.UFIPayloadSourceType,fb=ab.clientid,gb=false,hb=r({},ab);if(fb){delete hb.clientid;gb=g.isExistingClientID(fb);if(gb&&z[fb])return;}if(za===eb.LIVE_SEND&&ab.parentcommentid&&x[cb]===undefined)return;if((za===eb.LIVE_SEND)||(za===eb.USER_ACTION)||(za===eb.ENDPOINT_ADD_COMMENT)||(za===eb.ENDPOINT_EDIT_COMMENT))hb.isunseen=true;if(za===eb.ENDPOINT_COMMENT_FETCH||za===eb.ENDPOINT_ID_COMMENT_FETCH)hb.fromfetch=true;if(gb){if(u[fb].ufiinstanceid)o.updateStateField(u[fb].ufiinstanceid,'locallycomposed',ab.id,true);hb.ufiinstanceid=u[fb].ufiinstanceid;z[fb]=ab.id;u[ab.id]=u[fb];delete u[fb];l.didUpdateComment(fb);}var ib,jb;if(ab.parentcommentid){jb=[ea(cb)];}else jb=da(cb);var kb=false;jb.forEach(function(ob){var pb=ob.getAllResources(),qb={};for(var rb in pb){var sb=pb[rb];qb[sb]=rb;}if(gb)if(fb in qb){qb[ab.id]=qb[fb];var tb=qb[fb];ob.setResource(tb,ab.id);}if(qb[ab.id]){kb=true;}else{var ub=x[cb]||0;qb[ab.id]=ub;ob.setResource(ub,ab.id);}ib=qb[ab.id];});if(!kb){var lb=x[cb]||0;x[cb]=lb+1;oa(cb);}if(ab.status===m.UFIStatus.FAILED_ADD)y[cb]=y[cb]+1;var mb=x[cb];hb.replycount=(x[ab.id]||0)-(y[ab.id]||0);var nb=ha(ib,mb);if(ab.parentcommentid&&u[ab.parentcommentid]){hb.permalink=p(db.permalink).addQueryData({comment_id:u[ab.parentcommentid].legacyid,reply_comment_id:ab.legacyid,total_comments:mb}).toString();}else hb.permalink=p(db.permalink).addQueryData({comment_id:ab.legacyid,offset:nb,total_comments:mb}).toString();xa.setComment(ab.id,new h(hb));l.didUpdateComment(ab.id);l.didUpdateFeedback(bb);});});}function ha(ya,za){return Math.floor((za-ya-1)/m.defaultPageSize)*m.defaultPageSize;}function ia(ya){for(var za=0;za<ya.length;za++){var ab=ya[za];switch(ab.actiontype){case m.UFIActionType.COMMENT_LIKE:la(ab);break;case m.UFIActionType.DELETE_COMMENT:pa(ab);break;case m.UFIActionType.LIVE_DELETE_COMMENT:qa(ab);break;case m.UFIActionType.UNDO_DELETE_COMMENT:ra(ab);break;case m.UFIActionType.REMOVE_PREVIEW:sa(ab);break;case m.UFIActionType.COMMENT_SET_SPAM:ta(ab);break;case m.UFIActionType.CONFIRM_COMMENT_REMOVAL:ua(ab);break;case m.UFIActionType.TRANSLATE_COMMENT:ma(ab);break;}}}function ja(ya,za,ab){var bb=za.range,cb=za.values;if(!bb){t.error('nullrange',{target:ya,commentList:za});return;}var db={};for(var eb=0;eb<bb.length;eb++)db[bb.offset+eb]=cb[eb]||aa;var fb,gb;if(ab){fb=ca(ya,ab);gb=ya;}else{fb=ea(ya);gb=za.ftentidentifier;if(za.count!==undefined){x[ya]=za.count;y[ya]=0;}}fb.addResourcesAndExecute(db);l.didUpdateFeedback(gb);}function ka(ya){ya.forEach(function(za){x[za.entidentifier]=za.commentcount;y[za.entidentifier]=0;l.didUpdateFeedback(za.entidentifier);});}function la(ya){var za=xa.getComment(ya.commentid);if(za){var ab={},bb=ya.clientid&&g.isExistingClientID(ya.clientid);if(!bb){ab.hasviewerliked=ya.viewerliked;ab.likecount=ya.likecount;}ab.likeconfirmhash=s(0,1024);wa(ya.commentid,ab);}}function ma(ya){var za=ya.commentid,ab=xa.getComment(ya.commentid);if(ab)wa(za,{translatedtext:ya.translatedtext});}function na(ya){var za={reportLink:ya.reportLink,commenterIsFOF:ya.commenterIsFOF,userIsMinor:ya.userIsMinor};if(ya.undoData)za.undoData=ya.undoData;return za;}function oa(ya,za){if(ya){if(za!==undefined){var ab=(y[ya]||0)+(za?1:-1);y[ya]=Math.max(ab,0);}var bb=xa.getComment(ya);if(bb){var cb={replycount:xa.getDisplayedCommentCount(ya)};wa(ya,cb);}}}function pa(ya){var za=xa.getComment(ya.commentid);if(za.status!==m.UFIStatus.DELETED){var ab=za.parentcommentid||za.ftentidentifier;if(za.status===m.UFIStatus.FAILED_ADD){oa(ab);}else oa(ab,true);}va(za,m.UFIStatus.DELETED);}function qa(ya){var za=xa.getComment(ya.commentid);if(za&&za.status!==m.UFIStatus.DELETED)va(za,m.UFIStatus.LIVE_DELETED);}function ra(ya){var za=xa.getComment(ya.commentid);if(za.status===m.UFIStatus.DELETED){var ab=za.parentcommentid||za.ftentidentifier;oa(ab,false);}va(za,m.UFIStatus.PENDING_UNDO_DELETE);}function sa(ya){wa(ya.commentid,{attachment:null});}function ta(ya){var za=xa.getComment(ya.commentid),ab=ya.shouldHideAsSpam?m.UFIStatus.SPAM_DISPLAY:null;va(za,ab);}function ua(ya){wa(ya.commentid,na(ya));}function va(ya,za){wa(ya.id,{priorstatus:ya.status,status:za});}function wa(ya,za){var ab=xa.getComment(ya)||new h({});xa.setComment(ya,h.set(ab,za));l.didUpdateComment(ab.id);l.didUpdateFeedback(ab.ftentidentifier);}var xa={getComments:function(ya){var za={};for(var ab=0;ab<ya.length;ab++)za[ya[ab]]=xa.getComment(ya[ab]);return za;},getComment:function(ya){return u[ba(ya)];},setComment:function(ya,za){q(za instanceof h);u[ba(ya)]=za;},resetFeedbackTarget:function(ya){var za=da(ya),ab={};za.forEach(function(cb){var db=cb.getAllResources();for(var eb in db){var fb=db[eb];ab[fb]=1;}});for(var bb in ab)delete u[ba(bb)];fa(ya);},getCommentsInRange:function(ya,za,ab,bb,cb){var db=ca(ya,ab);n.getFeedbackTarget(ya,function(eb){var fb=[];for(var gb=0;gb<za.length;gb++)fb.push(za.offset+gb);var hb=function(nb){var ob=[],pb=za.offset,qb=za.offset+za.length-1;for(var rb=0;rb<za.length;rb++){var sb=eb.isranked?qb-rb:pb+rb;if(nb[sb]!=aa){var tb=this.getComment(nb[sb]);if(tb)ob.push(tb);}}cb(ob);},ib=db.getUnavailableResourcesFromRequest(fb);if(ib.length){var jb=Math.min.apply(Math,ib),kb=Math.max.apply(Math,ib),lb=jb,mb=kb-jb+1;k.trySend('/ajax/ufi/comment_fetch.php',{ft_ent_identifier:eb.entidentifier,viewas:bb,source:null,offset:lb,length:mb,orderingmode:ab});}else db.deferredExecuteOrEnqueue(fb).addCallback(hb,this);}.bind(this));},getRepliesInRanges:function(ya,za,ab){var bb={},cb={},db={},eb=false;n.getFeedbackTarget(ya,function(fb){for(var gb in za){var hb=ea(gb),ib=za[gb],jb=[];for(var kb=0;kb<ib.length;kb++)jb.push(ib.offset+kb);bb[gb]=hb.executeOrEnqueue(jb,function(ub){var vb=[];for(var wb=0;wb<ib.length;wb++){var xb=ib.offset+wb;if(ub[xb]!=aa){var yb=this.getComment(ub[xb]);if(yb)vb.push(yb);}}cb[gb]=vb;}.bind(this));db[gb]=hb.getUnavailableResources(bb[gb]);if(db[gb].length){eb=true;hb.unsubscribe(bb[gb]);}}if(!eb){ab(cb);}else{var lb=[],mb=[],nb=[];for(var ob in db){var pb=db[ob];if(pb.length){var qb=Math.min.apply(Math,pb),rb=Math.max.apply(Math,pb),sb=qb,tb=rb-qb+1;lb.push(ob);mb.push(sb);nb.push(tb);}}k.trySend('/ajax/ufi/reply_fetch.php',{ft_ent_identifier:fb.entidentifier,parent_comment_ids:lb,source:null,offsets:mb,lengths:nb});}}.bind(this));return bb;},getCommentCount:function(ya){return x[ya]||0;},getDeletedCount:function(ya){return y[ya]||0;},getDisplayedCommentCount:function(ya){return (x[ya]||0)-(y[ya]||0);},_dump:function(){var ya={_comments:u,_commentLists:v,_replyLists:w,_commentCounts:x,_deletedCounts:y,_localIDMap:z};return JSON.stringify(ya);}};k.registerEndpoints({'/ajax/ufi/comment_fetch.php':{mode:k.IMMEDIATE,handler:l.handleUpdate.bind(l,m.UFIPayloadSourceType.ENDPOINT_COMMENT_FETCH)},'/ajax/ufi/reply_fetch.php':{mode:k.IMMEDIATE,handler:l.handleUpdate.bind(l,m.UFIPayloadSourceType.ENDPOINT_COMMENT_FETCH)}});l.subscribe('update-comments',function(ya,za){if(za.comments&&za.comments.length)ga(za.comments,za.payloadsource);});l.subscribe('update-actions',function(ya,za){if(za.actions&&za.actions.length)ia(za.actions);});l.subscribe('update-comment-lists',function(ya,za){var ab=za.commentlists;if(ab&&Object.keys(ab).length){if(ab.comments)for(var bb in ab.comments)for(var cb in ab.comments[bb])ja(bb,ab.comments[bb][cb],cb);if(ab.replies)for(var db in ab.replies)ja(db,ab.replies[db]);}});l.subscribe('update-feedback',function(ya,za){var ab=za.feedbacktargets;if(ab&&ab.length)ka(ab);});e.exports=xa;});
__d("UFILikeLink.react",["React","TrackingNodes","tx"],function(a,b,c,d,e,f){var g=b('React'),h=b('TrackingNodes'),i=b('tx'),j=g.createClass({displayName:'UFILikeLink',render:function(){var k=this.props.likeAction?"Like":"Unlike",l=h.getTrackingInfo(this.props.likeAction?h.types.LIKE_LINK:h.types.UNLIKE_LINK),m=this.props.likeAction?"Like this":"Unlike this";return (g.DOM.a({className:"UFILikeLink",href:"#",role:"button",'aria-live':"polite",title:m,onClick:this.props.onClick,'data-ft':l},k));}});e.exports=j;});
__d("UFISubscribeLink.react",["React","tx"],function(a,b,c,d,e,f){var g=b('React'),h=b('tx'),i=g.createClass({displayName:'UFISubscribeLink',render:function(){var j=this.props.subscribeAction?"Follow Post":"Unfollow Post",k=this.props.subscribeAction?"Get notified when someone comments":"Stop getting notified when someone comments";return (g.DOM.a({className:"UFISubscribeLink",href:"#",role:"button",'aria-live':"polite",title:k,onClick:this.props.onClick},j));}});e.exports=i;});
__d("UFITimelineBlingBox.react",["ProfileBrowserLink","ProfileBrowserTypes","React","UFIBlingItem.react","URI","cx","fbt"],function(a,b,c,d,e,f){var g=b('ProfileBrowserLink'),h=b('ProfileBrowserTypes'),i=b('React'),j=b('UFIBlingItem.react'),k=b('URI'),l=b('cx'),m=b('fbt'),n=i.createClass({displayName:'UFITimelineBlingBox',render:function(){var o=[];if(this.props.likes&&this.props.enableShowLikes){var p=this._getProfileBrowserURI(),q="See who likes this",r=i.DOM.a({ajaxify:p.dialog,className:this._getItemClassName(o),'data-ft':this.props['data-ft'],'data-gt':this.props['data-gt'],'data-hover':"tooltip",'data-tooltip-alignh':"right",'data-tooltip-uri':this._getLikeToolTipURI(),href:p.page,rel:"dialog",role:"button",title:q},j({contextArgs:this.props.contextArgs,count:this.props.likes,iconClassName:"UFIBlingBoxTimelineLikeIcon"}));o.push(r);}if(this.props.comments&&this.props.enableShowComments){var s="Show comments",t=i.DOM.a({'aria-label':s,className:this._getItemClassName(o),'data-ft':this.props['data-ft'],'data-hover':"tooltip",'data-tooltip-alignh':"right",href:"#",onClick:this.props.commentOnClick},j({contextArgs:this.props.contextArgs,count:this.props.comments,iconClassName:"UFIBlingBoxTimelineCommentIcon"}));o.push(t);}if(this.props.reshares){var u="Show shares",v=this._getShareViewURI(),w=i.DOM.a({ajaxify:v.dialog,'aria-label':u,className:this._getItemClassName(o),'data-ft':this.props['data-ft'],'data-hover':"tooltip",'data-tooltip-alignh':"right",href:v.page,rel:"async"},j({contextArgs:this.props.contextArgs,count:this.props.reshares,iconClassName:"UFIBlingBoxTimelineReshareIcon"}));o.push(w);}return (i.DOM.span(null,o));},_getItemClassName:function(o){return ((o.length>0?"mls":'')+(' '+"UFIBlingBoxTimelineItem"));},_getLikeToolTipURI:function(){if(this.props.feedbackFBID){var o=new k('/ajax/timeline/likestooltip.php').setQueryData({obj_fbid:this.props.feedbackFBID});return o.toString();}else return null;},_getProfileBrowserURI:function(){if(this.props.feedbackFBID){var o=h.LIKES,p={id:this.props.feedbackFBID},q=g.constructDialogURI(o,p),r=g.constructPageURI(o,p),s={dialog:q.toString(),page:r.toString()};return s;}},_getShareViewURI:function(){if(this.props.feedbackFBID){var o=new k('/ajax/shares/view').setQueryData({target_fbid:this.props.feedbackFBID}),p=new k('/shares/view').setSubdomain('www').setQueryData({id:this.props.feedbackFBID}),q={dialog:o.toString(),page:p.toString()};return q;}}});e.exports=n;});
__d("UFIUserActions",["AsyncResponse","CLoggerX","ClientIDs","ImmutableObject","JSLogger","Nectar","UFICentralUpdates","UFIComments","UFIConstants","UFIFeedbackTargets","MercuryServerDispatcher","collectDataAttributes","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('AsyncResponse'),h=b('CLoggerX'),i=b('ClientIDs'),j=b('ImmutableObject'),k=b('JSLogger'),l=b('Nectar'),m=b('UFICentralUpdates'),n=b('UFIComments'),o=b('UFIConstants'),p=b('UFIFeedbackTargets'),q=b('MercuryServerDispatcher'),r=b('collectDataAttributes'),s=b('copyProperties'),t=b('tx'),u=k.create('UFIUserActions'),v={BAN:'ban',UNDO_BAN:'undo_ban'},w={changeCommentLike:function(ka,la,ma){var na=n.getComment(ka);if(na.hasviewerliked!=la){var oa=x(ma.target),pa=la?1:-1,qa={commentid:ka,actiontype:o.UFIActionType.COMMENT_LIKE,viewerliked:la,likecount:na.likecount+pa};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[qa]});q.trySend('/ajax/ufi/comment_like.php',s({comment_id:ka,legacy_id:na.legacyid,like_action:la,ft_ent_identifier:na.ftentidentifier,source:ma.source,client_id:i.getNewClientID()},oa));}},addComment:function(ka,la,ma,na){p.getFeedbackTarget(ka,function(oa){var pa=x(na.target),qa=i.getNewClientID();if(!oa.actorforpost)return;var ra={ftentidentifier:ka,body:{text:la},author:oa.actorforpost,id:qa,islocal:true,ufiinstanceid:na.ufiinstanceid,likecount:0,hasviewerliked:false,parentcommentid:na.replyid,attachment:na.attachedsticker,photo_comment:na.attachedphoto,timestamp:{time:Date.now(),text:"a few seconds ago"}},sa={actiontype:o.UFIActionType.SUBSCRIBE_ACTION,actorid:oa.actorforpost,hasviewersubscribed:true,entidentifier:ka};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{comments:[ra],actions:[sa]});var ta=null;if(na.replyid)ta=(n.getComment(na.replyid)).fbid;var ua=h.getCLParamsForTarget(na.target,ta);q.trySend('/ajax/ufi/add_comment.php',s({ft_ent_identifier:oa.entidentifier,comment_text:ma,source:na.source,client_id:qa,reply_fbid:ta,parent_comment_id:na.replyid,timeline_log_data:na.timelinelogdata,rootid:na.rootid,clp:ua,attached_sticker_fbid:na.attachedsticker?na.attachedsticker.fbid:0,attached_photo_fbid:na.attachedphoto?na.attachedphoto.fbid:0,giftoccasion:na.giftoccasion},pa));});},editComment:function(ka,la,ma,na){var oa=x(na.target),pa=n.getComment(ka);pa=j.set(pa,{status:o.UFIStatus.PENDING_EDIT,body:{text:la},timestamp:{time:Date.now(),text:"a few seconds ago"},originalTimestamp:pa.timestamp.time,editnux:null,attachment:na.attachedSticker,photo_comment:na.attachedPhoto});m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{comments:[pa]});q.trySend('/ajax/ufi/edit_comment.php',s({ft_ent_identifier:pa.ftentidentifier,comment_text:ma,source:na.source,comment_id:pa.id,parent_comment_id:pa.parentcommentid,attached_sticker_fbid:na.attachedSticker?na.attachedSticker.fbid:0,attached_photo_fbid:na.attachedPhoto?na.attachedPhoto.fbid:0},oa));},translateComment:function(ka,la){q.trySend('/ajax/ufi/translate_comment.php',{ft_ent_identifier:ka.ftentidentifier,comment_ids:[ka.id],source:la.source});},setHideAsSpam:function(ka,la,ma){var na=x(ma.target),oa=n.getComment(ka),pa={commentid:ka,actiontype:o.UFIActionType.COMMENT_SET_SPAM,shouldHideAsSpam:la};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[pa]});q.trySend('/ajax/ufi/comment_spam.php',s({comment_id:ka,spam_action:la,ft_ent_identifier:oa.ftentidentifier,source:ma.source},na));},removeComment:function(ka,la){var ma=x(la.target),na=n.getComment(ka),oa={actiontype:o.UFIActionType.DELETE_COMMENT,commentid:ka,oneclick:la.oneclick};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[oa]});q.trySend('/ajax/ufi/delete_comment.php',s({comment_id:na.id,comment_legacyid:na.legacyid,ft_ent_identifier:na.ftentidentifier,one_click:la.oneclick,source:la.source,client_id:i.getNewClientID(),timeline_log_data:la.timelinelogdata},ma));},undoRemoveComment:function(ka,la,ma){var na=n.getComment(ka);if(!na.undoData){u.error('noundodata',{comment:ka});return;}var oa=x(ma.target),pa={actiontype:o.UFIActionType.UNDO_DELETE_COMMENT,commentid:ka};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[pa]});var qa=na.undoData;qa.page_admin=la;var ra=s(oa,qa);q.trySend('/ajax/ufi/undo_delete_comment.php',ra);},banUser:function(ka,la,ma,na){var oa=ma?v.BAN:v.UNDO_BAN;q.trySend('/ajax/ufi/ban_user.php',{page_id:la,commenter_id:ka.author,action:oa,comment_id:ka.id,client_side:true});},changeLike:function(ka,la,ma){p.getFeedbackTarget(ka,function(na){var oa=x(ma.target);if(na.hasviewerliked!==la){var pa=la?1:-1,qa={actiontype:o.UFIActionType.LIKE_ACTION,actorid:na.actorforpost,hasviewerliked:la,likecount:na.likecount+pa,entidentifier:ka,likesentences:{current:na.likesentences.alternate,alternate:na.likesentences.current}};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[qa]});q.trySend('/ajax/ufi/like.php',s({like_action:la,ft_ent_identifier:ka,source:ma.source,client_id:i.getNewClientID(),rootid:ma.rootid,giftoccasion:ma.giftoccasion},oa));}});},changeSubscribe:function(ka,la,ma){p.getFeedbackTarget(ka,function(na){var oa=x(ma.target);if(na.hasviewersubscribed!==la){var pa={actiontype:o.UFIActionType.SUBSCRIBE_ACTION,actorid:na.actorforpost,hasviewersubscribed:la,entidentifier:ka};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[pa]});q.trySend('/ajax/ufi/subscribe.php',s({subscribe_action:la,ft_ent_identifier:ka,source:ma.source,client_id:i.getNewClientID(),rootid:ma.rootid,comment_expand_mode:ma.commentexpandmode},oa));}});},fetchSpamComments:function(ka,la,ma,na){q.trySend('/ajax/ufi/id_comment_fetch.php',{ft_ent_identifier:ka,viewas:na,comment_ids:la,parent_comment_id:ma,source:null});},removePreview:function(ka,la){var ma=x(la.target),na={commentid:ka.id,actiontype:o.UFIActionType.REMOVE_PREVIEW};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[na]});q.trySend('/ajax/ufi/remove_preview.php',s({comment_id:ka.id,ft_ent_identifier:ka.ftentidentifier,source:la.source},ma));}};function x(ka){if(!ka)return {ft:{}};var la={ft:r(ka,['ft']).ft};l.addModuleData(la,ka);return la;}function y(ka){var la=ka.request.data;g.defaultErrorHandler(ka);var ma=la.client_id||la.comment_id,na=n.getComment(ma),oa=(na.status===o.UFIStatus.PENDING_EDIT)?o.UFIStatus.FAILED_EDIT:o.UFIStatus.FAILED_ADD;na=j.setDeep(na,{status:oa,allowRetry:z(ka),body:{mentionstext:la.comment_text,mentionsphoto:na.photo_comment}});m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{comments:[na]});}function z(ka){var la=ka.getError();if(la===1404102)return false;if(ka.silentError)return true;if(la===1357012||la===1357006)return false;return true;}function aa(ka){var la=ka.request.data,ma=la.comment_id,na=n.getComment(ma);na=j.set(na,{status:na.priorstatus||null,priorstatus:undefined});m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{comments:[na]});}function ba(ka){var la=ka.request.data,ma=la.comment_id,na=n.getComment(ma);if(la.like_action===na.hasviewerliked){var oa=na.hasviewerliked?-1:1,pa={commentid:ma,actiontype:o.UFIActionType.COMMENT_LIKE,viewerliked:!na.hasviewerliked,likecount:na.likecount+oa};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[pa]});}g.defaultErrorHandler(ka);}function ca(ka){var la=ka.request.data,ma=la.ft_ent_identifier;p.getFeedbackTarget(ma,function(na){if(na.hasviewerliked===la.like_action){var oa=na.hasviewerliked?-1:1,pa={actiontype:o.UFIActionType.LIKE_ACTION,actorid:na.actorforpost,hasviewerliked:!na.hasviewerliked,likecount:na.likecount+oa,entidentifier:ma,likesentences:{current:na.likesentences.alternate,alternate:na.likesentences.current}};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[pa]});}});g.defaultErrorHandler(ka);}function da(ka){var la=ka.request.data,ma=la.ft_ent_identifier;p.getFeedbackTarget(ma,function(na){if(na.hasviewersubscribed===la.subscribe_action){var oa={actiontype:o.UFIActionType.SUBSCRIBE_ACTION,actorid:na.actorforpost,hasviewersubscribed:!na.hasviewersubscribed,entidentifier:ma};m.handleUpdate(o.UFIPayloadSourceType.USER_ACTION,{actions:[oa]});}});g.defaultErrorHandler(ka);}var ea=function(ka){return m.handleUpdate.bind(m,ka);},fa=o.UFIPayloadSourceType;q.registerEndpoints({'/ajax/ufi/comment_like.php':{mode:q.BATCH_CONDITIONAL,handler:ea(fa.ENDPOINT_COMMENT_LIKE),error_handler:ba,batch_if:ga,batch_function:ja},'/ajax/ufi/comment_spam.php':{mode:q.IMMEDIATE,handler:ea(fa.ENDPOINT_COMMENT_SPAM),error_handler:aa},'/ajax/ufi/add_comment.php':{mode:q.IMMEDIATE,handler:ea(fa.ENDPOINT_ADD_COMMENT),error_handler:y},'/ajax/ufi/delete_comment.php':{mode:q.IMMEDIATE,handler:ea(fa.ENDPOINT_DELETE_COMMENT),error_handler:aa},'/ajax/ufi/undo_delete_comment.php':{mode:q.IMMEDIATE,handler:ea(fa.ENDPOINT_UNDO_DELETE_COMMENT),error_handler:aa},'/ajax/ufi/ban_user.php':{mode:q.IMMEDIATE,handler:ea(fa.ENDPOINT_BAN)},'/ajax/ufi/edit_comment.php':{mode:q.IMMEDIATE,handler:ea(fa.ENDPOINT_EDIT_COMMENT),error_handler:y},'/ajax/ufi/like.php':{mode:q.BATCH_CONDITIONAL,handler:ea(fa.ENDPOINT_LIKE),error_handler:ca,batch_if:ha,batch_function:ja},'/ajax/ufi/subscribe.php':{mode:q.BATCH_CONDITIONAL,handler:ea(fa.ENDPOINT_SUBSCRIBE),error_handler:da,batch_if:ia,batch_function:ja},'/ajax/ufi/id_comment_fetch.php':{mode:q.IMMEDIATE,handler:ea(fa.ENDPOINT_ID_COMMENT_FETCH)},'/ajax/ufi/remove_preview.php':{mode:q.IMMEDIATE,handler:ea(fa.ENDPOINT_REMOVE_PREVIEW)},'/ajax/ufi/translate_comment.php':{mode:q.IMMEDIATE,handler:ea(fa.ENDPOINT_TRANSLATE_COMMENT)}});function ga(ka,la){return ka&&ka.ft_ent_identifier==la.ft_ent_identifier&&ka.comment_id==la.comment_id;}function ha(ka,la){return ka&&ka.ft_ent_identifier==la.ft_ent_identifier;}function ia(ka,la){return ka&&ka.ft_ent_identifier==la.ft_ent_identifier;}function ja(ka,la){return la;}e.exports=w;});
__d("UFIActionLinkController",["Arbiter","ClickTTIIdentifiers","CSS","DOMQuery","Parent","PubcontentFeedChainingController","React","TrackingNodes","UFIBlingBox.react","UFICentralUpdates","UFIComments","UFIConstants","UFIFeedbackTargets","UFILikeLink.react","UFISubscribeLink.react","UFITimelineBlingBox.react","UFIUserActions","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ClickTTIIdentifiers'),i=b('CSS'),j=b('DOMQuery'),k=b('Parent'),l=b('PubcontentFeedChainingController'),m=b('React'),n=b('TrackingNodes'),o=b('UFIBlingBox.react'),p=b('UFICentralUpdates'),q=b('UFIComments'),r=b('UFIConstants'),s=b('UFIFeedbackTargets'),t=b('UFILikeLink.react'),u=b('UFISubscribeLink.react'),v=b('UFITimelineBlingBox.react'),w=b('UFIUserActions'),x=b('copyProperties');function y(aa,ba,ca){if(this._root)throw new Error('UFIActionLinkController attempted to initialize when a root was'+' already present');var da=j.scry(aa,ba)[0];if(da){var ea=document.createElement('span');da.parentNode.replaceChild(ea,da);ea.appendChild(da);if(typeof ca==="function")ca(ea);}else var fa=g.subscribe('PhotoSnowlift.DATA_CHANGE',function(){g.unsubscribe(fa);y(aa,ba,ca);},g.SUBSCRIBE_NEW);}var z=function(aa,ba,ca){this._id=ba.ftentidentifier;this._ftFBID=ca.targetfbid;this._source=ba.source;this._contextArgs=ba;this._ufiRoot=aa;if(this._isSourceProfile(this._contextArgs.source)){this._attemptInitializeTimelineBling();}else this._attemptInitializeBling();if(ca.viewercanlike)this._attemptInitializeLike();if(ca.viewercansubscribetopost)this._attemptInitializeSubscribe();p.subscribe('feedback-updated',function(da,ea){var fa=ea.updates;if(this._id in fa)this.render();}.bind(this));p.subscribe('feedback-id-changed',function(da,ea){var fa=ea.updates;if(this._id in fa)this._id=fa[this._id];}.bind(this));};x(z.prototype,{_attemptInitializeBling:function(){y(this._ufiRoot,'^form .uiBlingBox',function(aa){this._blingRoot=aa;if(this._dataReady)this._renderBling();}.bind(this));},_attemptInitializeTimelineBling:function(){if(this._root)throw new Error('UFIActionLinkController attempted to initialize when a root was'+' already present');var aa=j.scry(this._ufiRoot,'^form .fbTimelineFeedbackActions span')[0];if(aa){i.addClass(aa,"UFIBlingBoxTimeline");var ba=j.scry(aa,'.fbTimelineFeedbackLikes')[0];this._enableShowLikes=ba?true:false;var ca=j.scry(aa,'.fbTimelineFeedbackComments')[0];this._enableShowComments=ca?true:false;}this._blingTimelineRoot=aa;if(this._dataReady)this._renderTimelineBling();},_attemptInitializeLike:function(){y(this._ufiRoot,'^form .like_link',function(aa){this._likeRoot=aa;if(this._dataReady)this._renderLike();}.bind(this));},_attemptInitializeSubscribe:function(){y(this._ufiRoot,'^form .unsub_link',function(aa){this._subscribeRoot=aa;if(this._dataReady)this._renderSubscribe();}.bind(this));},render:function(){this._dataReady=true;if(this._isSourceProfile(this._contextArgs.source)){this._renderTimelineBling();}else this._renderBling();this._renderLike();this._renderSubscribe();},_renderBling:function(){if(this._blingRoot)s.getFeedbackTarget(this._id,function(aa){var ba=function(event){var ea=k.byTag(event.target,"form");i.toggleClass(ea,"collapsed_comments");i.toggleClass(ea,"hidden_add_comment");event.preventDefault();}.bind(this),ca=n.getTrackingInfo(n.types.BLINGBOX),da=o({likes:aa.likecount,comments:q.getDisplayedCommentCount(this._id),reshares:aa.sharecount,permalink:aa.permalink,contextArgs:this._contextArgs,onClick:ba,'data-ft':ca});this._blingBox=m.renderComponent(da,this._blingRoot);}.bind(this));},_renderTimelineBling:function(){if(this._blingTimelineRoot)s.getFeedbackTarget(this._id,function(aa){var ba=n.getTrackingInfo(n.types.BLINGBOX),ca=h.getUserActionID(h.types.TIMELINE_SEE_LIKERS),da=function(event){var fa=k.byTag(event.target,"form");i.removeClass(fa,"collapsed_comments");var ga=j.scry(fa,'a.UFIPagerLink');if(ga.length)ga[0].click();event.preventDefault();}.bind(this),ea=v({comments:q.getDisplayedCommentCount(this._id),commentOnClick:da,contextArgs:this._contextArgs,'data-ft':ba,'data-gt':ca,enableShowComments:this._enableShowComments,enableShowLikes:this._enableShowLikes,feedbackFBID:this._ftFBID,likes:aa.likecount,reshares:aa.sharecount});m.renderComponent(ea,this._blingTimelineRoot);}.bind(this));},_renderLike:function(){if(this._likeRoot)s.getFeedbackTarget(this._id,function(aa){var ba=!aa.hasviewerliked,ca=function(event){if(ba)l.onExplicitLike(this._id,event.target);w.changeLike(this._id,ba,{source:this._source,target:event.target,rootid:this._contextArgs.rootid,giftoccasion:this._contextArgs.giftoccasion});event.preventDefault();}.bind(this),da=t({onClick:ca,likeAction:ba});this._likeLink=m.renderComponent(da,this._likeRoot);}.bind(this));},_renderSubscribe:function(){if(this._subscribeRoot)s.getFeedbackTarget(this._id,function(aa){var ba=!aa.hasviewersubscribed,ca=function(event){w.changeSubscribe(this._id,ba,{source:this._source,target:event.target,rootid:this._contextArgs.rootid,commentexpandmode:aa.commentexpandmode});event.preventDefault();}.bind(this),da=u({onClick:ca,subscribeAction:ba});this._subscribeLink=m.renderComponent(da,this._subscribeRoot);}.bind(this));},_isSourceProfile:function(aa){return aa===r.UFIFeedbackSourceType.PROFILE;}});e.exports=z;});
__d("MentionsInputUtils",[],function(a,b,c,d,e,f){var g={generateDataFromTextWithEntities:function(h){var i=h.text,j=[];(h.ranges||[]).forEach(function(l){var m=l.entities[0];if(!m.external)j.push({uid:m.id,text:i.substr(l.offset,l.length),offset:l.offset,length:l.length,weakreference:!!m.weakreference});});var k={value:i,mentions:j};return k;}};e.exports=g;});
__d("ClipboardPhotoUploader",["ArbiterMixin","AsyncRequest","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('copyProperties');function j(k,l){this.uploadURIString=k;this.data=l;}i(j.prototype,g,{handlePaste:function(event){if(!event.clipboardData)return;var k=event.clipboardData.items;if(!k)return;for(var l=0;l<k.length;++l){var m=k[l];if(m.kind==='file'&&m.type.indexOf('image/')!==-1){var n=new FormData();n.append('pasted_file',m.getAsFile());var o=new h();o.setURI(this.uploadURIString).setData(this.data).setRawData(n).setHandler(function(p){this.inform('upload_success',p);}.bind(this)).setErrorHandler(function(p){this.inform('upload_error',p);}.bind(this));this.inform('upload_start');o.send();break;}}}});e.exports=j;});
__d("LitestandStoryInsertionStatus",["ArbiterMixin","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('copyProperties'),i='check',j={registerBlocker:function(k){return j.subscribe(i,function(l,m){if(m.can_insert&&k())m.can_insert=false;});},canInsert:function(){var k={can_insert:true};j.inform(i,k);return k.can_insert;}};h(j,g);e.exports=j;});
__d("LegacyMentionsInput.react",["PlaceholderListener","Bootloader","Event","Keys","React","cx"],function(a,b,c,d,e,f){b('PlaceholderListener');var g=b('Bootloader'),h=b('Event'),i=b('Keys'),j=b('React'),k=b('cx'),l=j.createClass({displayName:'ReactLegacyMentionsInput',componentDidMount:function(m){this.props.initialData&&this._initializeTextarea(m);},hasEnteredText:function(){return !!(this._mentionsInput&&this._mentionsInput.getValue().trim());},_handleKeydown:function(event){var m=event.nativeEvent,n=this.props.onEnterSubmit,o=h.getKeyCode(m)==i.RETURN&&!h.$E(m).getModifiers().any,p=this._mentionsInput&&this._mentionsInput.getTypeahead().getView().getSelection();if(n&&o&&!p){if(this.props.isLoadingPhoto)return false;var q=event.target,r=q.value&&q.value.trim();if(r||this.props.acceptEmptyInput){var s={visibleValue:r,encodedValue:r,attachedPhoto:null};if(this._mentionsInput){s.encodedValue=this._mentionsInput.getRawValue().trim();this._mentionsInput.reset();}n(s,event);}event.preventDefault();}},_handleFocus:function(){this.props.onFocus&&this.props.onFocus();this._initializeTextarea(this.refs.root.getDOMNode());},_handleBlur:function(){this.props.onBlur&&this.props.onBlur();},_initializeTextarea:function(m){if(this._mentionsInput||this._bootloadingMentions)return;this._bootloadingMentions=true;g.loadModules(['CompactTypeaheadRenderer','ContextualTypeaheadView','InputSelection','MentionsInput','TextAreaControl','Typeahead','TypeaheadAreaCore','TypeaheadBestName','TypeaheadHoistFriends','TypeaheadMetrics','TypingDetector'],function(n,o,p,q,r,s,t,u,v,w,x){var y=this.refs.textarea.getDOMNode();new r(y);if(this.props.onTypingStateChange){var z=new x(y);z.init();z.subscribe('change',this.props.onTypingStateChange);}var aa={autoSelect:true,renderer:n,causalElement:y};if(this.props.viewOptionsTypeObjects)aa.typeObjects=this.props.viewOptionsTypeObjects;if(this.props.viewOptionsTypeObjectsOrder)aa.typeObjectsOrder=this.props.viewOptionsTypeObjectsOrder;var ba=new s(this.props.datasource,{ctor:o,options:aa},{ctor:t},this.refs.typeahead.getDOMNode()),ca=[u,v],da=new w({extraData:{event_name:'mentions'}});s.initNow(ba,ca,da);this._mentionsInput=new q(m,ba,y,{hashtags:this.props.sht});this._mentionsInput.init({max:6},this.props.initialData);if(this.props.initialData)p.set(y,y.value.length);if(this.props.onPaste)h.listen(y,'paste',this.props.onPaste);this._bootloadingMentions=false;}.bind(this));},focus:function(){try{this.refs.textarea.getDOMNode().focus();}catch(m){}},render:function(){var m=(("textInput")+(' '+"mentionsTextarea")+(' '+"uiTextareaAutogrow")+(' '+"uiTextareaNoResize")+(' '+"UFIAddCommentInput")+(' '+"DOMControl_placeholder"));return (j.DOM.div({ref:"root",className:"uiMentionsInput textBoxContainer ReactLegacyMentionsInput"},j.DOM.div({className:"highlighter"},j.DOM.div(null,j.DOM.span({className:"highlighterContent hidden_elem"}))),j.DOM.div({ref:"typeahead",className:"uiTypeahead mentionsTypeahead"},j.DOM.div({className:"wrap"},j.DOM.input({type:"hidden",autocomplete:"off",className:"hiddenInput"}),j.DOM.div({className:"innerWrap"},j.DOM.textarea({ref:"textarea",name:"add_comment_text",className:m,title:this.props.placeholder,placeholder:this.props.placeholder,onFocus:this._handleFocus,onBlur:this._handleBlur,onKeyDown:this._handleKeydown,defaultValue:this.props.placeholder})))),j.DOM.input({type:"hidden",autocomplete:"off",className:"mentionsHidden",defaultValue:""})));}});e.exports=l;});
__d("UFIStickerButton.react",["AsyncRequest","Bootloader","DOM","React","fbt"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Bootloader'),i=b('DOM'),j=b('React'),k=b('fbt'),l=null,m=null,n=null,o=j.createClass({displayName:'UFIStickerButton',render:function(){var s="Attach a Sticker";return (j.DOM.div({className:"UFICommentStickerButton",'data-hover':"tooltip",'data-tooltip-alignh':"center",'aria-label':s,onClick:p.bind(this,this)},j.DOM.div({className:"UFICommentStickerIcon"})));},componentDidMount:function(s){this._button=s;},_onStickerSelected:function(s){this.props.onStickerSelected(s);}});o.initDialog=function(s){l=s;if(m.isShown()){m.hide();l.showAtButton(n);}};function p(s){if(!l){r(s);return;}l.showAtButton(s);}function q(){var s=l||m;if(s)s.hide();n=null;}function r(s){h.loadModules(['ContextualDialog','LayerHideOnBlur'],function(t,u){if(!m){m=new t({addedBehaviors:[u]},i.create('img',{className:'UFICommentStickerLoadingDialog',src:'/images/loaders/indicator_blue_medium.gif'}));new g('/ajax/ufi/emoticons_dialog').setErrorHandler(function(){q();m=null;}).send();}n=s;m.setContext(s.getDOMNode()).show();});}e.exports=o;});
__d("UFIAddComment.react",["AsyncRequest","Bootloader","CLogConfig","ClipboardPhotoUploader","CloseButton.react","Event","Keys","LitestandStoryInsertionStatus","LoadingIndicator.react","React","LegacyMentionsInput.react","Run","TrackingNodes","UFIClassNames","UFIImageBlock.react","UFIStickerButton.react","cx","fbt","joinClasses","tx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Bootloader'),i=b('CLogConfig'),j=b('ClipboardPhotoUploader'),k=b('CloseButton.react'),l=b('Event'),m=b('Keys'),n=b('LitestandStoryInsertionStatus'),o=b('LoadingIndicator.react'),p=b('React'),q=b('LegacyMentionsInput.react'),r=b('Run'),s=b('TrackingNodes'),t=b('UFIClassNames'),u=b('UFIImageBlock.react'),v=b('UFIStickerButton.react'),w=b('cx'),x=b('fbt'),y=b('joinClasses'),z=b('tx'),aa="Write a comment...",ba="Write a reply...",ca="fcg fss UFICommentTip",da=19,ea='/ajax/ufi/upload/',fa='/ajax/ufi/sticker_preview/',ga=p.createClass({displayName:'UFIAddComment',getInitialState:function(){if(this.props.attachedPhoto)this.props.contextArgs.attachedphoto=this.props.attachedPhoto;if(this.props.attachedSticker)this.props.contextArgs.attachedsticker=this.props.attachedSticker;return {attachedPhoto:this.props.attachedPhoto?this.props.attachedPhoto:null,attachedSticker:this.props.attachedSticker?this.props.attachedSticker:null,isCommenting:false,isLoadingPhoto:false,isOnBeforeUnloadListenerAdded:false};},_onKeyDown:function(event){if(this.props.isEditing&&l.getKeyCode(event.nativeEvent)===m.ESC)this.props.onCancel();if(this.isMounted()&&!this.state.isOnBeforeUnloadListenerAdded){r.onBeforeUnload(this._handleUnsavedChanges);this.setState({isOnBeforeUnloadListenerAdded:true});}},_handleUnsavedChanges:function(){var ha=a.PageTransitions;if(ha){var ia=ha.getNextURI(),ja=ha.getMostRecentURI();if(ia.getQueryData().hasOwnProperty('theater')||ja.getQueryData().hasOwnProperty('theater'))return;}if(this.refs&&this.refs.mentionsinput&&this.refs.mentionsinput.hasEnteredText())return "You haven't finished your comment yet. Do you want to leave without finishing?";},_blur:function(){if(this.refs.mentionsinput&&this.refs.mentionsinput.hasEnteredText())return;this.setState({isCommenting:false});},_onPaste:function(event){var ha=new j(ea,this._getPhotoUploadData());this._cancelCurrentSubscriptions();this._subscriptions=[ha.subscribe('upload_start',this._prepareForAttachedPhotoPreview),ha.subscribe('upload_error',this._onRemoveAttachedPhotoPreviewClicked),ha.subscribe('upload_success',function(ia,ja){this._onPhotoUploadComplete(ja);}.bind(this))];ha.handlePaste(event);},_cancelCurrentSubscriptions:function(){if(this._subscriptions)this._subscriptions.forEach(function(ha){ha.unsubscribe();});},componentWillMount:function(){this._storyInsertionBlocker=n.registerBlocker(function(){return this.state.isCommenting;}.bind(this));},componentWillUnmount:function(){this._cancelCurrentSubscriptions();this._storyInsertionBlocker&&this._storyInsertionBlocker.unsubscribe();this._storyInsertionBlocker=null;},focus:function(){if(this.refs&&this.refs.mentionsinput)this.refs.mentionsinput.focus();},render:function(){var ha=!this.props.contextArgs.collapseaddcomment||this.state.isCommenting,ia=null;if(this.props.isEditing){ia=p.DOM.span({className:ca},"Press Esc to cancel.");}else if(this.props.showSendOnEnterTip){ia=p.DOM.span({className:ca},"Press Enter to post.");}else if(this.props.subtitle)ia=p.DOM.span({className:ca},this.props.subtitle);var ja=null,ka=null,la=this.state.attachedPhoto||this.state.attachedSticker,ma=null;if(this.props.allowStickerAttachments&&!la)ka=v({onStickerSelected:this._prepareForAttachedStickerPreview});if(this.props.allowPhotoAttachments){ma=this._onPaste;var na="Choose a file to upload",oa=p.DOM.input({ref:"PhotoInput",accept:"image/*",className:"_n",name:"file[]",type:"file",multiple:false,title:na}),pa=la?"UFICommentPhotoAttachedIcon":"UFICommentPhotoIcon",qa="UFIPhotoAttachLinkWrapper _m";ja=p.DOM.div({ref:"PhotoInputContainer",className:qa,'data-hover':"tooltip",'data-tooltip-alignh':"center",'aria-label':"Attach a Photo"},p.DOM.i({ref:"PhotoInputControl",className:pa}),oa);}var ra=s.getTrackingInfo(s.types.ADD_COMMENT_BOX),sa=y(t.ACTOR_IMAGE,((!ha?"hidden_elem":''))),ta=p.DOM.div({className:"UFIReplyActorPhotoWrapper"},p.DOM.img({className:sa,src:this.props.viewerActor.thumbSrc})),ua=y(t.ROW,((this.props.hide?"noDisplay":'')+(' '+"UFIAddComment")+(this.props.allowPhotoAttachments?' '+"UFIAddCommentWithPhotoAttacher":'')+(this.props.withoutSeparator?' '+"UFIAddCommentWithoutSeparator":'')+(this.props.isFirstComponent?' '+"UFIFirstComponent":'')+(this.props.isLastComponent?' '+"UFILastComponent":''))),va=!!this.props.replyCommentID?ba:aa,wa=this.props.contextArgs.entstream?this._blur:null,xa=this.props.contextArgs.viewoptionstypeobjects,ya=this.props.contextArgs.viewoptionstypeobjectsorder,za=null,ab=this.props.onCommentSubmit;if(la){za=p.DOM.div({isStatic:true,dangerouslySetInnerHTML:la.markupPreview?la.markupPreview:la.markup});ia=null;}else if(this.state.isLoadingPhoto)za=o({color:"white",className:"UFICommentPhotoAttachedPreviewLoadingIndicator",size:"medium"});var bb,cb=this.state.attachedPhoto?this._onRemoveAttachedPhotoPreviewClicked:this._onRemoveAttachedStickerPreviewClicked;if(za!=null){bb=p.DOM.div({className:"UFICommentPhotoAttachedPreview pas"},za,k({tooltip:"Remove Photo",onClick:cb}));ab=function(eb,event){this.setState({isLoadingPhoto:false,attachedPhoto:null,attachedSticker:null});eb.attachedPhoto=this.props.contextArgs.attachedphoto;eb.attachedSticker=this.props.contextArgs.attachedsticker;this.props.onCommentSubmit(eb,event);}.bind(this);}var db=this.props.allowStickerAttachments?y("UFIMentionsInputWrap","UFIStickersEnabledInput"):"UFIMentionsInputWrap";return (p.DOM.li({className:ua,onKeyDown:this._onKeyDown,'data-ft':ra},u({className:db},ta,p.DOM.div(null,q({initialData:this.props.initialData,placeholder:va,ref:"mentionsinput",datasource:this.props.mentionsDataSource,acceptEmptyInput:this.props.isEditing||la,onEnterSubmit:ab,onFocus:this.setState.bind(this,{isCommenting:true},null),viewOptionsTypeObjects:xa,viewOptionsTypeObjectsOrder:ya,onBlur:wa,onTypingStateChange:this.props.onTypingStateChange,onPaste:ma,sht:this.props.contextArgs.sht,isLoadingPhoto:this.state.isLoadingPhoto}),ja,ka,bb,ia))));},componentDidMount:function(ha){if(i.gkResults){var ia=this.props.replyCommentID;if(this.refs&&this.refs.mentionsinput){var ja=this.refs.mentionsinput.refs.textarea.getDOMNode();h.loadModules(['CLoggerX','UFIComments'],function(oa,pa){var qa=pa.getComment(ia),ra=qa?qa.fbid:null;oa.trackMentionsInput(ja,ra);});}}if(!this.props.allowPhotoAttachments)return;var ka=this.refs.PhotoInputContainer.getDOMNode(),la=this.refs.PhotoInputControl.getDOMNode(),ma=this.refs.PhotoInput.getDOMNode(),na=l.listen(ka,'click',function(event){h.loadModules(['FileInput','FileInputUploader','Input'],function(oa,pa,qa){var ra=new oa(ka,la,ma),sa=new pa().setURI(ea).setData(this._getPhotoUploadData());ra.subscribe('change',function(event){if(ra.getValue()){this._prepareForAttachedPhotoPreview();sa.setInput(ra.getInput()).send();}}.bind(this));sa.subscribe('success',function(ta,ua){ra.clear();this._onPhotoUploadComplete(ua.response);}.bind(this));}.bind(this));na.remove();}.bind(this));},_getPhotoUploadData:function(){return {profile_id:this.props.viewerActor.id,target_id:this.props.targetID,source:da};},_onPhotoUploadComplete:function(ha){if(!this.state.isLoadingPhoto)return;var ia=ha.getPayload();if(ia&&ia.fbid){this.props.contextArgs.attachedphoto=ia;this.setState({attachedPhoto:ia,isLoadingPhoto:false});}},_onRemoveAttachedPhotoPreviewClicked:function(event){this.props.contextArgs.attachedphoto=null;this.setState({attachedPhoto:null,isLoadingPhoto:false});},_prepareForAttachedPhotoPreview:function(){this.props.contextArgs.attachedphoto=null;this.setState({attachedPhoto:null,isLoadingPhoto:true});},_onStickerUploadComplete:function(ha){if(!this.state.isLoadingPhoto)return;var ia=ha.getPayload();if(ia&&ia.fbid){this.props.contextArgs.attachedsticker=ia;this.setState({attachedSticker:ia,isLoadingPhoto:false});}},_onRemoveAttachedStickerPreviewClicked:function(event){this.props.contextArgs.attachedsticker=null;this.setState({attachedSticker:null,isLoadingPhoto:false});},_prepareForAttachedStickerPreview:function(ha){this.props.contextArgs.attachedsticker=null;this.setState({attachedSticker:null,isLoadingPhoto:true});new g(fa).setData({sticker_id:ha}).setErrorHandler(this._onRemoveAttachedStickerPreviewClicked).setHandler(this._onStickerUploadComplete).send();}});e.exports=ga;});
__d("UFIAddCommentController",["Arbiter","copyProperties","MentionsInputUtils","Parent","UFIAddComment.react","React","ShortProfiles","UFICentralUpdates","UFIComments","UFIFeedbackTargets","UFIInstanceState","UFIUserActions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('MentionsInputUtils'),j=b('Parent'),k=b('UFIAddComment.react'),l=b('React'),m=b('ShortProfiles'),n=b('UFICentralUpdates'),o=b('UFIComments'),p=b('UFIFeedbackTargets'),q=b('UFIInstanceState'),r=b('UFIUserActions');function s(t,u,v,w){this.id=u;this._ufiInstanceID=w.instanceid;this._contextArgs=w;this._replyCommentID=v;if(t){this.root=t;if(!this._contextArgs.rootid)this._contextArgs.rootid=t.id;this.render();n.subscribe('instance-updated',function(x,y){var z=y.updates;if(this._ufiInstanceID in z)this.render();}.bind(this));}n.subscribe('feedback-id-changed',function(x,y){var z=y.updates;if(this.id in z)this.id=z[this.id];}.bind(this));}h(s.prototype,{_onCommentSubmit:function(t,event){r.addComment(this.id,t.visibleValue,t.encodedValue,{source:this._contextArgs.source,ufiinstanceid:this._ufiInstanceID,target:event.target,replyid:this._replyCommentID,timelinelogdata:this._contextArgs.timelinelogdata,rootid:this._contextArgs.rootid,attachedphoto:this._contextArgs.attachedphoto,attachedsticker:this._contextArgs.attachedsticker,giftoccasion:this._contextArgs.giftoccasion});this._contextArgs.attachedphoto=null;p.getFeedbackTarget(this.id,function(u){var v=j.byTag(this.root,'form');if(v)g.inform('ufi/comment',{form:v,isranked:u.isranked});}.bind(this));return false;},_onTypingStateChange:function(t,u){},renderAddComment:function(t,u,v,w,x,y,z,aa,ba){var ca=this._contextArgs.logtyping?this._onTypingStateChange.bind(this):null,da=null,ea=q.getKeyForInstance(this._ufiInstanceID,'isediting')&&!this._replyCommentID;return (k({hide:ea,replyCommentID:this._replyCommentID,viewerActor:t,targetID:u,initialData:da,ref:x,withoutSeparator:y,onCommentSubmit:this._onCommentSubmit.bind(this),mentionsDataSource:v,onTypingStateChange:ca,showSendOnEnterTip:w,allowPhotoAttachments:aa,allowStickerAttachments:ba,source:this._contextArgs.source,contextArgs:this._contextArgs,subtitle:z}));},renderEditComment:function(t,u,v,w,x,y,z,aa){var ba=o.getComment(v),ca;if(ba.attachment)ca=ba.attachment.type=='sticker'?ba.attachment:null;var da=i.generateDataFromTextWithEntities(ba.body);return (k({viewerActor:t,targetID:u,initialData:da,onCommentSubmit:x,onCancel:y,mentionsDataSource:w,source:this._contextArgs.source,contextArgs:this._contextArgs,isEditing:true,editingCommentID:v,attachedPhoto:ba.photo_comment,attachedSticker:ca,allowPhotoAttachments:z,allowStickerAttachments:aa}));},render:function(){if(!this.root)throw new Error('render called on UFIAddCommentController with no root');p.getFeedbackTarget(this.id,function(t){if(t.cancomment&&t.actorforpost)m.get(t.actorforpost,function(u){var v=this.renderAddComment(u,t.ownerid,t.mentionsdatasource,t.showsendonentertip,null,null,t.subtitle,t.allowphotoattachments,t.allowstickerattachments);this._addComment=l.renderComponent(v,this.root);}.bind(this));}.bind(this));}});e.exports=s;});
__d("LegacyScrollableArea.react",["Scrollable","Bootloader","React","Style","cx"],function(a,b,c,d,e,f){b('Scrollable');var g=b('Bootloader'),h=b('React'),i=b('Style'),j=b('cx'),k="uiScrollableArea native",l="uiScrollableAreaWrap scrollable",m="uiScrollableAreaBody",n="uiScrollableAreaContent",o=h.createClass({displayName:'ReactLegacyScrollableArea',render:function(){var p={height:this.props.height?this.props.height+'px':'auto'};return this.transferPropsTo(h.DOM.div({className:k,ref:"root",style:p},h.DOM.div({className:l},h.DOM.div({className:m,ref:"body"},h.DOM.div({className:n},this.props.children)))));},getArea:function(){return this._area;},componentDidMount:function(){g.loadModules(['ScrollableArea'],this._loadScrollableArea);},_loadScrollableArea:function(p){this._area=p.fromNative(this.refs.root.getDOMNode(),{fade:this.props.fade,persistent:this.props.persistent,shadow:this.props.shadow===undefined?true:this.props.shadow});var q=this.refs.body.getDOMNode();i.set(q,'width',this.props.width+'px');this.props.onScroll&&this._area.subscribe('scroll',this.props.onScroll);}});e.exports=o;});
__d("UFIAddCommentLink.react",["React","UFIClassNames","cx","joinClasses","tx"],function(a,b,c,d,e,f){var g=b('React'),h=b('UFIClassNames'),i=b('cx'),j=b('joinClasses'),k=b('tx'),l=g.createClass({displayName:'UFIAddCommentLink',render:function(){var m=j(h.ROW,(("UFIAddCommentLink")+(this.props.isFirstCommentComponent?' '+"UFIFirstCommentComponent":'')+(this.props.isLastCommentComponent?' '+"UFILastCommentComponent":'')+(this.props.isFirstComponent?' '+"UFIFirstComponent":'')+(this.props.isLastComponent?' '+"UFILastComponent":''))),n="Write a comment...";return (g.DOM.li({className:m,'data-ft':this.props['data-ft']},g.DOM.a({className:"UFICommentLink",onClick:this.props.onClick,href:"#",role:"button"},n)));}});e.exports=l;});
__d("PubContentTypes",[],function(a,b,c,d,e,f){var g={HASHTAG:'hashtag',TOPIC:'topic',MINUTIAE:'minutiae',URL:'url'};e.exports=g;});
__d("HovercardLinkInterpolator",["Bootloader","CSS","HovercardLink","Link.react","PubContentTypes","React","URI","cx"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('CSS'),i=b('HovercardLink'),j=b('Link.react'),k=b('PubContentTypes'),l=b('React'),m=b('URI'),n=b('cx');function o(p,q,r,s,t){var u=q.entities[0],v=r||(u.external?'_blank':null),w,x=((!u.external?"profileLink":'')+(u.weakreference?' '+"weakReference":''));if(u.hashtag){var y=h.hasClass(document.body,"_6nw"),z=null;if(y){z={type:k.HASHTAG,id:u.id,source:'comment'};}else z={id:u.id};var aa=new m(u.url).setSubdomain('www'),ba=function(ca,da){ca.setupLink(da,{type:k.HASHTAG,id:u.id,source:'comment',name:p,href:aa.getUnqualifiedURI().toString()});};if(y){g.loadModules(['EntstreamLayerPageController','EntstreamPubContentOverlay'],ba);}else g.loadModules(['HashtagLayerPageController','HashtagLayerPageController'],ba);w=l.DOM.a({className:"_58cn",'data-pub':JSON.stringify(z),href:aa.toString()},l.DOM.span({className:"_58cl"},p.substring(0,1)),l.DOM.span({className:"_58cm"},p.substring(1)));}else if(u.weakreference){w=j({className:x,href:u,target:v},l.DOM.i({className:"UFIWeakReferenceIcon"}),p);}else w=j({className:x,href:u,target:v},p);if(!u.external&&!u.hashtag)w.props['data-hovercard']=i.constructEndpointWithGroupAndLocation(u,s,t).toString();return w;}e.exports=o;});
__d("LinkButton",["cx","React"],function(a,b,c,d,e,f){var g=b('cx'),h=b('React'),i=function(j){var k=j.name&&j.value?j.name+'['+encodeURIComponent(j.value)+']':null;return (h.DOM.label({className:(("uiLinkButton")+(j.subtle?' '+"uiLinkButtonSubtle":'')+(j.showSaving?' '+"async_throbber":''))},h.DOM.input({type:j.inputType||'button',name:k,value:j.label,className:((j.showSaving?"stat_elem":''))})));};e.exports=i;});
__d("SeeMore.react",["React","tx"],function(a,b,c,d,e,f){var g=b('React'),h=b('tx'),i=g.createClass({displayName:'SeeMore',getInitialState:function(){return {isCollapsed:true};},handleClick:function(){this.setState({isCollapsed:false});},render:function(){var j=this.state.isCollapsed,k=!j?null:g.DOM.span(null,"..."),l=this.props.children[0],m=j?null:g.DOM.span(null,this.props.children[1]),n=!j?null:g.DOM.a({className:"SeeMoreLink fss",onClick:this.handleClick,href:"#",role:"button"},"See More");return (g.DOM.span({className:this.props.className},l,k,n,m));}});e.exports=i;});
__d("TruncatedTextWithEntities.react",["React","TextWithEntities.react","SeeMore.react"],function(a,b,c,d,e,f){var g=b('React'),h=b('TextWithEntities.react'),i=b('SeeMore.react');function j(n,o){var p=n.offset+n.length;return o>n.offset&&o<p;}function k(n,o){for(var p=0;p<n.length;p++){var q=n[p];if(j(q,o))return q.offset;}return o;}var l=function(n,o,p){var q=[],r=[],s=k(o,p);for(var t=0;t<o.length;t++){var u=o[t];if(u.offset<s){q.push(u);}else r.push({offset:u.offset-s,length:u.length,entities:u.entities});}return {first:{ranges:q,text:n.substr(0,s)},second:{ranges:r,text:n.substr(s)}};},m=g.createClass({displayName:'TruncatedTextWithEntities',render:function(){var n=this.props.maxLines,o=this.props.maxLength,p=this.props.truncationPercent||.6,q=Math.floor(p*o),r=this.props.text||'',s=this.props.ranges||[],t=r.split('\n'),u=t.length-1,v=o&&r.length>o,w=n&&u>n;if(w)q=Math.min(t.slice(0,n).join('\n').length,q);if(v||w){var x=l(r,s,q);return (g.DOM.span({'data-ft':this.props['data-ft'],dir:this.props.dir},i({className:this.props.className},h({interpolator:this.props.interpolator,ranges:x.first.ranges,text:x.first.text,renderEmoticons:this.props.renderEmoticons,renderEmoji:this.props.renderEmoji}),h({interpolator:this.props.interpolator,ranges:x.second.ranges,text:x.second.text,renderEmoticons:this.props.renderEmoticons,renderEmoji:this.props.renderEmoji}))));}else return (g.DOM.span({'data-ft':this.props['data-ft'],dir:this.props.dir},h({className:this.props.className,interpolator:this.props.interpolator,ranges:s,text:r,renderEmoticons:this.props.renderEmoticons,renderEmoji:this.props.renderEmoji})));}});e.exports=m;});
__d("UFICommentAttachment.react",["DOM","React"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('React'),i=h.createClass({displayName:'UFICommentAttachment',_attachmentFromCommentData:function(j){return j.photo_comment||j.attachment;},componentDidMount:function(j){var k=this._attachmentFromCommentData(this.props.comment);if(k)this.renderAttachment(k);},shouldComponentUpdate:function(j,k){var l=this._attachmentFromCommentData(this.props.comment),m=this._attachmentFromCommentData(j.comment);if(!l&&!m)return false;if(!l||!m||l.markup!=m.markup){return true;}else return false;},componentDidUpdate:function(j){var k=this._attachmentFromCommentData(this.props.comment);this.renderAttachment(k);},renderAttachment:function(j){if(j&&this.refs.contents)g.setContent(this.refs.contents.getDOMNode(),j.markup);},render:function(){if(this._attachmentFromCommentData(this.props.comment)){return h.DOM.div({ref:"contents"});}else return h.DOM.span(null);}});e.exports=i;});
__d("UFIReplyLink.react",["React","tx"],function(a,b,c,d,e,f){var g=b('React'),h=b('tx'),i=g.createClass({displayName:'UFIReplyLink',render:function(){return (g.DOM.a({className:"UFIReplyLink",href:"#",onClick:this.props.onClick},"Reply"));}});e.exports=i;});
__d("UFISpamCount",["UFISpamCountImpl"],function(a,b,c,d,e,f){e.exports=b('UFISpamCountImpl').module||{enabled:false};});
__d("UFIComment.react",["function-extensions","Bootloader","CloseButton.react","Env","Focus","HovercardLink","HovercardLinkInterpolator","LinkButton","NumberFormat","ProfileBrowserLink","ProfileBrowserTypes","React","Timestamp.react","TrackingNodes","TruncatedTextWithEntities.react","UFIClassNames","UFICommentAttachment.react","UFIConfig","UFIConstants","UFIImageBlock.react","UFIInstanceState","UFIReplyLink.react","UFISpamCount","URI","cx","keyMirror","joinClasses","tx"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Bootloader'),h=b('CloseButton.react'),i=b('Env'),j=b('Focus'),k=b('HovercardLink'),l=b('HovercardLinkInterpolator'),m=b('LinkButton'),n=b('NumberFormat'),o=b('ProfileBrowserLink'),p=b('ProfileBrowserTypes'),q=b('React'),r=b('Timestamp.react'),s=b('TrackingNodes'),t=b('TruncatedTextWithEntities.react'),u=b('UFIClassNames'),v=b('UFICommentAttachment.react'),w=b('UFIConfig'),x=b('UFIConstants'),y=b('UFIImageBlock.react'),z=b('UFIInstanceState'),aa=b('UFIReplyLink.react'),ba=b('UFISpamCount'),ca=b('URI'),da=b('cx'),ea=b('keyMirror'),fa=b('joinClasses'),ga=b('tx'),ha=x.UFIStatus,ia=' \u00b7 ',ja=ea({edit:true,hide:true,remove:true}),ka="UFICommentBody",la="UFICommentActorName",ma="UFICommentNotSpamLink",na="fsm fwn fcg UFICommentActions",oa="UFIDeletedMessageIcon",pa="UFIDeletedMessage",qa="UFIFailureMessageIcon",ra="UFIFailureMessage",sa="UFICommentLikeButton",ta="UFICommentLikeIcon",ua="UFITranslateLink",va="UFITranslatedText",wa="uiLinkSubtle",xa="stat_elem",ya="pls",za="fcg",ab=27,bb=null,cb=function(kb,lb){var mb=new ca('/ajax/like/tooltip.php').setQueryData({comment_fbid:kb.fbid,comment_from:kb.author,cache_buster:kb.likeconfirmhash||0});if(lb)mb.addQueryData({viewas:lb});return mb;},db=function(kb){var lb=kb.status;return lb===ha.FAILED_ADD||lb===ha.FAILED_EDIT;};function eb(kb){return kb.commenterIsFOF!==undefined&&kb.userIsMinor!==undefined&&kb.reportLink!==undefined;}var fb=q.createClass({displayName:'UFICommentLikeCount',render:function(){var kb=this.props.comment,lb=n.formatIntegerWithDelimiter(kb.likecount||0,this.props.contextArgs.numberdelimiter),mb=p.LIKES,nb={id:kb.fbid},ob=cb(this.props.comment,this.props.viewas),pb=q.DOM.i({className:ta}),qb=q.DOM.span(null,lb);return (q.DOM.a({className:sa,role:"button",rel:"dialog",'data-hover':"tooltip",'data-tooltip-alignh':"center",'data-tooltip-uri':ob.toString(),ajaxify:o.constructDialogURI(mb,nb).toString(),href:o.constructPageURI(mb,nb).toString()},pb,qb));}}),gb=q.createClass({displayName:'UFICommentActions',render:function(){var kb=this.props,lb=kb.comment,mb=kb.feedback,nb=kb.markedAsSpamHere,ob=lb.status===ha.SPAM_DISPLAY,pb=this.props.showReplyLink,qb=this.props.hideAsSpamForPageAdmin,rb,sb,tb,ub,vb,wb,xb=!lb.islocal&&lb.status!==ha.LIVE_DELETED;if(xb){if(ob&&!nb){if(kb.viewerCanMarkNotSpam)rb=q.DOM.a({onClick:kb.onMarkAsNotSpam,className:ma,href:"#",role:"button"},"Unhide");if(qb&&mb.isthreaded&&mb.cancomment&&pb)vb=aa({comment:lb,onClick:kb.onCommentReply,contextArgs:kb.contextArgs});}else{if(mb.viewercanlike){var yb=s.getTrackingInfo(lb.hasviewerliked?s.types.UNLIKE_LINK:s.types.LIKE_LINK),zb=lb.hasviewerliked?"Unlike this comment":"Like this comment";sb=q.DOM.a({className:"UFILikeLink",href:"#",role:"button",onClick:kb.onCommentLikeToggle,'data-ft':yb,title:zb},lb.hasviewerliked?"Unlike":"Like");}if(mb.isthreaded&&mb.cancomment&&pb)vb=aa({comment:lb,onClick:kb.onCommentReply,contextArgs:kb.contextArgs});if(lb.likecount>0)tb=fb({comment:lb,viewas:this.props.viewas,contextArgs:this.props.contextArgs});if(lb.spamcount&&ba.enabled)ub=ba({count:lb.spamcount});}if(lb.attachment&&lb.attachment.type=="share"&&lb.canremove)wb=q.DOM.a({onClick:kb.onPreviewRemove,href:"#",role:"button"},"Remove Preview");}var ac=hb({comment:lb,onRetrySubmit:kb.onRetrySubmit,showPermalink:kb.showPermalink}),bc;if(kb.contextArgs.entstream){bc=[ac,sb,tb,vb,ub,rb,wb];}else if(mb.isthreaded){bc=[sb,vb,rb,wb,tb,ub,ac];}else bc=[ac,sb,tb,ub,vb,rb,wb];if(lb.status===ha.LIVE_DELETED){var cc=q.DOM.span({className:pa},q.DOM.i({className:oa,'data-hover':"tooltip",'aria-label':"Comment deleted"}));bc.push(cc);}var dc=[];for(var ec=0;ec<bc.length;ec++)if(bc[ec]){dc.push(ia);dc.push(bc[ec]);}dc.shift();return (q.DOM.div({className:na},dc));}}),hb=q.createClass({displayName:'UFICommentMetadata',render:function(){var kb=this.props.comment,lb=this.props.onRetrySubmit,mb,nb;if(db(kb)){mb=[q.DOM.span({className:ra},q.DOM.i({className:qa}),"Unable to post comment."),kb.allowRetry&&lb?[' ',q.DOM.a({onClick:lb,href:"#",role:"button"},"Try Again")]:null];}else{var ob=this.props.showPermalink?kb.permalink:null,pb=s.getTrackingInfo(s.types.SOURCE),qb=q.DOM.a({className:wa,href:ob,'data-ft':pb},r({time:kb.timestamp.time,text:kb.timestamp.text,verbose:kb.timestamp.verbose})),rb;switch(kb.source){case x.UFISourceType.MOBILE:rb=q.DOM.a({className:wa,href:new ca('/mobile/').setSubdomain('www').toString()},"mobile");break;case x.UFISourceType.SMS:rb=q.DOM.a({className:wa,href:new ca('/mobile/?v=texts').setSubdomain('www').toString()},"text message");break;case x.UFISourceType.EMAIL:rb=m({subtle:true,label:"email",inputType:"submit",name:"email_explain",value:true,className:xa});break;}nb=qb;if(rb)nb=q.DOM.span({className:"UFITimestampViaSource"},ga._("{time} via {source}",{time:qb,source:rb}));}var sb=null;if(kb.originalTimestamp){var tb=new ca('/ajax/edits/browser/comment').addQueryData({comment_token:kb.id}).toString();sb=[ia,q.DOM.a({ref:"EditLink",href:"#",role:"button",rel:"dialog",className:"uiLinkSubtle",ajaxify:tb,'data-hover':"tooltip",'aria-label':"Show edit history",title:"Show edit history"},"Edited")];}return (q.DOM.span(null,nb,mb,sb));},componentWillUpdate:function(kb){var lb=this.props.comment,mb=kb.comment;if(!lb.editnux&&!!mb.editnux)g.loadModules(['LegacyContextualDialog'],function(nb){var ob=new nb();ob.init(mb.editnux).setContext(this.refs.EditLink.getDOMNode()).setWidth(300).setPosition('below').show();}.bind(this));}}),ib=q.createClass({displayName:'UFISocialContext',render:function(){var kb=this.props.topMutualFriend,lb=this.props.otherMutualCount,mb=this.props.commentAuthor,nb=k.constructEndpoint(kb).toString(),ob=q.DOM.a({href:kb.uri,'data-hovercard':nb},kb.name),pb=mb.name.length+kb.name.length,qb;if(lb===0){qb=ga._("Friends with {name}",{name:ob});}else if(pb<ab){var rb;if(lb==1){rb="1 other";}else rb=ga._("{count} others",{count:lb});qb=ga._("Friends with {name} and {others}",{name:ob,others:this.getOthersLink(rb,mb,kb)});}else{var sb=ga._("{count} mutual friends",{count:lb+1});qb=this.getOthersLink(sb,mb);}return (q.DOM.span({className:"UFICommentSocialContext"},ia,qb));},getOthersLink:function(kb,lb,mb){var nb=p.MUTUAL_FRIENDS,ob={uid:lb.id},pb=new ca('/ajax/mutual_friends/tooltip.php').setQueryData({friend_id:lb.id});if(mb)pb.addQueryData({exclude_id:mb.id});var qb=o.constructDialogURI(nb,ob).toString();return (q.DOM.a({rel:"dialog",'data-hover':"tooltip",'data-tooltip-alignh':"center",'data-tooltip-uri':pb.toString(),ajaxify:qb,href:o.constructPageURI(nb,ob).toString()},kb));}}),jb=q.createClass({displayName:'UFIComment',getInitialState:function(){return {isHighlighting:this.props.comment.highlightcomment,wasHighlighted:this.props.comment.highlightcomment,markedAsSpamHere:false,oneClickRemovedHere:false,isInlinePageDeleted:false,isInlineBanned:false};},_onHideAsSpam:function(event){this.props.onHideAsSpam(event);this.setState({markedAsSpamHere:true});},_onMarkAsNotSpam:function(event){this.props.onMarkAsNotSpam(event);this.setState({markedAsSpamHere:false});},_onDeleteSpam:function(event){this.props.onOneClickRemove(event);this.setState({isInlinePageDeleted:true});},_onUndoDeleteSpam:function(event){this.props.onUndoOneClickRemove(event);this.setState({isInlinePageDeleted:false});},_onInlineBan:function(event){this.props.onInlineBan(event);this.setState({isInlineBanned:true});},_onUndoInlineBan:function(event){this.props.onUndoInlineBan(event);this.setState({isInlineBanned:false});},_onOneClickRemove:function(event){this.props.onOneClickRemove(event);this.setState({oneClickRemovedHere:true});},_onUndoOneClickRemove:function(event){this.props.onUndoOneClickRemove(event);this.setState({oneClickRemovedHere:false});},_onAction:function(event,kb){if(kb===ja.remove){this.props.onRemove(event);}else if(kb===ja.edit){this.props.onEdit(event);}else if(kb===ja.hide)this._onHideAsSpam(event);},_createRemoveReportMenu:function(event){if(this._removeReportMenu)return;var kb=[{label:"Delete Comment...",value:ja.remove},{label:"Hide Comment",value:ja.hide}];if(event.persist){event.persist();}else event=event.constructor.persistentCloneOf(event);g.loadModules(['LegacyMenuUtils'],function(lb){this._removeReportMenu=lb.createAndShowPopoverMenu(event.target,kb,this._onAction.bind(this,event));}.bind(this));},_createEditDeleteMenu:function(event){if(event.persist){event.persist();}else event=event.constructor.persistentCloneOf(event);if(this._editDeleteMenu)return;var kb=[{label:"Edit...",value:ja.edit},{label:"Delete...",value:ja.remove}];g.loadModules(['LegacyMenuUtils'],function(lb){this._editDeleteMenu=lb.createAndShowPopoverMenu(event.target,kb,this._onAction.bind(this,event));}.bind(this));},_renderCloseButton:function(){var kb=this.props.comment,lb=this.props.feedback,mb=null,nb=null,ob=false;if(kb.canremove&&!this.props.hideAsSpamForPageAdmin){if(this.props.viewerIsAuthor){if(kb.canedit){nb="Edit or Delete";mb=this._createEditDeleteMenu;ob=true;}else{nb="Remove";mb=this.props.onRemove;}}else if(lb.canremoveall)if(this.props.showRemoveReportMenu){nb="Remove or Report";mb=this._createRemoveReportMenu;}else{nb="Remove";mb=this._onOneClickRemove;}}else if(kb.canreport){nb="Hide";mb=this._onHideAsSpam;}var pb=(("UFICommentCloseButton")+(ob?' '+"UFIEditButton":'')+(mb===null?' '+"hdn":''));return (h({onClick:mb,tooltip:nb,className:pb}));},componentDidMount:function(kb){var lb=this.props.comment.ufiinstanceid;if(this.state.isHighlighting){g.loadModules(['UFIScrollHighlight'],function(nb){nb.actOn.curry(kb).defer();});this.setState({isHighlighting:false});}var mb=z.getKeyForInstance(lb,'autofocus');if(mb){j.setWithoutOutline(this.refs.AuthorName.getDOMNode());z.updateState(lb,'autofocus',false);}},shouldComponentUpdate:function(kb){var lb=this.props;return (kb.comment!==lb.comment||kb.showReplyLink!==lb.showReplyLink||kb.showReplies!==lb.showReplies||kb.isFirst!==lb.isFirst||kb.isLast!==lb.isLast||kb.isFirstCommentComponent!==lb.isFirstCommentComponent||kb.isLastCommentComponent!==lb.isLastCommentComponent||kb.isFirstComponent!==lb.isFirstComponent||kb.isLastComponent!==lb.isLastComponent||kb.isFeaturedComment!==lb.isFeaturedComment||kb.hasPartialBorder!==lb.hasPartialBorder);},render:function(){var kb=this.props.comment,lb=this.props.feedback,mb=kb.status===ha.DELETED,nb=kb.status===ha.LIVE_DELETED,ob=kb.status===ha.SPAM_DISPLAY,pb=kb.status===ha.PENDING_UNDO_DELETE,qb=this.state.markedAsSpamHere,rb=this.state.oneClickRemovedHere,sb=this.state.isInlinePageDeleted,tb=this.props.hideAsSpamForPageAdmin,ub=this.state.isInlineBanned,vb=eb(kb),wb=!kb.status&&(kb.isunseen||kb.islocal);if(!kb.status&&lb.lastseentime){var xb=kb.originalTimestamp||kb.timestamp.time;wb=wb||xb>lb.lastseentime;}var yb=this.props.contextArgs.markedcomments;if(yb&&yb[kb.legacyid])wb=true;if(vb)if(bb){var zb,ac=null,bc=null,cc=null;if(tb){bc=ub?this._onUndoInlineBan:this._onInlineBan;if(sb){ac=this._onUndoDeleteSpam;var dc=q.DOM.a({href:"#",onClick:ac},"Undo");zb=ga._("You've deleted this comment so no one can see it. {undo}.",{undo:dc});}else if(qb){zb="Now this is only visible to the person who wrote it and their friends.";cc=this._onDeleteSpam;ac=this._onMarkAsNotSpam;}}else if(qb){zb="This comment has been hidden.";cc=this._onDeleteSpam;ac=this._onMarkAsNotSpam;}else if(rb){zb="This comment has been removed.";ac=this._onUndoOneClickRemove;}if(zb)return (q.DOM.li({className:fa(u.ROW,"UFIHide")},bb({notice:zb,comment:this.props.comment,authorProfiles:this.props.authorProfiles,onUndo:ac,onBanAction:bc,onDeleteAction:cc,isInlineBanned:ub,hideAsSpamForPageAdmin:tb})));}else g.loadModules(['UFICommentRemovalControls.react'],function(hc){bb=hc;setTimeout(function(){this.forceUpdate();}.bind(this));}.bind(this));var ec=!mb||rb,fc=fa(u.ROW,(("UFIComment")+(db(kb)?' '+"UFICommentFailed":'')+(mb||nb||ob||pb?' '+"UFITranslucentComment":'')+(this.state.isHighlighting?' '+"highlightComment":'')+(!ec?' '+"noDisplay":'')+(ec?' '+"display":'')+(this.props.isFirst&&!this.props.isReply?' '+"UFIFirstComment":'')+(this.props.isLast&&!this.props.isReply?' '+"UFILastComment":'')+(this.props.isFirstCommentComponent?' '+"UFIFirstCommentComponent":'')+(this.props.isLastCommentComponent?' '+"UFILastCommentComponent":'')+(this.props.isFirstComponent?' '+"UFIFirstComponent":'')+(this.props.isLastComponent?' '+"UFILastComponent":'')+(this.props.isFeatured?' '+"UFIFeaturedComment":'')+(this.props.hasPartialBorder&&!this.props.contextArgs.entstream?' '+"UFIPartialBorder":''))),gc=this.renderComment();if(wb)if(this.props.contextArgs.snowliftredesign){gc=q.DOM.div({className:"_5cis"},q.DOM.div({className:"_5cit"}),gc);}else if(this.props.contextArgs.entstream&&!this.props.isReply){gc=q.DOM.div({className:"_52mp"},q.DOM.div({className:"_52mq"}),gc);}else fc=fa(fc,u.UNSEEN_ITEM);return (q.DOM.li({className:fc,'data-ft':this.props['data-ft']},gc));},renderComment:function(){var kb=this.props,lb=kb.comment,mb=kb.feedback,nb=kb.authorProfiles[lb.author],ob=lb.status===ha.SPAM_DISPLAY,pb=lb.status===ha.LIVE_DELETED,qb=!(ob||pb),rb=mb.canremoveall||lb.hiddenbyviewer,sb=null,tb=null;if(!kb.isLocallyComposed&&!this.state.wasHighlighted&&!lb.fromfetch){tb=x.commentTruncationLength;sb=x.commentTruncationMaxLines;}var ub=s.getTrackingInfo(s.types.SMALL_ACTOR_PHOTO),vb=s.getTrackingInfo(s.types.USER_NAME),wb=s.getTrackingInfo(s.types.USER_MESSAGE),xb=null,yb=null;if(lb.istranslatable&&(lb.translatedtext===undefined))xb=q.DOM.a({href:"#",role:"button",title:"Translate this comment",className:ua,onClick:kb.onCommentTranslate},"See Translation");if(lb.translatedtext){var zb=new ca('http://bing.com/translator').addQueryData({text:lb.body.text});yb=q.DOM.span({className:va},lb.translatedtext,q.DOM.span({className:ya}," (",q.DOM.a({href:zb.toString(),className:za},"Translated by Bing"),") "));}var ac;if(i.rtl&&lb.body.dir==='ltr'){ac='rtl';}else if(!i.rtl&&lb.body.dir==='rtl')ac='ltr';var bc=k.constructEndpointWithLocation(nb,'ufi').toString(),cc=q.DOM.a({ref:"AuthorName",className:la,href:nb.uri,'data-hovercard':bc,'data-ft':vb,dir:ac},nb.name),dc=function(ic,jc){return l(ic,jc,'_blank',mb.grouporeventid,'ufi');},ec=t({className:ka,interpolator:dc,ranges:lb.body.ranges,text:lb.body.text,truncationPercent:x.commentTruncationPercent,maxLength:tb,maxLines:sb,renderEmoticons:w.renderEmoticons,renderEmoji:w.renderEmoji,'data-ft':wb,dir:lb.body.dir}),fc;if(lb.socialcontext){var gc=lb.socialcontext,hc=ib({topMutualFriend:kb.authorProfiles[gc.topmutualid],otherMutualCount:gc.othermutualcount,commentAuthor:nb});fc=[cc,hc,q.DOM.div(null,ec)];}else fc=[cc,' ',ec];return (y({spacing:"medium"},q.DOM.a({href:nb.uri,'data-hovercard':bc,'data-ft':ub},q.DOM.img({src:nb.thumbSrc,className:u.ACTOR_IMAGE,alt:""})),q.DOM.div(null,q.DOM.div({className:"UFICommentContent"},fc,xb,yb,v({comment:kb.comment})),gb({comment:lb,feedback:mb,onBlingBoxClick:kb.onBlingBoxClick,onCommentLikeToggle:kb.onCommentLikeToggle,onCommentReply:kb.onCommentReply,onPreviewRemove:kb.onPreviewRemove,onRetrySubmit:kb.onRetrySubmit,onMarkAsNotSpam:this._onMarkAsNotSpam,viewerCanMarkNotSpam:rb,viewas:kb.contextArgs.viewas,showPermalink:kb.showPermalink,showReplyLink:kb.showReplyLink,showReplies:kb.showReplies,contextArgs:kb.contextArgs,markedAsSpamHere:this.state.markedAsSpamHere,hideAsSpamForPageAdmin:kb.hideAsSpamForPageAdmin})),qb?this._renderCloseButton():null));}});e.exports=jb;});
__d("UFIContainer.react",["React","TrackingNodes","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('TrackingNodes'),i=b('cx'),j=g.createClass({displayName:'UFIContainer',render:function(){var k=null;if(this.props.hasNub)k=g.DOM.li({className:"UFIArrow"},g.DOM.i(null));var l=((!this.props.isReplyList?"UFIList":'')+(this.props.isReplyList?' '+"UFIReplyList":'')+(this.props.isParentLiveDeleted?' '+"UFITranslucentReplyList":'')+(this.props.isFirstCommentComponent?' '+"UFIFirstCommentComponent":'')+(this.props.isLastCommentComponent?' '+"UFILastCommentComponent":'')+(this.props.isFirstComponent?' '+"UFIFirstComponent":'')+(this.props.isLastComponent?' '+"UFILastComponent":''));return (g.DOM.ul({className:l,'data-ft':h.getTrackingInfo(h.types.UFI)},k,this.props.children));}});e.exports=j;});
__d("GiftOpportunityLogger",["AsyncRequest","Event"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Event'),i={init:function(k,l,m){var n=false;h.listen(k,'click',function(o){if(n)return true;n=true;i.send(l,m);});},send:function(k,l){if(j[k.opportunity_id])return;j[k.opportunity_id]=true;return new g().setURI('/ajax/gifts/log/opportunity').setData({data:k,entry_point:l}).send();}},j={};e.exports=i;});
__d("InlineBlock.react",["ReactPropTypes","React","cx","joinClasses"],function(a,b,c,d,e,f){var g=b('ReactPropTypes'),h=b('React'),i=b('cx'),j=b('joinClasses'),k={baseline:null,bottom:"_6d",middle:"_6b",top:"_6e"},l=h.createClass({displayName:'InlineBlock',propTypes:{alignv:g.oneOf(['baseline','bottom','middle','top']),height:g.number},getDefaultProps:function(){return {alignv:'baseline'};},render:function(){var m=k[this.props.alignv],n=h.DOM.div({className:j("_6a",m)},this.props.children);if(this.props.height!=null){var o=h.DOM.div({className:j("_6a",m),style:{height:this.props.height+'px'}});n=h.DOM.div({className:"_6a",height:null},o,n);}return this.transferPropsTo(n);}});e.exports=l;});
__d("UFIGiftSentence.react",["AsyncRequest","CloseButton.react","GiftOpportunityLogger","ImageBlock.react","InlineBlock.react","LeftRight.react","Link.react","React","Image.react","UFIClassNames","UFIImageBlock.react","URI","DOM","ix","tx"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CloseButton.react'),i=b('GiftOpportunityLogger'),j=b('ImageBlock.react'),k=b('InlineBlock.react'),l=b('LeftRight.react'),m=b('Link.react'),n=b('React'),o=b('Image.react'),p=b('UFIClassNames'),q=b('UFIImageBlock.react'),r=b('URI'),s=b('DOM'),t=b('ix'),u=b('tx'),v=n.createClass({displayName:'UFIGiftSentence',_entry_point:'detected_gift_worthy_story_inline',render:function(){var w=this.props.recipient,x=this.props.giftdata,y=x?x.giftproductid:null,z=this._getURI(y).toString();this._log();return (n.DOM.li({className:p.ROW,ref:"UFIGiftSentence"},l({direction:"right"},x?this._renderGiftSuggestion(z,w,x):this._renderGiftLink(z,w),h({size:"small",onClick:function(){var aa=this.refs.UFIGiftSentence.getDOMNode();s.remove(aa);this._requestClose();}.bind(this)}))));},_renderGiftSuggestion:function(w,x,y){return (q(null,o({src:t('/images/group_gifts/icons/gift_icon_red-13px.png'),alt:"invite"}),n.DOM.div(null,n.DOM.span({className:"fwb"},u._("Surprise {name} with a gift",{name:x.firstName})),j({spacing:"medium",className:"mvs"},m({className:"fwb",rel:"async-post",ajaxify:w,href:{url:'#'}},o({className:"UFIGiftProductImg",src:y.giftproductimgsrc,alt:"product image"})),k({alignv:"middle",height:79},n.DOM.p({className:"mvs"},m({className:"fwb",rel:"async-post",ajaxify:w,href:{url:'#'}},y.giftproductname)),n.DOM.p({className:"mvs fcg"},y.giftproductpricerange),n.DOM.p({className:"mvs"},m({rel:"async-post",ajaxify:w,href:{url:'#'}},'Give This Gift')," · ",m({rel:"async-post",ajaxify:this._getURI().toString(),href:{url:'#'}},'See All Gifts')))))));},_renderGiftLink:function(w,x){return (q(null,m({className:"UFIGiftIcon",tabIndex:"-1",href:{url:'#'},rel:"async-post",ajaxify:w},o({src:t('/images/group_gifts/icons/gift_icon_red-13px.png'),alt:"invite"})),m({rel:"async-post",href:{url:'#'},ajaxify:w},u._("Surprise {name} with a gift",{name:x.firstName}))));},_log:function(){var w=this.props.giftdata,x={opportunity_id:this.props.contextArgs.ftentidentifier,sender_id:this.props.sender.id,recipient_id:this.props.recipient.id,link_description:'UFIGiftSentence',product_id:w?w.giftproductid:null,custom:{gift_occasion:this.props.contextArgs.giftoccasion,ftentidentifier:this.props.contextArgs.ftentidentifier}};i.send([x],this._entry_point);},_getURI:function(w){return r('/ajax/gifts/send').addQueryData({gift_occasion:this.props.contextArgs.giftoccasion,recipient_id:this.props.recipient.id,entry_point:this._entry_point,product_id:w});},_requestClose:function(){var w=r('/ajax/gifts/moments/close/');new g().setMethod('POST').setReadOnly(false).setURI(w).setData({action:'hide',data:JSON.stringify({type:'detected_moment',friend_id:this.props.recipient.id,ftentidentifier:this.props.contextArgs.ftentidentifier})}).send();}});e.exports=v;});
__d("UFILikeSentenceText.react",["HovercardLinkInterpolator","ProfileBrowserLink","ProfileBrowserTypes","React","TextWithEntities.react","URI"],function(a,b,c,d,e,f){var g=b('HovercardLinkInterpolator'),h=b('ProfileBrowserLink'),i=b('ProfileBrowserTypes'),j=b('React'),k=b('TextWithEntities.react'),l=b('URI');function m(p,q,r,s){if(s.count!=null){var t=i.LIKES,u={id:p.targetfbid};return (j.DOM.a({href:h.constructPageURI(t,u).toString(),target:"_blank"},r));}else return g(r,s,'_blank',null,'ufi');}function n(p,q,r,s){if(s.count!=null){var t=i.LIKES,u={id:p.targetfbid},v=[];for(var w=0;w<q.length;w++)if(!q[w].count)v.push(q[w].entities[0].id);var x=new l('/ajax/like/tooltip.php').setQueryData({comment_fbid:p.targetfbid,comment_from:p.actorforpost,seen_user_fbids:v.length?v:true});return (j.DOM.a({rel:"dialog",ajaxify:h.constructDialogURI(t,u).toString(),href:h.constructPageURI(t,u).toString(),'data-hover':"tooltip",'data-tooltip-alignh':"center",'data-tooltip-uri':x.toString()},r));}else return g(r,s,null,null,'ufi');}var o=j.createClass({displayName:'UFILikeSentenceText',render:function(){var p=this.props.feedback,q=this.props.likeSentenceData,r;if(this.props.contextArgs.embedded){r=m;}else r=n;r=r.bind(null,p,q.ranges);return (k({interpolator:r,ranges:q.ranges,aggregatedRanges:q.aggregatedranges,text:q.text}));}});e.exports=o;});
__d("UFILikeSentence.react",["Bootloader","LeftRight.react","ProfileBrowserLink","ProfileBrowserTypes","React","UFIClassNames","UFIImageBlock.react","UFILikeSentenceText.react","URI","cx","joinClasses","tx"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('LeftRight.react'),i=b('ProfileBrowserLink'),j=b('ProfileBrowserTypes'),k=b('React'),l=b('UFIClassNames'),m=b('UFIImageBlock.react'),n=b('UFILikeSentenceText.react'),o=b('URI'),p=b('cx'),q=b('joinClasses'),r=b('tx'),s=k.createClass({displayName:'UFILikeSentence',getInitialState:function(){return {selectorModule:null,bootloadedSelectorModule:false};},componentWillMount:function(){this._bootloadSelectorModule(this.props);},componentWillReceiveProps:function(t){this._bootloadSelectorModule(t);},_bootloadSelectorModule:function(t){if(t.showOrderingModeSelector&&!t.contextArgs.embedded&&!this.state.bootloadedSelectorModule){var u=function(v){this.setState({selectorModule:v});}.bind(this);if(t.contextArgs.entstream){g.loadModules(['UFIEntStreamOrderingModeSelector.react'],u);}else g.loadModules(['UFIOrderingModeSelector.react'],u);this.setState({bootloadedSelectorModule:true});}},render:function(){var t=this.props.feedback,u=t.likesentences.current,v=this.props.contextArgs.entstream,w=q(l.ROW,t.likesentences.isunseen?l.UNSEEN_ITEM:'',(("UFILikeSentence")+(this.props.isFirstComponent?' '+"UFIFirstComponent":'')+(this.props.isLastComponent?' '+"UFILastComponent":''))),x=null,y=null;if(u.text)y=k.DOM.div({className:"UFILikeSentenceText"},n({contextArgs:this.props.contextArgs,feedback:t,likeSentenceData:u}));if(y&&!v){x=k.DOM.i({className:"UFILikeIcon"});if(t.viewercanlike&&!t.hasviewerliked)x=k.DOM.a({className:"UFILikeThumb",href:"#",tabIndex:"-1",title:"Like this",onClick:this.props.onTargetLikeToggle},x);}var z=y,aa=null;if(t.seencount>0&&!v){var ba=j.GROUP_MESSAGE_VIEWERS,ca={id:t.targetfbid},da=i.constructDialogURI(ba,ca),ea=i.constructPageURI(ba,ca),fa=new o('/ajax/ufi/seen_tooltip.php').setQueryData({ft_ent_identifier:t.entidentifier,displayed_count:t.seencount}),ga;if(t.seenbyall){ga="Seen by everyone";}else ga=t.seencount==1?"Seen by 1":r._("Seen by {count}",{count:t.seencount});aa=k.DOM.a({rel:"dialog",ajaxify:da.toString(),href:ea.toString(),tabindex:"-1",'data-hover':"tooltip",'data-tooltip-alignh':"left",'data-tooltip-uri':fa.toString(),className:(("UFISeenCount")+(!!u.text?' '+"UFISeenCountRight":''))},k.DOM.span({className:"UFISeenCountIcon"}),ga);}else if(this.props.showOrderingModeSelector&&this.state.selectorModule&&!this.props.contextArgs.embedded){var ha=this.state.selectorModule;aa=ha({currentOrderingMode:this.props.orderingMode,entstream:v,orderingmodes:t.orderingmodes,onOrderChanged:this.props.onOrderingModeChange});if(!z)z=k.DOM.div(null);}var ia=null;if(x&&y){ia=m(null,x,y,aa);}else if(z){ia=h(null,z,aa);}else ia=aa;return (k.DOM.li({className:w},ia));}});e.exports=s;});
__d("UFIPager.react",["LeftRight.react","React","UFIClassNames","UFIImageBlock.react","cx","joinClasses"],function(a,b,c,d,e,f){var g=b('LeftRight.react'),h=b('React'),i=b('UFIClassNames'),j=b('UFIImageBlock.react'),k=b('cx'),l=b('joinClasses'),m=h.createClass({displayName:'UFIPager',onPagerClick:function(n){!this.props.isLoading&&this.props.onPagerClick&&this.props.onPagerClick();n.nativeEvent.prevent();},render:function(){var n=this.onPagerClick,o=((this.props.isLoading?"ufiPagerLoading":'')),p=l(i.ROW,this.props.isUnseen?i.UNSEEN_ITEM:'',(("UFIPagerRow")+(this.props.isFirstCommentComponent?' '+"UFIFirstCommentComponent":'')+(this.props.isLastCommentComponent?' '+"UFILastCommentComponent":'')+(this.props.isFirstComponent?' '+"UFIFirstComponent":'')+(this.props.isLastComponent?' '+"UFILastComponent":''))),q=h.DOM.a({className:"UFIPagerLink",onClick:n,href:"#",role:"button"},h.DOM.span({className:o},this.props.pagerLabel)),r=(("fcg")+(' '+"UFIPagerCount")),s=h.DOM.span({className:r},this.props.countSentence),t;if(this.props.contextArgs.entstream){t=(g({direction:g.DIRECTION.right},q,s));}else t=(j(null,h.DOM.a({className:"UFIPagerIcon",onClick:n,href:"#",role:"button"}),q,s));return (h.DOM.li({className:p,'data-ft':this.props['data-ft']},t));}});e.exports=m;});
__d("UFIReplySocialSentence.react",["LiveTimer","React","Timestamp.react","UFIClassNames","UFIConstants","UFIImageBlock.react","cx","joinClasses","tx"],function(a,b,c,d,e,f){var g=b('LiveTimer'),h=b('React'),i=b('Timestamp.react'),j=b('UFIClassNames'),k=b('UFIConstants'),l=b('UFIImageBlock.react'),m=b('cx'),n=b('joinClasses'),o=b('tx'),p=' \u00b7 ',q=43200,r=h.createClass({displayName:'UFIReplySocialSentence',render:function(){var s=((this.props.isLoading?"UFIReplySocialSentenceLoading":'')),t=n(j.ROW,(("UFIReplySocialSentenceRow")+(this.props.isFirstComponent?' '+"UFIFirstComponent":'')+(this.props.isLastComponent?' '+"UFILastComponent":''))),u,v;if(this.props.isExpanded){u=this.props.replies>1?o._("Hide {count} Replies",{count:this.props.replies}):"Hide 1 Reply";}else{u=this.props.replies>1?o._("{count} Replies",{count:this.props.replies}):"1 Reply";if(this.props.timestamp){var w=g.getApproximateServerTime()/1000-this.props.timestamp.time;if(w<q||this.props.orderingMode==k.UFICommentOrderingMode.RECENT_ACTIVITY)v=h.DOM.span({className:"fcg"},p,i({time:this.props.timestamp.time,text:this.props.timestamp.text,verbose:this.props.timestamp.verbose}));}}var x=Object.keys(this.props.authors),y=x.length&&!this.props.isExpanded,z,aa;if(y){var ba=this.props.authors[x[0]];z=h.DOM.img({alt:"",src:ba.thumbSrc,className:j.ACTOR_IMAGE});aa=[o._("{author} replied",{author:ba.name}),p,u];}else{z=h.DOM.i({className:((!this.props.isExpanded?"UFIPagerIcon":'')+(this.props.isExpanded?' '+"UFICollapseIcon":''))});aa=u;}return (h.DOM.li({className:t,'data-ft':this.props['data-ft']},h.DOM.a({className:"UFICommentLink",onClick:this.props.onClick,href:"#",role:"button"},l(null,h.DOM.div({className:((y?"UFIReplyActorPhotoWrapper":''))},z),h.DOM.span({className:s},h.DOM.span({className:"UFIReplySocialSentenceLinkText"},aa),v)))));}});e.exports=r;});
__d("UFIShareRow.react",["NumberFormat","React","UFIClassNames","UFIImageBlock.react","URI","cx","joinClasses","tx"],function(a,b,c,d,e,f){var g=b('NumberFormat'),h=b('React'),i=b('UFIClassNames'),j=b('UFIImageBlock.react'),k=b('URI'),l=b('cx'),m=b('joinClasses'),n=b('tx'),o=h.createClass({displayName:'UFIShareRow',render:function(){var p=new k('/ajax/shares/view').setQueryData({target_fbid:this.props.targetID}),q=new k('/shares/view').setSubdomain('www').setQueryData({id:this.props.targetID}),r;if(this.props.shareCount>1){var s=g.formatIntegerWithDelimiter(this.props.shareCount,this.props.contextArgs.numberdelimiter||',');r=n._("{count} shares",{count:s});}else r="1 share";var t=m(i.ROW,((this.props.isFirstComponent?"UFIFirstComponent":'')+(this.props.isLastComponent?' '+"UFILastComponent":'')));return (h.DOM.li({className:t},j(null,h.DOM.a({className:"UFIShareIcon",rel:"dialog",ajaxify:p.toString(),href:q.toString()}),h.DOM.a({className:"UFIShareLink",rel:"dialog",ajaxify:p.toString(),href:q.toString()},r))));}});e.exports=o;});
__d("UFISpamPlaceholder.react",["React","UFIClassNames","cx","tx"],function(a,b,c,d,e,f){var g=b('React'),h=b('UFIClassNames'),i=b('cx'),j=b('tx'),k=g.createClass({displayName:'UFISpamPlaceholder',render:function(){var l=(("UFISpamCommentWrapper")+(this.props.isLoading?' '+"UFISpamCommentLoading":''));return (g.DOM.li({className:h.ROW},g.DOM.a({href:"#",role:"button",className:"UFISpamCommentLink",onClick:this.props.onClick},g.DOM.span({'data-hover':"tooltip",'data-tooltip-alignh':"center",'aria-label':j._("{count} hidden",{count:this.props.numHidden}),className:l},g.DOM.i({className:"placeholderIcon"})))));}});e.exports=k;});
__d("UFI.react",["NumberFormat","React","LegacyScrollableArea.react","TrackingNodes","UFIAddCommentController","UFIAddCommentLink.react","UFIComment.react","UFIConstants","UFIContainer.react","UFIGiftSentence.react","UFIInstanceState","UFILikeSentence.react","UFIPager.react","UFIReplySocialSentence.react","UFIShareRow.react","UFISpamPlaceholder.react","copyProperties","isEmpty","tx"],function(a,b,c,d,e,f){var g=b('NumberFormat'),h=b('React'),i=b('LegacyScrollableArea.react'),j=b('TrackingNodes'),k=b('UFIAddCommentController'),l=b('UFIAddCommentLink.react'),m=b('UFIComment.react'),n=b('UFIConstants'),o=b('UFIContainer.react'),p=b('UFIGiftSentence.react'),q=b('UFIInstanceState'),r=b('UFILikeSentence.react'),s=b('UFIPager.react'),t=b('UFIReplySocialSentence.react'),u=b('UFIShareRow.react'),v=b('UFISpamPlaceholder.react'),w=b('copyProperties'),x=b('isEmpty'),y=b('tx'),z=h.createClass({displayName:'UFI',getInitialState:function(){return {requestRanges:w({},this.props.availableRanges),instanceShowRepliesMap:{},instanceShowReplySocialSentenceMap:{},loadingSpamIDs:{},isActiveLoading:false,hasPagedToplevel:false};},componentWillReceiveProps:function(aa){if(this.state.isActiveLoading){var ba=this.props.availableRanges[this.props.id],ca=aa.availableRanges[this.props.id];if(ba.offset!=ca.offset||ba.length!=ca.length){var da=(ca.offset<ba.offset)?0:ba.length;if(da<aa.availableComments.length){var ea=aa.availableComments[da].ufiinstanceid;q.updateState(ea,'autofocus',true);}}this.setState({isActiveLoading:false});}if(aa.orderingMode!=this.props.orderingMode)this.setState({requestRanges:w({},aa.availableRanges)});},render:function(){var aa=this.props,ba=aa.feedback,ca=aa.contextArgs,da=aa.source!=n.UFIFeedbackSourceType.ADS,ea=ba.orderingmodes&&aa.commentCounts[aa.id]>=n.minCommentsForOrderingModeSelector,fa=(!x(ba.likesentences.current)||(ba.seencount>0&&!ca.entstream)||ea)&&da,ga=null;if(fa)ga=r({contextArgs:ca,feedback:ba,onTargetLikeToggle:aa.onTargetLikeToggle,onOrderingModeChange:aa.onOrderingModeChange,orderingMode:aa.orderingMode,showOrderingModeSelector:ea});var ha=null;if(aa.feedback.hasviewerliked&&this._shouldShowGiftSentence()&&!ca.embedded)ha=p({contextArgs:ca,recipient:aa.giftRecipient,sender:aa.authorProfiles[ba.actorforpost],giftdata:aa.feedback.giftdata});var ia=aa.availableComments&&aa.availableComments.length&&da,ja=null;if(ia)ja=this.renderCommentMap(aa.availableComments,aa.availableRanges[aa.id].offset);var ka=null,la=ba.cancomment,ma=la&&ca.showaddcomment&&ba.actorforpost&&!ca.embedded;if(ma){var na=new k(null,aa.id,null,ca),oa=aa.authorProfiles[ba.actorforpost];ka=na.renderAddComment(oa,ba.ownerid,ba.mentionsdatasource,ba.showsendonentertip,'toplevelcomposer',null,ba.subtitle,ba.allowphotoattachments,ba.allowstickerattachments);}var pa=null,qa=ca.showshares&&ba.sharecount&&da;if(qa&&!ca.entstream&&!ca.embedded)pa=u({targetID:ba.targetfbid,shareCount:ba.sharecount,contextArgs:ca});var ra=fa||qa||ia||la,sa=this.renderPagers();this.applyToUFIComponents([sa.topPager],ja,[sa.bottomPager],{isFirstCommentComponent:true},{isLastCommentComponent:true});var ta=ba.commentboxhoisted?ka:null,ua=ba.commentboxhoisted?null:ka,va=null;if(ma&&ba.hasaddcommentlink&&this.state.hasPagedToplevel&&!ca.embedded)va=l({onClick:this.onComment});this.applyToUFIComponents([ga,pa,ta,sa.topPager],ja,[sa.bottomPager,ua,va],{isFirstComponent:true},{isLastComponent:true});var wa=[sa.topPager,ja,sa.bottomPager];if(ca.embedded){wa=null;}else if(ca.scrollcomments&&ca.scrollwidth)wa=h.DOM.li(null,i({width:ca.scrollwidth},h.DOM.ul(null,wa)));return (o({hasNub:ca.shownub&&ra},ga,ha,pa,ta,wa,ua,va));},applyToUFIComponents:function(aa,ba,ca,da,ea){var fa=Object.keys(ba||{}).map(function(ha){return ba[ha];}),ga=[].concat(aa,fa,ca);this._applyToFirstComponent(ga,da);ga.reverse();this._applyToFirstComponent(ga,ea);},_applyToFirstComponent:function(aa,ba){for(var ca=0;ca<(aa||[]).length;ca++)if(aa[ca]){w(aa[ca].props,ba);return;}},renderCommentMap:function(aa,ba){var ca=this.props,da={},ea=aa.length;if(!ea)return da;var fa=aa[0].parentcommentid,ga=[],ha=function(){if(ga.length>0){var qa=function(ra,sa){this.state.loadingSpamIDs[ra[0]]=true;this.forceUpdate();ca.onSpamFetch(ra,sa);}.bind(this,ga,fa);da['spam'+ga[0]]=v({onClick:qa,numHidden:ga.length,isLoading:!!this.state.loadingSpamIDs[ga[0]]});ga=[];}}.bind(this),ia=ca.instanceid,ja=q.getKeyForInstance(ia,'editcommentid'),ka=!!aa[0].parentcommentid,la=false;for(var ma=0;ma<ea;ma++)if(aa[ma].status==n.UFIStatus.SPAM){ga.push(aa[ma].id);}else{ha();var na=Math.max(ca.loggingOffset-ma-ba,0),oa=aa[ma],pa;if(oa.id==ja){pa=this.renderEditCommentBox(oa);}else{pa=this.renderComment(oa,na);pa.props.isFirst=ma===0;pa.props.isLast=ma===ea-1;if(!ka)pa.props.showReplyLink=true;}da['comment'+oa.id]=pa;if(ca.feedback.actorforpost===oa.author&&!la&&!ca.feedback.hasviewerliked&&this._shouldShowGiftSentence()){da['gift'+oa.id]=p({contextArgs:ca.contextArgs,recipient:ca.giftRecipient,sender:ca.authorProfiles[ca.feedback.actorforpost],giftdata:ca.feedback.giftdata});la=true;}if(oa.status!==n.UFIStatus.DELETED)da['replies'+oa.id]=this.renderReplyContainer(oa);}ha();return da;},_shouldShowGiftSentence:function(){var aa=this.props;return aa.contextArgs.giftoccasion&&!aa.contextArgs.entstream;},renderReplyContainer:function(aa){var ba=this.props,ca={};for(var da=0;da<(aa.replyauthors||[]).length;da++){var ea=ba.authorProfiles[aa.replyauthors[da]];if(ea)ca[ea.id]=ea;}var fa=ba.repliesMap&&ba.repliesMap[aa.id]&&this._shouldShowCommentReplies(aa.id),ga,ha=Math.max(aa.replycount-aa.spamreplycount,0);if(ha&&this._shouldShowReplySocialSentence(aa.id)){var ia=this._shouldShowCommentReplies(aa.id)&&(this.isLoadingPrev(aa.id)||this.isLoadingNext(aa.id));ga=t({authors:ca,replies:ha,timestamp:aa.recentreplytimestamp,onClick:this.onToggleReplies.bind(this,aa),isLoading:ia,isExpanded:fa,orderingMode:this.props.orderingMode});}var ja,ka,la,ma;if(fa){var na=this.renderPagers(aa.id);ja=na.topPager;la=na.bottomPager;ka=this.renderCommentMap(ba.repliesMap[aa.id],ba.availableRanges[aa.id].offset);var oa=Object.keys(ka);for(var pa=0;pa<oa.length;pa++){var qa=ka[oa[pa]];if(qa)qa.props.hasPartialBorder=pa!==0;}if(ba.feedback.cancomment){var ra=false,sa=Object.keys(ka);for(var da=sa.length-1;da>=0;da--){var ta=sa[da];if(ta&&ka[ta]){ra=ka[ta].props.isAuthorReply;break;}}ma=this.renderReplyComposer(aa,!ra);}}var ua;if(ga||ja||ka||la||ma){this.applyToUFIComponents([ga,ja],ka,[la,ma],{isFirstComponent:true},{isLastComponent:true});var va=aa.status===n.UFIStatus.LIVE_DELETED;ua=o({isParentLiveDeleted:va,isReplyList:true},ga,ja,ka,la,ma);}return ua;},renderReplyComposer:function(aa,ba){var ca=this.props;return (new k(null,ca.id,aa.id,ca.contextArgs)).renderAddComment(ca.authorProfiles[ca.feedback.actorforpost],ca.feedback.ownerid,ca.feedback.mentionsdatasource,false,'replycomposer-'+aa.id,ba,null,ca.feedback.allowphotoattachments,ca.feedback.allowstickerattachments);},renderEditCommentBox:function(aa){var ba=new k(null,this.props.id,null,{}),ca=ba.renderEditComment(this.props.authorProfiles[this.props.feedback.actorforpost],this.props.feedback.ownerid,aa.id,this.props.feedback.mentionsdatasource,this.props.onEditAttempt.bind(null,aa),this.props.onCancelEdit,this.props.feedback.allowphotoattachments,this.props.feedback.allowstickerattachments);return ca;},_shouldShowCommentReplies:function(aa){if(aa in this.state.instanceShowRepliesMap){return this.state.instanceShowRepliesMap[aa];}else if(aa in this.props.showRepliesMap)return this.props.showRepliesMap[aa];return false;},_shouldShowReplySocialSentence:function(aa){if(aa in this.state.instanceShowReplySocialSentenceMap){return this.state.instanceShowReplySocialSentenceMap[aa];}else if(aa in this.props.showReplySocialSentenceMap)return this.props.showReplySocialSentenceMap[aa];return false;},renderComment:function(aa,ba){var ca=this.props,da=ca.feedback,ea=da.actorforpost===aa.author,fa=q.getKeyForInstance(this.props.instanceid,'locallycomposed'),ga=aa.islocal||fa&&fa[aa.id],ha=da.showremovemenu||(da.viewerid===aa.author),ia=da.canremoveall&&da.isownerpage&&!ea,ja=ca.source!=n.UFIFeedbackSourceType.INTERN,ka=j.getTrackingInfo(j.types.COMMENT,ba),la=!!aa.parentcommentid,ma=this._shouldShowCommentReplies(aa.id),na=!!aa.isfeatured;return (m({comment:aa,authorProfiles:this.props.authorProfiles,viewerIsAuthor:ea,feedback:da,'data-ft':ka,contextArgs:this.props.contextArgs,hideAsSpamForPageAdmin:ia,isLocallyComposed:ga,isReply:la,isFeatured:na,showPermalink:ja,showRemoveReportMenu:ha,showReplies:ma,onCommentLikeToggle:ca.onCommentLikeToggle.bind(null,aa),onCommentReply:this.onCommentReply.bind(this,aa),onCommentTranslate:ca.onCommentTranslate.bind(null,aa),onEdit:ca.onCommentEdit.bind(null,aa),onHideAsSpam:ca.onCommentHideAsSpam.bind(null,aa),onInlineBan:ca.onCommentInlineBan.bind(null,aa),onMarkAsNotSpam:ca.onCommentMarkAsNotSpam.bind(null,aa),onOneClickRemove:ca.onCommentOneClickRemove.bind(null,aa),onPreviewRemove:ca.onPreviewRemove.bind(null,aa),onRemove:ca.onCommentRemove.bind(null,aa),onRetrySubmit:ca.onRetrySubmit.bind(null,aa),onUndoInlineBan:ca.onCommentUndoInlineBan.bind(null,aa),onUndoOneClickRemove:ca.onCommentUndoOneClickRemove.bind(null,aa)}));},_updateRepliesState:function(aa,ba,ca){var da=this.state.instanceShowRepliesMap;da[aa]=ba;var ea=this.state.instanceShowReplySocialSentenceMap;ea[aa]=ca;this.setState({instanceShowRepliesMap:da,instanceShowReplySocialSentenceMap:ea});},onToggleReplies:function(aa){var ba=!this._shouldShowCommentReplies(aa.id),ca=this._shouldShowReplySocialSentence(aa.id)&&!(ba&&aa.replycount<=this.props.replySocialSentenceMaxReplies);this._updateRepliesState(aa.id,ba,ca);var da=this.props.availableRanges[aa.id].length;if(aa.id in this.state.requestRanges)da=this.state.requestRanges[aa.id].length;da-=this.props.deletedCounts[aa.id];if(ba&&da===0){var ea=this.props.commentCounts[aa.id],fa=Math.min(ea,this.props.pageSize);this.onPage(aa.id,{offset:ea-fa,length:fa});}},onPage:function(aa,ba){var ca=this.state.requestRanges;ca[aa]=ba;var da=this.state.hasPagedToplevel||aa===this.props.id;this.setState({requestRanges:ca,isActiveLoading:true,hasPagedToplevel:da});this.props.onChangeRange(aa,ba);},isLoadingPrev:function(aa){var ba=this.props;aa=aa||ba.id;if(!this.state.requestRanges[aa])this.state.requestRanges[aa]=ba.availableRanges[aa];var ca=this.state.requestRanges[aa].offset,da=ba.availableRanges[aa].offset;return ca<da;},isLoadingNext:function(aa){var ba=this.props;aa=aa||ba.id;if(!this.state.requestRanges[aa])this.state.requestRanges[aa]=ba.availableRanges[aa];var ca=this.state.requestRanges[aa].offset,da=this.state.requestRanges[aa].length,ea=ba.availableRanges[aa].offset,fa=ba.availableRanges[aa].length;return ca+da>ea+fa;},renderPagers:function(aa){var ba=this.props;aa=aa||ba.id;var ca=ba.availableRanges[aa].offset,da=ba.availableRanges[aa].length,ea=ba.deletedCounts[aa],fa=ba.commentCounts[aa],ga=fa-ea,ha=da-ea,ia=ba.contextArgs.numberdelimiter||',',ja=aa!==ba.id,ka={topPager:null,bottomPager:null};if(ba.source==n.UFIFeedbackSourceType.ADS)return ka;var la=this.isLoadingPrev(aa),ma=this.isLoadingNext(aa);if(da==fa)return ka;var na=(ca+da)==fa;if((fa<ba.pageSize&&na)||ha===0){var oa=Math.min(fa,ba.pageSize),pa=this.onPage.bind(this,aa,{offset:fa-oa,length:oa}),qa,ra;if(ha===0){if(ga==1){qa=ja?"View 1 reply":"View 1 comment";}else{ra=g.formatIntegerWithDelimiter(ga,ia);qa=ja?y._("View all {count} replies",{count:ra}):y._("View all {count} comments",{count:ra});}}else if(ga-ha==1){qa=ja?"View 1 more reply":"View 1 more comment";}else{ra=g.formatIntegerWithDelimiter(ga-ha,ia);qa=ja?y._("View {count} more replies",{count:ra}):y._("View {count} more comments",{count:ra});}var sa=j.getTrackingInfo(j.types.VIEW_ALL_COMMENTS),ta=s({contextArgs:ba.contextArgs,isUnseen:ba.feedback.hasunseencollapsed,isLoading:la,pagerLabel:qa,onPagerClick:pa,'data-ft':sa});if(ba.feedback.isranked&&!ja){ka.bottomPager=ta;}else ka.topPager=ta;return ka;}if(ca>0){var ua=Math.max(ca-ba.pageSize,0),oa=ca+da-ua,va=this.onPage.bind(this,aa,{offset:ua,length:oa}),wa=g.formatIntegerWithDelimiter(ha,ia),xa=g.formatIntegerWithDelimiter(ga,ia),ya=y._("{countshown} of {totalcount}",{countshown:wa,totalcount:xa});if(ba.feedback.isranked&&!ja){ka.bottomPager=s({contextArgs:ba.contextArgs,isLoading:la,pagerLabel:"View more comments",onPagerClick:va,countSentence:ya});}else{var za=ja?"View previous replies":"View previous comments";ka.topPager=s({contextArgs:ba.contextArgs,isLoading:la,pagerLabel:za,onPagerClick:va,countSentence:ya});}}if(ca+da<fa){var ab=Math.min(da+ba.pageSize,fa-ca),bb=this.onPage.bind(this,aa,{offset:ca,length:ab});if(ba.feedback.isranked&&!ja){ka.topPager=s({contextArgs:ba.contextArgs,isLoading:ma,pagerLabel:"View previous comments",onPagerClick:bb});}else{var cb=ja?"View more replies":"View more comments";ka.bottomPager=s({contextArgs:ba.contextArgs,isLoading:ma,pagerLabel:cb,onPagerClick:bb});}}return ka;},onCommentReply:function(aa){var ba=aa.parentcommentid||aa.id;if(!this._shouldShowCommentReplies(ba))this.onToggleReplies(aa);if(this.refs&&this.refs['replycomposer-'+ba])this.refs['replycomposer-'+ba].focus();},onComment:function(){if(this.refs&&this.refs.toplevelcomposer)this.refs.toplevelcomposer.focus();}});e.exports=z;});
__d("onEnclosingPageletDestroy",["Arbiter","DOMQuery"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('DOMQuery');function i(j,k){var l=g.subscribe('pagelet/destroy',function(m,n){if(h.contains(n.root,j)){l.unsubscribe();k();}});return l;}e.exports=i;});
__d("UFIController",["Arbiter","Bootloader","CSS","DOM","ImmutableObject","LayerRemoveOnHide","LiveTimer","Parent","PubcontentFeedChainingController","React","ReactMount","ShortProfiles","UFI.react","UFIActionLinkController","UFICentralUpdates","UFIComments","UFIConstants","UFIFeedbackTargets","UFIInstanceState","UFIUserActions","URI","copyProperties","isEmpty","onEnclosingPageletDestroy","tx","UFICommentTemplates"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Bootloader'),i=b('CSS'),j=b('DOM'),k=b('ImmutableObject'),l=b('LayerRemoveOnHide'),m=b('LiveTimer'),n=b('Parent'),o=b('PubcontentFeedChainingController'),p=b('React'),q=b('ReactMount'),r=b('ShortProfiles'),s=b('UFI.react'),t=b('UFIActionLinkController'),u=b('UFICentralUpdates'),v=b('UFIComments'),w=b('UFIConstants'),x=b('UFIFeedbackTargets'),y=b('UFIInstanceState'),z=b('UFIUserActions'),aa=b('URI'),ba=b('copyProperties'),ca=b('isEmpty'),da=b('onEnclosingPageletDestroy'),ea=b('tx'),fa=b('UFICommentTemplates'),ga=function(ja,ka,la,ma){var na=ja.offset+ja.length===ka;return {offset:ja.offset,length:(na&&ha(ma))?la-ja.offset:ja.length};},ha=function(ja){return ja==w.UFIPayloadSourceType.USER_ACTION||ja==w.UFIPayloadSourceType.LIVE_SEND;};function ia(ja,ka,la){this.root=ja;this.id=ka.ftentidentifier;this.source=ka.source;this._ufiInstanceID=ka.instanceid;this._contextArgs=ka;this._contextArgs.rootid=this.root.id;this._verifiedCommentsExpanded=false;var ma=la.feedbacktargets[0];this.actionLink=new t(ja,this._contextArgs,ma);this.orderingMode=ma.defaultcommentorderingmode;var na=la.commentlists.comments[this.id][this.orderingMode];this.replyRanges={};this.repliesMap={};this.showRepliesMap={};this.showReplySocialSentenceMap={};this.commentcounts={};this.commentcounts[this.id]=v.getCommentCount(this.id);var oa={},pa=ma.orderingmodes||[{value:this.orderingMode}];pa.forEach(function(ta){oa[ta.value]=ba({},na.range);});this.ranges=oa;if(la.commentlists.replies)for(var qa=0;qa<na.values.length;qa++){var ra=na.values[qa],sa=la.commentlists.replies[ra];if(sa){this.commentcounts[ra]=v.getCommentCount(ra);this.replyRanges[ra]=ba({},sa.range);}}this._loggingOffset=null;this._ufi=null;this.ufiCentralUpdatesSubscriptions=[u.subscribe('feedback-updated',function(ta,ua){var va=ua.updates,wa=ua.payloadSource;if(wa!=w.UFIPayloadSourceType.COLLAPSED_UFI&&this.id in va)this.fetchAndUpdate(this.render.bind(this),wa);}.bind(this)),u.subscribe('feedback-id-changed',function(ta,ua){var va=ua.updates;if(this.id in va)this.id=va[this.id];}.bind(this)),u.subscribe('instance-updated',function(ta,ua){var va=ua.updates;if(this._ufiInstanceID in va){var wa=va[this._ufiInstanceID];if(wa.editcommentid)this.render(ua.payloadSource);}}.bind(this)),u.subscribe('update-comment-lists',function(ta,ua){if(ua.commentlists&&ua.commentlists.replies){var va=ua.commentlists.replies;for(var wa in va)if(this.id!=wa&&va[wa]&&va[wa].ftentidentifier==this.id&&!this.replyRanges[wa])this.replyRanges[wa]=va[wa].range;}}.bind(this))];this.clearPageletSubscription=da(this.root,this._onEnclosingPageletDestroy.bind(this));this.clearPageSubscription=g.subscribe('ufi/page_cleared',this._onDestroy.bind(this));u.handleUpdate(w.UFIPayloadSourceType.INITIAL_SERVER,la);if(this._contextArgs.viewas)this.viewasUFICleanSubscription=g.subscribe('pre_page_transition',function(ta,ua){if(this._contextArgs.viewas!==aa(ua.to).getQueryData('viewas'))v.resetFeedbackTarget(this.id);}.bind(this));h.loadModules(['ScrollAwareDOM'],function(ta){q.scrollMonitor=ta.monitor;});}ba(ia.prototype,{_getParentForm:function(){if(!this._form)this._form=n.byTag(this.root,'form');return this._form;},_onTargetLikeToggle:function(event){var ja=!this.feedback.hasviewerliked;z.changeLike(this.id,ja,{source:this.source,target:event.target,rootid:this._contextArgs.rootid});event.preventDefault();},_onCommentLikeToggle:function(ja,event){var ka=!ja.hasviewerliked;z.changeCommentLike(ja.id,ka,{source:this.source,target:event.target});},_onCommentEdit:function(ja){y.updateState(this._ufiInstanceID,'isediting',true);y.updateState(this._ufiInstanceID,'editcommentid',ja.id);},_onEditAttempt:function(ja,ka,event){if(!ka.visibleValue&&!ka.attachedPhoto&&!ka.attachedSticker){this._onCommentRemove(ja,event);}else z.editComment(ja.id,ka.visibleValue,ka.encodedValue,{source:this._contextArgs.source,target:event.target,attachedPhoto:ka.attachedPhoto,attachedSticker:ka.attachedSticker});y.updateStateField(this._ufiInstanceID,'locallycomposed',ja.id,true);this._onEditReset();},_onEditReset:function(){y.updateState(this._ufiInstanceID,'isediting',false);y.updateState(this._ufiInstanceID,'editcommentid',null);},_onCommentRemove:function(ja,event){var ka=fa[':fb:ufi:hide-dialog-template'].build();j.setContent(ka.getNode('body'),"Are you sure you want to delete this comment?");j.setContent(ka.getNode('title'),"Delete Comment");h.loadModules(['DialogX'],function(la){var ma=new la({modal:true,width:465,addedBehaviors:[l]},ka.getRoot());ma.subscribe('confirm',function(){z.removeComment(ja.id,{source:this.source,oneclick:false,target:event.target,timelinelogdata:this._contextArgs.timelinelogdata});ma.hide();}.bind(this));ma.show();}.bind(this));},_onCommentOneClickRemove:function(ja,event){z.removeComment(ja.id,{source:this.source,oneclick:true,target:event.target,timelinelogdata:this._contextArgs.timelinelogdata});},_onCommentUndoOneClickRemove:function(ja,event){var ka=this.feedback.canremoveall&&this.feedback.isownerpage&&this.feedback.actorforpost!==this.authorProfiles[ja.author];z.undoRemoveComment(ja.id,ka,{source:this.source,target:event.target});},_onCommentHideAsSpam:function(ja,event){z.setHideAsSpam(ja.id,true,{source:this.source,target:event.target});},_onCommentMarkAsNotSpam:function(ja,event){z.setHideAsSpam(ja.id,false,{source:this.source,target:event.target});},_onCommentTranslate:function(ja,event){z.translateComment(ja,{source:this.source,target:event.target});},_onCommentInlineBanChange:function(ja,ka,event){z.banUser(ja,this.feedback.ownerid,ka,{source:this.source,target:event.target});},_onCommentInlineBan:function(ja,event){this._onCommentInlineBanChange(ja,true,event);},_onCommentUndoInlineBan:function(ja,event){this._onCommentInlineBanChange(ja,false,event);},_fetchSpamComments:function(ja,ka){z.fetchSpamComments(this.id,ja,ka,this._contextArgs.viewas);},_removePreview:function(ja,event){z.removePreview(ja,{source:this.source,target:event.target});},_retrySubmit:function(ja){h.loadModules(['UFIRetryActions'],function(ka){ka.retrySubmit(ja,{source:this.source});}.bind(this));},_ensureCommentsExpanded:function(){if(this._verifiedCommentsExpanded)return;var ja=n.byTag(this.root,'form');if(ja&&!o.ufiExpansionBlockedOnce(this.id)){i.removeClass(ja,'collapsed_comments');this._verifiedCommentsExpanded=true;}},render:function(ja){var ka=this.comments.length||!ca(this.feedback.likesentences.current);if(ka&&ha(ja))this._ensureCommentsExpanded();if(this._loggingOffset===null)this._loggingOffset=this.ranges[this.orderingMode].offset+this.comments.length-1;var la=this.feedback.replysocialsentencemaxreplies||-1,ma={};ma[this.id]=v.getDeletedCount(this.id);this.comments.forEach(function(pa){ma[pa.id]=v.getDeletedCount(pa.id);});var na=ba({},this.replyRanges);na[this.id]=this.ranges[this.orderingMode];na=new k(na);var oa=s({feedback:this.feedback,id:this.id,onTargetLikeToggle:this._onTargetLikeToggle.bind(this),onCommentLikeToggle:this._onCommentLikeToggle.bind(this),onCommentRemove:this._onCommentRemove.bind(this),onCommentHideAsSpam:this._onCommentHideAsSpam.bind(this),onCommentMarkAsNotSpam:this._onCommentMarkAsNotSpam.bind(this),onCommentEdit:this._onCommentEdit.bind(this),onCommentOneClickRemove:this._onCommentOneClickRemove.bind(this),onCommentUndoOneClickRemove:this._onCommentUndoOneClickRemove.bind(this),onCommentTranslate:this._onCommentTranslate.bind(this),onCommentInlineBan:this._onCommentInlineBan.bind(this),onCommentUndoInlineBan:this._onCommentUndoInlineBan.bind(this),onEditAttempt:this._onEditAttempt.bind(this),onCancelEdit:this._onEditReset.bind(this),onChangeRange:this._changeRange.bind(this),onSpamFetch:this._fetchSpamComments.bind(this),onPreviewRemove:this._removePreview.bind(this),onRetrySubmit:this._retrySubmit.bind(this),onOrderingModeChange:this._onOrderingModeChange.bind(this),contextArgs:this._contextArgs,repliesMap:this.repliesMap,showRepliesMap:this.showRepliesMap,showReplySocialSentenceMap:this.showReplySocialSentenceMap,commentCounts:this.commentcounts,deletedCounts:ma,availableComments:this.comments,source:this.source,availableRanges:na,pageSize:w.defaultPageSize,authorProfiles:this.authorProfiles,instanceid:this._ufiInstanceID,loggingOffset:this._loggingOffset,replySocialSentenceMaxReplies:la,giftRecipient:this._giftRecipient,orderingMode:this.orderingMode});this._ufi=p.renderComponent(oa,this.root);m.updateTimeStamps();if(this._getParentForm())g.inform('ufi/changed',{form:this._getParentForm()});if(ja!=w.UFIPayloadSourceType.INITIAL_SERVER&&ja!=w.UFIPayloadSourceType.COLLAPSED_UFI)g.inform('reflow');},fetchAndUpdate:function(ja,ka){x.getFeedbackTarget(this.id,function(la){var ma=v.getCommentCount(this.id),na=ga(this.ranges[this.orderingMode],this.commentcounts[this.id],ma,ka);v.getCommentsInRange(this.id,na,this.orderingMode,this._contextArgs.viewas,function(oa){var pa=[],qa={},ra={};if(la.actorforpost)pa.push(la.actorforpost);for(var sa=0;sa<oa.length;sa++){if(oa[sa].author)pa.push(oa[sa].author);if(oa[sa].socialcontext)pa.push(oa[sa].socialcontext.topmutualid);if(oa[sa].replyauthors&&oa[sa].replyauthors.length)for(var ta=0;ta<oa[sa].replyauthors.length;ta++)pa.push(oa[sa].replyauthors[ta]);if(la.isthreaded){var ua=oa[sa].id,va=v.getCommentCount(ua),wa;if(this.replyRanges[ua]){wa=ga(this.replyRanges[ua],this.commentcounts[ua],va,ka);}else wa={offset:0,length:Math.min(va,2)};qa[ua]=wa;ra[ua]=va;}}v.getRepliesInRanges(this.id,qa,function(xa){for(var ya=0;ya<oa.length;ya++){var za=oa[ya].id,ab=xa[za]||[];for(var bb=0;bb<ab.length;bb++){if(ab[bb].author)pa.push(ab[bb].author);if(ab[bb].socialcontext)pa.push(ab[bb].socialcontext.topmutualid);}}if(this._contextArgs.giftoccasion)pa.push(la.actorid);r.getMulti(pa,function(cb){if(this._contextArgs.giftoccasion)this._giftRecipient=cb[la.actorid];this.authorProfiles=cb;this.feedback=la;this.commentcounts[this.id]=ma;this.comments=oa;this.ranges[this.orderingMode]=na;for(var db=0;db<oa.length;db++){var eb=oa[db].id,fb=qa[eb];this.repliesMap[eb]=xa[eb];this.replyRanges[eb]=fb;this.commentcounts[eb]=ra[eb];this.showRepliesMap[eb]=fb&&fb.length>0;if(this.showReplySocialSentenceMap[eb]===undefined&&ra[eb]>0)this.showReplySocialSentenceMap[eb]=!this.showRepliesMap[eb];}ja(ka);if(ka==w.UFIPayloadSourceType.ENDPOINT_COMMENT_FETCH)g.inform('CommentUFI.Pager');}.bind(this));}.bind(this));}.bind(this));}.bind(this));},_changeRange:function(ja,ka){if(ja==this.id){this.ranges[this.orderingMode]=ka;}else this.replyRanges[ja]=ka;this.fetchAndUpdate(this.render.bind(this),w.UFIPayloadSourceType.USER_ACTION);},_onEnclosingPageletDestroy:function(){p.unmountAndReleaseReactRootNode(this.root);this.ufiCentralUpdatesSubscriptions.forEach(u.unsubscribe.bind(u));g.unsubscribe(this.clearPageSubscription);this.viewasUFICleanSubscription&&g.unsubscribe(this.viewasUFICleanSubscription);},_onDestroy:function(){this._onEnclosingPageletDestroy();g.unsubscribe(this.clearPageletSubscription);},_onOrderingModeChange:function(ja){this.orderingMode=ja;this.fetchAndUpdate(this.render.bind(this),w.UFIPayloadSourceType.USER_ACTION);}});e.exports=ia;});
__d("EntstreamCollapsedUFIActions",["PopupWindow","React","TrackingNodes","URI","cx","tx"],function(a,b,c,d,e,f){var g=b('PopupWindow'),h=b('React'),i=b('TrackingNodes'),j=b('URI'),k=b('cx'),l=b('tx'),m=h.createClass({displayName:'EntstreamCollapsedUFIActions',getLikeButton:function(){return this.refs.likeButton.getDOMNode();},getLikeIcon:function(){return this.refs.likeIcon.getDOMNode();},render:function(){var n;if(this.props.shareHref!==null){var o=i.getTrackingInfo(i.types.SHARE_LINK),p=j(this.props.shareHref),q=[h.DOM.i({className:"_6k1 _528f"}),"Share"];if(p.getPath().indexOf('/ajax')===0){n=h.DOM.a({ajaxify:this.props.shareHref,className:"_6j_ _5cix",'data-ft':o,href:"#",rel:"dialog",title:"Share this item"},q);}else{var r=function(){g.open(this.props.shareHref,480,600);return false;}.bind(this);n=h.DOM.a({className:"_6j_ _5cix",'data-ft':o,href:this.props.shareHref,onClick:r,target:"_blank",title:"Share this item"},q);}}var s;if(this.props.canComment){var t="_6k4 _528f",u=[h.DOM.i({className:t}),"Comment"],v="_6k2 _5cix",w=i.getTrackingInfo(i.types.COMMENT_LINK);if(this.props.storyHref){s=h.DOM.a({className:v,'data-ft':w,href:this.props.storyHref,target:"_blank",title:"Write a comment..."},u);}else s=h.DOM.a({className:v,'data-ft':w,href:"#",onClick:this.props.onCommentClick,title:"Write a comment..."},u);}var x;if(this.props.canLike){var y=((this.props.hasViewerLiked?"_6k5":'')+(' '+"_6k6")+(' '+"_5cix")),z=i.getTrackingInfo(this.props.hasViewerLiked?i.types.UNLIKE_LINK:i.types.LIKE_LINK),aa=this.props.hasViewerLiked?"Unlike this":"Like this";x=h.DOM.a({className:y,'data-ft':z,href:"#",onClick:this.props.onLike,onMouseDown:this.props.onLikeMouseDown,ref:"likeButton",title:aa},h.DOM.i({className:"_6k7 _528f",ref:"likeIcon"}),"Like",h.DOM.div({className:"_55k4"}));}return (h.DOM.div({className:"_5ciy"},x,s,n));}});e.exports=m;});
__d("EntstreamCollapsedUFISentence",["Bootloader","NumberFormat","ProfileBrowserLink","ProfileBrowserTypes","React","URI","cx","tx"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('NumberFormat'),i=b('ProfileBrowserLink'),j=b('ProfileBrowserTypes'),k=b('React'),l=b('URI'),m=b('cx'),n=b('tx'),o=k.createClass({displayName:'EntstreamCollapsedUFISentence',_showShareDialog:function(event){event=event.nativeEvent;if(event.isDefaultRequested())return;g.loadModules(['EntstreamShareOverlay'],function(p){p.display(this.props.feedback.targetfbid,this._getShareString());}.bind(this));event.prevent();},_getShareString:function(){var p=this.props.feedback.sharecount,q=this.props.numberDelimiter||',';if(p===1){return "1 Share";}else if(p>1){var r=h.formatIntegerWithDelimiter(p,q);return n._("{count} Shares",{count:r});}},render:function(){var p=this.props.feedback,q=p.likecount,r=this.props.commentCount,s=p.sharecount,t=p.seencount,u=this.props.hasAttachedUFIExpanded,v=this.props.numberDelimiter||',';if(u){q=0;r=0;}if(!q&&!r&&!s&&!t)return k.DOM.span(null);var w;if(q===1){w="1 Like";}else if(q>1){var x=h.formatIntegerWithDelimiter(q,v);w=n._("{count} Likes",{count:x});}var y;if(r===1){y="1 Comment";}else if(r>1){var z=h.formatIntegerWithDelimiter(r,v);y=n._("{count} Comments",{count:z});}var aa=this._getShareString(),ba,ca,da;if(w){ca=new l('/ajax/like/tooltip.php').setQueryData({comment_fbid:p.targetfbid,comment_from:p.actorforpost,seen_user_fbids:true});var ea=((y||aa?"prm":''));ba=j.LIKES;da={id:p.targetfbid};var fa=i.constructDialogURI(ba,da).toString();if(this.props.storyHref){w=null;}else w=k.DOM.a({ajaxify:fa,className:ea,href:i.constructPageURI(ba,da).toString(),'data-hover':"tooltip",'data-tooltip-alignh':"center",'data-tooltip-uri':ca.toString(),rel:"dialog"},w);}var ga;if(t>0){ba=j.GROUP_MESSAGE_VIEWERS;da={id:p.targetfbid};var ha=i.constructDialogURI(ba,da),ia=i.constructPageURI(ba,da);ca=new l('/ajax/ufi/seen_tooltip.php').setQueryData({ft_ent_identifier:p.entidentifier,displayed_count:t});var ja=h.formatIntegerWithDelimiter(t,v);if(p.seenbyall){ga="Seen by everyone";}else ga=ja==1?"Seen by 1":n._("Seen by {count}",{count:ja});ga=k.DOM.a({ajaxify:ha.toString(),'data-hover':"tooltip",'data-tooltip-alignh':"center",'data-tooltip-uri':ca.toString(),href:ia.toString(),rel:"dialog",tabindex:"-1"},ga);}if(y){var ka=((aa?"prm":''));if(this.props.storyHref){y=k.DOM.a({className:ka,href:this.props.storyHref,target:"_blank"},y);}else y=k.DOM.a({className:ka,href:"#",onClick:this.props.onCommentClick},y);}if(aa){var la=new l('/shares/view').setSubdomain('www').setQueryData({id:p.targetfbid});if(this.props.storyHref){aa=k.DOM.a({href:la.toString(),target:"_blank"},aa);}else aa=k.DOM.a({href:la.toString(),onClick:this._showShareDialog,rel:"ignore"},aa);}return (k.DOM.span({className:"_5civ"},w,y,aa,ga));}});e.exports=o;});
__d("EntstreamCollapsedUFI",["Event","Animation","BrowserSupport","CSS","DOM","Ease","EntstreamCollapsedUFIActions","EntstreamCollapsedUFISentence","React","TrackingNodes","Vector","cx","queryThenMutateDOM"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Animation'),i=b('BrowserSupport'),j=b('CSS'),k=b('DOM'),l=b('Ease'),m=b('EntstreamCollapsedUFIActions'),n=b('EntstreamCollapsedUFISentence'),o=b('React'),p=b('TrackingNodes'),q=b('Vector'),r=b('cx'),s=b('queryThenMutateDOM'),t=16,u=o.createClass({displayName:'EntstreamCollapsedUFI',_animate:function(v,w,x,y){if(!i.hasCSSTransforms())return;var z=this.refs.icons.getLikeIcon();this._animation&&this._animation.stop();this._animation=new h(z).from('scaleX',v).from('scaleY',v).to('scaleX',w).to('scaleY',w).duration(x);y&&this._animation.ease(y);this._animation.go();},bounceLike:function(){this._animate(1.35,1,750,l.bounceOut);},shrinkLike:function(){this._animate(1,.85,150);this._mouseUpListener=g.listen(document.body,'mouseup',this._onMouseUp);},_onMouseUp:function(event){this._mouseUpListener.remove();if(!k.contains(this.refs.icons.getLikeButton(),event.getTarget()))this._animate(.85,1,150);},render:function(){var v=this.props.feedback,w=p.getTrackingInfo(p.types.BLINGBOX);return (o.DOM.div({className:"clearfix"},m({canLike:v.viewercanlike,canComment:v.cancomment,hasViewerLiked:v.hasviewerliked,onCommentClick:this.props.onCommentClick,onLike:this.props.onLike,onLikeMouseDown:this.props.onLikeMouseDown,ref:"icons",shareHref:this.props.shareHref,storyHref:this.props.storyHref}),o.DOM.div({className:"_6j-",'data-ft':w,ref:"sentence"},n({commentCount:this.props.commentCount,feedback:v,hasAttachedUFIExpanded:this.props.hasAttachedUFIExpanded,numberDelimiter:this.props.numberDelimiter,onCommentClick:this.props.onCommentClick,storyHref:this.props.storyHref}))));},componentDidMount:function(v){var w=this.refs.icons.getDOMNode(),x=this.refs.sentence.getDOMNode(),y,z,aa;s(function(){y=q.getElementDimensions(v).x;z=q.getElementDimensions(w).x;aa=q.getElementDimensions(x).x;},function(){if(z+aa>y+t)j.addClass(v,"_5ext");});}});e.exports=u;});
__d("EntstreamCollapsedUFIController",["Bootloader","CommentPrelude","CSS","DOM","EntstreamCollapsedUFI","React","ReactMount","UFICentralUpdates","UFIComments","UFIConstants","UFIFeedbackTargets","UFIUserActions","copyProperties","cx","onEnclosingPageletDestroy"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('CommentPrelude'),i=b('CSS'),j=b('DOM'),k=b('EntstreamCollapsedUFI'),l=b('React'),m=b('ReactMount'),n=b('UFICentralUpdates'),o=b('UFIComments'),p=b('UFIConstants'),q=b('UFIFeedbackTargets'),r=b('UFIUserActions'),s=b('copyProperties'),t=b('cx'),u=b('onEnclosingPageletDestroy'),v=p.UFIPayloadSourceType;function w(x,y,z){this._root=x;this._id=z.ftentidentifier;this._contextArgs=z;this._ufiVisible=z.hasattachedufiexpanded;this._updateSubscription=n.subscribe('feedback-updated',function(aa,ba){if(ba.payloadSource!=v.INITIAL_SERVER&&this._id in ba.updates)this.render();}.bind(this));n.handleUpdate(p.UFIPayloadSourceType.COLLAPSED_UFI,y);g.loadModules(['ScrollAwareDOM'],function(aa){m.scrollMonitor=aa.monitor;});u(this._root,this.destroy.bind(this));}s(w.prototype,{_onLike:function(event){this._feedbackSubscription=q.getFeedbackTarget(this._id,function(x){r.changeLike(this._id,!x.hasviewerliked,{source:this._contextArgs.source,target:event.target,rootid:j.getID(this._root)});}.bind(this));this._ufi.bounceLike();event.preventDefault();},_onLikeMouseDown:function(event){this._ufi.shrinkLike();event.preventDefault();},_onCommentClick:function(event){if(!this._ufiVisible){this._ufiVisible=true;i.addClass(this._root,"_6ka");}h.click(this._root);event.preventDefault();},render:function(){this._feedbackSubscription=q.getFeedbackTarget(this._id,function(x){var y=k({commentCount:o.getCommentCount(this._id),feedback:x,hasAttachedUFIExpanded:this._contextArgs.hasattachedufiexpanded,numberDelimiter:this._contextArgs.numberdelimiter,onCommentClick:this._onCommentClick.bind(this),onLike:this._onLike.bind(this),onLikeMouseDown:this._onLikeMouseDown.bind(this),shareHref:this._contextArgs.sharehref,storyHref:this._contextArgs.storyhref});l.renderComponent(y,this._root);this._ufi=this._ufi||y;}.bind(this));},destroy:function(){if(this._feedbackSubscription){q.unsubscribe(this._feedbackSubscription);this._feedbackSubscription=null;}this._updateSubscription.unsubscribe();this._updateSubscription=null;l.unmountAndReleaseReactRootNode(this._root);this._root=null;this._id=null;this._contextArgs=null;this._ufiVisible=null;}});e.exports=w;});