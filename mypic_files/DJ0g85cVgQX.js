/*!CK:799699895!*//*1375676967,178195489*/

if (self.CavalryLogger) { CavalryLogger.start_js(["c32Ny"]); }

__d("InteractionLogger",["Arbiter","Banzai","Event","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Banzai'),i=b('Event'),j=b('copyProperties');function k(l,m){m=m||{};this.profiler={};this.log={};this.lastInteraction=Date.now();this.interactionTime=0;this.eventSequence=[];this.projectName=l;if(m.trackInteractionTime)i.listen(document.body,'mousemove',this._pingActive.bind(this));if(m.submitOnLeave||m.submitOnLeave===undefined)this.arbiterToken=g.subscribe('onload/exit',function(){this.submit();this.arbiterToken.unsubscribe();}.bind(this));}j(k,{IDLE_LIMIT:20000});j(k.prototype,{set:function(l,m){this.log[l]=m;},tap:function(l){this.eventSequence.push(l);},bump:function(l,m){if(m===undefined)m=1;this.log[l]=(this.log[l]||0)+m;},bumpTap:function(l,m){this.tap(l);this.bump(l,m);},startRun:function(l){if(!this.profiler[l])this.profiler[l]={average:0,count:0};this.profiler[l].start=+new Date();},endRun:function(l){if(!this.profiler[l]||!this.profiler[l].start)return;this._recordRun(l,new Date()-this.profiler[l].start);this.profiler[l].start=null;},getLog:function(){this._updateLog();return this.log;},submit:function(){this._updateLog();h.post(this.projectName,this.log);},_pingActive:function(){var l=Date.now(),m=l-this.lastInteraction;if(m<(k.IDLE_LIMIT))this.interactionTime+=m;this.lastInteraction=l;},_updateLog:function(){for(var l in this.profiler){this.log[l+'-count']=this.profiler[l].count;this.log[l+'-average']=this.profiler[l].average;}if(this.interactionTime)this.log['interaction-time']=this.interactionTime;if(this.eventSequence.length)this.log['event-sequence']=this.eventSequence;},_recordRun:function(l,m){var n=this.profiler[l];n.average=(n.average*n.count+m)/(n.count+1);n.count++;}});e.exports=k;});
__d("TimelineMapFilterMedley",["CSS","DOM","Style","$","csx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('$'),k=b('csx');function l(m){var n=h.find(j('pagelet_timeline_medley_map'),"._3dc");g.show(m);h.setContent(n,m);i.set(n,'visibility','visible');}e.exports=l;});
__d("TimelineMapStickyHeaderComposer",["Arbiter","AsyncRequest","Bootloader","CSS","$","bind","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Bootloader'),j=b('CSS'),k=b('$'),l=b('bind'),m=b('copyProperties'),n=b('ge');function o(){g.subscribe('TimelineMapStickyHeaderComposer/showPhotoTagUnit',this.showPhotoTagUnit.bind(this));g.subscribe('TimelineMapStickyHeaderComposer/hidePhotoTagUnit',this.hidePhotoTagUnit.bind(this));}m(o.prototype,{initPlaceTypeahead:function(p){p.subscribe('focus',function(){i.loadModules(['TimelineMLE'],function(q){q.hideFlyout();});g.inform('TimelineMapStickyHeaderComposer/typeaheadFocus');}.bind(this));p.subscribe('blur',function(){g.inform('TimelineMapStickyHeaderComposer/typeaheadBlur');}.bind(this));p.subscribe('select',function(){g.inform('TimelineMapStickyHeaderComposer/typeaheadSelect');}.bind(this));},showPhotoTagUnit:function(p,q){this.tagUnit=k('fbTimelineMapTagUnit');var r=g.inform('TimelineAppSectionCuration/categoryHasContent');j.conditionShow(this.tagUnit,r);var s=n('mainContainer');s&&j.addClass(s,'photoTaggingMode');if(!this.tagUnitInited){this.tagUnitInited=true;this.indicator=k('fbTimelineMapAddPhotoLoading');j.show(this.indicator);var t=q?q.sid:null;new h().setURI('/ajax/timeline/map/photo_strip.php').setData({div_id:'fbTimelineMapTagUnit',sid:t}).setReadOnly(true).setHandler(l(this,'_onLoadPhotoStrip')).send();}else this._onLoadPhotoStrip();},hidePhotoTagUnit:function(){this.tagUnit=k('fbTimelineMapTagUnit');j.hide(this.tagUnit);var p=n('mainContainer');p&&j.removeClass(p,'photoTaggingMode');},_onLoadPhotoStrip:function(){j.hide(this.indicator);}});e.exports=o;});
__d("legacy:TimelineMapStickyHeaderComposer",["TimelineMapStickyHeaderComposer"],function(a,b,c,d){a.TimelineMapStickyHeaderComposer=b('TimelineMapStickyHeaderComposer');},3);
__d("TypeaheadTimelineHighlightMapPlace",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe(['reset','select','highlight'],function(j,k){if(j==='highlight'&&k.index!==-1&&k.selected.type!='freeform'&&k.selected.latitude&&k.selected.longitude&&!k.selected.changeCity&&k.index!=this.lastDataIdx){var l=k.selected.place_type=='city'?10:15;g.inform('TimelineMap/highlightMapPlace',{placeID:k.selected.uid,center:{latitude:k.selected.latitude,longitude:k.selected.longitude},zoom:l});}else if(j==='highlight'&&k.index==-1){g.inform('TimelineMap/highlightMapPlace',{dismiss:true});}else if(j==='select'){g.inform('TimelineMap/highlightMapPlace',{selected:true});}else if(j==='reset')g.inform('TimelineMap/highlightMapPlace',{dismiss:true});this.lastDataIdx=k&&k.index;});},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("TypeaheadTimelineShowThrobberOnSelect",["Arbiter","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe(['select'],function(j,k){g.inform('TimelineMap/highlightMapPlace',{showThrobber:true});});},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("legacy:TimelineMapPlaceTypeaheadBehaviors",["TypeaheadTimelineHighlightMapPlace","TypeaheadTimelineShowThrobberOnSelect"],function(a,b,c,d){var e=b('TypeaheadTimelineHighlightMapPlace'),f=b('TypeaheadTimelineShowThrobberOnSelect');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.highlightMapPlace=function(g){g.enableBehavior(e);};a.TypeaheadBehaviors.showThrobberOnSelect=function(g){g.enableBehavior(f);};},3);
__d("TimelineMLEPhotoPreviewGrid",["AsyncUploadRequest","AsyncRequest","Bootloader","CSS","DOM","FileInputUploader","Parent","ProgressBar","SortableGroup","TimelineMLEPhotoConfig","tx"],function(a,b,c,d,e,f){var g=b('AsyncUploadRequest'),h=b('AsyncRequest'),i=b('Bootloader'),j=b('CSS'),k=b('DOM'),l=b('FileInputUploader'),m=b('Parent'),n=b('ProgressBar'),o=b('SortableGroup'),p=b('TimelineMLEPhotoConfig'),q=b('tx'),r=1,s=2,t=3,u=[null,'typeOne','typeTwo','typeThree'];function v(z,aa,ba,ca,da){this._container=z;this._containerID=z.id;this._grid=aa;this._photoLimit=ba;this._profileID=ca;this._progressBarMarkup=p.progressBarMarkup;this._loadingIndicators=[];this._isLargePhotoPreview=da.isLargePhotoPreview;this._pendingPhotoRequests=0;this._photoDisplayType=0;this._tempPhotoRef=[];if(!p.enableDrag)return;this._sortableGroup=new o().setGrabCallback(x).setDropCallback(y);var ea=k.scry(aa,'.mlePhotoPreviewThumb');this._photoDisplayType=this._getPhotoType(ea.length);for(var fa=0;fa<ea.length;fa++){if(this._isLargePhotoPreview)this._updatePhotoClass(ea[fa]);this._bindPhoto(ea[fa]);}}v.prototype.destroy=function(){this._sortableGroup&&this._sortableGroup.destroy();};v.prototype._getNumPhotos=function(){return k.scry(this._grid,'.mlePhotoPreviewThumb').length+k.scry(this._grid,'.mlePhotoPlaceholder').length;};v.prototype._getPhotoType=function(z){switch(z){case 0:case 1:return r;case 2:return s;default:if((z<0)||(z>this._photoLimit))throw new Error('invalid number of photos');return t;}};v.prototype._updatePhotoClass=function(z){j.addClass(z,u[this._photoDisplayType]);};v.prototype._updateProgressBarClass=function(z){j.addClass(z,u[this._photoDisplayType]);};v.prototype._updateAddMorePhotosClass=function(){if(this._pendingPhotoRequests>0){j.addClass(k.find(this._container,'.mleAddMorePhotoButtons'),'disabled');}else j.removeClass(k.find(this._container,'.mleAddMorePhotoButtons'),'disabled');};v.prototype._updatePhotos=function(z,aa){var ba=aa,ca,da,ea,fa=this._getPhotoType(z),ga={display_elem:this._containerID,field_name:'photos',image_ids:[],profile_id:this._profileID,display_type:this._photoDisplayType};if(this._photoDisplayType!==fa){da=this._photoDisplayType;this._photoDisplayType=fa;ga.display_type=this._photoDisplayType;var ha=k.scry(this._grid,'.mlePhotoPreviewThumb');for(var ia=0;ia<ha.length;ia++){ca=k.find(ha[ia],'.mlePhotoPreviewInput');ba.push(ca.value);if((this._photoDisplayType===t)||(da===t)){this._unbindPhoto(ha[ia]);k.remove(ha[ia]);ea=this.createPlaceholder(ca.value);this._updateProgressBarClass(ea);}else{j.removeClass(ha[ia],u[da]);j.addClass(ha[ia],'photoLoading');j.hide(k.find(ha[ia],'.detachPhotoIcon'));j.show(k.find(ha[ia],'.photoLoadingSpinner'));this._unbindPhoto(ha[ia]);this._updatePhotoClass(ha[ia]);this._tempPhotoRef[ca.value]=ha[ia];}}}if(ba.length>0){ga.image_ids=ba;this._pendingPhotoRequests+=ba.length;if(this._photoDisplayType!==t)this._updateAddMorePhotosClass();new h().setURI('/ajax/timeline/mle_photo_select.php').setData(ga).setMethod('POST').send();}};v.prototype._bindPhoto=function(z){this._sortableGroup&&this._sortableGroup.addSortable(k.find(z,'input').getAttribute('value'),z);};v.prototype._unbindPhoto=function(z){this._sortableGroup&&this._sortableGroup.removeSortable(k.find(z,'input').getAttribute('value'));};v.prototype.filterPhotoClick=function(event){if((this._pendingPhotoRequests>0)&&(this._photoDisplayType!=t))event.kill();};v.prototype.attachPhoto=function(z,aa){if((!this._loadingIndicators[aa])&&(!this._tempPhotoRef[aa]))return;if(this._tempPhotoRef[aa]){this._updatePhotoClass(z);k.replace(this._tempPhotoRef[aa],z);this._bindPhoto(z);delete this._tempPhotoRef[aa];}else{var ba=this._loadingIndicators[aa].getRoot();if(m.byTag(ba,'body')){if(this._isLargePhotoPreview)this._updatePhotoClass(z);k.replace(ba,z);this._bindPhoto(z);}delete this._loadingIndicators[aa];}if(this._isLargePhotoPreview)if(--this._pendingPhotoRequests===0)this._updateAddMorePhotosClass();};v.prototype.detachPhoto=function(z){if(this._pendingPhotoRequests>0)return;this._unbindPhoto(z);k.remove(z);var aa=this._getNumPhotos();if(this._isLargePhotoPreview)this._updatePhotos(aa,[]);if(aa===0){j.show(k.find(this._container,'.mlePhotoButtons'));j.hide(k.find(this._container,'.mleAddMorePhotoButtons'));}else if(aa===this._photoLimit-1)j.show(k.find(this._container,'.mleAddMorePhotoButtons'));};v.prototype.createPlaceholder=function(z){var aa=this._progressBarMarkup.cloneNode(true);aa=k.appendContent(this._grid,aa)[0];this._loadingIndicators[z]=new n(aa);return aa;};v.prototype.addPhotos=function(z){var aa,ba=this._getNumPhotos(),ca=z.length,da=ba+ca;if(da>this._photoLimit){var ea=q._("The maximum number of photos you can add to this life event is {limit}. Please remove some photos and try again.",{limit:this._photoLimit});i.loadModules(['Dialog'],function(ha){new ha().setTitle("Too Many Photos").setBody(ea).setButtons(ha.OK).show();});return;}if(da===this._photoLimit)j.hide(k.find(this._container,'.mleAddMorePhotoButtons'));for(var fa=0;fa<ca;fa++)aa=this.createPlaceholder(z[fa]);if(this._isLargePhotoPreview){var ga=z.slice(0,ca);this._updatePhotos(da,ga);this._updateProgressBarClass(aa);}};v.prototype.destroyPlaceholder=function(z){if(!this._loadingIndicators[z])return;k.remove(this._loadingIndicators[z].getRoot());delete this._loadingIndicators[z];};v.prototype.initUploader=function(z,aa){var ba=z.getInput();ba.multiple=aa.multiple&&g.isSupported();z.subscribe('change',this._uploadPhotos.bind(this,ba,aa));};v.prototype._uploadPhotos=function(z,aa){j.hide(k.find(this._container,'.mlePhotoButtons'));j.show(k.find(this._container,'.mleAddMorePhotoButtons'));var ba=this._getNumPhotos(),ca=z.files?z.files.length:1;if(ca+ba>this._photoLimit){var da=q._("The maximum number of photos you can add to this life event is {limit}. Please remove some photos and try again.",{limit:this._photoLimit});i.loadModules(['Dialog'],function(ia){new ia().setTitle("Too Many Photos").setBody(da).setButtons(ia.OK).show();});w(z);return;}var ea;for(var fa=0;fa<ca;fa++){var ga=z.files?z.files[fa].name:z.value.split('\\').pop();ea=this.createPlaceholder(ga);}if(this._isLargePhotoPreview){this._updatePhotos(ba+ca,[]);this._updateProgressBarClass(ea);aa.uploadData.display_type=this._photoDisplayType;if(this._photoDisplayType!=t)this._pendingPhotoRequests+=ca;}var ha=new l(z).setURI(aa.uploadURI).setData(aa.uploadData).setAllowCrossOrigin(true).setUploadInParallel(true);ha.subscribe('progress',this._onProgress.bind(this));ha.subscribe('failure',this._onFailure.bind(this));ha.send();w(z);};v.prototype._onProgress=function(z,aa){var event=aa.event,ba=this._loadingIndicators[aa.upload.getFile().name];j.hide(k.find(ba.getRoot(),'.mlePhotoLoadingIndicator'));j.show(k.find(ba.getRoot(),'.mlePhotoProgressBar'));if(event.loaded==event.total){ba.setPosition(50);ba.setTarget(100,2000);}else ba.setPosition(50*event.loaded/event.total);};v.prototype._onFailure=function(z,aa){this.destroyPlaceholder(aa.upload.getFile().name);};function w(z){z.value='';z.files=null;}function x(z){j.addClass(z,'dragging');}function y(z,aa){j.removeClass(aa,'dragging');}e.exports=v;});
__d("TimelineMLEPhotoPreview",["Event","CSS","Dialog","DOM","Layer","Parent","TimelineMLEPhotoPreviewGrid","$"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('Dialog'),j=b('DOM'),k=b('Layer'),l=b('Parent'),m=b('TimelineMLEPhotoPreviewGrid'),n=b('$'),o=[],p={initPreviewGrid:function(q,r,s,t){var u=l.byClass(q,'mleContainer');p.destroyPreviewGrid(u);o[u.id]=new m(u,q,r,s,t);if(t.isLargePhotoPreview)g.listen(j.find(u,'.mleAddMorePhotoButtons'),'click',function(event){o[u.id].filterPhotoClick(event);});},destroyPreviewGrid:function(q){if(o[q.id]){o[q.id].destroy();delete o[q.id];}},initUploader:function(q,r,s){if(o[r])o[r].initUploader(q,s);},attachPhoto:function(q,r,s){if(o[q])o[q].attachPhoto(r,s);},listenForDetach:function(q,r){var s=o[r];g.listen(j.find(q,'.detachPhotoIcon'),'click',s.detachPhoto.bind(s,q));},listenForPhotoSelect:function(q,r){var s=n(r.display_elem),t=false;g.listen(q,'click',function(){if(t)return;t=true;h.hide(j.find(s,'.mlePhotoButtons'));h.show(j.find(s,'.mleAddMorePhotoButtons'));i.getCurrent().hide();var u=o[s.id];if(u)u.addPhotos([r.photo_fbid]);});},listenForSubmit:function(q,r,s){var t=n(s);q.subscribe('confirm',function(){var u=j.scry(q.getContentRoot(),'input[name="'+r+'"]'),v=[];for(var w=0;w<u.length;w++){var x=u[w];if(x.checked===true)v.push(x.value);}h.hide(j.find(t,'.mlePhotoButtons'));h.show(j.find(t,'.mleAddMorePhotoButtons'));var y;if(y=i.getCurrent())y.hide();if(y=k.getTopmostLayer())y.hide();if(o[t.id])o[t.id].addPhotos(v);});}};e.exports=p;});
__d("TimelineMLE",["Event","function-extensions","Arbiter","AsyncRequest","Bootloader","CSS","DOM","DOMScroll","fbt","Form","Parent","ProgressiveDatepicker","RelationshipStatus","TimelineCapsule","TimelineComposerUtilities","TimelineContentLoader","TimelineMLEPhotoPreview","Vector","$","areObjectsEqual","csx","tidyEvent"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Arbiter'),i=b('AsyncRequest'),j=b('Bootloader'),k=b('CSS'),l=b('DOM'),m=b('DOMScroll'),n=b('fbt'),o=b('Form'),p=b('Parent'),q=b('ProgressiveDatepicker'),r=b('RelationshipStatus'),s=b('TimelineCapsule'),t=b('TimelineComposerUtilities'),u=b('TimelineContentLoader'),v=b('TimelineMLEPhotoPreview'),w=b('Vector'),x=b('$'),y=b('areObjectsEqual'),z=b('csx'),aa=b('tidyEvent'),ba=0,ca={},da=null,ea=null;function fa(pa){return p.byClass(pa,'mleFlyoutForm');}function ga(pa){var qa=p.byClass(pa.getContext(),'fbTimelineCapsule');if(qa)return qa;return u.capsuleForCurrentSection();}function ha(pa){if(!pa)return;var qa=w.getScrollPosition().x,ra=w.getElementPosition(pa).y;ra=ra-u.HEADER_SCROLL_CUTOFF;m.scrollTo(new w(qa,ra,'document'));}function ia(pa){var qa=o.serialize(pa);ka(pa,qa);ja(pa,qa);if(!y(qa,ca.state)){la(pa);new i().setData(qa).setURI('/ajax/timeline/mle_header.php').setRelativeTo(pa).send();}}function ja(pa,qa){var ra=l.scry(pa,"._594n")[0];if(!ra)return;var sa=(qa.text_with&&qa.text_with[0])||qa.name;if(sa)l.setContent(ra,n._("{name} will be added to the Family section on your profile.",[n.param("name",sa)]));k.conditionClass(ra,'hidden_elem',!sa);}function ka(pa,qa){var ra=qa.type,sa=qa['with'],ta=l.scry(pa,'input.updateRelationshipStatus')[0];if(!ta)return;var ua=l.scry(pa,'li.relationshipConfirmation')[0];if(!ua)return;var va=l.find(pa,'li.relationshipTooManyPartners');if(sa&&sa.length>1){k.hide(ua);k.show(va);ta.checked=false;ta.disabled=true;return;}k.hide(va);ta.disabled=false;var wa=sa&&sa[0],xa=l.find(pa,'input.relationshipCurrentPartnerID').value,ya=l.find(pa,'input.relationshipCurrentStatus').value,za=r.isPartnerlessStatus(ra),ab=ta.checked&&!za&&wa&&(xa!=wa||ya!=ra);if(wa){var bb=qa.text_with[0],cb=l.find(pa,'span.relationshipPartnerName');l.setContent(cb,bb);}k.conditionClass(ua,'hidden_elem',!ab);}function la(pa){pa=pa||ca.element;if(!pa)return;ca={element:pa,state:o.serialize(pa)};}function ma(event){var pa=event.getTarget(),qa=pa.options[pa.selectedIndex];h.inform('TimelineMLE/mleSelectUpdated',pa);var ra=p.byClass(qa,'mleFormContainer');ia(ra);var sa=l.scry(ra,'.mleOtherLabel'),ta=l.scry(ra,'.mleOtherField');if(sa.length)sa=sa[0];if(ta.length)ta=ta[0];if(k.hasClass(qa,'mleOther')){k.show(sa);k.show(ta);var ua=l.find(ta,'.inputOuter').firstChild;ua.focus();}else{k.hide(sa);k.hide(ta);}}function na(pa){if(pa)g.listen(pa,'change',ma);}var oa={cancel:function(pa){if(fa(pa)){oa.hideFlyout();}else{var qa=p.byClass(pa,'mleContainer');qa&&v.destroyPreviewGrid(qa);var ra=p.byClass(pa,'fbTimelineNewMLE'),sa=p.byClass(pa,'fbTimelineCapsule');if(ra){l.remove(ra);}else{ra=p.byClass(pa,'fbTimelineEditMLE');k.removeClass(ra,'fbTimelineEditMLE');l.remove(l.scry(ra,'.timelineUnitContainer')[0]);k.show(l.scry(ra,'.timelineUnitContainer')[0]);}if(k.hasClass(ra,'fbTimelineNotStarred')){k.removeClass(ra,'fbTimelineNotStarred');j.loadModules(['TimelineStar'],function(ta){ta.unstarUnit(ra.childNodes[0],null,true);});}sa&&s.balanceCapsule(sa);h.inform('TimelineMap/resizeCallout');}ca={};return false;},registerButtons:function(pa,qa,ra,sa){aa(g.listen(qa,'mousedown',function(){pa.standalone?da.setStackable(false):l.setContent(l.find(sa,'.mleInlineErrorMsg'),'');}));if(ra)aa(g.listen(ra,'click',function(ta){ta.prevent();if(pa.location==='map')h.inform('TimelineMap/cancelCreation');pa.standalone?oa.hideFlyout():oa.cancel(ra);}));},replace:function(pa,qa){var ra=p.byClass(pa,'mleContainer');ra&&v.destroyPreviewGrid(ra);if(fa(pa)){var sa=p.byClass(pa,'fbTimelineEditMLEFlyout');if(sa){var ta=p.byClass(pa,'uiContextualLayerPositioner'),ua=ta.getAttribute('data-ownerid');pa=x(ua);oa.hideFlyout();}else{j.loadModules(['TimelineStoryPublisher'],function(ya){ya.publish(qa,da.getContext());oa.hideFlyout();});return false;}}var va=p.byClass(pa,'fbTimelineNewMLE'),wa=p.byClass(pa,'fbTimelineCapsule'),xa=false;if(va){xa=true;k.removeClass(va,'fbTimelineNewMLE');k.removeClass(va,'mleEditUnitContainer');}else{va=p.byClass(pa,'fbTimelineEditMLE');k.removeClass(va,'fbTimelineEditMLE');}l.setContent(va,qa.streamStory);k.addClass(va,'lifeEventContainer');if((xa||k.hasClass(va,'fbTimelineNotStarred'))&&!l.scry(va,'div.keepStarred')[0]){k.removeClass(va,'fbTimelineNotStarred');j.loadModules(['TimelineStar'],function(ya){ya.unstarUnit(va.childNodes[0],null,true);});}wa&&s.balanceCapsule(wa);return false;},swapInPromotedMLE:function(pa,qa,ra,sa){var ta=pa.parentNode;l.replace(pa,ra);k.addClass(ta,'lifeEventContainer');k.removeClass(ta,'fbTimelineTwoColumn');k.addClass(ta,'fbTimelineOneColumn');oa.startEdit(ta,qa);l.insertAfter(l.scry(ta,'div.topBorder')[0],sa);return false;},startEdit:function(pa,qa){oa.hideFlyout();var ra=l.scry(pa,'div.timelineUnitContainer')[0];k.hide(ra);k.addClass(pa,'fbTimelineEditMLE');if(!qa)k.addClass(pa,'fbTimelineNotStarred');},showFlyout:function(pa,qa,ra){oa.hideFlyout();da=pa;ba=0;h.subscribe('TimelineMLE/mleSelectUpdated',function(wa,xa){var ya=p.byClass(xa,'mleFormOuterContainer'),za=l.scry(ya,'.registrationLink');if(!za.length)return;var ab=xa.selectedIndex;k.hide(za[ba]);k.show(za[ab]);ba=ab;});if(qa==='header'||qa==='map'){j.loadModules(['TimelineStickyHeader'],function(wa){var xa=wa.getRoot();if(!xa)xa=x("pagelet_timeline_medley_map");var ya;if(qa==='header'){ya=l.scry(xa,'.lifeEventAttachment')[0]||l.scry(xa,"._yq")[0];}else ya=l.find(xa,'div.fbTimelineMapStickyHeaderComposerContainer');pa.setContext(ya).show();var za=h.subscribe(wa.VISIBLE,function(ab,bb){if(!bb&&da===pa){oa.hideFlyout();za.unsubscribe();}});});}else if(qa==='composer'){t.showMLEFlyout(pa);ha(pa.getContext());}else if(qa==='yearly_summary'){pa.setContext(x("addMLELink")).show();}else if(qa==='goals_pagelet'){pa.setContext(x("addGoalLink")).show();}else if(qa==='feed_composer'){pa.setContext(x("life_event_attach")).show();}else if(qa==='edit'){pa.show();var sa=x(ra),ta=p.byClass(sa,'lifeEventContainer');k.addClass(ta,'fbTimelineEditMLE');var ua=l.find(pa.getContent(),'.timelineUnitContainer');k.addClass(ua,'fbTimelineEditMLEFlyout');m.ensureVisible(ua,null,100);}else j.loadModules(['TimelineSpine'],function(wa){wa.showMLEFlyout(pa);ha(pa.getContext());});if(qa!='map'){var va=l.scry(pa.getContent(),'.mleSelect');if(va.length)na(va[0]);}if(qa!=='edit')oa.setEstimatedDate(pa);h.inform('TimelineMLE/mleFlyoutShown',pa);},showPrivacyNotice:function(pa,qa){if(!qa||!pa)return;var ra=l.find(pa.getContent(),'.audienceSelector');qa.setContext(ra).show();ea=qa;g.listen(ra,'click',qa.hide.bind(qa));g.listen(l.find(qa.getContent(),'input'),'click',qa.hide.bind(qa));h.subscribe('TimelineMLE/mleFlyoutHidden',qa.hide.bind(qa));},hideFlyout:function(){if(da){var pa=da,qa=l.scry(pa.getContent(),'.mleContainer')[0];qa&&v.destroyPreviewGrid(qa);pa.hide();ca={};da=null;h.inform('TimelineMLE/mleFlyoutHidden');}},getFlyout:function(){return da;},listenForEditChanges:function(pa){var qa=l.find(pa,'form.mleFormContainer'),ra=qa.elements;for(var sa=0;sa<ra.length;++sa){if(p.byClass(ra[sa],'uiTypeahead')||p.byClass(ra[sa],'uiTokenizer')||k.hasClass(ra[sa],'mleSelect'))continue;if(k.hasClass(ra[sa],'inputradio')){g.listen(ra[sa],'click',ia.curry(qa));}else g.listen(ra[sa],'blur',ia.curry(qa));}ca={element:qa,state:o.serialize(qa)};var ta=l.scry(pa,'input.updateRelationshipStatus')[0];if(ta)aa(g.listen(ta,'change',function(){var ua=o.serialize(qa);ka(qa,ua);}));},updateHeader:function(pa){ia(p.byClass(pa,'mleFormContainer'));},setEstimatedDate:function(pa){var qa=l.scry(pa.getContext().parentNode,'.fbTimelineComposerUnit')[0];if(!qa){var ra=q.getInstance(l.scry(pa.getContent(),'.uiProgressiveDatepicker')[0]);if(ra)t.setEstimatedDate(ra,ga(pa));}},updatePrivacyNoticePosition:function(){ea&&ea.updatePosition();},registerOptionHandler:function(pa){var qa=l.scry(pa,'.lifeEventContainer')[0],ra=l.scry(qa,'.mleSelect');if(ra.length)na(ra[0]);},subscribeToTypeahead:function(pa,qa){pa.subscribe(['select','unselect','reset','blur'],oa.updateHeader.curry(qa));},subscribeToTokenizer:function(pa,qa){pa.subscribe(['addToken','removeToken'],oa.updateHeader.curry(qa));},replaceYearlySummary:function(pa){l.replace(x('pagelet_yearly'),pa);}};e.exports=a.TimelineMLE||oa;});
__d("legacy:TimelineMLE",["TimelineMLE"],function(a,b,c,d){a.TimelineMLE=b('TimelineMLE');},3);
__d("MapAppSectionCuration",["Arbiter","TimelineAppSectionCuration"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('TimelineAppSectionCuration'),i={registerContent:function(j){h.register(j,function(k,l,m){g.inform('TimelineMapStickyHeaderComposer/showPhotoTagUnit');m.unsubscribe();});}};e.exports=i;});