/*!CK:4256825015!*//*1375705729,173217321*/

if (self.CavalryLogger) { CavalryLogger.start_js(["TH2gN"]); }

__d("concatMap",[],function(a,b,c,d,e,f){function g(h,i){var j=-1,k=i.length,l=[],m;while(++j<k){m=h(i[j],j,i);Array.isArray(m)?Array.prototype.push.apply(l,m):Array.prototype.push.call(l,m);}return l;}e.exports=g;});
__d("NodeHighlighter",["concatMap","createArrayFrom","escapeRegex","TokenizeUtil","DOM"],function(a,b,c,d,e,f){var g=b('concatMap'),h=b('createArrayFrom'),i=b('escapeRegex'),j=b('TokenizeUtil'),k=b('DOM');function l(o,p){var q=k.getText(o).split(p),r=q.map(function(s){if(p.test(s))return m(s);return s||'';});return q.length>1?r:null;}function m(o){return k.create('span',{'class':'highlightNode'},o);}var n={getTextNodes:function(o){if(this.isLeafNode(o)||this.isStopNode(o)){return o;}else if(this.isDiscardNode(o))return [];return g(this.getTextNodes.bind(this),h(o.childNodes));},getHighlightCandidates:function(){return [];},isLeafNode:function(o){return k.isTextNode(o);},isStopNode:function(o){return false;},isDiscardNode:function(o){return false;},createSegmentedRegex:function(o){var p=j.getPunctuation();o=o.map(String).map(i);o=this.addBidirectionalCharsToTokens(o);return '(^|\\s|'+p+')('+o.join('|')+')(?=(?:$|\\s|'+p+'))';},createNonSegmentedRegex:function(o){return '('+o.map(String).join('|')+')';},addBidirectionalCharsToTokens:function(o){var p='[\\u200E\\u200F\\u202A\\u202B\\u202C\\u202D\\u202E]*',q=[];o.forEach(function(r){var s=p;for(var t=0;t<r.length;t++)if(r.charCodeAt(t)!==92)s+=r.charAt(t)+p;q.push(s);});return q;},createRegex:function(o){var p=/[\u0E00-\u109F\u2000-\uFFFF]/,q=[],r=[];o.forEach(function(t){if(p.test(t)){r.push(t);}else q.push(t);});var s='';if(q.length){s+=this.createSegmentedRegex(q);s+=(r.length)?'|':'';}if(r.length)s+=this.createNonSegmentedRegex(r);return new RegExp(s,'i');},highlight:function(o,p){if(!p||p.length===0||!o)return;var q=g(function(s){return g(this.getTextNodes.bind(this),k.scry(o,s));}.bind(this),this.getHighlightCandidates()),r=this.createRegex(p);q.forEach(function(s){var t=l(s,r);if(t)if(this.isStopNode(s)){k.setContent(s,t);}else k.replace(s,t);}.bind(this));}};e.exports=n;});
__d("BrowseFacebarHighlighter",["copyProperties","CSS","csx","escapeRegex","NodeHighlighter"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('CSS'),i=b('csx'),j=b('escapeRegex'),k=b('NodeHighlighter'),l={};g(l,k,{getHighlightCandidates:function(){return ["._53ad"];},isDiscardNode:function(m){return h.hasClass(m,'DefaultText');},createSegmentedRegex:function(m){m=m.map(String).map(j);m=this.addBidirectionalCharsToTokens(m);return '(^|\\s|\\b)('+m.join('|')+')';}});e.exports=l;});
__d("FacebarResultStore",["copyProperties","concatMap","FacebarResultStoreUtils","TokenizeUtil"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('concatMap'),i=b('FacebarResultStoreUtils'),j=b('TokenizeUtil'),k='unimplemented';function l(m,n,o,p){this.facebarConfig=m;this.facebarConfig.grammar_stop_words_penalty=this.facebarConfig.grammar_stop_words_penalty||2;this.facebarConfig.grammar_stop_words=this.facebarConfig.grammar_stop_words||{};this.facebarConfig.options=p;this.tokenize=n;this.getEntry=o;this.typeaheadTypeMap=this.facebarConfig.mapped_types;this.facebarConfig.typeahead_types.forEach(function(q){this.typeaheadTypeMap[q]=q;}.bind(this));this.resetCaches();this.cacheEnabled(true);}l.prototype.transformStructured=function(m){var n=[],o=[],p='',q='';m.forEach(function(t,u){if(t.isType('text')){p+=t.getText();q=(q==null)?null:q+t.getText();}else{var v=p.match(/\"/g);if(v&&v.length%2)p=p.replace(/\s+$/,'')+'"';if(p.length){Array.prototype.push.apply(n,this.tokenize(p));o.push(p);p='';}n.push(t.toStruct());o.push({uid:String(t.getUID()),type:this._getFBObjectType(t.getTypePart(1)),text:t.getText()});q=null;}}.bind(this));if(p.length){if(p[p.length-1]=='\'')p=p.substr(0,p.length-1);Array.prototype.push.apply(n,this.tokenize(p));o.push(p);if(p[p.length-1]==' ')n.push('');}var r=JSON.stringify(o),s=r.replace(/\]$/,'').replace(/\"$/,'');s=s.replace(/\s{2,}/g,' ');return {tokens:n,text_form:r,is_empty:!!r.match(/^\[(\"\s*\")?\]$/),raw_text:q,cache_id:s};};l.prototype.resetCaches=function(){this.bootstrapCache={};this.queryCache={'':{tokens:[],results:[]}};};l.prototype.setNullState=function(m){this.facebarConfig.null_state=m.map(this._extractStructure.bind(this));};l.prototype.addEntryToNullState=function(m){if(this.facebarConfig.null_state){var n=this.facebarConfig.entity_cost+m.grammar_costs['{'+m.type+'}'],o=i.processEntityResult(m.type,m.uid,m.text,n);this.facebarConfig.null_state.unshift(o);}};l.prototype.setSortFunction=function(m){this._sortFunction=m;};l.prototype.addBootstrap=function(m){var n=this.bootstrapCache;m.forEach(function(o){var p=this.getEntry(o);p.bootstrapped=true;var q=this.tokenize(p.textToIndex,true);if(p.tokens)Array.prototype.push.apply(q,p.tokens.split(' '));q.forEach(function(r){if(!n.hasOwnProperty(r))n[r]={};n[r][o]=true;});},this);};l.prototype.addNullStateToQueryCache=function(m){this.saveResults(this.facebarConfig.null_state,m,true);};l.prototype.getResults=function(m){if(m.tokens.length===0||(m.tokens.length==1&&m.tokens[0]===''))return {results:this.facebarConfig.null_state||[],null_state:true};var n=this._getBestQueryCache(m.cache_id),o=n.results,p={},q=this._getBootstrapMatchByType(m.tokens,p),r=this._addMatchingBootstrapResults(m.tokens,q[0]||{});Array.prototype.push.apply(r,h(this._getResultsFromCache.bind(this,q,m.tokens),o));var s={},t=[],u=false,v=0;r.sort(this._sortFunction).forEach(function(w){w.semantic=w.semantic.toLowerCase();if(!w.termMatches)w.termMatches=p[parseInt(w.semantic,10)];var x=l.getUniqueSemantic(w.semantic);if(!x)return;if(s[x]){if(w.isJSBootstrapMatch){s[x].isJSBootstrapMatch=true;s[x].bootstrapCost=w.bootstrapCost;}else if(s[x].isJSBootstrapMatch&&w.backendCost!==undefined&&s[x].backendCost===undefined)s[x].backendCost=w.backendCost;if(!!w.tags)s[x].tags=w.tags;return;}if(u&&w.blankFilled)return;if(w.type.indexOf('browse_type')>=0){v+=1;if(this.facebarConfig.maxGrammarResults!==undefined&&v>this.facebarConfig.maxGrammarResults)return;}u=u||!!w.blankFilled;s[x]=w;t.push(w);}.bind(this));return {results:t,webSuggOnTop:n.webSuggOnTop,webSuggLimit:n.webSuggLimit,webSuggLimitSeeMore:n.webSuggLimitSeeMore};};l.prototype.cacheEnabled=function(m){this._enableCache=m;};l.prototype.saveResults=function(m,n,o,p){m=m.map(this._processBackendResult.bind(this));var q=[];if(this._enableCache){var r={},s={};m.forEach(function(u){s[u.semantic]=true;u.parse&&u.parse.disambiguation&&u.parse.disambiguation.forEach(function(v){r[v]=true;});});var t=this._getBestQueryCache(n.cache_id);t.results.forEach(function(u){if(u.type==='websuggestion')return;if(u.semanticForest in r)return;var v=this._getDifferenceArrayTokens(u.tokens,n.tokens),w=this._getNumTokensMatching(v,u);w=this._tryMatchingFinalInsertedEntity(v,w,u);if(w>0&&w==v.length){u.cacheOnlyResult=!s[u.semantic];q.push(u);}}.bind(this));}m.forEach(function(u){u.tokens=n.tokens;u.cache_id_length=n.cache_id.length;q.push(u);});if(this.queryCache[n.cache_id]===undefined)this.queryCache[n.cache_id]={};g(this.queryCache[n.cache_id],{tokens:n.tokens,results:q,incomplete:o});g(this.queryCache[n.cache_id],p);};l.prototype.alreadyKnown=function(m){return !!this.queryCache[m]&&!this.queryCache[m].incomplete;};l.prototype.stripBrackets=function(m){return m.replace(/^[\[\{]/,'').replace(/[\]\}]$/,'');};l.prototype._extractStructure=function(m){function n(q,r,s){return {type:q,text:r,uid:s||null};}function o(q,r){q.split(' ').forEach(function(s){if(s!==''){if(r)m.chunks.push(m.structure.length);m.structure.push(n('text',s));}m.structure.push(n('text',' '));});m.structure.pop();}function p(q){var r=(m.structure.length===0&&m.type!='websuggestion')?q.charAt(0).toUpperCase()+q.substr(1):q;return r;}m.structure=[];m.chunks=[];m.parse.display.forEach(function(q){if(typeof q==='string'){o(p(q),true);}else if(q.uid){var r=this.getEntry(q.uid,q.fetchType);m.chunks.push(m.structure.length);if(r.grammar_like){o(p(r.text),false);}else{var s=q.type;if(q.fetchType)s+=':'+q.fetchType;m.structure.push(n(s,r.text,q.uid));}}else if(q.type=='blank'){m.chunks.push(m.structure.length);m.structure.push(n(q.type,'...'));}}.bind(this));return m;};l.prototype._getDifferenceArrayTokens=function(m,n){if(!m.length)return [''].concat(n);var o=m.length-1,p=m[o];if(p==='')p=m[--o];return [typeof(p)=='string'?n[o].substr(p.length):''].concat(n.slice(o+1));};l.prototype._processBackendResult=function(m){m.semantic=m.semantic.toString();m.backendCost=m.cost;this._extractStructure(m);if(m.type.match(/^\{.*\}$/))m.useExtendedIndex=true;if(m.semantic.match(/\[.*\]/)){var n=m.parse,o=n.pos;if(o===undefined){m.semantic=m.semantic.replace(/\[(.*)\]/g,'$1');}else{var p=n.remTokens[n.remTokens.length-1];if(n.remTokens.length&&m.structure[m.chunks[p]].uid){o=n.remTokens[n.remTokens.length-1];m.completed=true;}var q=m.structure[m.chunks[o]].uid;if(q===null){m.semantic=m.semantic.replace(/\[(\d*)\]/g,'$1');}else{var r=new RegExp('\\['+q+'\\]','g');m.unsubstituted_semantic=m.semantic;m.semantic=m.semantic.replace(r,q);if(n&&n.disambiguation&&n.disambiguation.length>0){n.disambiguation=n.disambiguation.filter(function(s){return s.indexOf('['+q+']')!==-1;});n.unsubstituted_disambiguation=n.disambiguation.splice(0);n.disambiguation=n.disambiguation.map(function(s){return s.replace(r,q);});}}}}m.semantic=m.semantic.replace(/\[(.*)\]/g,'$1');m.tuid=JSON.stringify({semantic:m.semantic,structure:m.structure});return m;};l.prototype._sortFunction=function(m,n){return (m.cost||0)-(n.cost||0);};l.prototype._getResultsFromCache=function(m,n,o){var p=this._getDifferenceArrayTokens(o.tokens,n),q=[],r=this._getNumTokensMatching(p,o),s=this._tryMatchingFinalInsertedEntity(p,r,o);if(s>0&&s==p.length)q.push(o);o.bolding=this._computeBolding(o,p,0);Array.prototype.push.apply(q,this._trySubstitutingBootstrapResult(m[n.length-p.length],o,p));if(r<=0)return q;var t=p.slice(r);r+=n.length-p.length;var u={};if(r==n.length){--r;if(r<0)return q;if(n[r]!=='')u=this._computeBolding(o,p,1);}if(r==n.length-1&&n[r]===''){--r;if(r<0)return q;u=this._computeBolding(o,p,1);}var v=function(w,x){x.bolding=w;return x;}.bind(null,u);Array.prototype.push.apply(q,this._tryMatchingFinalBootstrapResult(m[r],t,o).map(v));return q;};l.prototype._addMatchingBootstrapResults=function(m,n){return h(function(o){var p=n[o];if(p===undefined)return [];var q=[];p.forEach(function(r){var s=this.getEntry(r,o);if(!this._isTitleTermMatch(m,s))return;var t=this._isExactNameMatch(m,s)?0:this.facebarConfig.non_title_term_match_penalty,u=this._isNonGrammarTermMatch(m,s),v=s.grammar_costs['{'+o+'}']+t+this.facebarConfig.entity_cost+this.facebarConfig.grammar_stop_words_penalty*!u,w=i.processEntityResult(o,r,s.text,v);w.bootstrapCost=v;w.isJSBootstrapMatch=true;q.push(w);}.bind(this));return q;}.bind(this),this.facebarConfig.bootstrap_types);};l.prototype._isTitleTermMatch=function(m,n){var o=m[0]||{};if(typeof(o)=='object')return false;var p=n.titleToIndex;return m.length===1?j.isPrefixMatch(o,p):j.isExactMatch(o,p);};l.prototype._isExactNameMatch=function(m,n){var o=m[0]||{};if(typeof(o)=='object')return 0;var p=n.text;if(m.length===1?j.isPrefixMatch(o,p):j.isExactMatch(o,p))return true;return m.length==1&&n.alias!==undefined&&j.isExactMatch(o,n.alias);};l.prototype._isNonGrammarTermMatch=function(m,n){var o=j.parse(n.titleToIndex.toLowerCase()),p=o.tokens.filter(function(s){return s!==''&&!this.facebarConfig.grammar_stop_words[s];}.bind(this));p=p.join(' ');for(var q=0;q<m.length;++q){if(typeof(m[q])=='object')return true;var r=q===m.length-1?j.isPrefixMatch(m[q],p):j.isQueryMatch(m[q],p);if(r)return true;}return false;};l.prototype._getBootstrapMatchByType=function(m,n){if(m.length===0)return [];var o=m.map(function(){return {};}),p=(m[m.length-1]===''),q={},r,s=(p?m.length-1:m.length);if(s&&m[s-1].uid){this._pushBootstrapEntryAtPosition(o,s-1,m[s-1].uid);return o;}for(var t in this.bootstrapCache)if(s&&t.indexOf(m[s-1])===0&&(!p||t===m[s-1]))for(r in this.bootstrapCache[t])if(!q[r]){q[r]=1;this._addMatchedTerm(r,t,n);this._pushBootstrapEntryAtPosition(o,s-1,r);}for(var u=s-2;u>=0;u--){if(typeof(m[u])=='object')break;if(m[u].length&&m[u][0]=='"')break;for(r in this.bootstrapCache[m[u]]){if(!q[r])q[r]=0;if(q[r]+u==s-1){++q[r];this._addMatchedTerm(r,m[u],n);this._pushBootstrapEntryAtPosition(o,u,r);}}}return o;};l.prototype._addMatchedTerm=function(m,n,o){(o[m]=o[m]||[]).push(n);return o;};l.prototype._pushBootstrapEntryAtPosition=function(m,n,o){var p=this.getEntry(o);if(!p)return;for(var q in p.grammar_costs){var r=this.stripBrackets(q);if(m[n][r]===undefined)m[n][r]=[];m[n][r].push(o);}};l.prototype._getNumTokensMatching=function(m,n){var o=0,p=n.parse,q=m.length,r=null,s=null;if(p.pos!==undefined){var t=n.structure[n.chunks[p.pos]];r=t.uid;s=t.type.split(':')[2];}n.outputTokensUsed=[];n.termMatches=[];if(r){o=this._prefixMatchEntity(m,p,r,n.outputTokensUsed,s,!!n.useExtendedIndex,n.termMatches);if(o===0||o===q)return o;}else if(p.suffix&&q==1&&p.suffix.indexOf(m[0])===0){return q;}else if(p.suffix==m[0]){++o;}else return 0;var u=[];for(var v=0;v<p.remTokens.length;v++){if(typeof(m[o])!='string'||n.chunks.length<p.remTokens[v]||n.structure[n.chunks[p.remTokens[v]]].uid)break;var w=n.structure[n.chunks[p.remTokens[v]]].text;u.push(w.toLowerCase());}o=this._greedyMatchText(u,m,o,p.remTokens,n.outputTokensUsed);if(o==q-1&&m[o]==='')return q;return o;};l.prototype._prefixMatchEntity=function(m,n,o,p,q,r,s){if(n.entTokens.length===0){if(m[0]!=='')return 0;if(n.possessive&&m.length>1&&m[1]=='\'s'){p.push([n.pos+1]);return 2;}else return 1;}var t=false,u=this.getEntry(o,q);if(typeof(q)!=='undefined'&&q!==u.fetchType)return 0;var v=this.tokenize(r?u.textToIndex:u.text,true),w=[];for(var x=0;x<m.length+n.entTokens.length-1;x++)if(x<n.entTokens.length-1){w.push(n.entTokens[x]);}else if(x==n.entTokens.length-1){w.push(n.entTokens[x]+m[0]);}else w.push(m[x-n.entTokens.length+1]);var y=-n.entTokens.length+1;for(var z=0;z<w.length;++z){var aa=w[z];if(typeof(aa)!='string')break;if(aa===''){y++;continue;}var ba=false;for(var ca=0;ca<v.length;ca++)if(v[ca]==aa||(z===w.length-1&&v[ca].indexOf(aa)===0)){if(s)s.push(v[ca]);v[ca]='';ba=true;++y;break;}if(ba)continue;if(!n.possessive||aa.length<=2||aa.substr(aa.length-2)!='\'s')break;var da=aa.substr(0,aa.length-2);for(ca=0;ca<v.length;ca++)if(v[ca]==da){++y;if(p)t=true;break;}break;}if(y>0){if(t)p.push([n.pos+1]);return y;}if(p===undefined)return 0;var ea=m[0],fa=ea;if(n.possessive&&ea.length>=2&&ea.substr(ea.length-2)=='\'s')fa=ea.substr(0,ea.length-2);if((m.length==1&&n.suffix.indexOf(ea)===0)||n.suffix==fa||n.suffix==ea){if(fa!=ea&&n.suffix==fa)p.push([n.pos+1]);return 1;}return 0;};l.prototype._tryMatchingFinalInsertedEntity=function(m,n,o){if(!o.completed||n<0)return n;var p=o.parse,q=p.remTokens[p.remTokens.length-1],r=o.structure[o.chunks[q]],s=this.getEntry(r.uid,r.type),t=this.tokenize(s.text,true);n=this._greedyMatchText(t,m,n);if(n==m.length-1&&m[n]==='')return m.length;return n;};l.prototype._greedyMatchText=function(m,n,o,p,q){for(var r=0;r<m.length;r++){var s=m[r];if(s==n[o]){if(q!==undefined)q.push(p[r]);++o;continue;}if(o===n.length-1&&s.indexOf(n[o])===0){if(q!==undefined)if(s==n[o]){q.push([p[r]]);}else q.push([p[r],n[o].length]);return n.length;}}return o;};l.prototype._createMapOverFinalBootstrapUids=function(m,n,o,p,q,r){return function(s){var t=this.getEntry(s,q);if(t===undefined||r(s,t)===false)return;var u={};g(u,m);if(!u.iconClass)u.photo=t.photo;u.cost=m.cost+l.EPSILON+t.grammar_costs['{'+q+'}']-o.grammar_costs['{'+q+'}'];u.cache_id_length=Infinity;u.structure=m.structure.slice(0);u.structure[m.chunks[p]]={type:n.type,text:t.text,uid:s};u.blankFilled=true;var v=new RegExp('\\['+n.uid+'\\]','g');u.semantic=m.unsubstituted_semantic.replace(v,s);if(u.parse&&u.parse.disambiguation&&u.parse.disambiguation.length>0)u.parse.disambiguation=u.parse.unsubstituted_disambiguation.map(function(w){return w.replace(v,s);});u.tuid=JSON.stringify({semantic:u.semantic,structure:u.structure});return u;}.bind(this);};l.prototype._tryMatchingFinalBootstrapResult=function(m,n,o){if(!o.completed)return [];var p=o.parse,q=p.remTokens[p.remTokens.length-1],r=o.structure[o.chunks[q]],s=r.type.substr(4).replace(':blank',''),t=this.getEntry(r.uid,s),u=m[s];if(u===undefined||t===undefined||t.grammar_costs===undefined)return [];return u.map(this._createMapOverFinalBootstrapUids(o,r,t,q,s,function(v,w){return n.length==this._greedyMatchText(this.tokenize(w.text),n,0);}.bind(this))).filter(function(v){return !!v;});};l.prototype._trySubstitutingBootstrapResult=function(m,n,o){if(n.unsubstituted_semantic===undefined||n.completed||n.type===k)return [];var p=n.parse.pos,q=n.structure[n.chunks[n.parse.pos]],r=q.type.substr(4),s=m[r];if(s===undefined)return [];var t=this.getEntry(q.uid);if(!t||t.grammar_costs===undefined)return [];return s.map(this._createMapOverFinalBootstrapUids(n,q,t,p,r,function(u){return this._prefixMatchEntity(o,n.parse,u)===o.length;}.bind(this))).filter(function(u){return !!u;});};l.prototype._computeBolding=function(m,n,o){var p={};if(m.parse.pos!==undefined){var q=m.structure[m.chunks[m.parse.pos]];if(!q.uid)p[m.chunks[m.parse.pos]]=q.text.length-m.parse.suffix.length+n[0].length;}m.parse.unmatch.forEach(function(t){if(typeof(t)=='object'){p[m.chunks[t[0]]]=m.structure[m.chunks[t[0]]].text.length-t[1].length;}else p[m.chunks[t]]=0;});m.parse.remTokens.forEach(function(t){p[m.chunks[t]]=0;});for(var r=0;r<m.outputTokensUsed.length-o;r++){var s=m.outputTokensUsed[r];if(s.length==1){delete p[m.chunks[s[0]]];}else p[m.chunks[s[0]]]=s[1];}return p;};l.prototype._getBestQueryCache=function(m){for(var n=m.length;n>=0;n--){var o=this.queryCache[m.slice(0,n)];if(o)return o;}};l.prototype._getFBObjectType=function(m){if(this.typeaheadTypeMap[m]){return this.typeaheadTypeMap[m];}else return 'page';};l.EPSILON=1e-05;l.getUniqueSemantic=function(m){var n=[],o=[],p=[];m='('+m+')';var q=m,r=false;m.replace(/[\(\),]/g,function(s,t){var u;switch(s){case ',':var v=p.length-1;u=q.substr(p[v],t-p[v]);n[v].push(u);p[v]=t+1;break;case '(':p.push(t+1);n.push([]);o.push(t+1);break;case ')':if(p.length===0)throw m+' is not a valid semantic string';var w=p.pop();u=q.substr(w,t-w);var x=n.pop();x.push(u);var y=x.sort();for(var z=1;z<y.length;z++)if(y[z]==y[z-1])r=true;var aa=y.join(',');q=q.substr(0,o.pop())+aa+q.substr(t);break;}return s;});if(r)return '';return q.replace(/\((.*)\)/,'$1');};e.exports=l;});
__d("FacebarTokenizer",["TokenizeUtil"],function(a,b,c,d,e,f){var g=b('TokenizeUtil'),h="[^\"]",i=["\\s's","'s","\""+h+"*\"?"],j=[[/\s+$/,''],[/\"\s+/,'"'],[/\s+\"/,'"'],[/\"\"/,''],[/^\"$/,''],[/\s+/,' ']],k={tokenize:function(l,m){var n=[],o=0;l=l.replace(/\s/g,' ').toLowerCase();l.replace(new RegExp(i.join('|'),'g'),function(q,r){if(r>o){var s=l.substr(o,r-o);Array.prototype.push.apply(n,g.parse(s).tokens.slice(0));}var t=q;for(var u=0;u<j.length;u++){var v=j[u];t=t.replace(v[0],v[1]);}if(n.length&&t=='\'s'){n[n.length-1]+=t;}else if(t!=='')n.push(t);if(m)Array.prototype.push.apply(n,g.parse(q).tokens);o=r+q.length;});if(o<l.length){var p=l.substr(o,l.length-o);Array.prototype.push.apply(n,g.parse(p).tokens.slice(0));}return n;}};e.exports=k;});
__d("FacebarSemanticQuery",["URI","copyProperties","Env"],function(a,b,c,d,e,f){var g=b('URI'),h=b('copyProperties'),i=b('Env'),j='str';function k(t){var u={me:i.user};return h(u,t.semantic_map);}function l(t,u){var v=k(t);if(typeof v[u]!=='undefined')return String(v[u]);return u;}function m(t){return new g("/profile.php").addQueryData({id:t});}function n(t,u){var v,w=q(u),x={};for(var y=0;y<w.length;++y)if(w[y].indexOf('path(')===0){v=g(q(w[y])[0]);}else{var z=w[y].substring(6,w[y].indexOf('(')).split('_'),aa=q(w[y]);for(var ba=0;ba<z.length;++ba)x[z[ba]]=l(t,aa[ba]);}v.addQueryData(x);return v;}function o(t,u){var v=[u],w=[],x=t.browse_functions,y=t.search_path;while(v.length>0){var z=v.pop();if(!p(z)){w.push(z);continue;}var aa=z.substring(0,z.indexOf('(')),ba=aa,ca=q(z);if(!x[aa]){w=[];break;}var da=x[aa].minNumParams,ea=x[aa].maxNumParams;if(v.length>0)if(x[aa].numParamsUnbounded){if(w.length>0)aa+='-'+ca.length;}else if((ca.length!=1&&ca.length>da)||(ca.length===0&&da!=ea))aa+='-'+ca.length;v.push(aa);for(var fa=0;fa<ca.length;fa++){if(ca[fa].length===0)continue;if(x[ba].allowsFreeText){v.push(j+'/'+encodeURIComponent(ca[fa]));}else v.push(ca[fa]);}}return g(y+w.join('/'));}function p(t){return (/^[a-z\-]+\(.*\)$/).test(t);}function q(t){if(!p(t)&&t.indexOf('param_')!==0)return [t];var u=t.substring(t.indexOf('(')+1,t.length-1);if(u.length===0)return [];return r(u);}function r(t){var u=[],v=0,w=0;for(var x=0;x<t.length;++x)if(t[x]==','&&w===0){u.push(t.substring(v,x));v=x+1;}else if(t[x]=='('){w++;}else if(t[x]==')')w--;u.push(t.substring(v,t.length));return u;}function s(t,u){this.facebarConfig=t;this.unmapped=(u||"").trim();this.mapped=l(t,this.unmapped);this.position=null;}s.prototype.isEntity=function(){return (/^\d+$/).test(this.mapped);};s.prototype.isURI=function(){return this.mapped.indexOf('uri(')===0;};s.prototype.isShortcut=function(){return this.mapped.indexOf('shortcut(')===0;};s.prototype.isImplemented=function(){return this.mapped&&this.mapped.indexOf('*')==-1;};s.prototype.getUnimplemented=function(){return (this.mapped.match(/\*[\w\-]+\(/g)||[]).map(function(t){return t.substr(1,t.length-2);});};s.prototype.getURI=function(){if(this.isEntity()){return m(this.mapped);}else if(this.isShortcut()){return new g(this.mapped.substr(9,this.mapped.length-10));}else if(this.isURI()){return n(this.facebarConfig,this.mapped);}else return o(this.facebarConfig,this.unmapped);};e.exports=s;});
__d("FacebarURI",["URI","Env","FacebarSemanticQuery"],function(a,b,c,d,e,f){var g=b('URI'),h=b('Env'),i=b('FacebarSemanticQuery'),j={getSearchRawPrefix:function(){return 'search';},getSearchPath:function(){return '/'+this.getSearchRawPrefix()+'/';},getURI:function(k,l){var m=null,n=!l.song&&l.path;if(n){m=new g(n);if(l.type=='user')m.addQueryData({fref:'ts'});}else{var o=new i(k,l.semantic);if(o&&o.isImplemented())m=o.getURI();}return m&&j.getQualifiedURI(m);},getQualifiedURI:function(k){var l=new g(k);if(!l.getDomain()){var m=g(h.www_base);l.setProtocol(m.getProtocol()).setDomain(m.getDomain()).setPort(m.getPort());}return l;}};e.exports=j;});
__d("ResultsBucketizer",[],function(a,b,c,d,e,f){function g(h,i){this.$ResultsBucketizer0=h;this.$ResultsBucketizer1=i;}g.trimResults=function(h,i,j){var k=[];h.forEach(function(l,m){if(l.indexBeforeBuckets>i)k.push({index:m,originalIndex:l.indexBeforeBuckets});});k.sort(function(l,m){return l.originalIndex-m.originalIndex;}).slice(j).sort(function(l,m){return m.index-l.index;}).forEach(function(l){h.splice(l.index,1);});};g.mergeBuckets=function(h,i){var j=[];for(var k in i)if(!i[k].rule.hidden)j.push(i[k]);j.sort(function(l,m){var n=(l.rule.position||0)-(m.rule.position||0);if(n!==0)return n;return l.results[0].indexBeforeBuckets-m.results[0].indexBeforeBuckets;});h.length=0;j.forEach(function(l,m){if(l.rule.maxPromotions!==undefined&&m<j.length-1)g.trimResults(l.results,j[m+1].results[0].indexBeforeBuckets,l.rule.maxPromotions);Array.prototype.push.apply(h,l.results);}.bind(this));};g.prototype.$ResultsBucketizer2=function(h,i){if(i.propertyName===undefined)return i.bucketName||'default';var j=this.$ResultsBucketizer1(h,i.propertyName);if(j===undefined||(i.propertyValue!==undefined&&j.toString()!==i.propertyValue))return false;return i.bucketName||(i.propertyName+'.'+j.toString());};g.prototype.$ResultsBucketizer3=function(h,i){var j={},k=this.$ResultsBucketizer2.bind(this);h.forEach(function(l,m){i.some(function(n){var o=k(l,n);if(o===false)return false;if(j[o]===undefined)j[o]={results:[],rule:n};if(!!n.maxResults&&j[o].results.length>=n.maxResults)return false;l.bucketLineage.push({bucketName:o,bucketIndex:j[o].results.length});j[o].results.push(l);return true;});});return j;};g.prototype.$ResultsBucketizer4=function(h,i){var j=this.$ResultsBucketizer0[i];if(!j)return {};var k=this.$ResultsBucketizer3(h,j);for(var l in k){var m=k[l].rule.subBucketRules;if(!!m)this.$ResultsBucketizer4(k[l].results,m);}g.mergeBuckets(h,k);return k;};g.prototype.bucketize=function(h){h.forEach(function(i,j){i.bucketLineage=[];i.indexBeforeBuckets=j;});return this.$ResultsBucketizer4(h,'main');};e.exports=g;});
__d("FacebarTypeaheadTypeNamedX",[],function(a,b,c,d,e,f){var g={browse_type_user:'user',browse_type_page:'page',browse_type_place:'place',browse_type_group:'group',browse_type_application:'app'},h=1,i=3;function j(){}j.addTypeNamedX=function(k,l,m,n){var o=new j(),p=o.buildTypeNamedXBuckets((l.entities||{}).results||[],(l['isSeeMore.true']||{}).results||[],n),q=p[0],r=p[1];q.forEach(function(t,u){t.bucketLineage.push({bucketName:'promotedFromSeeMore',bucketIndex:u});});var s=o.replaceResults(k,q);s.forEach(function(t,u){t.bucketLineage.push({bucketName:'demotedToSeeMore',bucketIndex:u});});s.push.apply(s,r);r=s;if(m)k.push.apply(k,r);};j.prototype.buildTypeNamedXBuckets=function(k,l,m){var n={};k.forEach(function(v,w){var x=v.render_type||v.type;if(n[x]===undefined)n[x]={index:w,matchCount:0};if(v.text.toLowerCase().indexOf(m.toLowerCase())>=0)n[x].matchCount++;});var o=[],p=[],q,r;l.forEach(function(v){if(v.results_set_type=='browse_type_story'){if(v.isPostsAboutEnt===true){r=v;}else q=v;}else{var w=g[v.results_set_type];if(n[w]!==undefined&&n[w].matchCount>=h){o.push([v,n[w].index]);}else p.push(v);}});o.sort(function(v,w){return v[1]-w[1];});var s=o.map(function(v){return v[0];});if(r!==undefined)s.unshift(r);if(q!==undefined)s.unshift(q);var t=s.slice(0,i),u=s.slice(i);return [t,u.concat(u,p)];};j.prototype.replaceResults=function(k,l){var m=[];for(var n=0;n<l.length;n++){var o=0,p=-1;k.forEach(function(s,t){if(k[t].cost!==undefined&&k[t].cost>o){p=t;o=k[t].cost;}});if(p>=0){m.push(k[p]);k.splice(p,1);}}var q=k.length;while(q>0&&(k[q-1].type=='websuggestion'))q--;for(var r=0;r<l.length;r++){k.splice(q,0,l[r]);q++;}return m;};e.exports=j;});
__d("FacebarDataSource",["Arbiter","AsyncRequest","emptyFunction","FacebarResultStore","FacebarStructuredText","FacebarTokenizer","FacebarURI","SearchDataSource","Vector","ViewportBounds","copyProperties","throttle","FacebarTypeNamedXTokenOptions","FacebarGlobalOptions","ResultsBucketizer","ResultsBucketizerConfig","FacebarTypeaheadTypeNamedX","BingScalingCommon"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('emptyFunction'),j=b('FacebarResultStore'),k=b('FacebarStructuredText'),l=b('FacebarTokenizer'),m=b('FacebarURI'),n=b('SearchDataSource'),o=b('Vector'),p=b('ViewportBounds'),q=b('copyProperties'),r=b('throttle'),s=b('FacebarTypeNamedXTokenOptions'),t=b('FacebarGlobalOptions'),u=b('ResultsBucketizer'),v=b('ResultsBucketizerConfig'),w=b('FacebarTypeaheadTypeNamedX'),x=b('BingScalingCommon'),y=100,z=250;for(var aa in n)if(n.hasOwnProperty(aa)&&aa!=="_metaprototype")ca[aa]=n[aa];var ba=n===null?null:n.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=n;function ca(da){n.call(this,da);this.filterOutWebSuggestion=true;this.bootstrap_saved=[];this.null_state=null;this._initialQueryData=null;this._curQueryId=-1;this._seeMore=false;this._waitingQueries=0;this.mixGrammarAndEntity=da.mixGrammarAndEntity!==undefined?da.mixGrammarAndEntity:true;this.grammarVersion=da.grammarVersion||'';if(!da.grammarOptions)da.grammarOptions={};this.recordingRoute=da.grammarOptions.recordingRoute||'banzai_vital';this._maxGrammarResults=da.grammarOptions.maxGrammarResults;this.nullStateEndpoint=da.nullStateEndpoint||'/ajax/browse/null_state.php';this.setNullStateData(da.nullStateData||{},true);this._minWebSugg=da.minWebSugg||1;this._minQueryLength=da.minQueryLength||-1;this.allowWebSuggOnTop=da.allowWebSuggOnTop||false;this._maxWebSuggToCountFetchMore=da.maxWebSuggToCountFetchMore||0;this._fixProcessLean=da.grammarOptions.fixProcessLean||false;if(da.throttled==='0'){this.executeQueryThrottled=this.executeQuery;this.sendRemoteQueryThrottled=this.sendRemoteQuery;}else{this.executeQueryThrottled=r(this.executeQuery,y,this);this.sendRemoteQueryThrottled=r(this.sendRemoteQuery,z,this);}this.resultStoreOptions=da.grammarOptions||{};this.resultStoreOptions.useNewExactNameMatch=(da.grammarOptions.useNewExactNameMatch==="true");this._bypassBucketizer=false;this._resultsBucketizer=new u(v.rules,function(fa,ga){switch(ga){case 'isSeeMore':return fa.isSeeMore;case 'objectType':return fa.type;case 'resultSetType':return fa.results_set_type;case 'renderType':return fa.render_type||fa.type;case 'cacheOnlyResult':return fa.cacheOnlyResult;case 'bootstrapped':return fa.bootstrapped;default:return !!fa.tags?fa.tags[ga]:undefined;}});var ea=new h().setURI('/ajax/typeahead/search/facebar/config.php').setData({version:this.grammarVersion}).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(fa){this.facebarConfig=fa.payload;this.createResultStore();if(this.null_state){this.setNullState(this.null_state);this.null_state=null;}this.inform('ready',true);}.bind(this)).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();ea.send();this.fetchNullState();}ca.prototype.createResultStore=function(){this.facebarConfig.maxGrammarResults=this._maxGrammarResults;this.resultStore=new j(this.facebarConfig,l.tokenize,this.getEntry.bind(this),this.resultStoreOptions);this.addEntries(this.bootstrap_saved);if(this._fixProcessLean)this._processLean();this.bootstrap_saved=[];this.subscribe('enableCache',function(da,ea){this.resultStore.cacheEnabled(ea);}.bind(this));this.subscribe('setSortFunction',function(da,ea){this.resultStore.setSortFunction(ea);}.bind(this));};ca.prototype.dirty=function(){this.bootstrap_saved=[];this._nullStateFetched=false;if(this.resultStore)this.resultStore.resetCaches();ba.dirty.call(this);};ca.prototype.addEntries=function(da){if(this.resultStore){this.resultStore.addBootstrap(this.processEntries(da));}else Array.prototype.push.apply(this.bootstrap_saved,da);};ca.prototype._processLean=function(){if(this._fixProcessLean){if(this._leanPayload&&this.resultStore){var da,ea=this._leanPayload.entries;for(var fa in ea){da=this.getEntry(fa);if(!da)continue;for(var ga in ea[fa]){if(!da.grammar_costs)da.grammar_costs={};da.grammar_costs['{'+ga+'}']=ea[fa][ga];}}this.setExclusions(this._leanPayload.blocked);this._leanPayload=null;}}else ba._processLean.call(this);};ca.prototype.setNullStateData=function(da,ea){if(ea)this.nullStateData={grammar_version:this.grammarVersion};q(this.nullStateData,da);return this;};ca.prototype.setNullState=function(da){if(this.resultStore){this.processEntries(da.entities);this.resultStore.setNullState(da.queries);this.resultStore.addNullStateToQueryCache(this.getRawStructure(k.fromString('')));this.inform('ready',true);}};ca.prototype.fetchNullState=function(){if(this._nullStateFetched||!t.allowGrammar)return;var da=new h().setURI(this.nullStateEndpoint).setData(this.nullStateData).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(ea){if(this.resultStore){this.setNullState(ea.payload);}else this.null_state=ea.payload;this._nullStateFetched=true;}.bind(this)).setFinallyHandler(this.activityEnd.bind(this));this.activityStart();da.send();};ca.prototype.toTypeaheadEntryUid=function(da){var ea,fa=k.fromStruct(da.structure),ga=fa.getFragment(0);if(fa.getCount()==1&&ga.isType('ent')){var ha=ga.getType().split(':')[2];ea=this.getEntry(ga.getUID(),ha);ea.type=this.resultStore.stripBrackets(da.type);}else{ea=this.getEntry(da.tuid);if(!ea){var ha,ia,ja;if(da.type==='websuggestion'){ha=da.type;ja=da.iconClass;}else{ha='grammar';ia=da.type;ja=da.iconClass;}ea={dynamic_cost:da.dynamic_cost,extra_uri_params:da.extra_uri_params,icon_class:ja,memcache:da.fromMemcache,photo:da.photo,results_set_type:ia,tuid:da.tuid,type:ha,uid:da.tuid,tags:da.tags,websuggestion_source:da.websuggestion_source,is_redirect:da.isRedirect};this.processEntries([ea]);ea=this.getEntry(da.tuid);}}if(ea.type==='websuggestion'||ea.is_redirect)ea.path=da.path;ea.error_info=da.errorInfo;ea.logInfo=da.logInfo;ea.structure=fa;ea.text=ea.structure.toString();ea.queryTypeText=da.queryTypeText;ea.semantic=da.semantic;ea.tree=da.tree;ea.cost=da.cost;ea.isSeeMore=!!da.isSeeMore;ea.isNullState=!!da.isNullState;ea.isSingleState=!!da.isSingleState;ea.entityInfo=da.entityInfo;ea.cacheOnlyResult=da.cacheOnlyResult||false;ea.uri=ea.uri||m.getURI(this.facebarConfig,ea);ea.semanticForest=da.semanticForest;ea.entityTypes=da.entityTypes;ea.parse=da.parse;ea.tags=da.tags;ea.isPostsAboutEnt=da.isPostsAboutEnt||false;ea.qid=da.qid;ea.removable=true;if(da.isJSBootstrapMatch){ea.isJSBootstrapMatch=da.isJSBootstrapMatch;ea.backendCost=da.backendCost;ea.bootstrapCost=da.bootstrapCost;}this._replaceCategoryWithTermMatches(ea,da);if(da.parse&&da.parse.disambiguation&&da.parse.disambiguation.length>0){ea.disambiguation_paths=[];for(var ka=0;ka<da.parse.disambiguation.length;ka++){var la={};la.semantic=da.parse.disambiguation[ka];var ma=m.getURI(this.facebarConfig,la);if(ma){ma.path=ma.path.replace('/^\/'+m.getSearchRawPrefix()+'\//','');ea.disambiguation_paths.push(ma.path);}}}return ea.tuid;};ca.prototype._replaceCategoryWithTermMatches=function(da,ea){if(da.type!=="user"||!da.term_to_subtitle||!ea.termMatches)return;var fa=[];ea.termMatches.forEach(function(ha){if(da.term_to_subtitle[ha])fa.push(da.term_to_subtitle[ha]);}.bind(this));if(da.category===undefined)da.category="";var ga=da.category.split(" \xB7 ");ga.unshift.apply(ga,fa);ga=ga.filter(function(ha,ia,ja){return ia==ja.indexOf(ha);});da.category=ga.splice(0,2).join(" \xB7 ");};ca.prototype.getRawStructure=function(da){if(typeof da=='string')da=k.fromString(da);if(this.resultStore)return this.resultStore.transformStructured(da.toArray());};ca.prototype.isSeeMore=function(){return this._seeMore;};ca.prototype.saveResult=function(da){this._initialQueryData=this.getUID(da.uid,da.fetchType);};ca.prototype.buildUids=function(da,ea,fa){if(!da||!this.resultStore)return [];if(typeof da=='string')da=k.fromString(da);var ga=this.getRawStructure(da),ha=this.resultStore.getResults(ga),ia=ha.results;if(typeof ia==='undefined')return [];var ja=ha.webSuggOnTop;if(typeof ja==='undefined')ja=false;var ka=ha.webSuggLimit||0,la=ha.null_state===true,ma=this.filterOutWebSuggestion&&!la,na=0;ia=ia.filter(function(sa,ta){if(!t.allowGrammar&&sa.type=='grammar')return false;if(sa.type!='websuggestion'){return sa.semantic!='<blank>'&&(sa.type!='unimplemented'||na++===0);}else return !ma;}.bind(this));var oa=ia.slice(),pa=[],qa=[],ra=[];ia.forEach(function(sa){if(sa.forcedPosition>0){ra.push(sa);}else if(sa.isSeeMore){pa.push(sa);}else qa.push(sa);});if(la){ia=this.orderNullState(ia,this.getMaxResults());}else{ia=x.integrateWebsuggestions(qa,Boolean(ja),this.getMaxResults(),ka,this._minWebSugg);ia.length=Math.min(ia.length,this.getMaxResults());}this.inform('decorateSeeMoreSuggestions',{structured:da,allResults:oa,selectedResults:ia,seeMoreResults:pa});if(ra.length>0){ra.sort(function(sa,ta){return sa.forcedPosition-ta.forcedPosition;});ra.forEach(function(sa){ia.splice(sa.forcedPosition,0,sa);});}if(pa.length>0)ia.push.apply(ia,pa);return ia.map(this.toTypeaheadEntryUid.bind(this));};ca.prototype.orderNullState=function(da,ea){var fa={top:[],bottom:[],middle:[]},ga=function(ja){var ka=ja.null_state_position;return fa.hasOwnProperty(ka)?ka:'middle';},ha=function(ja,ka){return ja.original_cost-ka.original_cost;};da&&da.forEach(function(ja){fa[ga(ja)].push(ja);}.bind(this));for(var ia in fa){fa[ia]=fa[ia].sort(ha).slice(0,ea);ea-=fa[ia].length;}return [].concat(fa.top,fa.middle,fa.bottom);};ca.prototype.handleResponse=function(da,ea){if(!(da.payload.errors)){this.processEntries(da.payload.entities);this.filterOutWebSuggestion=true;for(var fa=0;fa<da.payload.results.length;fa++)if(da.payload.results[fa].type=='websuggestion'){this.filterOutWebSuggestion=false;break;}da.payload.results.forEach(function(ha){ha.qid=this._curQueryId;}.bind(this));var ga={};['webSuggOnTop','webSuggLimit','webSuggLimitSeeMore'].forEach(function(ha){if(da.payload.hasOwnProperty(ha))ga[ha]=da.payload[ha];});this.resultStore.saveResults(da.payload.results,ea,da.payload.incomplete,ga);}};ca.prototype.processEntries=function(da){return da.map(function(ea,fa){var ga=(ea.uid=ea.uid+'');ea.textToIndex=this.getTextToIndex(ea);ea.titleToIndex=this.getTitleTerms(ea);ga=this.getUID(ga,ea.fetchType);var ha=this.getEntry(ga);if(!ha){this.setEntry(ga,{});ha=this.getEntry(ga);}q(ha,ea);ha.tokenVersion=ea.tokenVersion;ha.tuid=ga;ha.index===undefined&&(ha.index=fa);return ga;}.bind(this));};ca.prototype.getUID=function(da,ea){da=da+'';if(ea!==undefined){ea=/([^:]+:)?([^:]+)(:.*)?/.exec(ea)[2];return JSON.stringify([da,ea]);}return da;};ca.prototype.getEntry=function(da,ea){da=da+'';if(ea!==undefined){var fa=ba.getEntry.call(this,this.getUID(da,ea));if(fa)return fa;}return ba.getEntry.call(this,da);};ca.prototype.getEntryForFragment=function(da){return this.getEntry(da.getUID(),da.getTypePart(2));};ca.prototype.getMaxResults=function(){return this._numResults.max;};ca.prototype.query=function(da,ea,fa,ga){this.executeQueryThrottled(da,ga,this._initialQueryData);this._initialQueryData=null;};ca.prototype.executeQuery=function(da,ea,fa){this._seeMore=ea===true;this._curQueryId++;this.setQueryData({qid:this._curQueryId,see_more:this._seeMore,max_results:(this.getMaxResults()+s.additionalResultsToFetch)});this.inform('beforeQuery',{value:da,queryId:this._curQueryId});var ga=this.buildUids(da,[]);if(fa&&ga.length===0)ga.push(fa);this.value=da;this.inform('query',{value:da,results:ga,see_more:this._seeMore,queryId:this._curQueryId});if(this.resultStore){var ha=this.getRawStructure(da);if(this.shouldFetchMore(ha,ga))this.sendRemoteQueryThrottled(ha,da);this.respond(da,ga,false);}};ca.prototype.shouldFetchMore=function(da,ea){if(da.is_empty)return false;if(this._seeMore)return true;if(this.resultStore.alreadyKnown(da.cache_id))return false;if(da.raw_text&&this._isQueryTooShort(da.raw_text))return false;if(ea.length<this.getMaxResults())return true;return this.countValidResults(ea)<this.getMaxResults();};ca.prototype.countValidResults=function(da){var ea=0,fa=0;da.forEach(function(ga){var ha=this.getEntry(ga);if(ha&&!ha.isNullState)if(ha.type==='websuggestion'){ea++;}else fa++;}.bind(this));return fa+Math.min(this._maxWebSuggToCountFetchMore,ea);};ca.prototype.sendRemoteQuery=function(da,ea){var fa=new h().setURI(this.queryEndpoint).setData(this.getQueryData(da.text_form)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true).setHandler(function(ga,ha){ha.queryId=ga;this.inform('response_received',ha);this.handleResponse(ha,da);this.respond(ea,this.buildUids(ea),true,ha.payload&&(!ha.payload.results||ha.payload.results.length===0));this.inform('backend_response',ha);}.bind(this,this._curQueryId)).setFinallyHandler(this.activityEnd.bind(this));this.inform('sending_request',fa);this.activityStart();fa.send();};ca.prototype.activityStart=function(){if(!this._waitingQueries)this.inform('activity',{activity:true,seeMore:this._seeMore},g.BEHAVIOR_STATE);this._waitingQueries++;};ca.prototype.activityEnd=function(){this._waitingQueries--;if(!this._waitingQueries)this.inform('activity',{activity:false,seeMore:this._seeMore},g.BEHAVIOR_STATE);};ca.prototype._bucketizeResults=function(da,ea){var fa=this._resultsBucketizer.bucketize(ea);w.addTypeNamedX(ea,fa,this.isSeeMore(),da.toString());};ca.prototype.setBypassBucketizer=function(da){this._bypassBucketizer=da;};ca.prototype.respond=function(da,ea,fa,ga){this.inform('reorderResults',ea);this.inform('respondValidUids',ea);var ha=ea.map(this.getEntry.bind(this)).filter(i.thatReturnsArgument);if(!!da&&(da instanceof k&&!da.isEmptyOrWhitespace())&&!this._bypassBucketizer)this._bucketizeResults(da,ha);this.inform('respond',{value:da,results:ha,isAsync:!!fa,isEmptyResults:ga,isScrollable:this.isSeeMore()});return ha;};ca.prototype._updateMaxResults=function(){var da=o.getViewportDimensions().y,ea=p.getTop()||42,fa=56,ga=48;this.setMaxResults(Math.max(this._numResults.min,Math.min(this._numResults.max,Math.floor((da-ea-ga-25)/fa)-1)));};ca.prototype.getCurQueryId=function(){return this._curQueryId;};q(ca.prototype,{events:['query','respond','bootstrapped','activity','ready']});e.exports=ca;});
__d("FacebarFragmentRenderer",["Badge","DOM"],function(a,b,c,d,e,f){var g=b('Badge'),h=b('DOM');function i(m,n,o){var p=m.structure.getFragment(n),q=null,r=m.bolding&&m.bolding[n];if(typeof r=="number"){q=[r,p.getLength()-r];}else if(r)q=r;var s=[p.getText()];if(m.verified)s.push(g('medium','verified'));if(q&&q.length){return h.create('span',{},j(p.getText(),q,o));}else return h.create('span',{className:m.bolding&&o.unchanged||''},s);}function j(m,n,o){var p=[],q=false,r=0;n.forEach(function(s){var t=m.substr(r,s),u=q?o.changed:o.unchanged;if(s&&u){p.push(h.create('span',{className:u},t));}else p.push(t);r+=s;q=!q;});return p;}function k(m,n){var o={};m.forEach(function(p,q){if(p.type.lastIndexOf('ent:',0)===0)o[q]=l(n,p);});return o;}function l(m,n){var o=false,p=[];m.tokens.forEach(function(t){if(typeof t=='object'){if(t.uid==n.getUID())o=true;}else{p.push(t);if(t.length>2&&t.substr(t.length-2)=='\'s')p.push(t.substr(0,t.length-2));}});if(o)return;var q=n.getText().split(' '),r='',s=[];q.forEach(function(t,u){var v=0;p.forEach(function(w){if(w.length>v&&t.toLowerCase().indexOf(w)===0)v=w.length;});r+=t.substr(0,v);if(v!=t.length){s.push(r.length);s.push(t.length-v);r='';}if(u<q.length-1)r+=' ';});s.push(r.length);return s;}e.exports={renderFragment:i,computeEntBolding:k};});
__d("FacebarTypeahead",["Arbiter","Typeahead","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Typeahead'),i=b('copyProperties'),j=b('emptyFunction');for(var k in h)if(h.hasOwnProperty(k)&&k!=="_metaprototype")m[k]=h[k];var l=h===null?null:h.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=h;function m(n,o,p,q,r,s){h.call(this,n,o,p,q);this.getCore();this.proxyEvents();this.initBehaviors(r||[]);var t=this.core.subscribe('focus',function(){if(s)s.init(this);this.core.unsubscribe(t);this.data.bootstrap(false);this.core.input.focus();}.bind(this));this.data.bootstrap(true);this.inform('init',this,g.BEHAVIOR_PERSISTENT);g.inform('Facebar/init',this,g.BEHAVIOR_PERSISTENT);}m.prototype.proxyEvents=function(){var n,o=[],p=null,q=(function(){while(n=o.shift())this.inform(n[0],n[1]);p=null;}).bind(this);[this.data,this.view,this.core].forEach(function(r){r.subscribe(r.events,function(s,t){o.push([s,t]);p=p||q.defer();}.bind(this));},this);};i(m.prototype,{init:j});e.exports=m;});
__d("StructuredInputDOM",["createArrayFrom","CSS","cx","DOM"],function(a,b,c,d,e,f){var g=b('createArrayFrom'),h=b('CSS'),i=b('cx'),j=b('DOM'),k={ENTITY_CLASS:"_586o",encodeText:function(l){return l.replace(/ /g,'\u00a0');},decodeText:function(l){return l.replace(/\u00a0/g,' ');},createIconNode:function(l){if(l&&typeof l=='object'){var m=j.create('i',{className:l.className,style:l.uri&&{backgroundImage:'url("'+l.uri+'")'}});m.setAttribute('data-select','ignore');return m;}},createTextNode:function(l){return j.create('span',{'data-si':true},k.encodeText(l||""));},createEntityNode:function(l,m){var n=k.encodeText(l.text),o=k.createIconNode(m.icon),p=j.create('span',{},o?[o,n]:n),q=(m.className||'').split(/\s+/);q.push(k.ENTITY_CLASS);q.forEach(h.addClass.bind(h,p));var r={si:true,uid:l.uid,type:l.type,text:n,fulltext:n,group:m.group,select:m.select,icon:JSON.stringify(m.icon||null)};for(var s in r)if(r[s]!=null)p.setAttribute('data-'+s,r[s]);return p;},convertToTextNode:function(l){l.className='';l.setAttribute('data-type','text');l.removeAttribute('data-group');l.removeAttribute('data-select');l.removeAttribute('data-icon');l.removeAttribute('data-uid');for(var m=l.firstChild;m;m=m.nextSibling)if(!j.isTextNode(m))j.remove(m);},isEntityNode:function(l){return j.isElementNode(l)&&h.hasClass(l,k.ENTITY_CLASS);},containsOnlyText:function(l,m){m=g(m);for(var n=l.firstChild;n;n=n.nextSibling)if(!(j.isTextNode(n)||l.nodeName in m))return false;return true;},getText:function(l){return j.getText(l).replace(/ /g,'\u00a0');},getDecodedText:function(l){return k.decodeText(j.getText(l));},getLength:function(l){return j.getText(l).length;},getMarker:function(l,m,n){var o=l.firstChild;while(o){var p=k.getLength(o);if(p>m||!o.nextSibling){if(j.isTextNode(o)||!n){return {node:o,offset:Math.min(m,p)};}else return k.getMarker(o,m);}else m-=p;o=o.nextSibling;}}};e.exports=k;});
__d("StructuredInputUtil",["StructuredInputDOM"],function(a,b,c,d,e,f){var g=b('StructuredInputDOM');function h(n,o,p){var q=n.substr(0,o).lastIndexOf(p);return q!==-1?q+1:0;}function i(n,o,p){var q=n.indexOf(p,o);return q!==-1?q:n.length;}function j(n,o,p){return (o===0||o===n.length||n.substr(o,p.length)==p);}function k(n,o,p,q){switch(o){case 'none':return p;case 'all':return q?n.length:0;case 'word':if(j(n,p,'\u00a0')){return p;}else if(q){return i(n,p,'\u00a0');}else return h(n,p,'\u00a0');}}function l(n,o){return o&&g.isEntityNode(n)&&!g.isEntityNode(o);}var m={getMarkerAtOffset:function(n,o){var p=n.firstChild,q=0,r=0;while(p){q+=r;r=g.getLength(p);if(q+r>o){break;}else p=p.nextSibling;}return {node:p||n.lastChild,offset:o-q};},validateEntityText:function(n){var o=g.getText(n),p=n.getAttribute('data-fulltext'),q=n.getAttribute('data-group');if(q=='hashtag'){var r=o.match(/#[^\s]+/);p=r&&r[0];}var s=o.indexOf(p),t={prefix:null,entity:null,suffix:null};switch(q){case 'none':t.entity=o;break;case 'hashtag':case 'all':if(s!=-1){t.prefix=o.substr(0,s);t.entity=o.substr(s,p.length);t.suffix=o.substr(s+p.length);}else t.suffix=o;break;case 'word':if(s!=-1){t.prefix=o.substr(0,s);o=o.substr(s);}var u=0,v=0;while(u<p.length){v=i(p,u+1,'\u00a0');if(o.substr(0,v)!=p.substr(0,v)){break;}else u=v;}t.entity=o.substr(0,u)||null;t.suffix=o.substr(u)||null;}return t;},getGrouping:function(n,o){var p=n.getAttribute('data-group'),q=n.getAttribute('data-select');if(o=='select'){return q=='group'?p:'none';}else return p;},snapMarkerToText:function(n,o){var p=n.node;if(g.isEntityNode(p)){var q=n.offset,r=m.getGrouping(p,o);if(r!='none')if(q===0){var s=p.previousSibling;if(l(p,s))return {node:s,offset:g.getLength(s)};}else if(q==g.getLength(p)){var t=p.nextSibling;if(l(p,t))return {node:t,offset:0};}}return n;},nextMarkerBoundary:function(n,o,p){var q=n.node;if(g.isEntityNode(q)&&(!o||n.offset!==0)){var r=m.getGrouping(q,p);if(r!='none')return {node:n.node,offset:k(g.getText(q),r,n.offset,o)};}return n;}};e.exports=m;});
__d("StructuredInputCleaner",["DOM","createArrayFrom","copyProperties","StructuredInputUtil","StructuredInputDOM","UserAgent"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('createArrayFrom'),i=b('copyProperties'),j=b('StructuredInputUtil'),k=b('StructuredInputDOM'),l=b('UserAgent');function m(n,o){this._node=n;this._wrapText=o;}m.prototype._cleanEntityNode=function(n){var o=n.getAttribute('data-text'),p=k.getText(n);n.style.cssText='';if(o==p&&k.containsOnlyText(n,{I:true}))return null;var q=[],r=j.validateEntityText(n),s=k.createIconNode(JSON.parse(n.getAttribute('data-icon')));if(!r.entity&&((r.suffix&&!r.prefix)||(r.prefix&&!r.suffix))){k.convertToTextNode(n);n.setAttribute('data-text',p);return null;}if(r.prefix)q.push(this._createTextNode(r.prefix));if(r.entity){g.setContent(n,s?[s,r.entity]:r.entity);n.setAttribute('data-text',r.entity);q.push(n);}if(r.suffix)q.push(this._createTextNode(r.suffix));return q;};m.prototype._removeSpecialNodes=function(){var n=h(this._node.getElementsByTagName('script')),o=h(this._node.getElementsByTagName('style'));n.forEach(g.remove);o.forEach(g.remove);};m.prototype._collapseNodes=function(){for(var n,o=this._node.firstChild;o;o=n){n=o.nextSibling;if(!g.isTextNode(o)&&!k.isEntityNode(o)&&!k.containsOnlyText(o))for(var p=o.lastChild;p;p=o.lastChild){this._node.insertBefore(p,n);n=p;}}};m.prototype._createTextNode=function(n){if(this._wrapText){return k.createTextNode(n);}else return document.createTextNode(n);};m.prototype.replaceNodes=function(n,o){if(o==null)return;var p=n.length?n[n.length-1].nextSibling:null;n.forEach(g.remove);o.forEach(function(q){this._node.insertBefore(q,p);}.bind(this));};m.prototype.clean=function(){this._removeSpecialNodes();this._collapseNodes();var n=[],o=function(){if(n.length){this.replaceNodes(n,this._cleanTextNodes(n));n.length=0;}}.bind(this);h(this._node.childNodes).forEach(function(p){if(k.isEntityNode(p)){this.replaceNodes([p],this._cleanEntityNode(p));o(n);}else n.push(p);}.bind(this));o();if(!this._node.firstChild&&l.firefox())this._node.appendChild(this._createTextNode());};m.prototype.endOnText=function(){var n=function(o,p){if(k.isEntityNode(o))this._node.insertBefore(this._createTextNode(),p?o:null);}.bind(this);n(this._node.firstChild,true);n(this._node.lastChild,false);};i(m.prototype,{_cleanTextNodes:(function(){var n=function(p){return (p.nodeName==='BR'||p.nodeName==='SPAN'&&o(p));},o=function(p){return p.getAttribute('data-si')&&k.containsOnlyText(p)&&k.getLength(p)>0;};return function(p){if(p.length!=1||!n(p[0])){var q=p.map(k.getText).join('').replace(/\s+/g,' ');return q?[this._createTextNode(q)]:[];}else{p[0].style.cssText='';return;}};})()});e.exports=m;});
__d("DOMSelection",[],function(a,b,c,d,e,f){(function(){var g=this,h={isPreceding:function(n,o){return o.compareDocumentPosition(n)&2;},contains:function(n,o){if(n.compareDocumentPosition!=null){return n.compareDocumentPosition(o)&16;}else return n.contains(o);},isCursorPreceding:function(n,o,p,q){if(n===p)return o<=q;if(h.isText(n)&&h.isText(p))return h.isPreceding(n,p);if(h.isText(n)&&!h.isText(p))return !h.isCursorPreceding(p,q,n,o);if(!h.contains(n,p))return h.isPreceding(n,p);if(n.childNodes.length<=o)return false;if(n.childNodes[o]===p)return 0<=q;return h.isPreceding(n.childNodes[o],p);},isText:function(n){return (n!=null?n.nodeType==3:false);},getChildIndex:function(n){var o=0;while(n=n.previousSibling)o++;return o;}},i=g.Selection=(function(){function n(o){this.win=o;}n.prototype.hasSelection=function(){return n.hasSelection(this.win);};n.prototype.isBidirectional=function(){return n.isBidirectional(this.win);};n.prototype.getOrigin=function(){return n.getOrigin(this.win);};n.prototype.getFocus=function(){return n.getFocus(this.win);};n.prototype.getStart=function(){return n.getStart(this.win);};n.prototype.getEnd=function(){return n.getEnd(this.win);};n.prototype.trySelection=function(o,p,q,r){return n.trySelection(this.win,o,p,q,r);};n.prototype.setSelection=function(o,p,q,r){return n.setSelection(this.win,o,p,q,r);};n.prototype.clearSelection=function(){return n.clearSelection(this.win);};return n;})();function j(){if(g.document.selection&&/MSIE 9\./.test(navigator.userAgent)){return false;}else return !!g.getSelection;}if(j()){i.supported=true;i.hasSelection=function(n){var o;return (o=n.getSelection())&&(o.focusNode!=null)&&(o.anchorNode!=null);};i.isBidirectional=function(n){return true;};i.getOrigin=function(n){var o;if(!((o=n.getSelection())&&(o.anchorNode!=null)))return null;return [o.anchorNode,o.anchorOffset];};i.getFocus=function(n){var o;if(!((o=n.getSelection())&&(o.focusNode!=null)))return null;return [o.focusNode,o.focusOffset];};i.getStart=function(n){var o,p,q,r,s,t;if(!i.hasSelection(n))return null;s=i.getOrigin(n),o=s[0],q=s[1];t=i.getFocus(n),p=t[0],r=t[1];if(h.isCursorPreceding(o,q,p,r))return [o,q];return [p,r];};i.getEnd=function(n){var o,p,q,r,s,t;if(!i.hasSelection(n))return null;s=i.getOrigin(n),o=s[0],q=s[1];t=i.getFocus(n),p=t[0],r=t[1];if(h.isCursorPreceding(o,q,p,r))return [p,r];return [o,q];};var k=function(n,o,p,q,s,t){var u=o.getSelection();if(!u)return;if(s==null)s=p;if(t==null)t=q;if(u.collapse&&u.extend){u.collapse(p,q);u.extend(s,t);}else{r=o.document.createRange();r.setStart(p,q);r.setEnd(s,t);if(n||!i.hasSelection(o)||(r.endContainer===s&&r.endOffset===t&&r.startContainer===p&&r.startOffset===q)){try{u.removeAllRanges();}catch(v){}u.addRange(r);}}};i.setSelection=k.bind(i,true);i.trySelection=k.bind(i,false);i.clearSelection=function(n){try{var p=n.getSelection();if(!p)return;p.removeAllRanges();}catch(o){}};i.getText=function(n){var o=n.getSelection();if(!o)return;return o.toString();};}else if(g.document.selection){var l=function(n,o,p){var q,r,s,t,u;r=n.createElement('a');q=o.duplicate();q.collapse(p);u=q.parentElement();while(true){u.insertBefore(r,r.previousSibling);q.moveToElementText(r);if(!(q.compareEndPoints((p?'StartToStart':'StartToEnd'),o)>0&&(r.previousSibling!=null)))break;}if(q.compareEndPoints((p?'StartToStart':'StartToEnd'),o)===-1&&r.nextSibling){q.setEndPoint((p?'EndToStart':'EndToEnd'),o);s=r.nextSibling;t=q.text.length;}else{s=r.parentNode;t=h.getChildIndex(r);}r.parentNode.removeChild(r);return [s,t];},m=function(n,o,p,q,r){var s,t,u,v,w;w=0;s=h.isText(q)?q:q.childNodes[r];t=h.isText(q)?q.parentNode:q;if(h.isText(q))w=r;v=n.createElement('a');t.insertBefore(v,s||null);u=n.body.createTextRange();u.moveToElementText(v);v.parentNode.removeChild(v);o.setEndPoint((p?'StartToStart':'EndToEnd'),u);return o[p?'moveStart':'moveEnd']('character',w);};i.supported=true;i.hasSelection=function(n){var o;if(!n.document.selection)return false;o=n.document.selection.createRange();return o&&o.parentElement().document===n.document;};i.getStart=function(n){var o;if(!i.hasSelection(n))return null;o=n.document.selection.createRange();return l(n.document,o,true);};i.getEnd=function(n){var o;if(!i.hasSelection(n))return null;o=n.document.selection.createRange();return l(n.document,o,false);};i.isBidirectional=function(n){return false;};i.getOrigin=function(n){return i.getStart(n);};i.getFocus=function(n){return i.getEnd(n);};var k=function(n,o,p,q,r,s){if(r==null)r=p;if(s==null)s=q;var t=o.document.body.createTextRange();m(o.document,t,false,r,s);m(o.document,t,true,p,q);return t.select();};i.setSelection=k.bind(i,true);i.trySelection=k.bind(i,false);i.clearSelection=function(n){return n.document.selection.empty();};i.getText=function(n){if(!i.hasSelection(n))return null;var o=n.document.selection.createRange();return o&&o.text;};}else i.supported=false;}).call(this);e.exports=Selection;});
__d("StructuredInputSelection",["DOMSelection","Vector","StructuredInputUtil","StructuredInputDOM"],function(a,b,c,d,e,f){var g=b('DOMSelection'),h=b('Vector'),i=b('StructuredInputUtil'),j=b('StructuredInputDOM');function k(m){var n=m.ownerDocument;this.window=n.defaultView||n.parentWindow;this.root=m;this.selection=false;this.start=new l(this,[]);this.end=new l(this,[]);this.update();}k.prototype.isSupported=function(){return !!(g&&g.hasSelection);};k.prototype.update=function(){this.selection=false;if(this.isSupported()&&this.root==document.activeElement)if(g.hasSelection(this.window)){var m=g.getStart(this.window),n=g.getEnd(this.window),o=g.getFocus(this.window);this.start=this.makeMarker(m);this.end=this.makeMarker(n);this.backward=m[0]==o[0]&&m[1]==o[1];this.selection=this.start.node&&this.end.node;}};k.prototype.makeMarker=function(m){if(m[0]===this.root){return new l(this,[this.root.childNodes[m[1]],0]);}else return new l(this,m);};k.prototype.getFocus=function(){return this.backward?this.start:this.end;};k.prototype.getOrigin=function(){return this.backward?this.end:this.start;};k.prototype.move=function(m){if(this.selection){this.start.move(m);this.start.snap();this.end.setPosition(this.start);return this.apply();}};k.prototype.expand=function(m){if(this.selection){if(g.isBidirectional()){this.start.move(!m);this.start.snap();this.end.move(m);this.end.snap();}return this.apply();}};k.prototype.getText=function(){if(this.selection&&this.isSupported()){var m=g.getText(this.window);return m;}};k.prototype.getOffset=function(){if(this.selection)return this.start.rootOffset;};k.prototype.getLength=function(){return (this.getText()||"").length;};k.prototype.setPosition=function(m,n){this.backward=false;this.selection=true;this.start.setPosition(i.getMarkerAtOffset(this.root,m));this.start.snap();if(n>0){this.end.setPosition(i.getMarkerAtOffset(this.root,m+n));this.end.snap();}else this.end.setPosition(this.start);return this.apply();};k.prototype.hasRange=function(){return this.selection&&(this.start.node!=this.end.node||this.start.offset!=this.end.offset);};k.prototype.scrollToFocus=function(){var m=5,n=this.getFocus();if(n.node){var o=h.getElementDimensions(this.root).x,p=this.root.scrollLeft,q=n.node.offsetLeft+n.node.offsetWidth;if(q-p<m){this.root.scrollLeft=q-m;}else if(q-p>o-m)this.root.scrollLeft=q-o+m;}};k.prototype.apply=function(){if(this.start.hasChanged()||this.end.hasChanged()){var m=this.getOrigin().getMarker(true),n=this.getFocus().getMarker(true);this.selection=this.selection&&m&&m.node&&n&&n.node;if(this.selection&&this.isSupported()){this.start.changed=false;this.end.changed=false;g.trySelection(this.window,m.node,m.offset,n.node,n.offset);return true;}}};function l(m,n){this.selection=m;this.node=n[0];this.offset=n[1];this.rootOffset=this.getRootOffset(n[0],n[1]);this.sibling=this.node&&this.node.previousSibling;this.changed=false;}l.prototype.hasChanged=function(){return this.changed||!this.isNodeValid();};l.prototype.isNodeValid=function(){if(j.getLength(this.node)>this.offset){var m=this.node;while(m=m.parentNode)if(m==this.selection.root)return true;}};l.prototype.getMarker=function(m){if(this.isNodeValid()&&((m&&!this.node.firstChild)||(!m&&this.node.parentNode==this.selection.root))){return this;}else return j.getMarker(this.selection.root,this.rootOffset,m);};l.prototype.move=function(m){this.node&&this.setPosition(i.nextMarkerBoundary(this.getMarker(false),m,'select'));};l.prototype.snap=function(){this.node&&this.setPosition(i.snapMarkerToText(this.getMarker(false),'select'));};l.prototype.setPosition=function(m){if(m.offset!=this.offset||m.node!=this.node){this.changed=true;this.node=m.node;this.offset=m.offset;this.rootOffset=this.getRootOffset(this.node,this.offset);}};l.prototype.getRootOffset=function(m,n){var o=0,p=5;while(m&&o++<p)if(m===this.selection.root){return n;}else{var q=m;while(q=q.previousSibling)n+=j.getLength(q);m=m.parentNode;}};e.exports=k;});
__d("StructuredInput",["Event","Arbiter","ArbiterMixin","CSS","cx","csx","DataStore","DOM","Input","InputSelection","Keys","Parent","requestAnimationFrame","StructuredInputCleaner","StructuredInputDOM","StructuredInputSelection","StructuredInputUtil","Style","UserAgent","copyProperties","createArrayFrom","createObjectFrom","emptyFunction","mixin"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('CSS'),k=b('cx'),l=b('csx'),m=b('DataStore'),n=b('DOM'),o=b('Input'),p=b('InputSelection'),q=b('Keys'),r=b('Parent'),s=b('requestAnimationFrame'),t=b('StructuredInputCleaner'),u=b('StructuredInputDOM'),v=b('StructuredInputSelection'),w=b('StructuredInputUtil'),x=b('Style'),y=b('UserAgent'),z=b('copyProperties'),aa=b('createArrayFrom'),ba=b('createObjectFrom'),ca=b('emptyFunction'),da=229,ea=ba([q.UP,q.DOWN,q.LEFT,q.RIGHT]),fa=ba([q.BACKSPACE,q.DELETE]),ga=ba([q.SPACE,q.RETURN]),ha=ba('IUB'.split('').map(function(qa){return qa.charCodeAt(0);})),ia=y.firefox(),ja=y.ie(),ka=y.webkit(),la=b("mixin"),ma=la(i);for(var na in ma)if(ma.hasOwnProperty(na)&&na!=="_metaprototype")pa[na]=ma[na];var oa=ma===null?null:ma.prototype;pa.prototype=Object.create(oa);pa.prototype.constructor=pa;pa.__superConstructor__=ma;function pa(qa){m.set(qa,'StructuredInput',this);this._root=qa;this._richInput=n.find(qa,"._586i");this._textInput=n.find(qa,"._586f");this._placeholderText=n.scry(qa,"._586j")[0];this._hintText=n.find(qa,"._586k");this._contentWidth=null;this._richWidth=null;this._hintNodes=[];this.init();}pa.prototype.init=function(){this.init=ca;this._initSelection();this._initCleaner();this._initInputs();this._initEvents();this._scheduledCleanInput=false;this._richChanged=false;this._textChanged=false;this._selectionChanged=false;this._selectionIgnore=false;this._imeMode=false;this.cleanInput();this.inform('init',null,h.BEHAVIOR_PERSISTENT);};pa.prototype._initInputs=function(){this._richInput.contentEditable=true;this._richInput.spellcheck=false;this._richInput.tabIndex=0;this._textInput.tabIndex=-1;this._multiline=this._textInput.nodeName=='TEXTAREA';if(!j.shown(this._richInput)){var qa=p.get(this._textInput);n.setContent(this._richInput,u.encodeText(o.getValue(this._textInput)));j.hide(this._textInput);j.show(this._richInput);this.cleanInput();this.setSelection({offset:qa.start,length:qa.end-qa.start});}this.togglePlaceholder();this._toggleHint();};pa.prototype._initEvents=function(){var qa=null,ra=!ja&&('oninput' in this._richInput),sa=function(){this._richChanged=true;ra||this.scheduleCleanInput(true);}.bind(this),ta=function(){this._textChanged=true;ra||this.scheduleCleanInput(false);}.bind(this),ua=function(){this._selectionChanged=true;this.scheduleCleanInput(false);}.bind(this),va=function(){this._imeMode=true;this._placeholderText&&j.hide(this._placeholderText);j.hide(this._hintText);}.bind(this),wa=function(){this._imeMode=false;this._richChanged=true;this.cleanInput();}.bind(this);g.listen(this._richInput,'keydown',function(xa){qa=xa.keyCode;if(xa.ctrlKey&&xa.keyCode in ha){return xa.kill();}else if(xa.keyCode in ea){ua();}else if(xa.keyCode===q.BACKSPACE&&this._deleteTrailingChunk()){this._richChanged=true;this.cleanInput();return xa.kill();}else if(xa.keyCode in fa){sa();}else if(xa.keyCode==da)va();}.bind(this));g.listen(this._richInput,'keypress',function(xa){if(xa.keyCode==q.RETURN){this._multiline&&this._insertText("\n");return xa.kill();}else if(!this._selectionChanged&&this._selectionIsText()){ta();}else sa();}.bind(this));if(!ra){g.listen(this._richInput,'keyup',function(xa){if((this._imeMode||xa.keyCode!=qa)&&xa.keyCode in ga){wa();return xa.kill();}else if(this._imeMode){this._textChanged=true;this.cleanInput();}}.bind(this));}else{g.listen(this._richInput,'compositionstart',va);g.listen(this._richInput,'compositionend',wa);g.listen(this._richInput,'input',function(){this._textChanged=true;if(!this._imeMode)if(!this._richChanged){this.cleanInput();}else this.scheduleCleanInput();}.bind(this));}g.listen(document,'selectionchange',function(){if(this._selectionIgnore){this._selectionIgnore=false;}else this._selectionChanged=true;}.bind(this));g.listen(this._richInput,'mousedown',function(){this._selectionChanged=true;this._selectionLength=0;this._selectionOffset=0;}.bind(this));g.listen(this._richInput,'mouseup',function(){this._selectionChanged=true;s(this.cleanInput.bind(this));}.bind(this));g.listen(this._richInput,'cut',function(){this._richChanged=true;this.scheduleCleanInput(false);}.bind(this));g.listen(this._richInput,'paste',function(xa){if(this._insertClipboard(xa&&xa.clipboardData||window.clipboardData)){return xa.kill();}else{this._richChanged=true;this.scheduleCleanInput(true);}}.bind(this));g.listen(this._richInput,'drop',function(xa){this.focus();this.selectAll();this._insertClipboard(xa&&xa.dataTransfer);return xa.kill();}.bind(this));g.listen(this._richInput,'dragover',function(xa){xa.dataTransfer.dropEffect='move';xa.dataTransfer.effectAllowed='move';return xa.kill();});g.listen(this._richInput,'focus',function(xa){this._toggleHint();this.inform('focus');}.bind(this));g.listen(this._richInput,'blur',function(xa){j.hide(this._hintText);this._imeMode=false;this._richChanged=true;this.scheduleCleanInput(false);this.inform('blur');}.bind(this));};pa.prototype._initCleaner=function(){this._cleaner=new t(this._richInput,true);};pa.prototype._initSelection=function(){this._selection=new v(this._richInput);this._selectionLength=0;this._selectionOffset=0;};pa.prototype._insertClipboard=function(qa){if(qa&&qa.getData){var ra=qa.types&&aa(qa.types);if(!ra){this._insertText(qa.getData('Text'));}else if(ra.indexOf('text/html')!=-1){this._insertHTML(qa.getData('text/html'));}else if(ra.indexOf('text/plain')!=-1)this._insertText(qa.getData('text/plain'));return true;}else return false;};pa.prototype._deleteTrailingChunk=function(qa){var ra=this.getSelection();if(ra.length>0||ra.offset===0)return false;var sa=this.getSelection().offset-1,ta=w.getMarkerAtOffset(this._richInput,sa);if(ta&&u.isEntityNode(ta.node)&&w.getGrouping(ta.node,'select')!=='none'){n.remove(ta.node);return true;}return false;};pa.prototype._selectionIsText=function(){var qa=this._selection.start.node,ra=this._selection.end.node;return qa&&qa===ra&&!u.isEntityNode(qa)&&!u.isEntityNode(qa.parentNode);};pa.prototype._insertText=function(qa){if(qa){var ra=n.create('div',{},qa);return this._insertNodes(ra);}};pa.prototype._insertNodes=function(qa){if(document.selection){document.selection.createRange().pasteHTML(qa.innerHTML);}else document.execCommand('insertHTML',false,qa.innerHTML);this._richChanged=true;this.cleanInput();};pa.prototype.togglePlaceholder=function(qa){if(!this._placeholderText)return;var ra=u.getLength(this._richInput)===0;if(qa&&ra){j.show(this._placeholderText);}else j.conditionShow(this._placeholderText,ra&&!this._imeMode);};pa.prototype._toggleHint=function(){var qa=aa(this._hintNodes),ra=null,sa='',ta=u.getText(this._richInput).toLowerCase();if(!this.hasFocus())return;if(this._contentOverflows()){j.hide(this._hintText);return;}while(qa.length&&sa.length<ta.length){ra=qa.shift();sa+=u.getText(ra);}if(ta.length&&sa.substr(0,ta.length).toLowerCase()==ta.toLowerCase()){n.setContent(this._hintText,aa(this._richInput.cloneNode(true).childNodes));var ua=u.createTextNode(sa.substr(ta.length));qa.unshift(ua);n.appendContent(this._hintText,n.create('span',{className:"_586h"},qa));j.show(this._hintText);j.hide(this._placeholderText);}else j.hide(this._hintText);};pa.prototype._contentOverflows=function(){if(this._richWidth===null)this._richWidth=this._richInput.clientWidth;if(this._contentWidth===null){var qa=this._richInput.lastChild;this._contentWidth=n.isElementNode(qa)?qa.offsetLeft+qa.offsetWidth:0;}return this._contentWidth>this._richWidth;};pa.prototype._forceTop=function(){if(!this._multiline)this._richInput.scrollTop=0;this._root.scrollTop=0;};pa.prototype._createStructureNodes=function(qa){return qa.map(function(ra){return ra.uid||(ra.type&&ra.type!='text')?u.createEntityNode(ra,ra.display||{}):u.createTextNode(ra.text);}.bind(this));};pa.prototype._suppressInput=function(){if(ia||ja){if(this._richClean)return;this._richClean=this._richInput.cloneNode(true);this._richClean.contentEditable=false;this._root.insertBefore(this._richClean,this._richInput.nextSibling);this._richClean.scrollLeft=this._richInput.scrollLeft;x.set(this._richInput,'padding',0);x.set(this._richInput,'height',0);}};pa.prototype._revealInput=function(){if(!this._richClean)return;x.set(this._richInput,'height','');x.set(this._richInput,'padding','');this._root.removeChild(this._richClean);this.focus();this._richClean=null;};pa.prototype._cleanInput=function(){var qa;if(this._textChanged&&!this._richChanged){this._selection.update();qa='change';}else if(this._richChanged||this._selectionChanged){this._selection.update();if(this._richChanged){this._contentWidth=null;this._cleaner.clean();this._cleaner.endOnText();this._selection.apply();qa='change';}if(this._selectionChanged){this._cleanSelection();if(this._selectionLength||!this._richChanged)qa='select';}}this._revealInput();this._forceTop();if(this._richChanged||this._textChanged){this.togglePlaceholder();this._toggleHint();}this._selectionIgnore=true;this._selectionChanged=false;this._richChanged=false;this._textChanged=false;qa&&this.inform(qa);};pa.prototype._cleanSelection=function(){var qa=this._selection.getLength(),ra=this._selection.getOffset();if(qa){this._selection.expand(qa>=this._selectionLength);qa=this._selection.getLength();ra=this._selection.getOffset();}this._selectionLength=qa;this._selectionOffset=ra;};pa.prototype.cleanInput=function(){this._scheduledCleanInput||this._cleanInput();};pa.prototype.scheduleCleanInput=function(qa){qa&&this._suppressInput();if(!this._scheduledCleanInput){this._scheduledCleanInput=true;s(function(){this._cleanInput();this._scheduledCleanInput=false;}.bind(this));}};pa.prototype.setEnabled=function(qa){this._textInput.disabled=!qa;this._richInput.contentEditable=qa;};pa.prototype.getRoot=function(){return this._root;};pa.prototype.getRichInput=function(){return this._richInput;};pa.prototype.getEnabled=function(){return !this._textInput.disabled;};pa.prototype.getText=function(){return u.getDecodedText(this._richInput);};pa.prototype.setText=function(qa){n.setContent(this._richInput,u.createTextNode(qa));this._richChanged=false;this._selectionChanged=false;this.inform('change');};pa.prototype.setHint=function(qa){this._hintNodes=this._createStructureNodes(qa);this._toggleHint();};pa.prototype.getStructure=function(){var qa=[];aa(this._richInput.childNodes).forEach(function(ra){var sa=!n.isTextNode(ra),ta=u.getDecodedText(ra);ta.length&&qa.push({text:ta,uid:sa?ra.getAttribute('data-uid'):null,type:(sa&&ra.getAttribute('data-type'))||'text'});}.bind(this));return qa;};pa.prototype.setStructure=function(qa){n.setContent(this._richInput,this._createStructureNodes(qa));this._cleaner.endOnText();this._cleaner.clean();this.togglePlaceholder();this._toggleHint();this._richChanged=false;this._selectionChanged=false;this.inform('change');};pa.prototype.getContentDimensions=function(){var qa=this._richInput.lastChild;return {width:qa?qa.offsetLeft+qa.offsetWidth:0,height:qa?qa.offsetTop+qa.offsetHeight:0};};pa.prototype.getSelection=function(){return {offset:this._selection.getOffset(),length:this._selection.getLength()};};pa.prototype.setSelection=function(qa){if(this.hasFocus()){this._selection.update();this._selection.setPosition(qa.offset,qa.length);this._selection.scrollToFocus();this._selectionChanged=false;this.inform('select');}};pa.prototype.moveSelectionToEnd=function(){this.setSelection({length:0,offset:u.getLength(this._richInput)});};pa.prototype.isSelectionAtEnd=function(){var qa=this.getSelection().offset,ra=u.getLength(this._richInput);return qa>=ra;};pa.prototype.selectAll=function(){this.setSelection({offset:0,length:u.getLength(this._richInput)});};pa.prototype.hasFocus=function(){return n.contains(this._root,document.activeElement);};pa.prototype.focus=function(){this._richInput.focus();};pa.prototype.blur=function(){var qa=n.create('input',{type:'text',tabIndex:-1,style:{position:'absolute',top:0,left:'-100px',width:'1px',height:'1px'}});n.appendContent(this._root,qa);var ra=function(){if(this.hasFocus()||(ka&&document.activeElement===document.body)){qa.focus();qa.blur();}};this.blur=ra;this.blur();};pa.getInstance=function(qa){var ra=r.byClass(qa,"_586g");return ra?m.get(ra,'StructuredInput'):null;};z(pa.prototype,{_insertHTML:(function(){var qa=n.create('div'),ra=new t(qa,false);return function(sa){if(sa){qa.innerHTML=sa;ra.clean();return this._insertNodes(qa);}};})()});e.exports=pa;});
__d("FacebarTypeaheadInput",["ArbiterMixin","csx","DOM","FacebarStructuredText","StructuredInput","Vector","copyProperties","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('csx'),i=b('DOM'),j=b('FacebarStructuredText'),k=b('StructuredInput'),l=b('Vector'),m=b('copyProperties'),n={text:{className:"text",group:"all",select:"none"},ent:{className:"entity",group:"all",select:"group"},'ent:hashtag_exact':{className:"entity",group:"hashtag",select:"none"}},o=b("mixin");function p(u){return m(u.toStruct(),{display:n[u.getType()]||n[u.getTypePart(0)]});}var q=o(g);for(var r in q)if(q.hasOwnProperty(r)&&r!=="_metaprototype")t[r]=q[r];var s=q===null?null:q.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=q;function t(u){this.root=u;this.input=k.getInstance(u);this.value=null;this.selection={offset:0,length:0};this.resetOnChange=true;this.initEvents();}t.prototype.initEvents=function(){var u=function(v,w){this.inform(v,w);}.bind(this);this.input.subscribe('blur',u);this.input.subscribe('focus',u);this.input.subscribe('change',function(v,w){if(this.resetOnChange)this.value=null;this.inform('change',w);}.bind(this));};t.prototype.togglePlaceholder=function(u){return this.input.togglePlaceholder(u);};t.prototype.focus=function(){this.input.focus();};t.prototype.blur=function(){this.input.blur();};t.prototype.getElement=function(){return this.root;};t.prototype.getRawPlaceholderElement=function(){return i.find(this.root,"._586j");};t.prototype.getRawInputElement=function(){return i.scry(this.root,"._586i")[0];};t.prototype.getValue=function(){if(this.value===null)this.value=j.fromStruct(this.input.getStructure());return this.value;};t.prototype.getLength=function(){return this.getValue().getLength();};t.prototype.resetPlaceholder=function(){this.input.resetPlaceholder();};t.prototype.setValue=function(u){u=u.pad();this.value=u;this.resetOnChange=false;var v=u.toArray().map(p);this.input.setStructure(v);this.input.setSelection({offset:u.getLength(),length:0});this.resetOnChange=true;};t.prototype.storeSelection=function(){this.selection=this.input.getSelection();};t.prototype.restoreSelection=function(){this.input.setSelection(this.selection);};t.prototype.setHint=function(u){var v=u?u.toArray().map(p):[];this.input.setHint(v);};t.prototype.isSelectionAtEnd=function(){return this.input.isSelectionAtEnd();};t.prototype.selectInput=function(u){this.input.setSelection({offset:u||0,length:this.getLength()});};t.prototype.getEndOffset=function(){var u=l.getElementDimensions(this.root),v=this.input.getContentDimensions();return Math.min(u.x,v.width);};m(t.prototype,{events:['change','focus','blur']});e.exports=t;});
__d("FacebarTypeaheadWebSearch",["startsWith","FacebarStructuredFragment","FacebarStructuredText"],function(a,b,c,d,e,f){var g=b('startsWith'),h=b('FacebarStructuredFragment'),i=b('FacebarStructuredText'),j=new h({type:'ent:websuggestion',text:'Web Search: ',uid:null}),k=j.getText().toLowerCase().trim();function l(o,p){if(!o||o.type!=='websuggestion')return;var q=p.getValue().toArray();q.forEach(function(r){if(r.isType('ent')&&!r.isType('ent','user')&&r.getUID())if(o.extra_uri_params){o.extra_uri_params.qh=r.getUID();return;}});}function m(o){return o.getType()===j.getType();}function n(o){this._core=o.getCore();this._view=o.getView();this._input=this._core.input;this._isEnabled=false;}n.prototype.enable=function(){this._isEnabled=true;this.changeListener=this._input.subscribe('change',this._changeWebSearch.bind(this));this.lockListener=this._input.subscribe('shortcut',this._lockWebSearch.bind(this));this.beforeSelectListener=this._view.subscribe('beforeSelect',this._beforeSelect.bind(this));this.beforeRenderListener=this._view.subscribe('beforeRender',this._beforeRender.bind(this));};n.prototype._changeWebSearch=function(){var o=this._input.getValue(),p=o.toArray(),q=p[0];if(q&&q.getType()==='text')if(g(q.getText().toLowerCase(),k)){p.splice(0,1,j,new h({text:q.getText().substr(k.length).replace(/^ /,'')}));this._replaceFragments(p);}else if(p.length>1&&p.some(m))this._replaceFragments([new h({text:o.toString()})]);};n.prototype._replaceFragments=function(o){this._input.storeSelection();this._input.setValue(new i(o));this._input.restoreSelection();};n.prototype._beforeSelect=function(o,p){l(p.selected,this._input);return true;};n.prototype._beforeRender=function(o,p){var q=this._input.getValue().toArray()[0],r=q&&m(q);p.results.forEach(function(s){if(s.type==='websuggestion')s.isLockedWebSearchMode=r;});return true;};n.prototype._lockWebSearch=function(o,p){if(p.shift){var q=this._input.getValue().toArray()[0];if(!q||!m(q))this._input.setValue(new i([j]));}};n.prototype.disable=function(){this.beforeSelectListener.unsubscribe();this.changeListener.unsubscribe();this.lockListener.unsubscribe();this.beforeRenderListener.unsubscribe();this._isEnabled=false;};n.addPrefix=function(o){if(!m(o.getFragment(0))){var p=[j].concat(o.toArray());return new i(p);}else return o;};e.exports=n;});
__d("FacebarTypeaheadCore",["Event","Arbiter","ArbiterMixin","Animation","arrayContains","Base64","copyProperties","csx","CSS","DOM","FacebarStructuredText","FacebarTypeaheadInput","FacebarTypeaheadWebSearch","FacebarGlobalOptions","invariant","Keys","startsWith","Style","URI","mixin"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('Animation'),k=b('arrayContains'),l=b('Base64'),m=b('copyProperties'),n=b('csx'),o=b('CSS'),p=b('DOM'),q=b('FacebarStructuredText'),r=b('FacebarTypeaheadInput'),s=b('FacebarTypeaheadWebSearch'),t=b('FacebarGlobalOptions'),u=b('invariant'),v=b('Keys'),w=b('startsWith'),x=b('Style'),y=b('URI'),z=b('mixin'),aa=z(i);for(var ba in aa)if(aa.hasOwnProperty(ba)&&ba!=="_metaprototype")da[ba]=aa[ba];var ca=aa===null?null:aa.prototype;da.prototype=Object.create(ca);da.prototype.constructor=da;da.__superConstructor__=aa;function da(ea){m(this,ea);}da.prototype.init=function(ea,fa,ga){this.init=function(){};this.data=ea;this.view=fa;this.root=ga;this.windowFocused=true;this.isFocused=false;this.keepOpen=false;this.hoverAnimation=null;this.stickyQuery=null;this.settedQuery=null;this.selectedQuery=null;this.currentQuery=null;this.initSubcomponents();this.initEvents();this.checkValue();};da.prototype.initSubcomponents=function(){var ea=p.find(this.root,"._5861");this.input=new r(ea);this.view.setInputElement(this.input.getRawInputElement());};da.prototype.initEvents=function(){g.listen(this.root,'keydown',this.keydown.bind(this));g.listen(this.root.parentNode,'mousedown',this.mousedown.bind(this));g.listen(this.view.getElement(),'mousedown',this.mousedown.bind(this));g.listen(document.body,'mouseup',this.mouseup.bind(this));g.listen(window,'focus',this.focusWindow.bind(this));g.listen(window,'blur',this.blurWindow.bind(this));this.view.subscribe('select',this.selectView.bind(this));this.view.subscribe('highlight',this.highlightView.bind(this));this.view.subscribe('render',this.highlightView.bind(this));this.view.subscribe('hideHelp',this.performQuery.bind(this));this.input.subscribe('focus',this.focusInput.bind(this));this.input.subscribe('blur',this.blurInput.bind(this));this.input.subscribe('change',this.changeInput.bind(this));this.data.subscribe('activity',this.typeaheadActivity.bind(this));this.data.subscribe('respond',this.completeData.bind(this));this.data.subscribe('ready',this.typeaheadReady.bind(this));this.initFocus.bind(this).defer();};da.prototype.initFocus=function(){if(p.contains(this.input.root,document.activeElement)){this.isFocused=true;this._newSession();this.open();}};da.prototype.cleanQuery=function(ea){ea=m({},ea)||{};if(!ea.structure)ea.structure=new q();if(!t.allowGrammar||ea.type==='hashtag_exact'||ea.results_set_type==='browse_type_blended')ea.structure=q.fromString(ea.structure.toString());u(ea.structure instanceof q);if(ea.type=='websuggestion'&&t.allowGrammar&&t.webSearchLockedInMode)ea.structure=s.addPrefix(ea.structure);return ea;};da.prototype._unlockQuery=function(){var ea=this.input.getValue();if(ea.hasType('ent'))this.input.setValue(q.fromString(ea.toString()));};da.prototype.setPageQuery=function(ea){ea=this.cleanQuery(ea);var fa=this.input.getValue(),ga=ea.structure,ha=!ga.isEmptyOrWhitespace()&&(fa.isEmptyOrWhitespace()||fa.toString().trim()==ga.toString().trim());return this.selectQuery(ea,ha);};da.prototype.selectQuery=function(ea,fa){fa=fa!==false;ea=this.cleanQuery(ea);if(fa||!this.selectedQuery){if(fa||this.getValue().isEmptyOrWhitespace())this.setQuery(ea);this.selectedQuery=ea;}return ea;};da.prototype.completeSelection=function(){var ea=this.view.getSelection();if(ea&&!ea.search){this.data.saveResult(ea);this.setQuery(ea);return true;}};da.prototype.setQuery=function(ea,fa){ea=this.cleanQuery(ea);this.input.setValue(ea.structure);this.settedQuery=ea;this.stickyQuery=fa===false?this.stickyQuery:ea;this.checkValue();};da.prototype.checkValue=function(){if(!this.view.visible||!this.dataSourceReady||(this.value&&this.value.getHash()==this.input.getValue().getHash()))return;this.value=this.nextQuery=this.getValue();this.performQuery();};da.prototype.performQuery=function(){this.data.query(this.nextQuery);this.currentQuery=this.nextQuery;};da.prototype.expandView=function(){this.data.query(this.currentQuery,false,[],true);this.input.restoreSelection();};da.prototype.collapseView=function(){this.requery();};da.prototype.requery=function(){if(this.currentQuery)this.data.query(this.currentQuery);};da.prototype.executeQuery=function(ea){ea=this.cleanQuery(ea);var fa=this.inform('execute',ea),ga=this.getSessionID(),ha=ea.structure.hasType('blank');if(ha){ea.structure=new q(ea.structure.toArray().filter(function(ia){return ia.getType()!='blank';}));}else this.close();if(t.allowGrammar){this.selectQuery(ea);}else this.selectQuery();if(!fa&&!ha)this._navigateToQuery(ea,ga);};da.prototype.getSearchType=function(){return 'facebar';};da.prototype._newSession=function(){this._sessionID=Math.random().toString();this.inform('session',this._sessionID,h.BEHAVIOR_STATE);};da.prototype._closeSession=function(){this.inform('session',null,h.BEHAVIOR_STATE);};da.prototype.getSessionID=function(){return this._sessionID;};da.prototype._navigateToQuery=function(ea,fa){var ga=this.data.facebarConfig;if(ea.uri){ea.uri.addQueryData(ea.extra_uri_params);ea.uri.addQueryData({ref:'br_tf'});if(ea.structure&&(ea.type=='websuggestion'||(ea.type=='grammar'&&(!ga||w(ea.uri.getPath(),ga.search_path))))){var ha=this.data.getRawStructure(ea.structure).text_form,ia=l.encode(ha).replace(/\=+$/,''),ja={sid:fa,qs:ia,gv:this.data.getQueryData().grammar_version},ka=l.encode(JSON.stringify(ja)).replace(/\=+$/,'');ea.uri.addQueryData({ref:ka});}ea.uri.go();return;}};da.prototype.reset=function(){this.selectQuery();this.inform('reset');};da.prototype.animateInputValue=function(ea,fa,ga){this.hoverAnimation&&this.hoverAnimation.stop();var ha=new j(fa).from('opacity',1).to('opacity',0).duration(150).ondone(function(){this.input.setValue(ga);this.hoverAnimation=ia.go();}.bind(this)),ia=new j(ea).from('opacity',0).to('opacity',1).duration(150).ondone(function(){this.hoverAnimation=null;x.set(fa,'opacity','');x.set(ea,'opacity','');}.bind(this));x.set(ea,'opacity',0);this.hoverAnimation=ha.go();};da.prototype.open=function(){o.addClass(document.body,'facebarOpened');this.inform('open');this.view.show();this.input.focus();this.checkValue();if(!this.isFocused){this.isFocused=true;this._newSession();this.inform('focus');}};da.prototype.close=function(){this._closeSession();if(this.inform('close')===false)return;if((!this.value||this.value.isEmptyOrWhitespace())&&this.selectedQuery){this.input.setValue(this.selectedQuery.structure);}else if(this.stickyQuery)this.input.setValue(this.stickyQuery.structure);this.input.blur();this.view.hide();this.view.setAutoSelect(false);this.inform('session',null,h.BEHAVIOR_STATE);if(this.isFocused){o.addClass(document.body,'facebarClosing');o.removeClass(document.body,'facebarOpened');o.removeClass.curry(document.body,'facebarClosing').defer(355);this.isFocused=false;this.inform.bind(this,'blur').defer();}};da.prototype.getElement=function(){return this.root;};da.prototype.getValue=function(){return this.input.getValue();};da.prototype.getText=function(){return this.getValue().toString();};da.prototype.keydown=function(event){var ea=true,fa=g.getKeyCode(event);switch(fa){case v.ESC:this.close();break;case v.RIGHT:if(!t.disableLockingEntitiesOnRightArrow){ea=this.input.isSelectionAtEnd()&&this.completeSelection();}else ea=false;break;case v.TAB:if(event.getModifiers().shift||(!this.completeSelection()&&!this.loading)){this.view.setAutoSelect(false);this.view.hide();ea=false;}else this.tabQueued=true;break;case v.UP:this.view.prev();break;case v.DOWN:this.view.next();break;case v.RETURN:this.view.select();break;case v.PAGE_UP:this.view.first();break;default:if(fa>='0'.charCodeAt(0)&&fa<='z'.charCodeAt(0)){if(t.unlockTextOnKeypress)this._unlockQuery();this.view.setAutoSelect(true);}this.stickyQuery=null;ea=false;break;}this.input.storeSelection();if(ea)return event.kill();};da.prototype.mousedown=function(){this.view.setAutoSelect(true);this.input.storeSelection();this.keepOpen=true;};da.prototype.mouseup=function(ea){if(this.keepOpen)this.open();this.keepOpen=false;};da.prototype.focusWindow=function(){this.windowFocused=true;};da.prototype.blurWindow=function(){this.windowFocused=false;};da.prototype.selectView=function(ea,fa){if(!fa||!fa.selected)return;fa.selected.see_more=this.data.isSeeMore();this.inform('select',fa);var ga=this.cleanQuery(fa.selected);this.executeQuery(ga);};da.prototype.highlightView=function(){var ea=this.view.getSelection();ea&&this.input.setHint(ea.structure);};da.prototype.blurInput=function(){setTimeout((function(){if(this.windowFocused||y.getRequestURI().getSubdomain()=='apps'){this.input.togglePlaceholder();if(!this.keepOpen)this.close();}}).bind(this),0);};da.prototype.changeInput=function(){this.inform('change');this.checkValue();this.inform('change_end');};da.prototype.focusInput=function(){this.open();this.input.togglePlaceholder(false);};da.prototype.typeaheadReady=function(){this.dataSourceReady=true;this.checkValue();};da.prototype.updateData=function(){this.view.setLoading(this.loading);};da.prototype.completeData=function(ea,fa){if(fa.forceDisplay||(this.value&&this.value.matches(fa.value))){this.view.render(fa.value,fa.results,fa.isAsync,(fa.results.length===0)&&fa.isEmptyResults,fa.isScrollable);if(this.tabQueued&&this.completeSelection())delete this.tabQueued;}};da.prototype.typeaheadActivity=function(ea,fa){this.fetching=fa.activity;if(this.loading!=this.fetching){this.loading=this.fetching;this.updateData();}};da.prototype.getNameTextFromSelected=function(){var ea=this.settedQuery&&this.settedQuery.semantic,fa=this.data.facebarConfig&&this.data.facebarConfig.name_functions,ga=ea&&fa&&ea.match(/[a-z-]+\([^()]+\)/g);if(ga)for(var ha=0;ha<ga.length;ha++){var ia=ga[ha].match(/([a-z-]+)\(([^()]+)\)/);if(ia&&k(fa,ia[1]))return ia[2];}return this.value.toString();};m(da.prototype,{events:['session','focus','select','change','execute','blur'],dataSourceReady:false});e.exports=da;});
__d("FacebarTypeaheadHighlighter",[],function(a,b,c,d,e,f){function g(h){this.$FacebarTypeaheadHighlighter0=h.getCore();this.$FacebarTypeaheadHighlighter1=this.$FacebarTypeaheadHighlighter0.view;}g.prototype.enable=function(){this.$FacebarTypeaheadHighlighter2=this.$FacebarTypeaheadHighlighter1.subscribe('filter',this.$FacebarTypeaheadHighlighter3.bind(this));};g.prototype.disable=function(){this.$FacebarTypeaheadHighlighter2.unsubscribe();};g.prototype.$FacebarTypeaheadHighlighter3=function(h,event){var i=event.results,j=event.value;i.forEach(function(k){k.original_query=j;});};e.exports=g;});
__d("FacebarTypeaheadRecorder",["clickRefAction","copyProperties","Env","Event","Keys","ScubaSample","SearchTypeaheadRecorder","URI","userAction","Arbiter"],function(a,b,c,d,e,f){var g=b('clickRefAction'),h=b('copyProperties'),i=b('Env'),j=b('Event'),k=b('Keys'),l=b('ScubaSample'),m=b('SearchTypeaheadRecorder'),n=b('URI'),o=b('userAction'),p=b('Arbiter');for(var q in m)if(m.hasOwnProperty(q)&&q!=="_metaprototype")s[q]=m[q];var r=m===null?null:m.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=m;function s(t){this.typeahead=t;m.call(this,t);this.userText="";this.queryTimes=[];this._sessionDisabled=false;}s.prototype.initEvents=function(){this.typeahead.getCore().subscribe('session',function(t,u){if(u===null){this.sessionEnd();}else this.sessionStart(u);}.bind(this));this.typeahead.getCore().subscribe('select',function(t,u){this.recordSelectInfo(u);}.bind(this));this.typeahead.getCore().input.subscribe('shortcut',function(t,u){this.recordShortcut(u);}.bind(this));this.typeahead.getCore().subscribe('quickSelectRedirect',function(t,u){this.recordQuickSelectInfo(u);}.bind(this));this.typeahead.getView().subscribe('render',function(t,u){this.recordRender(u);}.bind(this));this.typeahead.data.subscribe('query',function(t,u){if(!u.value.isEmpty())this.recordCountStat('num_queries');if(u.see_more)this.recordStat('clicked_see_more',1);this.recordAvgStat('num_results_from_cache',u.results.length);this.queryTimes[u.queryId-this.startQueryId]={send:Date.now()};}.bind(this));this.typeahead.data.subscribe('sending_request',function(t,u){var v=u.data.value;if(!v)return;this.backendQueries.push(v);}.bind(this));this.typeahead.subscribe('navigation',function(t,u){if(u&&u.structure){this.recordStat('navigation_input',JSON.stringify(u.structure.toStruct()));this.recordStat('navigation_text',u.structure.toString());}}.bind(this));this.typeahead.data.subscribe('response_received',function(t,u,v){if(u.queryId>=this.startQueryId){var w=this.queryTimes[u.queryId-this.startQueryId];w.recv=Date.now()-w.send;}}.bind(this));this.typeahead.data.subscribe('backend_response',function(t,u){if(u.queryId>=this.startQueryId){var v=this.queryTimes[u.queryId-this.startQueryId];v.render=Date.now()-v.send;if(u.payload.incomplete)v.incomplete=true;v.backendInfo=u.payload.info;if(this.core.scubaInfo)this.logToScuba(u,v,this.core.scubaInfo);}}.bind(this));p.subscribe('BrowseNUX/typing',this.disableThisSession.bind(this));p.subscribe('TestConsole/typing',this.disableThisSession.bind(this));this.typeahead.getCore().subscribe('change',function(t,u){this.userInput(this.core.getText());}.bind(this));this.typeahead.subscribe('clear',function(){this.recordAppendStat('before_clear_queries',this.userText);}.bind(this));j.listen(this.element,'keydown',function(event){this.recordStat('keypressed',1);if(j.getKeyCode(event)==k.BACKSPACE){if(!this._backspacing){this._backspacing=true;this.recordAppendStat('before_backspace_queries',this.core.getText());}}else this._backspacing=false;}.bind(this));this.typeahead.subscribe('filter',function(t,u){this._unsupportedGrammarInfo=this.buildUnsupportedGrammarInfo(u);}.bind(this));this.typeahead.getCore().subscribe('recordFunction',function(t,u){this._extraRecorder.push(u);}.bind(this));};s.prototype._reset=function(t){this.stats={};this.avgStats={};this.appendStats={};this._backspacing=false;this.backendQueries=[];this._topreplace=false;this._inflightRequests={};};s.prototype.sessionStart=function(t){this._sessionEnded=false;this.data.setQueryData({sid:t});this.recordStat('sid',t);if(!this.stats.session_start_time)this.recordStat('session_start_time',Date.now());this.startQueryId=this.data.getCurQueryId()+1;this.recordStat('keypressed',0);this.queryTimes=[];};s.prototype.sessionEnd=function(){if(this._sessionEnded||this._sessionDisabled){if(this._sessionDisabled){this.reset();this._sessionDisabled=false;this._sessionEnded=true;}return;}this._sessionEnded=true;this.recordStat('session_end_time',Date.now());this.recordStat('grammar_version',this.data.getQueryData().grammar_version);this.submit();};s.prototype.disableThisSession=function(){this._sessionDisabled=true;};s.prototype.userInput=function(t){this.userText=t;};s.prototype.buildUnsupportedGrammarInfo=function(t){var u=t.results?t.results[0]:null;if(!u||u.results_set_type!=='unimplemented')return null;return {unsupported_grammar:{category:u.error_info.category||'unknown',edge:u.error_info.blamed_edge}};};s.prototype.buildTypeaheadRecord=function(t,u){var v=t.rankType||t.render_type||t.type,w=0,x=u;if(typeof t.groupIndex=='number'){w=t.groupIndex;x=t.indexInGroup;}var y={group_index:w,index_in_group:x,cost:t.cost,s_value:t.s_value||0,semantic:t.semantic,text:t.structure.toString(),cache_only:(t.cacheOnlyResult?1:0),parse:t.parse,semantic_forest:t.semanticForest,normalized_input:t.entityTypes,category:t.category,type:v,source:t.bootstrapped,grammar_results_type:(t.results_set_type||'').replace(/[\[\{](.*)[\]\}]/,'$1'),result_from_memcache:t.memcache,websuggestion_source:t.websuggestion_source,dynamic_cost:t.dynamic_cost,is_js_bootstrap_match:t.isJSBootstrapMatch,backend_cost:t.backendCost,bootstrap_cost:t.bootstrapCost,match_type:t.match_type,l_type:t.l_type,vertical_type:t.vertical_type,prefix_match:t.prefix_match,prefix_length:t.prefix_length,index_before_buckets:t.indexBeforeBuckets,bucket_lineage:t.bucketLineage,nullstate:t.isNullState,singlestate:t.isSingleState,query_id:t.qid};if(t.logInfo)y.backend_log_info=t.logInfo;if(t.s_token)y.s_token=t.s_token;if(t.s_categories)y.s_categories=t.s_categories;return y;};s.prototype.buildListTypeaheadRecords=function(){var t=[];this.results&&this.results.forEach(function(u,v){if(u.uid!=='search')t.push(this.buildTypeaheadRecord(u,v));}.bind(this));return t;};s.prototype.recordShortcut=function(t){this.recordStat('shortcut',1);this.recordStat('shortcut_with_shift',t.shift);};s.prototype.recordStats=function(t,u){for(var v in u)this.recordStat(t+'_'+v,u[v]);};s.prototype.getTypeaheadIndex=function(t,u){var v=typeof t.groupIndex=='number'?t.groupIndex+1:0;return u-v;};s.prototype.recordQuickSelectInfo=function(t){var u={input_query:t.input_query,semantic:t.semantic,type:t.type,position:t.position,with_mouse:t.with_mouse,text:t.text,quick_select:1};this.recordStats('selected',u);this.recordStat('quick_select',1);};s.prototype.recordSelectInfo=function(t){var u=t.selected,v=this.getTypeaheadIndex(u,t.index),w={};if(u.uid=='search'){w.selected_search=1;}else{w=this.buildTypeaheadRecord(u);var x=(w.type=='friend'?'user':w.type);w.position=v;w[x]=1;}w.with_mouse=t.clicked?1:0;w.quick_select=0;w.see_more=u.see_more?1:0;w.input_query=this.userText;w.input_fragments=JSON.stringify(this.core.currentQuery.toStruct());var y=u.dataGT?{gt:JSON.parse(u.dataGT)}:{},z={href:u.path};g('click',z,null,null,y);o('search').uai('click');this.recordStats('selected',w);this.recordAppendStat('selection_history',{selected:w,candidate_results:this.buildListTypeaheadRecords(),timestamp:Date.now()});var aa={};this._extraRecorder.forEach(function(ba){ba(t,this.results,aa);}.bind(this));this.recordStat('extra_select_info',JSON.stringify(aa));this.recordStat('selected_with_mouse',t.clicked?1:0);};s.prototype._dataToSubmit=function(){this.recordStat('max_results',this.data._maxResults);if(this.stats&&this.stats.selected_input_query){this.recordStat('input_query',this.stats.selected_input_query);}else this.recordStat('input_query',this.userText);this.recordStat('uri',n().toString());if(!this.stats.shortcut){this.recordStat('shortcut',0);this.recordStat('shortcut_with_shift',false);}var t=this.stats;for(var u in this.avgStats){var v=this.avgStats[u];t[u]=v[0]/v[1];}var w={candidate_results:this.buildListTypeaheadRecords(),timestamp:Date.now(),input_query:this.userText};if(this._unsupportedGrammarInfo)h(w,this._unsupportedGrammarInfo);this.recordAppendStat('suggestions_at_end_of_session',w);this.recordAppendStat('query_times',this.queryTimes);if(this.backendQueries.length>0){if(this.backendQueries.length>this.data.logBackendQueriesWindow)this.backendQueries=this.backendQueries.slice(this.backendQueries.length-this.data.logBackendQueriesWindow);this.recordStat('backend_queries',this.backendQueries);}for(var x in this.appendStats)t[x]=JSON.stringify(this.appendStats[x]);return t;};s.prototype.getDataToSubmit=function(){return this._dataToSubmit();};s.prototype.reset=function(){return this._reset();};s.prototype.submit=function(){if(!this._sessionDisabled)r.submit.call(this);this.view.inform('feedback');this._reset();};s.prototype.logToScuba=function(t,u,v){if(this._sessionDisabled)return;var w=new l('search_facebar_js',null,{addBrowserFields:true});w.addInteger('sample_rate',v.sample_rate);w.addNormal('site',v.site);w.addDenorm('query',t.request.uri.query_s);var x=t.payload;x.entities&&w.addInteger('num_entities',x.entities.length);x.results&&w.addInteger('num_results',x.results.length);if(x.times){w.addInteger('time_bootstrap',x.times.bootstrap);w.addInteger('time_php_end_to_end',x.times.end_to_end);w.addInteger('time_fetchers',x.times.fetchers);w.addInteger('time_grammar',x.times.grammar);}w.addInteger('incomplete',u.incomplete?1:0);w.addInteger('time_render',u.render-u.recv);w.addInteger('time_js_async',u.recv);w.addInteger('query_id',u.queryId);w.addInteger('user_id',i.user);w.addInteger('session_id',this.typeahead.getCore().getSessionID());w.flush();};h(s.prototype,{_endPoint:'/ajax/typeahead/search/record_metrics.php',_sessionEnded:true,_extraRecorder:[],_banzaiRoute:'facebar'});e.exports=s;});
__d("FacebarTypeaheadView",["Animation","Arbiter","ContextualLayer","copyProperties","CSS","csx","cx","DOM","Ease","Event","FacebarStructuredText","fbt","Parent","ScrollableArea","Style","throttle","TypeaheadView","Vector","ViewportBounds"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ContextualLayer'),j=b('copyProperties'),k=b('CSS'),l=b('csx'),m=b('cx'),n=b('DOM'),o=b('Ease'),p=b('Event'),q=b('FacebarStructuredText'),r=b('fbt'),s=b('Parent'),t=b('ScrollableArea'),u=b('Style'),v=b('throttle'),w=b('TypeaheadView'),x=b('Vector'),y=b('ViewportBounds'),z=981,aa='unimplemented';for(var ba in w)if(w.hasOwnProperty(ba)&&ba!=="_metaprototype")da[ba]=w[ba];var ca=w===null?null:w.prototype;da.prototype=Object.create(ca);da.prototype.constructor=da;da.__superConstructor__=w;function da(ea,fa){w.call(this,ea,fa);this.sid='';this.index=-1;this.animation=null;this.warningShown=false;this.autoSelect=false;this.minResults=fa.minResults||3;this.maxResults=fa.maxResults;this.animateHeightThrottled=v(this.animateHeight,50,this);this.animateCount=-1;this.animateWidth=-1;this.loading=false;this.setAnimationDuration(da.DEFAULT_ANIMATION_DURATION);}da.prototype.init=function(){this.initializeElements();ca.init.call(this);};da.prototype.initializeElements=function(){var ea=this.element;this.content=n.find(ea,"._21r");this.throbber=n.find(ea,"._21f");this.warningNode=n.find(ea,"._553e");this.scroller=n.find(ea,"._8v2");this.scrollableArea=t.getInstance(this.scroller);this.footer=this.createFooter();};da.prototype.initializeLayer=function(){var ea=n.scry(document.body,'#blueBar')[0],fa,ga,ha;if(ea&&n.contains(ea,this.element)){fa=ea;ha="_53df";ga='100%';}else{fa=this.element.parentNode;ha='';ga=z+'px';}this.wrapper=n.create('div');n.appendContent(this.wrapper,this.element);this.layer=new i({context:fa,position:'below',alignment:this.alignment,causalElement:this.causalElement},this.wrapper);this.layer.show();this.layer.hide();k.addClass(this.layer.getRoot(),ha);u.set(this.layer.getContentRoot(),'width',ga);};da.prototype.initializeEvents=function(){p.listen(this.content,{click:this.click.bind(this),mouseover:this.mouseover.bind(this)});};da.prototype.setInputElement=function(ea){this.setAccessibilityControlElement(ea);this.causalElement=ea;this.initializeLayer();};da.prototype.setAutoSelect=function(ea){this.autoSelect=ea;if(this.index===-1&&ea)this.first();};da.prototype.setAnimationDuration=function(ea){this.$FacebarTypeaheadView0=ea;};da.prototype.click=function(event){if(!event.isMiddleClick()&&!event.getModifiers().any){var ea=s.byTag(event.getTarget(),'a');if(!ea||k.hasClass(ea,"_205")){this.select(true);return event.kill();}}};da.prototype.show=function(){if(!this.visible){this.inform('beforeShow',this.layer);var ea=ca.show.call(this);this.first();this.layer.show();this.layer.updatePosition();this.recalculateScrollableArea();this.animateCount=-1;this.animateHeight();this.inform('show');h.inform('layer_shown',{type:'FacebarTypeahead'});return ea;}};da.prototype.hide=function(){if(this.visible){this.layer.hide();ca.hide.call(this);u.set(this.scroller,'height','0px');this.inform('hide');h.inform('layer_hidden',{type:'FacebarTypeahead'});}return this;};da.prototype.select=function(ea){var fa=this.results[this.index];if(!fa){this.inform('quickSelect');return;}var ga=this.inform('beforeSelect',{index:this.index,selected:fa});if(ga!==false&&this.isIndexFooter(this.index))ga=false;if(ga!==false)ca.select.call(this,ea);};da.prototype.buildResults=function(ea){this.list=k.addClass(ca.buildResults.call(this,ea),"_21c");return this.list;};da.prototype.animateHeight=function(){if(this.items.length==this.animateCount){var ea=x.getViewportDimensions().x;if(this.animateWidth!=ea){this.animateWidth=ea;this.recalculateScrollableArea();}return;}if(this.list&&k.shown(this.list)){this.animateCount=this.items.length;var fa=Math.min(x.getElementDimensions(this.list).y,this.calculateMaxAllowableHeight());this.animation&&this.animation.stop();this.animation=new g(this.scroller).to('height',fa).duration(this.$FacebarTypeaheadView0).ease(o.makePowerOut(5)).ondone(this.recalculateScrollableArea.bind(this)).go();}};da.prototype.calculateMaxAllowableHeight=function(){var ea=x.getViewportDimensions().y,fa=y.getTop()||48,ga=56,ha=Math.max(this.minResults,Math.floor((ea-fa-25)/ga)-1)+1;return ha*ga+(ga/4);};da.prototype.render=function(ea,fa,ga,ha,ia){this.inform('filter',{results:fa,value:ea,isScrollable:ia});if(this.loading)fa.push({uid:'search',node:this.footer,structure:new q(),search:true});var ja=fa[0];if(ha){this.showWarning(r._("There are no results for '{query}'",[r.param("query",ea.toString())]));}else if(ja&&ja.results_set_type===aa){if(!ja.error_info.suppress)this.showWarning(ja.error_info.errorMessage||"This search isn't currently supported.");}else this.hideWarning();if(this.inform('removeUnimplementedGrammar')!==false)fa=fa.filter(function(ka){return ka.results_set_type!==aa;}.bind(this));ca.render.call(this,ea,fa,ga);this.renderFooter();this.animateHeightThrottled();};da.prototype.showWarning=function(ea){k.show(this.warningNode);n.setContent(this.warningNode,ea);this.warningShown=true;this.highlight(-1,false);};da.prototype.hideWarning=function(){k.hide(this.warningNode);this.warningShown=false;this.highlight(this.index,false);};da.prototype.recalculateScrollableArea=function(){u.set(this.scroller,'width',x.getElementDimensions(this.element).x+'px');this.scrollableArea.resize();this.scrollableArea.poke();};da.prototype.setLoading=function(ea){this.loading=ea;this.renderFooter();};da.prototype.scrollTo=function(ea){ea&&this.scrollableArea.scrollIntoView(ea,true);};da.prototype.renderFooter=function(){k.conditionShow(this.throbber,this.loading);k.conditionShow(this.footer,this.loading);if(this.loading){this.inform('showingFooter');}else this.inform('hidingFooter');};da.prototype.isIndexFooter=function(ea){var fa=this.results[ea];return fa&&fa.node==this.footer;};da.prototype.first=function(){this.index=this.autoSelect?0:-1;this.highlight(this.index);};da.prototype.prev=function(){if(this.index<=0)this.index=this.items.length;if(this.isIndexFooter(this.index-1))this.index-=1;this.ignoreMouseover=true;ca.prev.call(this);};da.prototype.next=function(){if(this.index+1>=this.items.length)this.index=-1;if(this.isIndexFooter(this.index+1))this.index=-1;this.ignoreMouseover=true;ca.next.call(this);};da.prototype.highlight=function(ea,fa){fa=fa!==false&&(this.index!=ea);if(!fa||this.inform('beforeHighlight')!==false){var ga=this.warningShown||!this.autoSelect?-1:0;ca.highlight.call(this,Math.max(ga,ea),fa);}};da.prototype.createFooter=function(){return n.create('li',{className:"_3su hidden_elem"},this.throbber);};j(da.prototype,{events:['highlight','render','filter']});da.DEFAULT_ANIMATION_DURATION=500;e.exports=da;});
__d("FacebarTypeaheadDecorateEntities",["arrayContains","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('copyProperties'),i=b('emptyFunction');function j(n){var o=[];n.forEach(function(p){if(p.isType('ent'))o.push(p.getUID());});return o;}function k(n,o){var p=null;n.structure.forEach(function(q){if(q.isType('ent')&&!g(o,q.getUID()))p=q;});return p;}function l(n,o,p){n.forEach(function(q){var r=k(q,o);q.decoration={entity:r&&p.getEntryForFragment(r)};});}function m(n){this._typeahead=n;}m.prototype.enable=function(){this._typeahead.view.subscribe('filter',function(n,o){l(o.results,j(this._typeahead.core.getValue()),this._typeahead.data);}.bind(this));};h(m.prototype,{disable:i});e.exports=m;});
__d("FacebarTypeaheadDecorateMessageButton",["cx","ChatOpenTab","DOM","React","XUIButton.react"],function(a,b,c,d,e,f){var g=b('cx'),h=b('ChatOpenTab'),i=b('DOM'),j=b('React'),k=b('XUIButton.react');function l(m){this.$FacebarTypeaheadDecorateMessageButton0=m;this.$FacebarTypeaheadDecorateMessageButton1=null;}l.prototype.enable=function(){this.$FacebarTypeaheadDecorateMessageButton1=this.$FacebarTypeaheadDecorateMessageButton0.view.subscribe('renderingItem',this.$FacebarTypeaheadDecorateMessageButton2.bind(this));};l.prototype.$FacebarTypeaheadDecorateMessageButton2=function(m,event){event.item.setShouldRenderEducation(false);var n=event.result;if(n.type!=='user'&&n.type!=='{user}')return;var o=i.create('span',{className:"_5anx"}),p=function(){h.openUserTab(n.uid,'search');};j.renderComponent(k({label:"Message",onMouseDown:p}),o);event.item.setMessageButton(o);};l.prototype.disable=function(){this.$FacebarTypeaheadDecorateMessageButton1&&this.$FacebarTypeaheadDecorateMessageButton1.unsubscribe();};e.exports=l;});
__d("FacebarRender",["DOM","createArrayFrom","flattenArray","emptyFunction"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('createArrayFrom'),i=b('flattenArray'),j=b('emptyFunction');function k(){return i(h(arguments)).filter(j.thatReturnsArgument);}function l(m,n){return g.create('span',{className:m},k(n));}e.exports={span:l,children:k};});
__d("FacebarTypeaheadItem",["BrowseFacebarHighlighter","CSS","cx","DOM","FacebarFragmentRenderer","FacebarRender","fbt"],function(a,b,c,d,e,f){var g=b('BrowseFacebarHighlighter'),h=b('CSS'),i=b('cx'),j=b('DOM'),k=b('FacebarFragmentRenderer'),l=b('FacebarRender'),m=b('fbt'),n="_7gk",o="_53ad",p=k.renderFragment;function q(s){var t=s.getTypePart(0);return t?"fragment"+t.charAt(0).toUpperCase()+t.substr(1):"fragment";}function r(s){this._result=s;this._aux=null;this._debug=null;this._renderEducation=true;this._classes=(s.classNames||'').split(' ');this.addClass("_202");this.addClass("_5bl2");this._shouldVAlign=true;this._messageButton=null;}r.prototype.setVAlign=function(s){this._shouldVAlign=s;return this;};r.prototype.shouldVAlign=function(){return this._shouldVAlign;};r.prototype.addClass=function(s){this._classes.push(s);};r.prototype.setAux=function(s){this._aux=s;return this;};r.prototype.setShouldRenderEducation=function(s){this._renderEducation=s;return this;};r.prototype.setDebug=function(s){this._debug=s;return this;};r.prototype.setMessageButton=function(s){this._messageButton=s;return this;};r.prototype.cacheable=function(){return this._debug===null;};r.prototype.renderText=function(){return this._result.structure.toArray().map(function(s,t){var u=p(this._result,t,{});return h.addClass(u,q(s));}.bind(this));};r.prototype.renderAux=function(){return this._aux?[this._aux]:[];};r.prototype.renderSubtext=function(){return [];};r.prototype.renderIcon=function(){return [];};r.prototype.renderEduContent=function(){if(!this._renderEducation)return [];var s=j.create('span',{className:"_78d"},"Tab"),t=m._("Use {tab} key to select",[m.param("tab",s)]);return j.create('span',{className:"_6ji"},l.children(t));};r.prototype.highlight=function(s){if(!this._result.original_query||!h.hasClass(s,"_20e"))return;var t=this._result.original_query.toString().trim(),u=t.split(' '),v=u.length>1?[t].concat(u):[t];v=v.filter(function(w){return (w!=='');});if(h.hasClass(s,"_20e"))g.highlight(s,v);};r.prototype.render=function(){var s=this.renderAux(),t=this.renderIcon(),u=this.renderText(),v=this.renderEduContent(),w=this.renderSubtext(),x=this._debug,y=this._messageButton,z=l.span(o,l.children(u,w));h.conditionClass(z,"_55y-",this.shouldVAlign()&&w);var aa=l.span(n,[z,v,y]);h.conditionClass(aa,"_5byz",y);var ba=j.create('a',{className:"_205",href:this._result.uri,rel:'ignore'},j.create('span',{className:"_6i1"},l.children(t,aa,x))),ca=j.create('span',{className:"_6i2"},l.children(s,this._aux));if(t)this._classes.push("_6_k");var da=j.create('li',{className:this._classes.join(' ')},[ba,ca]);da.setAttribute('aria-label',this._result.structure.toString());return da;};e.exports=r;});
__d("FacebarTypeaheadToken",["cx","FacebarRender"],function(a,b,c,d,e,f){var g=b('cx'),h=b('FacebarRender'),i=' '+'\u00B7'+' ',j="_53a9",k="_53aa",l="_53ab";function m(n,o){this._text=n;this._limit=null;this._innerClass=o?o:k;this._showLeadingMiddot=false;this._separateMainText=true;}m.prototype.setLimit=function(n){this._limit=n;return this;};m.prototype.setLeadingMiddot=function(n){this._showLeadingMiddot=n;return this;};m.prototype.separateMainText=function(n){this._separateMainText=n;return this;};m.prototype.getText=function(){return this._text;};m.prototype.render=function(){var n=this.getText();if(n.length){this._limit&&n.splice(this._limit);n.forEach(function(r,s){if(s!==0||this._showLeadingMiddot)n[s]=[i,r];}.bind(this));var o=this._separateMainText?n.shift():null,p=n.length?h.span(l,n):null,q=h.span(j,h.span(this._innerClass,[o,p]));return q;}};e.exports=m;});
__d("FacebarTypeaheadEntityToken",["FacebarTypeaheadToken","DOM","HTML"],function(a,b,c,d,e,f){var g=b('FacebarTypeaheadToken'),h=b('DOM'),i=b('HTML'),j='\u00B7';for(var k in g)if(g.hasOwnProperty(k)&&k!=="_metaprototype")m[k]=g[k];var l=g===null?null:g.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=g;function m(n){g.call(this);this._entity=n;this._default={};}m.prototype.setDefaultText=function(n,o){this._default[n]=o;return this;};m.prototype.getText=function(){var n=[],o={},p=function(r){r=r.trim();if(!o[r]){n.push(r);o[r]=1;}},q=function(r){if(typeof r=='object')r=h.getText(i(r).getRootNode());r&&r.split(j).map(p);};this._entity.category?q(this._entity.category):n.push(this._default[this._entity.type]);q(this._entity.subtext);return n;};e.exports=m;});
__d("FacebarTypeaheadEntityItem",["CSS","cx","DOM","FacebarTypeaheadItem","FacebarTypeaheadEntityToken","fbt","TypeaheadFacepile","FacebarRender"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx'),i=b('DOM'),j=b('FacebarTypeaheadItem'),k=b('FacebarTypeaheadEntityToken'),l=b('fbt'),m=b('TypeaheadFacepile'),n=b('FacebarRender');for(var o in j)if(j.hasOwnProperty(o)&&o!=="_metaprototype")q[o]=j[o];var p=j===null?null:j.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=j;function q(r){j.call(this,r);this.addClass("_20e");}q.prototype.renderSubtext=function(){var r=n.span('DefaultText',"Timeline");return new k(this._result).setDefaultText('user',r).render();};q.prototype.renderIcon=function(){var r=this._result.photos||this._result.photo;if(!r)return null;if(r instanceof Array){r=m.render(r);g.addClass(r,"_51l_");return r;}else return i.create('img',{className:"_20h",alt:'',src:r});};e.exports=q;});
__d("FacebarTypeaheadDisambiguateResults",["FacebarDisambiguationDialog","FacebarStructuredFragment","FacebarStructuredText","URI","copyProperties","emptyFunction","getObjectValues"],function(a,b,c,d,e,f){var g=b('FacebarDisambiguationDialog'),h=b('FacebarStructuredFragment'),i=b('FacebarStructuredText'),j=b('URI'),k=b('copyProperties'),l=b('emptyFunction'),m=b('getObjectValues');function n(w,x){var y={};w.forEach(function(ba){if(ba.type=='grammar'){var ca=x(ba.structure).toLowerCase();y[ca]=y[ca]||[];y[ca].push(ba);}});var z=[];for(var aa in y)if(y[aa].length>1)z.push(y[aa]);return z;}function o(w){var x=[];w.toArray().forEach(function(y,z){if(y.isType('ent'))x.push(z);});return x;}function p(w,x,y){var z={},aa={},ba={};x.forEach(function(da){var ea=w[0].structure.getFragment(da),fa=ea.getHash();aa[fa]=aa[fa]||[];ba[da]=aa[fa];w.forEach(function(ga){var ha=ga.structure.getFragment(da),ia=ha&&ha.getUID();if(ia&&!z.hasOwnProperty(ia)){aa[fa].push(y.getEntryForFragment(ha));z[ia]=true;}});});for(var ca in ba)if(ba[ca].length<=1)delete ba[ca];return ba;}function q(w,x){var y={},z=[];w.forEach(function(aa){var ba=aa.structure.getFragment(x).getUID();if(!y.hasOwnProperty(ba)){y[ba]=z.length;z.push([]);}z[y[ba]].push(aa);});return z;}function r(w,x,y){var z=w.shift();z.ambiguity.entities=x;y.push.apply(y,w);return z;}function s(w,x){var y=[],z=[],aa=false;w.forEach(function(ca){ca.ambiguity={fragment:null,entities:null,text:null};});n(w,function(ca){return ca.getHash();}).forEach(function(ca){var da=ca[0].structure,ea=o(da),fa=p(ca,ea,x);if(aa){r(ca,fa,y);return;}var ga=ea.pop();if(typeof ga=='number'){var ha=q(ca,ga);aa=ha.length>1;if(aa)delete fa[ga];ha.forEach(function(ia){var ja=r(ia,fa,y);if(aa){var ka=ja.structure.getFragment(ga).getUID();ja.ambiguity.entity=x.getEntry(ka);z.push(ja);}});}});y.forEach(function(ca){var da=w.indexOf(ca);da!=-1&&w.splice(da,1);});n(w,function(ca){return ca.toString();}).forEach(function(ca){ca.forEach(function(da){if(!da.ambiguity.entities)da.ambiguity.text=da.queryTypeText;});});var ba=w.indexOf(z[0]);z.slice(1).forEach(function(ca){var da=w.indexOf(ca);if(da!=-1&&da!=++ba){w.splice(da,1);w.splice(ba,0,ca);}});}function t(w,x){var y=w&&w.ambiguity&&w.ambiguity.entities,z=y&&Object.keys(y).map(Number),aa=x.core.input;if(!z||z.length===0)return false;var ba=function(ea){x.core.executeQuery(u(w,z,ea));},ca=function(){aa.focus();aa.input.moveSelectionToEnd();};y=y?m(y):[];var da=new g(y,w.uri.getPath(),ba,ca,x.getCore().getSessionID());aa.blur();da.show();return true;}function u(w,x,y){var z=w.structure.toArray(),aa=j(w.uri),ba=aa.getPath().split('/');x.forEach(function(ca){var da=z[ca],ea=y.shift(),fa=ba.indexOf(String(da.getUID()));if(fa!=-1)ba[fa]=ea.uid;z[ca]=new h({uid:ea.uid,text:ea.text,type:'ent:'+ea.type});});return {uri:aa.setPath(ba.join('/')),structure:new i(z)};}function v(w){this._typeahead=w;}v.prototype.enable=function(){this._typeahead.view.subscribe('filter',function(w,x){s(x.results,this._typeahead.data);}.bind(this));this._typeahead.view.subscribe('beforeSelect',function(w,x){return !t(x.selected,this._typeahead);}.bind(this));};k(v.prototype,{disable:l});e.exports=v;});
__d("FacebarTypeaheadHashtagResult",["HashtagSearchResultUtils"],function(a,b,c,d,e,f){var g=b('HashtagSearchResultUtils');function h(i){this.$FacebarTypeaheadHashtagResult0=i.getData();}h.prototype.enable=function(){this.$FacebarTypeaheadHashtagResult1=this.$FacebarTypeaheadHashtagResult0.subscribe('beforeQuery',this.$FacebarTypeaheadHashtagResult2.bind(this));};h.prototype.$FacebarTypeaheadHashtagResult2=function(i,j){if(!j||!j.value)return;var k=this.$FacebarTypeaheadHashtagResult0.getRawStructure(j.value);if(!k||k.is_empty||!k.raw_text)return;var l=g.getHashtagFromQuery(k.raw_text);if(!l)return;var m='hashtag:'+l,n=this.$FacebarTypeaheadHashtagResult0.getEntry(m);if(!n){this.$FacebarTypeaheadHashtagResult0.processEntries([g.makeFacebarEntry(l)]);this.$FacebarTypeaheadHashtagResult0.resultStore.saveResults([g.makeFacebarResult(l)],k,true);}return;};h.prototype.disable=function(){this.$FacebarTypeaheadHashtagResult1&&this.$FacebarTypeaheadHashtagResult0.unsubscribe(this.$FacebarTypeaheadHashtagResult1);};e.exports=h;});
__d("FacebarTypeaheadMagGo",["csx","DOM","Event","$","SubscriptionsHandler"],function(a,b,c,d,e,f){var g=b('csx'),h=b('DOM'),i=b('Event'),j=b('$'),k=b('SubscriptionsHandler');function l(m){this._core=m.getCore();this._view=this._core.view;this._handler=new k();this._selected=null;}l.prototype.enable=function(){var m=h.find(j('blueBar'),"._585_");this._handler.addSubscriptions(i.listen(m,'click',this._runQuery.bind(this)),this._view.subscribe('highlight',this._highlight.bind(this)),this._view.subscribe('render',this._render.bind(this)),this._core.subscribe('close',this._close.bind(this)));};l.prototype.disable=function(){this._handler.release();};l.prototype._highlight=function(m,n){this._selected=n.selected;};l.prototype._render=function(m,n){this._selected=this._view.results[this._view.index];};l.prototype._runQuery=function(){if(this._selected)return this._core.selectView(null,{selected:this._selected});};l.prototype._close=function(){this._selected=null;};e.exports=l;});
__d("FacebarTypeaheadMagPPS",["csx","DOM","Event","FacebarStructuredText","FacebarURI","FacebarResultStoreUtils","$","SubscriptionsHandler","URI"],function(a,b,c,d,e,f){var g=b('csx'),h=b('DOM'),i=b('Event'),j=b('FacebarStructuredText'),k=b('FacebarURI'),l=b('FacebarResultStoreUtils'),m=b('$'),n=b('SubscriptionsHandler'),o=b('URI');function p(q){this._core=q.getCore();this._data=q.getData();this._view=this._core.view;this._input=this._core.input;this._handler=new n();}p.prototype.enable=function(){var q=h.find(m('blueBar'),"._585_");this._handler.addSubscriptions(i.listen(q,'click',this._runQuery.bind(this)));};p.prototype.disable=function(){this._handler.release();};p.prototype._runQuery=function(){var q=this._input.getValue(),r=this._data.getRawStructure(q);if(!r||r.is_empty)return;var s;if(!r.raw_text){s=l.getRawTextFromStructured(q.toArray());}else s=r.raw_text;var t=o(this._view.seeMoreSerpEndpoint).addQueryData('q',s).addQueryData('sid',this._core.getSessionID());t=k.getQualifiedURI(t);var u='uri('+'path('+this._view.seeMoreSerpEndpoint+')'+',param_q('+s+')'+',param_source(mag_glass)'+')';return this._core.selectView(null,{selected:{uid:'see_more_serp',node:this._moreBar,structure:new j(),search:true,uri:t,type:'see_more_serp',text:s,selected:true,semantic:u}});};e.exports=p;});
__d("FacebarTypeaheadNarrowDrawer",["CSS","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx');function i(j){this.$FacebarTypeaheadNarrowDrawer0=j;this.$FacebarTypeaheadNarrowDrawer1=null;}i.prototype.enable=function(){this.$FacebarTypeaheadNarrowDrawer1=this.$FacebarTypeaheadNarrowDrawer0.view.subscribe('beforeShow',this.$FacebarTypeaheadNarrowDrawer2.bind(this));};i.prototype.$FacebarTypeaheadNarrowDrawer2=function(j,k){g.removeClass(k.getRoot(),"_53df");g.addClass(k.getContentRoot(),"_5b71");k.setContext(this.$FacebarTypeaheadNarrowDrawer0.element.offsetParent);};i.prototype.disable=function(){this.$FacebarTypeaheadNarrowDrawer1&&this.$FacebarTypeaheadNarrowDrawer1.unsubscribe();};e.exports=i;});
__d("FacebarTypeaheadNavigation",["Arbiter","FacebarNavigation","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('FacebarNavigation'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this._core=l.core;this._preserveQuery=false;this._typeahead=l;}k.prototype.enable=function(){h.registerBehavior(this);this._core.subscribe('execute',this.executedUserQuery.bind(this));this._core.subscribe('change',this.changeUserQuery.bind(this));};k.prototype.executedUserQuery=function(l,m){this._preserveQuery=true;};k.prototype.changeUserQuery=function(){this._navigatedQuery=false;};k.prototype.pageTransition=function(){if(!this._preserveQuery){this._core.close();this._core.reset();}else this._preserveQuery=false;};k.prototype.setPageQuery=function(l){l=this._core.setPageQuery(l);this._typeahead.inform('navigation',l,g.BEHAVIOR_PERSISTENT);};i(k.prototype,{disable:j});e.exports=k;});
__d("FacebarTypeaheadQuickSelect",["FacebarStructuredText","URI"],function(a,b,c,d,e,f){var g=b('FacebarStructuredText'),h=b('URI'),i='/search/web/direct_search.php';function j(k){this._core=k.getCore();this._view=k.getView();this._input=this._core.input;this._beforeSelectListener=null;this._quickSelectListener=null;}j.prototype.enable=function(){this._beforeSelectListener=this._view.subscribe('beforeSelect',this._quickSelect.bind(this));this._quickSelectListener=this._view.subscribe('quickSelect',this._quickSelect.bind(this));};j.prototype._quickSelect=function(k,l){if(l&&l.selected&&l.selected.uid!=='search')return true;var m=this._input.getValue().toArray(),n=new g(m),o=n.toString();if(!o)return true;var p=h(i).addQueryData('q',o),q={input_query:o,type:'quickselect',text:o,position:0,with_mouse:0,semantic:'uri(path('+p.toString()+'))',extra_uri_params:{source:'quickselect',sid:this._core.getSessionID()},uri:p};this._core.inform('quickSelectRedirect',q);this._core.executeQuery(q);return false;};j.prototype.disable=function(){this._beforeSelectListener&&this._view.unsubscribe(this._beforeSelectListener);this._quickSelectListener&&this._view.unsubscribe(this._quickSelectListener);};e.exports=j;});
__d("FacebarTypeaheadRecorderBasic",["Arbiter","FacebarTypeaheadRecorder","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('FacebarTypeaheadRecorder'),i=b('copyProperties');function j(k){this._typeahead=k;}j.prototype.enable=function(){var k=this._typeahead;this._subscription=k.subscribe('init',function(l,m){var n=new h(k);k.inform('recorder',n,g.BEHAVIOR_PERSISTENT);});};j.prototype.disable=function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;};i(j.prototype,{_subscription:null});e.exports=j;});
__d("FacebarTypeaheadSeeMore",["CSS","cx","DOM","FacebarStructuredText","fbt"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx'),i=b('DOM'),j=b('FacebarStructuredText'),k=b('fbt');function l(m){this._core=m.getCore();this._view=this._core.view;this._moreBar=null;this._isOpen=false;}l.prototype.enable=function(){this._subscriptions=[this._core.subscribe('close',this._close.bind(this)),this._view.subscribe('filter',this._buildSeeMore.bind(this)),this._view.subscribe('beforeSelect',this._beforeSelect.bind(this)),this._view.subscribe('next',this._scrollView.bind(this)),this._view.subscribe('prev',this._scrollView.bind(this)),this._view.subscribe('showingFooter',this._footerShow.bind(this)),this._view.subscribe('hidingFooter',this._footerHide.bind(this))];};l.prototype.disable=function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();};l.prototype._beforeSelect=function(m,event){if(!event.selected||event.selected.node!==this._moreBar)return true;this._view.first();this._core.expandView();return false;};l.prototype._buildSeeMore=function(m,event){var n=event.results;if(n.length===0||event.isScrollable||event.value.toString().trim()=="")return;if(n.length<this._view.maxResults){var o=n.some(function(q){return q.type!=='websuggestion';});if(!o)return;}else if(n.length>this._view.maxResults+1){this._isOpen=true;return;}var p="See More";this._isOpen=false;this._moreBar=i.create('li',{className:"_70_ calltoaction"},p);this._moreBar.setAttribute('aria-label',p);n.push({uid:'search',node:this._moreBar,structure:new j(),search:true});};l.prototype._close=function(){if(this._isOpen){this._core.collapseView();this._isOpen=false;}return true;};l.prototype._footerHide=function(){if(this._moreBar){g.show(this._moreBar);this._view.animateCount=-1;this._view.animateHeightThrottled();}return true;};l.prototype._footerShow=function(){this._moreBar&&g.hide(this._moreBar);return true;};l.prototype._scrollView=function(m,n){if(this._isOpen)this._view.scrollTo(n);return true;};e.exports=l;});
__d("FacebarTypeaheadSeeMoreSerp",["CSS","cx","DOM","FacebarStructuredText","FacebarURI","fbt","URI"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx'),i=b('DOM'),j=b('FacebarStructuredText'),k=b('FacebarURI'),l=b('fbt'),m=b('URI');function n(o){this._core=o.getCore();this._view=this._core.view;this._moreBar=null;}n.prototype.enable=function(){this._subscriptions=[this._view.subscribe('filter',this._buildSeeMore.bind(this)),this._view.subscribe('showingFooter',this._footerShow.bind(this)),this._view.subscribe('hidingFooter',this._footerHide.bind(this))];};n.prototype.disable=function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();};n.prototype._buildSeeMore=function(o,event){var p=event.results,q=event.value.toString().trim();if(p.length===0||event.isScrollable||q==="")return;var r=l._("See more results for \"{query}\"",[l.param("query",q)]);this._moreBar=i.create('li',{className:"_57zy calltoaction"},[i.create('span',{className:'text'},[i.create('span',{className:'seeMore'},[r])])]);var s=m(this._view.seeMoreSerpEndpoint).addQueryData('q',q).addQueryData('sid',this._core.getSessionID());s=k.getQualifiedURI(s);var t='uri('+'path('+this._view.seeMoreSerpEndpoint+')'+',param_q('+q+')'+',param_source(typeahead_footer)'+')';this._moreBar.setAttribute('aria-label',r);p.push({uid:'see_more_serp',node:this._moreBar,structure:new j(),search:true,uri:s,type:'see_more_serp',text:q,semantic:t});};n.prototype._footerHide=function(){if(this._moreBar){g.show(this._moreBar);this._view.animateCount=-1;this._view.animateHeightThrottled();}return true;};n.prototype._footerShow=function(){this._moreBar&&g.hide(this._moreBar);return true;};e.exports=n;});
__d("FacebarTypeaheadSelectAll",["requestAnimationFrame"],function(a,b,c,d,e,f){var g=b('requestAnimationFrame');function h(i){this._core=i.getCore();this._listener=null;}h.prototype.enable=function(){var i=this._core.input;this._listener=this._core.subscribe('focus',function(){g(function(){i.selectInput();});});};h.prototype.disable=function(){this._listener&&this._core.unsubscribe(this._listener);};e.exports=h;});
__d("FacebarTypeaheadShortcut",["KeyEventController","Run","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('KeyEventController'),h=b('Run'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this._input=l.core.input;this._view=l.view;this._listener=null;}k.prototype.enable=function(){this._registerListener();};k.prototype._registerListener=function(){g.registerKey('SLASH',this._handleKeydown.bind(this));h.onLeave(function(){this._registerListener.bind(this).defer();}.bind(this));};k.prototype._handleKeydown=function(l){this._view.setAutoSelect(true);this._input.focus();this._input.inform('shortcut',{shift:l.getModifiers().shift});return false;};i(k.prototype,{disable:j});e.exports=k;});
__d("FacebarTypeaheadSizeAdjuster",["copyProperties","createArrayFrom","clip","emptyFunction","foldl","Style","Vector"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('createArrayFrom'),i=b('clip'),j=b('emptyFunction'),k=b('foldl'),l=b('Style'),m=b('Vector'),n=12,o=20,p=50,q=200,r=5;function s(u){return m.getElementDimensions(u).x;}function t(u){this._core=u.getCore();this._view=this._core.view;this._input=this._core.input;this._cachedSizes={};this._appliedSize=null;this._defaultSize=this.getDefaultFontSize();this._calculatedSize=this._defaultSize;this._containerWidth=this.getContainerWidth();}t.prototype.enable=function(){this._input.subscribe('change',this.adjustFontSize.bind(this));this.adjustFontSize();};t.prototype.getContainerWidth=function(){return m.getElementDimensions(this._input.getElement()).x;};t.prototype.getDefaultFontSize=function(){var u=l.get(this._input.getElement(),'font-size'),v=/^([\d\.]+)px$/.exec(u),w=v&&Number(v[1]);return Math.max(n,Math.min(o,w));};t.prototype.calculateFontSize=function(){var u=this.getTextWidth(),v=this._calculatedSize;if(u>this._containerWidth-p){v--;}else if(u<this._containerWidth-q)v++;this._calculatedSize=i(v,n,this._defaultSize);return this._calculatedSize;};t.prototype.getTextWidth=function(){var u=this._calculatedSize+this.getValueKey();if(!this._cachedSizes.hasOwnProperty(u))this._cachedSizes[u]=this.measureTextWidth();return this._cachedSizes[u];};t.prototype.getValueKey=function(){var u=this._core.getValue().getHash(),v=r*Math.floor(u.length/r);return u.substr(0,v);};t.prototype.measureTextWidth=function(){var u=this._input.getRawInputElement().childNodes;return k(function(v,w){return v+s(w);},h(u),0);};t.prototype.adjustFontSize=function(){for(var u=0;u<10;u++){var v=this.calculateFontSize();if(v!=this._appliedSize){this._appliedSize=v;l.set(this._input.getElement(),'font-size',v+'px');l.set(this._view.content,'font-size',v+'px');}else break;}};g(t.prototype,{disable:j});e.exports=t;});
__d("FacebarTypeaheadTrigger",["copyProperties","Arbiter"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Arbiter');function i(j){this._typeahead=j;this._core=j.getCore();this._subscription=null;}i.prototype.enable=function(){this._subscription=h.subscribe('FacebarTrigger/select',this._activateTrigger.bind(this));};i.prototype.disable=function(){h.unsubscribe(this._subscription);};i.prototype._activateTrigger=function(j,k){var l=g({type:'grammar',uri:null,structure:null},k);if(!l.uri){this._core.open();this._core.setQuery(l,false);}else this._core.executeQuery(l);};e.exports=i;});
__d("FacebarTypeaheadGrammarItem",["cx","DOM","FacebarTypeaheadItem","FacebarTypeaheadToken","FacebarTypeaheadEntityToken","fbt"],function(a,b,c,d,e,f){var g=b('cx'),h=b('DOM'),i=b('FacebarTypeaheadItem'),j=b('FacebarTypeaheadToken'),k=b('FacebarTypeaheadEntityToken'),l=b('fbt');for(var m in i)if(i.hasOwnProperty(m)&&m!=="_metaprototype")o[m]=i[m];var n=i===null?null:i.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=i;function o(p){i.call(this,p);this.addClass("_207");}o.prototype.renderIcon=function(){if(this._result.photo)return h.create('img',{className:"_20h",alt:'',src:this._result.photo});return h.create('span',{className:"_k83"},h.create('span',{className:this._result.icon_class}));};o.prototype.renderSubtext=function(){var p=this._result.decoration,q=this._result.ambiguity,r=q&&q.text,s=(p&&p.entity)||(q&&q.entity);if(r){return new j([r]).render();}else if(s){this.setVAlign(false);return new k(s).setDefaultText('user',"Person").setLeadingMiddot(true).setLimit(2).render();}};e.exports=o;});
__d("FacebarTypeaheadKeywordItem",["cx","FacebarTypeaheadGrammarItem","FacebarTypeaheadToken"],function(a,b,c,d,e,f){var g=b('cx'),h=b('FacebarTypeaheadGrammarItem'),i=b('FacebarTypeaheadToken'),j="_53ab";for(var k in h)if(h.hasOwnProperty(k)&&k!=="_metaprototype")m[k]=h[k];var l=h===null?null:h.prototype;m.prototype=Object.create(l);m.prototype.constructor=m;m.__superConstructor__=h;function m(n){h.call(this,n);}m.prototype.renderSubtext=function(){var n=new i(['Search'],j);return n.render();};e.exports=m;});
__d("FacebarTypeaheadWebSuggestionItem",["cx","DOM","FacebarTypeaheadItem","FacebarTypeaheadToken"],function(a,b,c,d,e,f){var g=b('cx'),h=b('DOM'),i=b('FacebarTypeaheadItem'),j=b('FacebarTypeaheadToken'),k={EXACT_MATCH:1,BING:2,BING_POPULAR:3,WEBSUGGESTIONS_AS_KEYWORDS:4},l="_57q5";for(var m in i)if(i.hasOwnProperty(m)&&m!=="_metaprototype")o[m]=i[m];var n=i===null?null:i.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=i;function o(p){i.call(this,p);this.addClass("_207");}o.prototype.renderIcon=function(){return h.create('span',{className:"_k83"},h.create('span',{className:"_6-a"}));};o.prototype.renderSubtext=function(){if(this._result.isLockedWebSearchMode)return;var p,q;p=this._result.websuggestion_source;var r=p===k.WEBSUGGESTIONS_AS_KEYWORDS?'Search':p===k.BING_POPULAR?"Popular Web Search":"Web Search";q=new j([r],l);return q.render();};e.exports=o;});
__d("FacebarTypeaheadRenderer",["FacebarTypeaheadEntityItem","FacebarTypeaheadGrammarItem","FacebarTypeaheadKeywordItem","FacebarTypeaheadWebSuggestionItem"],function(a,b,c,d,e,f){var g=b('FacebarTypeaheadEntityItem'),h=b('FacebarTypeaheadGrammarItem'),i=b('FacebarTypeaheadKeywordItem'),j=b('FacebarTypeaheadWebSuggestionItem'),k={};function l(n){if(n.type=='websuggestion'){return new j(n);}else if(n.results_set_type=='browse_type_blended'){return new i(n);}else if(n.type=='grammar'){return new h(n);}else return new g(n);}function m(n){var o=!n.fetchType&&!n.isLockedWebSearchMode,p=n.uid,q=o&&k[p],r=l(n);if(!q){this.inform('renderingItem',{item:r,result:n});q=r.render();o=o&&r.cacheable();}var s=q;if(o){k[p]=q;s=q.cloneNode(true);}r.highlight(s);return s;}e.exports=m;});