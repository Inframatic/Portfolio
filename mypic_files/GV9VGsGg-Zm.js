/*!CK:749726117!*//*1375823730,178195747*/

if (self.CavalryLogger) { CavalryLogger.start_js(["cEQym"]); }

__d("GenderConst",[],function(a,b,c,d,e,f){var g={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};e.exports=g;});
__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Chat'),j=b('ChatSidebar'),k=b('ChatVisibility'),l=b('CSS'),m=b('DOM'),n=b('PresencePrivacy'),o=b('Run'),p=b('Toggler'),q=b('Vector'),r=b('copyProperties'),s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=y.defer();}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=y.defer();}));});x.inform('videocallingtour/start');}});e.exports=x;});
__d("ChatPeopleSuggestionList.react",["ChatSidebarItem.react","fbt","React","ShortProfiles","PresenceStatus","cx"],function(a,b,c,d,e,f){var g=b('ChatSidebarItem.react'),h=b('fbt'),i=b('React'),j=b('ShortProfiles'),k=b('PresenceStatus'),l=b('cx'),m=i.createClass({displayName:'ChatPeopleSuggestionList',_renderPeopleList:function(){var n=[];this.props.uids.map(function(o){var p=j.getNow(o);if(p)n.push(i.DOM.li(null,g({isAdded:false,showEditButton:true,images:p.thumbSrc,name:p.name,status:k.get(o),onClick:this.props.onClick.curry(o)})));}.bind(this));return n;},render:function(){return (i.DOM.div(null,i.DOM.div({className:"_57zm"},i.DOM.span({className:"_57zn"},"SUGGESTIONS")),i.DOM.ul({className:"_56ym"},this._renderPeopleList())));}});e.exports=m;});
__d("Dock",["function-extensions","Event","shield","WebMessengerWidthControl","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Style","Toggler","Vector","copyProperties","csx","emptyFunction","ge"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Event'),h=b('shield');b('WebMessengerWidthControl');var i=b('Arbiter'),j=b('ArbiterMixin'),k=b('ChatQuietLinks'),l=b('CSS'),m=b('DataStore'),n=b('DOM'),o=b('Parent'),p=b('Style'),q=b('Toggler'),r=b('Vector'),s=b('copyProperties'),t=b('csx'),u=b('emptyFunction'),v=b('ge');function w(){}s(w,j,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(x){this.init=u;this.rootEl=x;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();k.removeEmptyHrefs(this.rootEl);g.listen(x,'click',this._onClick.bind(this));g.listen(window,'resize',this._onWindowResize.bind(this));q.subscribe(['show','hide'],function(y,z){var aa=z.getActive();if(!n.contains(x,aa))return;if(l.hasClass(aa,'fbNub')){this.notifyNub(aa,y);if(y==='show')this._resizeNubFlyout(aa);}else{var ba=o.byClass(aa,'fbNubFlyout');if(ba)l.conditionClass(ba,'menuOpened',y==='show');}}.bind(this));this.inform('init',{},i.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=r.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+r.getElementDimensions(this.rootEl).y;var x=v('blueBar');if(x){var y=p.isFixed(x)?'viewport':'document';this.flyoutHeightOffset+=r.getElementPosition(x,y).y+r.getElementDimensions(x).y;}},toggle:function(x){var y=this._findFlyout(x);if(!y)return;this.subscribe('init',function(){q.toggle(x);});},show:function(x){this.subscribe('init',function(){q.show(x);});},showNub:function(x){l.show(x);},hide:function(x){this.subscribe('init',function(){var y=q.getInstance(x);n.contains(x,y.getActive())&&y.hide();});},hideNub:function(x){l.hide(x);this.hide(x);},setUseMaxHeight:function(x,y){l.conditionClass(x,'maxHeight',y!==false);this._resizeNubFlyout(x);},_resizeNubFlyout:function(x){var y=this._findFlyout(x);if(!y||!(l.hasClass(x,'openToggler')||l.hasClass(x,'opened')))return;var z=n.find(y,'div.fbNubFlyoutOuter'),aa=n.find(z,'div.fbNubFlyoutInner'),ba=n.find(aa,'div.fbNubFlyoutBody'),ca=ba.scrollTop,da=ba.offsetHeight;p.set(ba,'height','auto');var ea=r.getElementDimensions(y),fa=r.getElementDimensions(ba),ga=this.getMaxFlyoutHeight(x);p.set(y,'max-height',ga+'px');p.set(z,'max-height',ga+'px');ea=r.getElementDimensions(y);var ha=r.getElementDimensions(aa),ia=ha.y-fa.y,ja=ea.y-ia,ka=parseInt(ba.style.height||ba.clientHeight,10),la=ja!==ka;if(ea.y>ia&&la)p.set(ba,'height',ja+'px');l.removeClass(y,'swapDirection');var ma=r.getElementPosition(y).x;l.conditionClass(y,'swapDirection',function(){if(ma<0)return true;return (ma+ea.x>this.viewportDimensions.x);}.bind(this)());if(la&&ca+da>=fa.y){ba.scrollTop=ba.scrollHeight;}else ba.scrollTop=ca;this.notifyNub(x,'resize');},getMaxFlyoutHeight:function(x){var y=this._findFlyout(x),z=r.getElementPosition(y,'viewport'),aa=r.getElementDimensions(y),ba=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-z.y-aa.y);return Math.max(ba,0);},resizeAllFlyouts:function(){var x=n.scry(this.rootEl,"div._50-v.openToggler");x=x.concat(n.scry(this.rootEl,"div._50-v.opened"));var y=x.length;while(y--)this._resizeNubFlyout(x[y]);},_onClick:function(event){var x=event.getTarget(),y=o.byClass(x,'fbNub');if(y){if(o.byClass(x,'fbNubFlyoutTitlebar')){var z=o.byTag(x,'a'),aa=x.nodeName=='INPUT'&&x.getAttribute('type')=='submit';if(!z&&!aa){this.hide(y);return false;}}this.notifyNub(y,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(x){return l.hasClass(x,'fbNubFlyout')?x:n.scry(x,'div.fbNubFlyout')[0]||null;},registerNubController:function(x,y){m.set(x,'dock:nub:controller',y);y.subscribe('nub/button/content-changed',h(this.inform,this,'resize',x));y.subscribe('nub/flyout/content-changed',h(this._resizeNubFlyout,this,x));},unregisterNubController:function(x){m.remove(x,'dock:nub:controller');},notifyNub:function(x,y,z){var aa=m.get(x,'dock:nub:controller');aa&&aa.inform(y,z);}});e.exports=a.Dock||w;});
__d("NubController",["ArbiterMixin","Dock","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('Dock'),i=b('copyProperties');function j(){}i(j.prototype,g,{init:function(k){this.el=k;h.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){h.hide(this.el);},show:function(){h.show(this.el);}});e.exports=j;});
__d("ChatApp",["CSS","JSLogger"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('JSLogger'),i=false,j=false,k=false,l=null,m={init:function(n,o,p){if(l){h.create('chat_app').error('repeated_init');return;}l=n;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(q,r,s,t,u,v){t.get().handleUpdate(p);this.tabsViewport=new q(o);this.tabController=new r(this.tabsViewport);this.tabViewCoordinator=new s(o,this.tabsViewport);i=j=true;}.bind(this));},hide:function(){if(!i||k)return;g.hide(l);k=true;},unhide:function(){if(i){if(k){g.show(l);this.tabsViewport.checkWidth();d(['Dock'],function(n){n.resizeAllFlyouts();});k=false;}}else if(!j){d(['UIPagelet'],function(n){n.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');n.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});j=true;}}};e.exports=m;});
__d("DataViewPolyfill",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i,j,k){if(j===undefined){this._ba=new Uint8Array(i);}else if(k===undefined){this._ba=new Uint8Array(i,j);}else this._ba=new Uint8Array(i,j,k);this.byteLength=this._ba.byteLength;}g(h,{isSupported:function(){return !!a.Uint8Array;}});g(h.prototype,{getUint8:function(i){if(i>=this._ba.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this._ba[i];},getUint16:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1);return j?(l*256)+k:(k*256)+l;},getUint32:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1),m=this.getUint8(i+2),n=this.getUint8(i+3);return j?(((n*256+m)*256+l)*256)+k:(((k*256+l)*256+m)*256)+n;}});e.exports=h;});
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f){var g=b('DataViewPolyfill'),h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;});
__d("ChatAutoSendPhotoUploader",["ArbiterMixin","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","MercuryAttachmentType","PhotosUploadID","SubscriptionsHandler","copyProperties","csx","getImageSize","removeFromArray","shield"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncUploadRequest'),i=b('DOM'),j=b('Event'),k=b('FileForm'),l=b('FileFormResetOnSubmit'),m=b('FileInput'),n=b('FormSubmitOnChange'),o=b('MercuryAttachmentType'),p=b('PhotosUploadID'),q=b('SubscriptionsHandler'),r=b('copyProperties'),s=b('csx'),t=b('getImageSize'),u=b('removeFromArray'),v=b('shield');function w(){return 'upload_'+p.getNewID();}function x(y,z,aa){this._idElem=aa;this._input=z;this._subscriptionsHandler=new q();this._uploadBatches=[];this._uploadEndpoint=y.getAttribute('action');var ba=new k(y,[n,l]),ca=i.find(y,"._4q60"),da=i.find(ca,"._4q61");new m(ca,da,z);this._subscriptionsHandler.addSubscriptions(ba.subscribe('submit',this._onFileSubmit.bind(this)),ba.subscribe('success',this._onFileUploadSuccess.bind(this)),ba.subscribe('failure',this._onFileUploadFailure.bind(this)),j.listen(da,'click',v(this.inform,this,'open')));}r(x.prototype,g,{isUploading:function(){return this._uploadBatches.length>0;},destroy:function(){this._subscriptionsHandler.release();},_getPreviewAttachment:function(y){var z={attach_type:o.PHOTO,preview_uploading:true};if(y){z.preview_width=y.width;z.preview_height=y.height;}return z;},_onFileSubmit:function(){var y=w();this._idElem.value=y;this._onUpload(y,this._input.files);},_onUpload:function(y,z){this._uploadBatches.push(y);if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&z&&z.length===1){var aa=new FileReader();aa.onload=function(){this.inform('submit',{upload_id:y,preview_attachments:[this._getPreviewAttachment(t(aa.result))]});}.bind(this);aa.onerror=function(){this.inform('submit',{upload_id:y,preview_attachments:[this._getPreviewAttachment(null)]});}.bind(this);aa.readAsArrayBuffer(z[0]);}else{var ba=1;if(z)ba=z.length;var ca=[];for(var da=0;da<ba;++da)ca.push(this._getPreviewAttachment(null));this.inform('submit',{upload_id:y,preview_attachments:ca});}},_onFileUploadSuccess:function(event,y){var z=y.response.getPayload(),aa=z.uploadID;u(this._uploadBatches,aa);var ba=[];z.metadata.forEach(function(ca){ba.push(ca.image_id);});this.inform('all-uploads-completed',{upload_id:z.uploadID,image_ids:ba});},_onFileUploadFailure:function(event,y){var z=this._uploadBatches[this._uploadBatches.length-1];u(this._uploadBatches,z);this.inform('all-uploads-failed',{upload_id:z});},uploadFile:function(y){var z=w(),aa=new h(this._uploadEndpoint).setData({attach_id:z,store_as_message_image:1}).setFiles({'attachment[]':y});this._subscriptionsHandler.addSubscriptions(aa.subscribe('success',function(ba,ca){this._onFileUploadSuccess(ba,{response:ca.getResponse()});}.bind(this)),aa.subscribe('failure',this._onFileUploadFailure.bind(this)));aa.send();this._onUpload(z,[y]);}});e.exports=x;});
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","ChatConfig","ChatVisibility","LegacyContextualDialog","CSS","MercuryParticipants","MercuryThreads","ChatTabTemplates","VideoCallCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('ChatConfig'),j=b('ChatVisibility'),k=b('LegacyContextualDialog'),l=b('CSS'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('VideoCallCore'),q=b('copyProperties'),r=b('emptyFunction');function s(){this._dialog=null;}function t(v){if(!(p.isSupported()&&i.get('video.show_promo')))return false;var w=n.getCanonicalUserInThread(v);if(!w)return false;return j.isOnline()&&p.availableForCall(w);}function u(v){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:v}).setAllowCrossPageTransition(true).setErrorHandler(r).send();}q(s.prototype,g);q(s.prototype,{render:function(v,w){var x=t(w);if(!x)return;var y=n.getCanonicalUserInThread(w);m.get('fbid:'+y,function(z){if(!z.call_promo)return;var aa=o[':fb:mercury:call:promo'].build();this._dialog=new k();this._dialog.init(aa.getRoot()).setWidth(250).setAlignH('center').setContext(v).show();l.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');l.addClass(v,'video_call_promo');u(n.getCanonicalUserInThread(w));this.inform('chat/dialog-rendered',{dialog:this,thread_id:w});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=s;});
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","MercuryThreads","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('LegacyContextualDialog'),i=b('CSS'),j=b('MercuryThreads').get(),k=b('ChatTabTemplates'),l=b('VideoCallCore'),m=b('VideoCallingTour'),n=b('copyProperties');function o(){this._dialog=null;}n(o.prototype,g);n(o.prototype,{render:function(p,q){var r=j.getCanonicalUserInThread(q);if(!r||!l.availableForCall(r))return;var s=k[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});m.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;});
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('ChatTabModel'),j=b('VideoCallingTour'),k=b('VideoCallPromo'),l=b('VideoCallTourDialog'),m=b('copyProperties'),n=b('setTimeoutAcrossTransitions'),o=60000,p=false,q=false,r=function(y,z){this._videoCallPromo=new k();this._videoCallTour=new l();this._threadID=y;this._tabMainElement=z;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function s(y,event,z){if(y._openDialog)y._openDialog.updatePosition();}function t(y){if(y._openDialog)y._openDialog.updatePosition();}function u(y){if(y._openDialog){y._openDialog.hide();y._openDialog=null;}if(y._timeout){clearTimeout(y._timeout);y._timeout=null;}while(y._subscriptionTokens.length)y._subscriptionTokens.pop().unsubscribe();if(y._scrollListener){y._scrollListener.remove();y._scrollListener=null;}}function v(y,event,z){if(z.thread_id===y._threadID){y._openDialog=z.dialog;p=true;x(y);y._timeout=n(y.destroy.bind(y,y._threadID),o);y._scrollListener=g.listen(window,'scroll',t.curry(y));}}function w(y,z){if(!y._openDialog){y._subscriptionTokens.push(z.subscribe('chat/dialog-rendered',v.curry(y)));z.render(y._tabMainElement,y._threadID);}}function x(y){y._subscriptionTokens.push(i.subscribe('chat/tabs-changed',s.curry(y)),r.subscribe('dialog/close-all',u.curry(y)));}m(r,h);m(r.prototype,{destroy:function(){u(this);},tabFocused:function(){if(q){w(this,this._videoCallTour);return;}if(!p)w(this,this._videoCallPromo);},tabNotActive:function(){u(this);},hideVideoCallouts:function(){u(this);}});j.subscribe('videocallingtour/start',function(){q=true;r.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){q=false;});e.exports=r;});
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f){var g=b('ChatVisibility'),h=b('JSLogger'),i=b('PresencePrivacy'),j=b('copyProperties'),k=function(l,m){this._userID=l;this._logger=h.create('blackbird');this._getState=function(){if(g.isOnline())return i.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var n=this._getState();switch(this._getState()){case k.OFFLINE:if(g.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});g.goOnline(function(){if(!i.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case k.BLOCKED:i.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:i.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};(function(){var n=function(){m&&m(this._getState());}.bind(this);n();this._subscribeToken=i.subscribe('privacy-changed',n);}.bind(this)).defer();};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';j(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){i.unsubscribe(this._subscribeToken);}});e.exports=k;});
__d("ChatShareLinkUploader",["AsyncRequest","CSS","DOM","URLScraper","MercuryShareLinkUploader","MercuryAttachmentTemplates","Event"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('CSS'),i=b('DOM'),j=b('URLScraper'),k=b('MercuryShareLinkUploader'),l=b('MercuryAttachmentTemplates'),m=b('Event');for(var n in k)if(k.hasOwnProperty(n)&&n!=="_metaprototype")p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r){this.$ChatShareLinkUploader0=q;this.$ChatShareLinkUploader1=r;this.$ChatShareLinkUploader2=false;this.$ChatShareLinkUploader3=null;this.$ChatShareLinkUploader4=null;m.listen(r,'keyup',function(){!r.value.length&&this.$ChatShareLinkUploader5.enable();}.bind(this));this.$ChatShareLinkUploader5=new j(r);this.$ChatShareLinkUploader5.subscribe('match',this.$ChatShareLinkUploader6.bind(this));this.$ChatShareLinkUploader7=null;}p.prototype.getAttachData=function(){return this.loadAttachData(this.$ChatShareLinkUploader2,this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader1);};p.prototype.close=function(){this.$ChatShareLinkUploader8();this.$ChatShareLinkUploader5.disable();this.inform('closed');};p.prototype.clear=function(){this.$ChatShareLinkUploader8();this.$ChatShareLinkUploader5.enable();};p.prototype.$ChatShareLinkUploader8=function(){var q=this.$ChatShareLinkUploader7;delete this.$ChatShareLinkUploader7;if(q){i.remove(q);this.inform('dom-updated');}this.$ChatShareLinkUploader2=false;this.$ChatShareLinkUploader3=null;this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5&&this.$ChatShareLinkUploader5.reset();};p.prototype.$ChatShareLinkUploader6=function(event,q){var r=this;this.$ChatShareLinkUploader3=q.url;this.$ChatShareLinkUploader4&&this.$ChatShareLinkUploader4.abort();var s=l[':fb:mercury:share-link-row'].build();if(this.$ChatShareLinkUploader7)i.remove(this.$ChatShareLinkUploader7);this.$ChatShareLinkUploader7=s.getRoot();m.listen(s.getNode('closeFileUpload'),'click',function(event){r.close();event.kill();});i.appendContent(this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader7);h.show(this.$ChatShareLinkUploader0);this.inform('dom-updated');this.$ChatShareLinkUploader4=new g().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:q.url,chat:true}).setHandler(function(t){if(r.$ChatShareLinkUploader3!==q.url)return;r.$ChatShareLinkUploader3=null;r.$ChatShareLinkUploader4=null;i.appendContent(r.$ChatShareLinkUploader7,t.payload);h.addClass(r.$ChatShareLinkUploader7,'done');r.$ChatShareLinkUploader2=true;});this.$ChatShareLinkUploader4.send();this.inform('link-detected');};e.exports=p;});
__d("ChatPhotoEditorContextualDialog",["ContextualDialog","CSS","Event","LayerHideOnBlur","PhotoEditorConfig","URI"],function(a,b,c,d,e,f){var g=b('ContextualDialog'),h=b('CSS'),i=b('Event'),j=b('LayerHideOnBlur'),k=b('PhotoEditorConfig'),l=b('URI');function m(n,o,p,q,r){var s=l(k.Constants.CHAT_DIALOG_PATH).addQueryData({thread_id:r}).toString(),t=l(k.Constants.BROWSE_ALBUMS_PATH).addQueryData({browse_mode:k.BrowseModes.CHOOSE_CHAT_TARGET,browse_args:{thread_id:r}}).toString();o.setAttribute('ajaxify',t);p.setAttribute('ajaxify',s);this.$ChatPhotoEditorContextualDialog0=n;this.$ChatPhotoEditorContextualDialog1=q;i.listen(n,'click',this.$ChatPhotoEditorContextualDialog2.bind(this));i.listen(q,'click',this.$ChatPhotoEditorContextualDialog3.bind(this));}m.prototype.$ChatPhotoEditorContextualDialog2=function(){var n=this.$ChatPhotoEditorContextualDialog4();if(n.isShown()){n.hide();}else n.show();};m.prototype.$ChatPhotoEditorContextualDialog3=function(){this.$ChatPhotoEditorContextualDialog4().hide();};m.prototype.$ChatPhotoEditorContextualDialog4=function(){if(!this.$ChatPhotoEditorContextualDialog5){var n={context:this.$ChatPhotoEditorContextualDialog0,width:115,alignment:'center',addedBehaviors:[j]};this.$ChatPhotoEditorContextualDialog5=new g(n,this.$ChatPhotoEditorContextualDialog1);h.show(this.$ChatPhotoEditorContextualDialog1);}return this.$ChatPhotoEditorContextualDialog5;};e.exports=m;});
__d("MercuryTypingIndicator",["Animation","CSS","DOM","MercuryTypingReceiver","MercuryParticipants","Style","ChatTabTemplates","MercuryThreadInformer","Tooltip","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('CSS'),i=b('DOM'),j=b('MercuryTypingReceiver'),k=b('MercuryParticipants'),l=b('Style'),m=b('ChatTabTemplates'),n=b('MercuryThreadInformer').get(),o=b('Tooltip'),p=b('copyProperties'),q=b('cx'),r=b('tx'),s=[];n.subscribe('messages-received',function(v,w){s.forEach(function(x){var y=w[x._threadID];y&&x.receivedMessages(y);});});j.subscribe('state-changed',function(v,w){s.forEach(function(x){var y=w[x._threadID];y&&x._handleStateChanged(y);});});function t(v){var w=m[':fb:chat:conversation:message-group'].build(),x=m[':fb:mercury:typing-indicator:typing'].build();h.addClass(w.getRoot(),"_50kd");var y=w.getNode('profileLink');o.set(y,v.name,'left');y.href=v.href;w.setNodeContent('profileName',v.name);w.setNodeProperty('profilePhoto','src',v.image_src);var z=r._("{name} is typing...",{name:v.short_name});o.set(x.getRoot(),z,'above');i.appendContent(w.getNode('messages'),x.getRoot());return w;}function u(v,w,x){this._animations={};this._activeUsers={};this._typingIndicator=w;this._messagesView=x;this._threadID=v;this._subscription=j.subscribe('state-changed',function(y,z){var aa=z[this._threadID];aa&&this._handleStateChanged(aa);}.bind(this));s.push(this);}p(u.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();s.remove(this);},receivedMessages:function(v){v.forEach(function(w){if(!k.isAuthor(w.author))this._removeUserBubble(w.author);}.bind(this));},_handleStateChanged:function(v){for(var w in this._activeUsers)if(v.indexOf(w)===-1){this._slideOutUserBubble(w);delete this._activeUsers[w];}if(v.length)k.getMulti(v,function(x){var y=this._messagesView.isScrolledToBottom(),z={};for(var aa in x){var ba=this._activeUsers[aa];z[aa]=ba||t(x[aa]).getRoot();if(!ba)i.appendContent(this._typingIndicator,z[aa]);}var ca=Object.keys(z).length>0;y&&this._messagesView.scrollToBottom(ca);this._activeUsers=z;}.bind(this));},_removeUserBubble:function(v,w){var x=this._getCurrentAnimation(v,w);if(x){x.animation.stop();i.remove(x.elem);delete this._animations[v];}if(v in this._activeUsers){i.remove(this._activeUsers[v]);delete this._activeUsers[v];}w&&i.remove(w);},_slideOutUserBubble:function(v){var w=this._activeUsers[v];if(this._getCurrentAnimation(v,w)){return;}else if(w){l.set(w,'overflow','hidden');var x=(new g(w)).from('opacity',1).from('height',w.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,v,w)).go();this._animations[v]={animation:x,elem:w};}},_getCurrentAnimation:function(v,w){if(this._animations[v]&&(!w||this._animations[v].elem===w))return this._animations[v];}});e.exports=u;});
__d("ChatTabMessagesView",["JSXDOM","Animation","Arbiter","ArbiterMixin","MercuryAttachment","MercuryAttachmentRenderer","ChannelConstants","ChatConfig","ChatVisibility","createArrayFrom","CSS","DOM","Env","Event","JoinableConversationMessageFilter","LiveTimer","MercuryActionTypeConstants","MercuryAPIArgsSource","MercuryLastMessageIndicator","MercuryLogMessageType","MercurySourceType","shield","MercuryMessages","MercuryServerRequests","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreads","MercuryThreadlistConstants","MercuryTypingIndicator","MercuryMessageRenderer","Parent","MercuryParticipants","React","ServerTime","MercuryStatusTemplates","Style","SubscriptionsHandler","ChatTabTemplates","MercuryThreadInformer","Timestamp.react","Tooltip","UserAgent","VideoCallCore","copyProperties","csx","cx","extendArray","formatDate","isRTL","removeFromArray","throttle","tx"],function(a,b,c,d,e,f){var g=b('JSXDOM'),h=b('Animation'),i=b('Arbiter'),j=b('ArbiterMixin'),k=b('MercuryAttachment'),l=b('MercuryAttachmentRenderer'),m=b('ChannelConstants'),n=b('ChatConfig'),o=b('ChatVisibility'),p=b('createArrayFrom'),q=b('CSS'),r=b('DOM'),s=b('Env'),t=b('Event'),u=b('JoinableConversationMessageFilter'),v=b('LiveTimer'),w=b('MercuryActionTypeConstants'),x=b('MercuryAPIArgsSource'),y=b('MercuryLastMessageIndicator'),z=b('MercuryLogMessageType'),aa=b('MercurySourceType'),ba=b('shield'),ca=b('MercuryMessages').get(),da=b('MercuryServerRequests').get(),ea=b('MercuryThreadMetadataRawRenderer'),fa=b('MercuryThreadMetadataRenderer').get(),ga=b('MercuryThreads').get(),ha=b('MercuryThreadlistConstants'),ia=b('MercuryTypingIndicator'),ja=b('MercuryMessageRenderer'),ka=b('Parent'),la=b('MercuryParticipants'),ma=b('React'),na=b('ServerTime'),oa=b('MercuryStatusTemplates'),pa=b('Style'),qa=b('SubscriptionsHandler'),ra=b('ChatTabTemplates'),sa=b('MercuryThreadInformer').get(),ta=b('Timestamp.react'),ua=b('Tooltip'),va=b('UserAgent'),wa=b('VideoCallCore'),xa=b('copyProperties'),ya=b('csx'),za=b('cx'),ab=b('extendArray'),bb=b('formatDate'),cb=b('isRTL'),db=b('removeFromArray'),eb=b('throttle'),fb=b('tx'),gb,hb=34,ib=1000*60*60,jb=70,kb=null,lb=20;function mb(wb){return bb(new Date(wb),'g:ia');}function nb(wb){var xb=ra[':fb:chat:conversation:message-group'].build(),yb=xb.getNode('profileLink'),zb=n.get('chat_tab_bubbles'),ac=la.isAuthor(wb.author),bc=da.tokenizeThreadID(wb.thread_id),cc=bc.type!=='user',dc=!ac||!zb;if(!zb)xb.setNodeContent('timestamp',mb(wb.timestamp));q.conditionClass(xb.getRoot(),"_50kd",!ac&&zb);q.conditionClass(xb.getRoot(),"_50x4",cc&&!ac&&zb);q.conditionShow(yb,dc);la.get(wb.author,function(ec){if(dc){yb.href=ec.href;var fc=ac?"You":ec.name;if(!ac&&zb)fc=g.div({className:"_522l"},g.div({className:"_522m"},mb(wb.timestamp)),ec.name);ua.set(yb,fc,'left');if(!ac&&zb&&cc)xb.setNodeContent('profileName',ec.name);xb.setNodeProperty('profilePhoto','src',ec.image_src);}});return xb;}function ob(wb){var xb=ra[':fb:chat:conversation:message:event'].build(),yb=n.get('chat_tab_bubbles'),zb=mb(wb.timestamp);if(yb){xb.getRoot().setAttribute('title',zb);}else xb.setNodeContent('timestamp',zb);ja.renderLogMessage(xb.getNode('icon'),xb.getNode('message'),xb.getNode('attachment'),wb);var ac=qb(wb);if(ac)r.appendContent(xb.getNode('message'),ac);return xb.getRoot();}function pb(wb,xb){if(!n.get('chat_tab_bubbles'))return;if(kb===null){var yb=xb.childNodes[0];pa.set(xb,'overflow','scroll');kb=yb.clientWidth-jb;pa.set(xb,'overflow','');}if(!q.hasClass(wb,"_kso")){var zb=r.scry(wb,"._kso");if(zb.length===1){wb=zb[0];}else return;}pa.set(wb,'max-width',kb+'px');var ac,bc,cc=wb.firstChild;if(wb.childNodes.length===1&&cc.getAttribute('data-measureme')){ac=cc.getClientRects();var dc=cc.offsetHeight;if(ac&&ac.length>1&&ac[0].height<dc){bc=true;if(!gb){r.remove(cc);gb=wb.offsetWidth;r.appendContent(wb,cc);}var ec=cc.offsetWidth,fc=wb.offsetWidth-ec-gb;if(fc>0)pa.set(wb,'max-width',ec+'px');}}var gc=ka.byClass(wb,"_50x4");if(gc)q.conditionClass(gc,"_51lo",ac?!bc:wb.offsetHeight<hb);}function qb(wb){var xb,yb;if(wb.log_message_type==z.VIDEO_CALL)if(wb.log_message_data.event_name=='install_canceled'){xb=r.tx._("Retry setup and call back.");yb='callback_cancelinstall_link';return rb(xb,wb.thread_id,wb.log_message_data.to,yb);}else if(!wb.log_message_data.event_name&&wb.log_message_data.callee==la.user&&!wb.log_message_data.answered){xb=r.tx._("Call Back");yb='callback_link';return rb(xb,wb.thread_id,wb.log_message_data.caller.split(':')[1],yb);}return null;}function rb(wb,xb,yb,zb){if(wa.isSupported()){var ac=!o.isOnline()||!wa.availableForCall(yb),bc=r.create('a',{href:'#',className:'callBackLink'},wb);if(ac)q.hide(bc);bc.setAttribute('data-gt',JSON.stringify({videochat:'clicked_callback_link'}));t.listen(bc,'click',function(){ub.inform('video-call-clicked',{userID:yb,threadID:xb,clickSource:zb});});return bc;}return null;}function sb(wb){var xb=ra[':fb:mercury:chat:message:forward'].build(),yb=xb.getNode('forwardText');if(yb){q.hide(xb.getRoot());fa.renderTitanLink(wb.thread_id,xb.getNode('forwardLink'),q.show.bind(q,xb.getRoot()));if(wb.forward_count>1){r.appendContent(yb,fb._("{count} forwarded messages",{count:wb.forward_count}));}else r.appendContent(yb,"1 forwarded message");}return xb.getRoot();}var tb=[];function ub(wb,xb,yb,zb,ac,bc,cc){this.loadingIcon=ac;this.threadID=wb;this.sheetController=xb;this.scrollContainer=yb;this.conversationElem=zb;this.messageElements={};this.messageGroup=null;this.prevMessage=null;v.restart(na.get()/1000);this._fetchMultiplier=1;this._oldestMessageDisplayedTimestamp=null;this._loadingMoreMessages=false;this._currentMessageCount=0;this._hasReachedClearedMessages=false;var dc=ha.MESSAGE_TIMESTAMP_THRESHOLD;this._oldestMessageDisplayedTimestamp=Date.now()-dc;tb.push(this);function ec(){ub.inform('interaction-with-tab',wb);}this._subscriptions=new qa();this._subscriptions.addSubscriptions(i.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),t.listen(this.scrollContainer,'mousedown',ec));if(va.firefox()){var fc=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(fc,ec,false);}else this._subscriptions.addSubscriptions(t.listen(this.scrollContainer,'mousewheel',ec));this._subscriptions.addSubscriptions(t.listen(this.scrollContainer,'scroll',eb(this.scrolling,50,this)));var gc=n.get('chat_tab_bubbles');this.lastMessageIndicator=new y(this.threadID,bc,gc,this);if(gc)this.typingIndicator=new ia(this.threadID,cc,this);ca.getThreadMessagesRange(this.threadID,0,ha.RECENT_MESSAGES_LIMIT,this._updateTimestamp.bind(this));this.rerender();}xa(ub,j);xa(ub.prototype,{scrolling:function(){if(!this._loadingMoreMessages&&this.isScrolledNearTop()&&!this.isScrolledToBottom()&&!this._hasReachedClearedMessages)this.loadMoreMessages();if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},destroy:function(){r.empty(this.conversationElem);this._subscriptions.release();db(tb,this);this.lastMessageIndicator&&this.lastMessageIndicator.destroy();this.destroyed=true;},_appendMessage:function(wb){if(wb==this.prevMessage)return;var xb=ha,yb=xb.GROUPING_THRESHOLD,zb=wb.action_type==w.LOG_MESSAGE&&wb.log_message_type==z.SERVER_ERROR;if(wb.is_cleared){this._hasReachedClearedMessages=true;return;}var ac;if(this.prevMessage!==null){ac=wb.timestamp-this.prevMessage.timestamp;}else ac=Infinity;if(!zb&&(ac>=ib)){var bc=Math.round(wb.timestamp/1000),cc=wb.timestamp_datetime,dc=ra[':fb:chat:conversation:date-break'].build();ma.renderComponent(ta({time:bc,verbose:cc,text:cc}),dc.getNode('date'));r.appendContent(this.conversationElem,dc.getRoot());this.messageGroup=null;}if(wb.action_type==w.LOG_MESSAGE){r.appendContent(this.conversationElem,ob(wb));this.messageGroup=null;this.prevMessage=wb;return;}var ec=n.get('chat_tab_bubbles');if(!this.messageGroup||ec&&wb.author!==la.user||this.prevMessage.author!=wb.author||this.prevMessage.timestamp<wb.timestamp-yb){this.messageGroup=nb(wb);r.appendContent(this.conversationElem,this.messageGroup.getRoot());}var fc=this._makeSingleMessage(wb);this.messageElements[wb.message_id]=fc;r.appendContent(this.messageGroup.getNode('messages'),fc);pb(fc,this.scrollContainer);this.prevMessage=wb;},rerender:function(){if(!this._oldestMessageDisplayedTimestamp)return;var wb=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollHeight,xb=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollTop,yb=this.isScrolledToBottom();r.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var zb=ca.getThreadMessagesSinceTimestamp(this.threadID,this._oldestMessageDisplayedTimestamp);this._renderOlderMessages(zb,wb,xb,yb);this._finishedFetchingMoreMessages=false;},update:function(wb){for(var xb in wb){var yb=this.messageElements[xb];if(yb){var zb=this.isScrolledToBottom(),ac=this._makeSingleMessage(ca.getMessagesFromIDs([xb])[0]);this.messageElements[xb]=ac;r.replace(yb,ac);pb(ac,this.scrollContainer);if(zb)this.scrollToBottom();}}},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_appendMessages:function(wb){wb.forEach(this._appendMessage.bind(this));this.lastMessageIndicator&&this.lastMessageIndicator.setLastMessage(this.prevMessage);},_appendNewMessages:function(wb){wb=u.filterMessages(function(zb){this.sheetController.openUserJoinStatusSheet(zb);}.bind(this),wb,true);var xb=this.isScrolledToBottom(),yb=this._messagesOnlySentFromSelf(wb);this._appendMessages(wb);if(xb){this.scrollToBottom();}else if(!yb){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}},_messagesOnlySentFromSelf:function(wb){for(var xb=0;xb<wb.length;xb++)if(wb[xb].author!==la.user)return false;return true;},_renderOlderMessages:function(wb,xb,yb,zb){if(!wb)return;wb=u.filterMessages(function(ac){this.sheetController.openUserJoinStatusSheet(ac);}.bind(this),wb,false);this._appendMessages(wb);if(zb){this.scrollToBottom();}else if(this._finishedFetchingMoreMessages)this.scrollToPosition(this.scrollContainer.scrollHeight-xb-this.loadingHeight+yb);},_updateTimestamp:function(wb){if(wb&&wb.length){this._oldestMessageDisplayedTimestamp=wb[0].timestamp;this._currentMessageCount=wb.length;}this._loadingMoreMessages=false;this._finishedFetchingMoreMessages=true;q.hide(this.loadingIcon);},isScrolledToBottom:function(){var wb=this.scrollContainer;return wb.scrollTop+wb.clientHeight>=wb.scrollHeight-lb;},isScrolledNearTop:function(){return this.scrollContainer.scrollTop<this.scrollContainer.clientHeight;},scrollToBottom:function(wb){this.scrollToPosition(this.scrollContainer.scrollHeight,wb);},scrollToPosition:function(wb,xb){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(xb===true){this._scrollTopAnimation=(new h(this.scrollContainer)).to('scrollTop',wb).ease(h.ease.end).duration(400).go();}else this.scrollContainer.scrollTop=wb;},loadMoreMessages:function(){if(ca.hasLoadedExactlyNMessages(this.threadID,this._currentMessageCount)&&ca.hasLoadedAllMessages(this.threadID))return;if(ga.isNewEmptyLocalThread(this.threadID))return;q.show(this.loadingIcon);this.loadingHeight=this._getLoadingHeight();this._loadingMoreMessages=true;if(this._fetchMultiplier<10)this._fetchMultiplier+=1;var wb=ha.RECENT_MESSAGES_LIMIT*this._fetchMultiplier,xb=this._currentMessageCount+wb,yb=ca.hasLoadedNMessages(this.threadID,xb);ca.getThreadMessagesRange(this.threadID,0,xb,this._updateTimestamp.bind(this),null,x.CHAT);if(yb)this.rerender();},_makeSingleMessage:function(wb){var xb=this._renderSingleMessage(wb);q.addClass(xb,"_55r0");return xb;},_renderSingleMessage:function(wb){var xb=ra[':fb:chat:conversation:message'].render(),yb=n.get('chat_tab_bubbles');if(yb&&la.isAuthor(wb.author))xb.setAttribute('title',mb(wb.timestamp));if(wb.subject){var zb=ra[':fb:chat:conversation:message:subject'].render();r.setContent(zb,wb.subject);r.appendContent(xb,zb);}function ac(ic){if(yb)ic=r.create('span',{'data-measureme':1},ic);return ic;}if(wb.is_filtered_content){var bc=oa[':fb:mercury:filtered-message'].build();r.appendContent(xb,ac(bc.getRoot()));return xb;}if(wb.body.substr(0,4)=='?OTR'){r.setContent(xb,ac("[encrypted message]"));q.addClass(xb,"_542c");}else{q.addClass(xb,cb(wb.body)?'direction_rtl':'direction_ltr');var cc=ja.formatMessageBody(wb.body);r.appendContent(xb,ac(cc));}if(wb.has_attachment){var dc=g.div(null),ec=this._appendMessageAttachments(dc,wb);if(yb&&!wb.body&&!ec)return dc;r.appendContent(xb,p(dc.childNodes));}if(wb.forward_count)r.appendContent(xb,sb(wb));if(wb.is_spoof_warning){var fc=ra[':fb:chat:conversation:message:undertext'].build();r.appendContent(fc.getNode('message'),xb);la.get(wb.author,function(ic){fa.renderChatSpoofWarning(fc.getNode('status'),wb.is_spoof_warning,ic);});return fc.getRoot();}var gc=ea.renderStatusIndicator(wb.status,wb.error_data,ba(ca.resendMessage,ca,wb));if(gc){var hc=ra[':fb:chat:conversation:message:status'].build();r.appendContent(hc.getNode('message'),xb);r.appendContent(hc.getNode('status'),gc);return hc.getRoot();}return xb;},_appendMessageAttachments:function(wb,xb){var yb=0,zb=xb.attachments;zb.sort(l.booleanLexicographicComparator([l.isPhotoAttachment,l.isShareAttachment,l.isFileAttachment,l.isErrorAttachment]));if(xb.raw_attachments&&xb.raw_attachments.length>0)zb=k.convertRaw(xb.raw_attachments);if(xb.attachments.length===0&&xb.preview_attachments&&xb.preview_attachments.length>0)ab(zb,xb.preview_attachments);var ac=l.renderPhotoAttachments(zb.filter(l.isPhotoAttachment),xb,176,4);if(ac)r.appendContent(wb,ac);for(var bc=0;bc<zb.length;bc++){if(l.isPhotoAttachment(zb[bc])){yb=1;continue;}var cc=l.renderAttachment(true,zb[bc],xb);cc.error&&r.appendContent(wb,cc.error);cc.content&&r.appendContent(wb,cc.content);yb|=cc.bubblePreferred;}var dc=r.scry(wb,'img');dc.forEach(function(ec){this._subscriptions.addSubscriptions(t.listen(ec,'load',ba(this._thumbLoaded,this,ec)));}.bind(this));return !!yb;},_thumbLoaded:function(wb){var xb=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(xb+wb.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();}});sa.subscribe('messages-reordered',function(wb,xb){tb.forEach(function(yb){xb[yb.threadID]&&yb.rerender();});});sa.subscribe('messages-updated',function(wb,xb){tb.forEach(function(yb){xb[yb.threadID]&&yb.update(xb[yb.threadID]);});});sa.subscribe('messages-received',function(wb,xb){tb.forEach(function(yb){var zb=xb[yb.threadID];if(zb&&zb.length)yb._currentMessageCount+=zb.length;zb&&yb._appendNewMessages(zb);});});i.subscribe(m.getArbiterType('chat_event'),function(wb,xb){if(vb(xb.obj)){var yb=(s.user==xb.obj.from)?xb.obj.to:xb.obj.from,zb=ga.getThreadIdForUser(yb),ac=tb.filter(function(dc){return dc.threadID===zb;});if(ac.length>0){var bc=ac[0],cc=ca.constructLogMessageObject(aa.CHAT_WEB,zb,z.VIDEO_CALL,xb.obj);cc.author='fbid:'+xb.obj.from;bc._appendNewMessages([cc]);}}});function vb(wb){return (wb.event_name==='installing'||wb.event_name==='install_canceled');}e.exports=ub;});
__d("MercuryPeopleSuggestions",["KeyedCallbackManager","MercuryServerDispatcher","OrderedFriendsList","ShortProfiles","arrayContains"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=b('MercuryServerDispatcher'),i=b('OrderedFriendsList'),j=b('ShortProfiles'),k=b('arrayContains'),l=new g(),m=6;function n(s){return s.sort().join(',');}function o(s,t){if(s.length<m){var u=i.getList();for(var v=0;v<u.length;v++)if(!(k(s,u[v])||k(t,u[v]))){s.push(u[v]);if(s.length>=m)break;}}return s;}function p(s){h.trySend('/ajax/chat/people_suggest.php',s);}function q(s,t,u){s=s.filter(function(w){return !k(t,w);});var v=o(s,t);j.getMulti(v,function(){u(v);});}var r={getPeopleSuggestions:function(s,t){if(s)if(s.length){var u=n(s),v=l.executeOrEnqueue(u,function(x){q(x,s,t);}),w=l.getUnavailableResources(v);if(w.length)p({query:u,size:m});return v;}else q([],[],t);return 0;},handleUpdate:function(s){if(s.query){var t=s.suggestions||"",u=t.length?t.split(','):[];l.setResource(s.query,u);}}};h.registerEndpoints({'/ajax/chat/people_suggest.php':{mode:h.IMMEDIATE,handler:r.handleUpdate}});e.exports=r;});
__d("ChatTabPeopleSuggestionView",["ChatPeopleSuggestionList.react","ChatQuietLinks","CSS","DOM","Event","MercuryPeopleSuggestions","MercuryIDs","React","ShortProfiles","Style","copyProperties"],function(a,b,c,d,e,f){var g=b('ChatPeopleSuggestionList.react'),h=b('ChatQuietLinks'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('MercuryPeopleSuggestions'),m=b('MercuryIDs'),n=b('React'),o=b('ShortProfiles'),p=b('Style'),q=b('copyProperties');function r(s,t,u){this.sheetController=s;this.viewNode=t;this.loadingIcon=u;this.addFriendsSheet=s.getAddFriendsTabSheet();this.mercuryTypeahead=this.addFriendsSheet&&this.addFriendsSheet._typeahead;this.typeaheadInput=this.mercuryTypeahead&&this.mercuryTypeahead._input;this.typeaheadView=this.mercuryTypeahead&&this.mercuryTypeahead.getTypeahead().getView();var v=this.showSuggestions.bind(this);if(this.typeaheadInput)k.listen(this.typeaheadInput,'focus',v);if(this.typeaheadView){this.typeaheadView.subscribe('reset',v);this.typeaheadView.subscribe('render',this.clearSuggestions.bind(this));}this.tokenizer=this.mercuryTypeahead&&this.mercuryTypeahead.getTokenizer();if(this.tokenizer)this.tokenizer.subscribe('removeToken',v);this.showSuggestions();}q(r.prototype,{addSelectedParticipant:function(s){var t=o.getNow(s);if(t&&this.tokenizer){this.tokenizer.addToken(this.tokenizer.createToken({uid:s,text:t.name}));this.showSuggestions();}},showSuggestions:function(){if(this.mercuryTypeahead){var s=this.mercuryTypeahead.getSelectedParticipantIDs();s=s.map(m.getUserIDFromParticipantID);j.empty(this.viewNode);i.show(this.loadingIcon);l.getPeopleSuggestions(s,function(t){var u=g({uids:t,onClick:this.addSelectedParticipant.bind(this)});i.hide(this.loadingIcon);n.renderComponent(u,this.viewNode);h.removeAllHrefs(this.viewNode);}.bind(this));}},clearSuggestions:function(){j.empty(this.viewNode);i.hide(this.loadingIcon);p.set(this.viewNode,'margin-top',0);},destroy:function(){this.clearSuggestions();}});e.exports=r;});
__d("ChatAddFriendsTabSheetRawRenderer",["ContextualTypeaheadView","DOM","Event","MercuryTypeahead","ChatTabTemplates","tx","MercuryDataSourceWrapper"],function(a,b,c,d,e,f){var g=b('ContextualTypeaheadView'),h=b('DOM'),i=b('Event'),j=b('MercuryTypeahead'),k=b('ChatTabTemplates'),l=b('tx'),m=b('MercuryDataSourceWrapper').source,n={render:function(o,p,q,r,s,t){var u=t?k[':fb:mercury:chat:tab-sheet:add-friends-empty-tab'].build():k[':fb:mercury:chat:tab-sheet:add-friends'].build(),v=new j(m,g);v.setExcludedParticipants(r.participants);if(!t)v.setPlaceholder("Add friends to this chat");v.build();h.replace(u.getNode('participantsTypeahead'),v.getElement());h.setContent(q,u.getRoot());v.getTokenizer().adjustWidth();v.focus();if(!t){var w=function(){var x=v.getSelectedParticipantIDs();if(x.length)s(x);p.close(o);};i.listen(u.getNode('doneButton'),'click',w);v.subscribe('tokens-return',function(){if(v.getTokens().length)w();});}return v;}};e.exports=n;});
__d("MultiChatController",["Arbiter","AsyncSignal","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncSignal'),i=b('copyProperties'),j=b('Form'),k=b('MercuryMessages').get(),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get();function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new h('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID(Date.now());m.createNewLocalThread(p,o);g.inform('chat/open-tab',{thread_id:p});return p;},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;});
__d("ChatAddFriendsTabSheet",["Arbiter","ChatAddFriendsTabSheetRawRenderer","MercuryLogMessageType","MercurySourceType","MercuryMessages","MultiChatController","Style","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatAddFriendsTabSheetRawRenderer'),i=b('MercuryLogMessageType'),j=b('MercurySourceType'),k=b('MercuryMessages').get(),l=b('MultiChatController'),m=b('Style'),n=b('MercuryThreads').get(),o=b('copyProperties');function p(s,t,u){this._threadID=s;this._rootElement=t;this._sheetView=u;this._typeahead=null;}o(p.prototype,{render:function(){n.getThreadMeta(this._threadID,function(s){var t=s.is_canonical_user?q:r;this._typeahead=h.render(this,this._sheetView,this._rootElement,s,t.curry(s),n.isNewEmptyLocalThread(this._threadID));this._typeahead.subscribe('resize',function(){this._sheetView.resize();}.bind(this));}.bind(this));},getParticipants:function(){if(!this._typeahead)return null;return this._typeahead.getSelectedParticipantIDs();},isPermanent:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);},getHeight:function(){return m.get(this._rootElement,'height');}});function q(s,t){var u=s.participants;l.createThreadForTokens(u.concat(t));}function r(s,t){var u=s.thread_id;if(n.isEmptyLocalThread(u)){n.addParticipantsToThreadLocally(u,t);g.inform('chat/open-tab',{thread_id:u});}else{k.sendMessage(k.constructLogMessageObject(j.CHAT_WEB,u,i.SUBSCRIBE,{added_participants:t}));g.inform('chat/open-tab',{thread_id:u});}}e.exports=p;});
__d("ChatNameConversationTabSheetRawRenderer",["DOM","Event","Input","Keys","ChatTabTemplates","fbt"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Event'),i=b('Input'),j=b('Keys'),k=b('ChatTabTemplates'),l=b('fbt'),m={render:function(n,o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:name-conversation'].build(),u=t.getNode('nameInput'),v=t.getNode('doneButton'),w="Done",x="Hide",y=q.name;if(y){i.setValue(u,y);}else g.setContent(v,x);var z=function(){var aa=i.getValue(u);if(aa)r(aa);s();o.close(n);};h.listen(u,'input',function(){g.setContent(v,i.getValue(u).length===0?x:w);});h.listen(v,'click',z);h.listen(u,'keyup',function(aa){if(aa.keyCode===j.RETURN){z();return false;}});g.setContent(p,t.getRoot());!n.isAutomatic()&&u.focus();}};e.exports=m;});
__d("ChatNameConversationTabSheet",["AsyncRequest","ChatNameConversationTabSheetRawRenderer","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('ChatNameConversationTabSheetRawRenderer'),i=b('MercuryAPIArgsSource'),j=b('MercuryLogMessageType'),k=b('MercurySourceType'),l=b('MercuryMessages').get(),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o='/ajax/chat/multichat/name_conversation/dismiss.php',p={};function q(r,s,t){this.$ChatNameConversationTabSheet0=r;this.$ChatNameConversationTabSheet1=s;this.$ChatNameConversationTabSheet2=t;this.$ChatNameConversationTabSheet3=false;}q.prototype.render=function(){n.getThreadMeta(this.$ChatNameConversationTabSheet0,function(r){h.render(this,this.$ChatNameConversationTabSheet2,this.$ChatNameConversationTabSheet1,r,this.$ChatNameConversationTabSheet4.curry(r),this.$ChatNameConversationTabSheet5.bind(this,r));this.$ChatNameConversationTabSheet2.resize();}.bind(this));};q.prototype.isPermanent=function(){return true;};q.prototype.getType=function(){return 'name_conversation_type';};q.prototype.open=function(r){this.$ChatNameConversationTabSheet3=r;if(!(this.$ChatNameConversationTabSheet3&&this.$ChatNameConversationTabSheet6()))this.$ChatNameConversationTabSheet2.open(this);};q.prototype.close=function(){this.$ChatNameConversationTabSheet2.close(this);};q.prototype.isAutomatic=function(){return this.$ChatNameConversationTabSheet3;};q.prototype.$ChatNameConversationTabSheet6=function(){return !!p[this.$ChatNameConversationTabSheet0];};q.prototype.$ChatNameConversationTabSheet7=function(){p[this.$ChatNameConversationTabSheet0]=true;};q.prototype.$ChatNameConversationTabSheet5=function(r){if(!r.name_conversation_sheet_dismissed||!this.$ChatNameConversationTabSheet6()){this.$ChatNameConversationTabSheet7();m.getServerThreadID(r.thread_id,function(s){new g(o).setData({thread_id:s}).send();});}};q.prototype.$ChatNameConversationTabSheet4=function(r,s){var t=r.name;if((s||t)&&(s!=t))l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,r.thread_id,j.THREAD_NAME,{name:s}),null,i.CHAT);};e.exports=q;});
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('ChatTabTemplates'),k=b('copyProperties');function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(m.getNode('text'),i.tx._("Scroll down to see new messages."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatNoRecipientsTabSheet",["DOM","fbt","MercuryParticipants","ChatTabTemplates","MercuryThreadInformer","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('fbt'),i=b('MercuryParticipants'),j=b('ChatTabTemplates'),k=b('MercuryThreadInformer').get(),l=b('MercuryThreads').get(),m=b('copyProperties');function n(o,p,q){this._threadID=o;this._rootElement=p;this._sheetView=q;k.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}m(n.prototype,{render:function(){var o=j[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(o.getNode('text'),"Everyone has left the conversation.");g.setContent(this._rootElement,o.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){l.getThreadMeta(this._threadID,function(o){var p=i.user,q=o.participants.filter(function(r){return r!=p;});if(q.length<1&&!o.is_joinable&&!l.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=n;});
__d("ChatOfflineTabSheet",["ChatPrivacyActionController","ChatVisibility","CSS","DOM","Event","JSLogger","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties","cx"],function(a,b,c,d,e,f){var g=b('ChatPrivacyActionController'),h=b('ChatVisibility'),i=b('CSS'),j=b('DOM'),k=b('Event'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('copyProperties'),q=b('cx');function r(s,t,u){this._rootElement=t;this._sheetView=u;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(s);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(r.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var s=o[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),t='fbid:'+this._canonicalUser;m.get(t,function(u){var v='fbChatGoOnlineLink',w=j.tx._("turn on chat"),x=j.create('a',{href:'#',className:v},w),y=j.tx._("To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});j.setContent(s.getNode('text'),y);i.addClass(s.getRoot(),"_1sk1");j.setContent(this._rootElement,s.getRoot());k.listen(this._rootElement,'click',function(event){if(i.hasClass(event.getTarget(),v)){if(h.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(s){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(s){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=r;});
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ChatTabTemplates'),i=b('copyProperties');function j(k,l,m){this._threadID=k;this._rootElement=l;this._sheetView=m;}i(j.prototype,{render:function(){var k=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(k.getNode('text'),g.tx._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,k.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=j;});
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('DOM'),j=b('ChatTabTemplates'),k=b('copyProperties');function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(m.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;});
__d("ChatUserBlockedTabSheet",["ChatPrivacyActionController","CSS","DOM","Event","GenderConst","JSLogger","MercuryParticipants","MercuryThreads","ChatTabTemplates","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('ChatPrivacyActionController'),h=b('CSS'),i=b('DOM'),j=b('Event'),k=b('GenderConst'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads').get(),o=b('ChatTabTemplates'),p=b('copyProperties'),q=b('cx'),r=b('tx');function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(t);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}p(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=o[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;m.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send her a message. ",{name:v.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=r._("You turned off chat for {name} but you can still send him a message. ",{name:v.short_name});break;default:w=r._("You turned off chat for {name} but you can still send them a message. ",{name:v.short_name});}i.setContent(t.getNode('text'),w);var x=r._("Turn on chat for {name}?",{name:v.short_name});i.setContent(t.getNode('actionLink'),x);h.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(t){case g.BLOCKED:this._sheetView.open(this);break;case g.NORMAL:case g.OFFLINE:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;});
__d("ChatUserJoinStatusTabSheet",["Class","JoinStatusTabSheet","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('JoinStatusTabSheet'),i=b('ChatTabTemplates'),j=b('copyProperties');function k(l,m){this.parent.construct(this,l,m);}g.extend(k,h);j(k.prototype,{_getTemplate:function(){return i[':fb:mercury:chat:tab-sheet:message-icon-sheet'];}});e.exports=k;});
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatThreadIsMutedTabSheet","ChatUserBlockedTabSheet","ChatUserJoinStatusTabSheet","copyProperties","MercurySheetView","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatAddFriendsTabSheet'),h=b('ChatNameConversationTabSheet'),i=b('ChatNewMessagesTabSheet'),j=b('ChatNoRecipientsTabSheet'),k=b('ChatOfflineTabSheet'),l=b('ChatUploadWarningTabSheet'),m=b('ChatThreadIsMutedTabSheet'),n=b('ChatUserBlockedTabSheet'),o=b('ChatUserJoinStatusTabSheet'),p=b('copyProperties'),q=b('MercurySheetView'),r=b('MercuryThreads').get(),s=function(t,u,v){this._sheetView=new q(t,u,v);this._addFriendsTabSheet=new g(t,u,this._sheetView);this._nameConversationTabSheet=new h(t,u,this._sheetView);this._userBlockedTabSheet=new n(t,u,this._sheetView);this._offlineTabSheet=new k(t,u,this._sheetView);this._newMessagesTabSheet=new i(t,u,this._sheetView);this._uploadWarningTabSheet=new l(t,u,this._sheetView);this._threadIsMutedTabSheet=new m(t,u,this._sheetView);this._userJoinStatusTabSheet=new o(u,this._sheetView);if(!r.getCanonicalUserInThread(t))this._noRecipientsTabSheet=new j(t,u,this._sheetView);};p(s.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},openUserJoinStatusSheet:function(t){this._userJoinStatusTabSheet.addToQueue(t);},getAddFriendsTabSheet:function(){return this._addFriendsTabSheet;},getAddFriendsParticipants:function(){var t=this._addFriendsTabSheet.getParticipants();this._addFriendsTabSheet.close();return t;},openNameConversationSheet:function(t){this._nameConversationTabSheet.open(t);},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},closeAutomaticNameConversationSheet:function(){if(this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(t){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',t);},onClickThreadIsMutedSheet:function(t){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',t);},onResize:function(t){this._sheetView.subscribe('resize',t);},destroy:function(){this._sheetView.destroy();this._offlineTabSheet.destroy();this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=s;});
__d("ChatTabView",["function-extensions","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","ChatBehavior","ChatConfig","ChatContextualDialogController","ChatAutoSendPhotoUploader","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","ChatPhotoEditorContextualDialog","ChatTabMessagesView","ChatTabPeopleSuggestionView","ChatTabSheetController","ChatVisibility","MercuryConstants","CSS","MercuryDrafts","Dialog","Dock","DOM","Event","Focus","Input","Keys","Locale","MercuryActionStatus","MercuryConfig","MercuryFileUploader","MercuryLogMessageType","MercuryMessages","MercuryMessageClientState","MercuryParticipants","MercuryServerRequests","MercurySourceType","MercuryStickers","MercuryThreadInformer","MercuryThreadMetadataRawRenderer","MercuryThreadMetadataRenderer","MercuryThreadMuter","MercuryThreads","MercuryTypingReceiver","MessagesEmoticonView","NubController","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","Run","Style","SubscriptionsHandler","ChatTabTemplates","TextAreaControl","Tooltip","TypingDetectorController","URI","UserAgent","VideoCallCore","WaterfallIDGenerator","copyProperties","cx","setIntervalAcrossTransitions","tx","fbt"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('AsyncSignal'),l=b('AvailableListConstants'),m=b('ChatBehavior'),n=b('ChatConfig'),o=b('ChatContextualDialogController'),p=b('ChatAutoSendPhotoUploader'),q=b('ChatPrivacyActionController'),r=b('ChatQuietLinks'),s=b('ChatShareLinkUploader'),t=b('ChatPhotoEditorContextualDialog'),u=b('ChatTabMessagesView'),v=b('ChatTabPeopleSuggestionView'),w=b('ChatTabSheetController'),x=b('ChatVisibility'),y=b('MercuryConstants'),z=b('CSS'),aa=b('MercuryDrafts').get(),ba=b('Dialog'),ca=b('Dock'),da=b('DOM'),ea=b('Event'),fa=b('Focus'),ga=b('Input'),ha=b('Keys'),ia=b('Locale'),ja=b('MercuryActionStatus'),ka=b('MercuryConfig'),la=b('MercuryFileUploader'),ma=b('MercuryLogMessageType'),na=b('MercuryMessages').get(),oa=b('MercuryMessageClientState'),pa=b('MercuryParticipants'),qa=b('MercuryServerRequests').get(),ra=b('MercurySourceType'),sa=b('MercuryStickers'),ta=b('MercuryThreadInformer').get(),ua=b('MercuryThreadMetadataRawRenderer'),va=b('MercuryThreadMetadataRenderer').get(),wa=b('MercuryThreadMuter'),xa=b('MercuryThreads').get(),ya=b('MercuryTypingReceiver'),za=b('MessagesEmoticonView'),ab=b('NubController'),bb=b('Parent'),cb=b('PhotosUploadWaterfall'),db=b('PresencePrivacy'),eb=b('PresenceStatus'),fb=b('Run'),gb=b('Style'),hb=b('SubscriptionsHandler'),ib=b('ChatTabTemplates'),jb=b('TextAreaControl'),kb=b('Tooltip'),lb=b('TypingDetectorController'),mb=b('URI'),nb=b('UserAgent'),ob=b('VideoCallCore'),pb=b('WaterfallIDGenerator'),qb=b('copyProperties'),rb=b('cx'),sb=b('setIntervalAcrossTransitions'),tb=b('tx'),ub=b('fbt'),vb=227878347358915,wb=/^\s*$/,xb={},yb=null,zb,ac;function bc(yc,zc){var ad=da.create('div');zc=zc.filter(function(bd){return bd!=pa.user;});if(!zc.length)return kb.remove(yc);pa.getMulti(zc,function(bd){for(var cd in bd){var dd=bd[cd],ed=ib[':fb:mercury:chat:multichat-tooltip-item'].build();da.setContent(ed.getNode('name'),dd.name);var fd=pa.getUserID(cd),gd=fd&&eb.get(fd)==l.ACTIVE;z.conditionShow(ed.getNode('icon'),gd);z.conditionClass(ed.getNode('name'),'tooltipItemWithIcon',gd);da.appendContent(ad,ed.getRoot());}kb.set(yc,ad,'above');});}var cc={},dc=null,ec=false;function fc(yc,zc,ad){if(ad){cc[yc]=zc;if(!dc)dc=sb(gc,600);}else{z.removeClass(zc,'highlightTitle');delete cc[yc];}}function gc(){for(var yc in cc){var zc=cc[yc];if(zc.parentNode){z.conditionClass(zc,'highlightTitle',ec);}else delete cc[yc];}ec=!ec;if(!Object.keys(cc).length){clearInterval(dc);dc=null;}}function hc(yc){var zc=qa.tokenizeThreadID(yc);switch(zc.type){case 'user':return ib[':fb:mercury:chat:user-tab'].build();}return ib[':fb:mercury:chat:multichat-tab'].build();}function ic(yc){var zc=yc._tabTemplate.getNode('input').value||'',ad=yc._fileUploader.getAttachments();if(pc(yc))lc(yc,zc,ad,function(bd){var cd=yc._fileUploader.getImageIDs();if(cd.length>0){bd.photo_fbids=cd;bd.has_attachment=true;}na.sendMessage(bd);yc._fileUploader.removeAttachments();n.get('chat_tab_share_sheet')&&yc._shareLinkUploader.clear();yc._getNode('input').value='';yc._lastMessageIndicator&&yc._lastMessageIndicator.resetState();yc._messagesView&&yc._messagesView.scrollToBottom();});}function jc(yc,zc){if(zc===0)return;uc(yc,cb.POST_PUBLISHED,{count:zc});yc._waterfallID=pb.generate();}function kc(yc){if(!ka.ChatSaveDraftsGK||pc(yc))return;var zc=aa.getDraft(yc._threadID);if(zc&&zc.message){yc._tabTemplate.getNode('input').focus();ga.setValue(yc._tabTemplate.getNode('input'),zc.message.body);if(zc.message.raw_attachments)yc._fileUploader.addCachedAttachments(zc.message.raw_attachments);}}function lc(yc,zc,ad,bd){xa.getThreadMeta(yc._threadID,function(cd){var dd=na.constructUserGeneratedMessageObject(zc,ra.CHAT_WEB,yc._threadID);if(ad.length>0){dd.has_attachment=true;dd.raw_attachments=ad;}if(n.get('chat_tab_share_sheet')){var ed=yc._shareLinkUploader.getAttachData();if(ed){dd.has_attachment=true;dd.content_attachment=ed;}}if(xa.isNewEmptyLocalThread(yc._threadID)){var fd=yc._sheetController.getAddFriendsParticipants();if(fd===null||fd.length===0){return;}else if(fd.length===1){var gd='user:'+pa.getUserID(fd[0]);dd.thread_id=gd;}else xa.addParticipantsToThreadLocally(yc._threadID,fd);}if(xa.isEmptyLocalThread(yc._threadID)){var hd=qa.tokenizeThreadID(yc._threadID);dd.message_id=hd.value;dd.specific_to_list=cd.participants;}if(typeof dd!='undefined')dd.signatureID=yc._signatureID;dd.ui_push_phase=y.UIPushPhase;bd(dd);if(yc._threadID!==dd.thread_id){vc.inform('closed-tab',yc._threadID);g.inform('chat/open-tab',{thread_id:dd.thread_id});}});}function mc(yc){yc._blocked=true;yc._sheetController.openUploadWarningTabSheet();}function nc(yc){return (yc._fileUploader.isUploading()||yc._photoUploader.isUploading());}function oc(yc){return yc._fileUploader.isUploading();}function pc(yc){var zc=yc._tabTemplate.getNode('input').value||'';if(!wb.test(zc))return true;if(yc._fileUploader.getAttachments().length>0||yc._fileUploader.getImageIDs().length>0)return true;if(n.get('chat_tab_share_sheet')&&yc._shareLinkUploader.getAttachData())return true;return false;}function qc(yc){return !!(ka.ChatSaveDraftsGK&&yc._threadID);}function rc(yc){if(yc._blocked){if(oc(yc))return;yc._blocked=false;ic(yc);yc._sheetController.closeUploadWarningTabSheet();}}function sc(yc){yc._nubController.flyoutContentChanged();yc._attachmentsDiv.scrollTop=yc._attachmentsDiv.scrollHeight;}function tc(yc,zc,ad){yc._subscriptionsHandler.addSubscriptions(yc._photoUploader.subscribe(zc,function(bd,cd){uc(yc,ad,cd);}));}function uc(yc,zc,ad){cb.sendSignal(qb({qn:yc._waterfallID,step:zc,uploader:cb.APP_CHAT},ad||{}));}function vc(yc,zc,ad){if(zc)qa.ensureThreadIsFetched(zc);this._threadID=yc;this._signatureID=ad;this._eventListeners=[];this._tabTemplate=hc(yc);this._tabElem=this._tabTemplate.getRoot();this._waterfallID=pb.generate();this._subscriptionsHandler=new hb();this._fileUploader=new la(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._initializeUploader(this._fileUploader);this._initializeAutoSendPhotoUploader();this._attachmentsDiv=this._getNode('attachmentShelf');if(n.get('chat_tab_share_sheet')){this._shareLinkUploader=new s(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('input'));this._initializeUploader(this._shareLinkUploader);}this._sheetController=new w(this._threadID,this._getNode('sheet'),this._tabElem);this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();vc.inform('read',this._threadID);}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){wa.showMuteChangeDialog(0,this._threadID);this.focus();}.bind(this));this._nubController=new ab().init(this._tabElem);this._sheetController.onResize(this._nubController.flyoutContentChanged.bind(this._nubController));this._contextualDialogController=new o(this._threadID,this._getNode('videoCallLink'));if(yb===null)yb=!n.get('seen_autosend_photo_nux');if(zb===undefined)zb=n.get('show_sticker_nux');this._messagesView=null;var bd=this._getNode('conversationLink');if(bd){z.hide(bd);va.renderTitanLink(yc,bd,z.show.bind(z,bd));}if(!xa.getCanonicalUserInThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var cd=this._getCanonicalUserID();if(this._isTitleTextLinked())pa.get('fbid:'+cd,function(nd){if(nd.href){var od=this._getNode('titlebarText');od.setAttribute('href',nd.href);od.removeAttribute('rel');z.removeClass(od,'noLink');}}.bind(this));var dd=this._getNode('inputContainer').clientHeight;jb.getInstance(this._getNode('input')).subscribe('resize',function(){var nd=this._getNode('inputContainer').clientHeight;if(nd!=dd)this._nubController.flyoutContentChanged();dd=nd;}.bind(this));var ed=null,fd=this._getNode('inputContainer');this._nubController.subscribe('resize',function(){if(!ed)ed=this._tabElem.clientWidth;var nd=2,od=ed-(fd.clientWidth+nd),pd=ia.isRTL()?'left':'right';gb.set(this._iconsContainerNode,pd,od+'px');jb.getInstance(this._getNode('input')).update();}.bind(this));var gd=n.get('chat_tab_height');if(gd){var hd=this._tabTemplate.getNode('chatWrapper');gb.set(hd,'height',gd+'px');}this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('nameConversationLink','click',this._nameConversationLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('muteThreadLink','click',this._showMuteSettingDialog.bind(this,-1),true);this._listen('unmuteThreadLink','click',this._showMuteSettingDialog.bind(this,0),true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===ha.TAB){this._getNode('input').focus();event.kill();}}.bind(this));this._iconsContainerNode=this._getNode('iconsContainer');var id=this._getNode('emoticons');this._emoticonView=null;if(id)this._emoticonView=new za(id,this._getNode('input'));var jd=this._getNode('stickers');if(jd){this._stickerController=new sa(jd);if(ka.BigThumbsUpStickerWWWGK)this._listen('bigThumbsUp','click',this._bigThumbsUpClicked);this._subscriptionsHandler.addSubscriptions(this._stickerController.subscribe('stickerselected',function(nd,od){this._stickerSelected(od.id);}.bind(this)));}if(nb.firefox()){this._listen('input','keypress',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new q(cd,this._updatePrivacyLink.bind(this));this._eventListeners.push(ea.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}xa.getThreadMeta(this._threadID,function(nd){var od=cd||(n.get('chat_multi_typ_send')&&!nd.is_canonical);if(od)qa.getServerThreadID(this._threadID,function(qd){this._lastMessageIndicator=new lb(cd,this._getNode('input'),'mercury-chat',null,qd);}.bind(this));this._setUpMutingSettings(nd);if(ka.PicassoWebChatGK){var pd=this._tabTemplate.getNode('photoAttachmentMenu');new t(this._tabTemplate.getNode('photoAttachLink'),this._tabTemplate.getNode('editPhotoLink'),this._tabTemplate.getNode('newPhotoLink'),pd,this._threadID);}}.bind(this));var kd=this._getNode('muteGroupLink');if(kd){var ld=xa.getCanonicalGroupInThread(this._threadID);if(ld)kd.setAttribute('ajaxify',mb(kd.getAttribute('ajaxify')).addQueryData({id:ld}));}r.removeEmptyHrefs(this._tabElem);xb[yc]=this;this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);var md={threadID:yc,userID:cd,signatureID:this._signatureID};new k('/ajax/chat/opentab_tracking.php',md).send();fb.onBeforeUnload(function(){if(this._hasUnfinishedPost())return "You haven't sent your message yet. Do you want to leave without sending?";if(na.getNumberLocalMessages(this._threadID))return "Your message is still being sent. Are you sure you want to leave?";return null;}.bind(this),false);fb.onUnload(function(){wc(this);this.onBeforeClose();}.bind(this));kc(this);}function wc(yc){if(yc._photoUploader.isUploading())uc(yc,cb.CANCEL_DURING_UPLOAD);}function xc(){for(var yc in xb){xb[yc].updateAvailableStatus();xb[yc].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],xc);db.subscribe(['privacy-changed','privacy-availability-changed'],xc);m.subscribe(m.ON_CHANGED,function(){for(var yc in xb)xa.getThreadMeta(yc,function(zc){xb[yc]._updateUnreadCount(zc);});});ya.subscribe('state-changed',function(yc,zc){for(var ad in zc){var bd=zc[ad]&&zc[ad].length,cd=xb[ad];cd&&cd.showTypingIndicator(bd);}});ta.subscribe('threads-updated',function(yc,zc){for(var ad in xb)zc[ad]&&xb[ad].updateTab();});ta.subscribe('threads-deleted',function(yc,zc){for(var ad in xb)zc[ad]&&vc.inform('thread-deleted',ad);});qb(vc,h,{get:function(yc){return xb[yc];}});qb(vc.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){(function(){this._sheetController.openAddFriendsSheet();}).bind(this).defer();},showPeopleSuggestions:function(){(function(){this._peopleSuggestions=new v(this._sheetController,this._getNode('conversation'),this._getNode('loadingIndicator'));}).bind(this).defer();},showNameConversation:function(yc){(function(){this._sheetController.openNameConversationSheet(yc);}).bind(this).defer();},hideAutomaticNameConversation:function(){(function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this).defer();},isVisible:function(){return z.shown(this._tabElem);},setVisibleState:function(yc,zc){var ad=z.shown(this._tabElem),bd=z.hasClass(this._tabElem,'opened');z.conditionShow(this._tabElem,yc);z.conditionClass(this._tabElem,'opened',zc);if(!(ad&&bd)&&yc&&zc){if(!this._messagesView)this._messagesView=new u(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'));this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(ad&&bd&&!(yc&&zc))this._contextualDialogController.tabNotActive();},focus:function(){var yc=z.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(yc).focus();},isFocused:function(){var yc=document.activeElement;return bb.byClass(yc,"_50mz")===this._tabElem;},hasEmptyInput:function(){return wb.test(this._getNode('input').value);},getInputElem:function(){return this._getNode('input');},setInput:function(yc){this._getNode('input').value=yc;},insertBefore:function(yc){da.insertBefore(yc._tabElem,this._tabElem);},appendTo:function(yc){da.appendContent(yc,this._tabElem);},nextTabIs:function(yc){var zc=yc&&yc._tabElem;return this._tabElem.nextSibling==zc;},getScrollTop:function(){return da.find(this._tabElem,'.scrollable').scrollTop;},setScrollTop:function(yc){da.find(this._tabElem,'.scrollable').scrollTop=yc;},destroy:function(){da.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();this._stickerController&&this._stickerController.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();this._messagesView&&this._messagesView.destroy();this._sheetController.destroy();this._fileUploader.destroy();this._photoUploader.destroy();this._subscriptionsHandler.release();this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();delete xb[this._threadID];ca.unregisterNubController(this._nubController);ga.reset(this._getNode('input'));},updateAvailableStatus:function(){xa.getThreadMeta(this._threadID,function(yc){var zc=l.OFFLINE,ad=this._getCanonicalUserID();if(ad){zc=eb.get(ad);}else{var bd=yc.participants.map(function(dd){return pa.getUserID(dd);});zc=eb.getGroup(bd);}if(!x.isOnline())zc=l.OFFLINE;if(ad)this._updateCallLink(zc);z.conditionClass(this._tabElem,"_5238",zc===l.ACTIVE);z.conditionClass(this._tabElem,"_5239",zc===l.MOBILE);var cd=this._getNode('presenceIndicator');switch(zc){case l.ACTIVE:cd.setAttribute('alt',"Online");break;case l.MOBILE:cd.setAttribute('alt',"Mobile");break;default:cd.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){xa.getThreadMeta(this._threadID,function(yc){if(!yc.is_subscribed){vc.inform('unsubscribed',this._threadID);return;}va.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:ua.renderShortNames,check_length:true});if(yc.is_joinable&&!n.get('joinable_conversation_is_modal'))this._updateJoinableAddFriendSheet(yc);this._updateMutingSettings(yc);this._updateUnreadCount(yc);this.updateMultichatTooltip();this._updateArchiveWarning(yc);this._updateNewThread(yc);this._updateNameConversationSheet(yc);}.bind(this));},onBeforeClose:function(){if(pc(this)&&qc(this)){var yc=this._tabTemplate.getNode('input').value||'',zc=this._fileUploader.getAttachments(),ad=this._fileUploader.getImageIDs();lc(this,yc,zc,function(bd){if(ad.length>0){bd.photo_fbids=ad;bd.has_attachment=true;}aa.saveDraft(aa.createDraft(this._threadID,bd));}.bind(this));}},_updateNameConversationSheet:function(yc){if(!yc.name&&!yc.is_canonical&&!yc.name_conversation_sheet_dismissed&&!xa.isEmptyLocalThread(yc.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateJoinableAddFriendSheet:function(yc){var zc=pa.user,ad=yc.participants.filter(function(bd){return bd!=zc;});if(yc.is_joinable&&ad.length<1)this.showAddFriend();},updateSignatureID:function(yc){this._signatureID=yc;},_showPhotoNUXIfNecessary:function(){if(yb){yb=false;new j('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoAttachLink')).setData({threadID:this._threadID}).send();return true;}},_showStickerNUXIfNecessary:function(){if(zb){zb=false;new j('/ajax/messaging/stickers/nux').setRelativeTo(this._getNode('emoticons')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(yc){var zc=wa.isThreadMuted(yc);if(zc)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(zc);},_updateMutingSettings:function(yc){var zc=wa.isThreadMuted(yc);if(zc&&z.shown(this._getNode('muteThreadLink').parentNode)){this._sheetController.openThreadIsMutedTabSheet();}else if(!zc&&z.shown(this._getNode('unmuteThreadLink').parentNode))this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(zc);},_updateActionMenu:function(yc){z.conditionShow(this._getNode('muteThreadLink').parentNode,!yc);z.conditionShow(this._getNode('unmuteThreadLink').parentNode,yc);},_updateArchiveWarning:function(yc){var zc=false;pa.get(pa.user,function(ad){zc=ad.employee;if(zc)pa.getMulti(yc.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateNewThread:function(yc){var zc=xa.isNewEmptyLocalThread(yc.thread_id);z.conditionShow(this._getNode('dropdown'),!zc);if(zc){this.showAddFriend();if(n.get('www_chat_compose_suggestions',0))this.showPeopleSuggestions();}else if(this._peopleSuggestions){this._peopleSuggestions.destroy();this._peopleSuggestions=null;}},_showArchiveWarningIfAllParticipantsAreEmployees:function(yc){var zc=true;for(var ad in yc)zc=zc&&yc[ad].employee;var bd=this._getNode('titanArchiveWarning');if(bd){if(this._titlebarTooltipAnchor)z.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',zc);z.conditionShow(bd,zc);}},updateMultichatTooltip:function(){xa.getThreadMeta(this._threadID,function(yc){if(!yc.is_canonical)bc(this._titlebarTooltipAnchor,yc.participants);}.bind(this));},_getNode:function(yc){return this._tabTemplate.getNode(yc);},_getCanonicalUserID:function(){return xa.getCanonicalUserInThread(this._threadID);},_listen:function(yc,event,zc,ad){var bd=this._getNode(yc);if(bd){this._eventListeners.push(ea.listen(bd,event,zc.bind(this)));}else if(!ad)throw new Error('Could not find node "'+yc+'"');},_closePreClicked:function(yc){this._closeMouseDown=true;},_closeClicked:function(yc){wc(this);vc.inform('closed-tab',this._threadID);yc.kill();},_nubClicked:function(yc){yc.kill();return vc.inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===ha.RETURN||event.keyCode===ha.SPACE){vc.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===ha.ESC){this._handleEscape();event.kill();}else if(event.keyCode===ha.TAB&&!event.ctrlKey){var yc=vc.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!yc&&event.kill();}},_handleEscape:function(){wc(this);if(this.hasEmptyInput()){vc.inform('esc-pressed',this._threadID);}else{var yc=[{name:'yes',label:"Yes",handler:function(){vc.inform('esc-pressed',this._threadID);}.bind(this)},ba.CANCEL],zc="Are you sure you want to stop chatting?",ad="You hit the escape key with an unsent message.",bd=new ba().setTitle(zc).setBody(ad).setButtons(yc).setModal(true).show(),cd=bd.getButtonElement('yes');cd&&fa.set(cd);}},_isTitleTextLinked:function(){var yc=this._getCanonicalUserID();return yc&&n.get('chat_tab_title_link_timeline');},_titleClicked:function(event){var yc=event.getTarget(),zc=bb.byClass(yc,'titlebarText'),ad=zc&&this._isTitleTextLinked();if(!ad&&!bb.byClass(yc,'uiSelector')&&!bb.byClass(yc,'addToThread')){vc.inform('lower-activated',this._threadID);event.kill();}},_callClicked:function(yc){var zc=this._getCanonicalUserID();if(ob.availableForCall(zc)){var ad='chat_tab_icon';if(yc.target&&z.hasClass(yc.target,'video_call_promo')){ad='chat_tab_icon_promo';}else if(yc.target&&z.hasClass(yc.target,'video_call_tour'))ad='chat_tab_icon_tour';vc.inform('video-call-clicked',{threadID:this._threadID,userID:zc,clickSource:ad});}return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_clearHistory:function(){var yc=xa.getThreadMetaNow(this._threadID);if(yc){var zc=this._getCanonicalUserID();qa.clearChat(this._threadID,zc,yc.timestamp);}},_unsubscribeLinkClicked:function(){var yc=[];yc.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});yc.push(ba.CANCEL);new ba().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(yc).show();},_bigThumbsUpClicked:function(){this._stickerSelected(vb);},_reportSpamClicked:function(){var yc=this._getCanonicalUserID(),zc=mb('/ajax/chat/report.php').addQueryData({id:yc}).addQueryData({src:'top_report_link'});i.send(new j(zc));},_showMuteSettingDialog:function(yc){wa.showMuteChangeDialog(yc,this._threadID);},_focusTab:function(){z.addClass(this._tabElem,'focusedTab');if(this._peopleSuggestions)this._peopleSuggestions.clearSuggestions();this.tryMarkAsRead();this._contextualDialogController.tabFocused();if(!ac&&(this._showPhotoNUXIfNecessary()||this._showStickerNUXIfNecessary()))g.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){ac=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);vc.inform('focus-tab',this._threadID);},_blurTab:function(){z.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(yc){var zc=this._getNode('titlebarCloseButton'),ad=yc?"Press Esc to close":"Close tab";kb.set(zc,ad,'above');},_inputKeyDown:function(event){if(event.keyCode===ha.RETURN&&!event.shiftKey){if(oc(this)){mc(this);event.kill();return;}ic(this);event.kill();return;}if(event.keyCode===ha.DOWN&&event.shiftKey&&this._getNode('input').value===''){vc.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},_hasUnfinishedPost:function(){return pc(this)||nc(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){vc.inform('read',this._threadID);return true;}return false;},_chatConvClicked:function(yc){this.tryMarkAsRead();if(bb.byTag(yc.getTarget(),'a')||da.getSelection())return;this.focus();},_inputContainerClicked:function(yc){this.tryMarkAsRead();this.focus();},showTypingIndicator:function(yc){var zc=xa.getThreadMetaNow(this._threadID),ad=this._getCanonicalUserID()||(n.get('chat_multi_typ')&&zc&&!zc.is_canonical);if(ad)z.conditionClass(this._tabElem,'typing',yc);},_updateUnreadCount:function(yc){var zc=yc.unread_count;if(typeof zc!='undefined'){var ad=!!zc&&(!m.showsTabUnreadUI||m.showsTabUnreadUI()),bd=this._getNode('numMessages');z.conditionShow(bd,ad);z.conditionClass(this._tabElem,'highlightTab',ad);fc(this._threadID,this._tabElem,ad);da.setContent(bd,zc);}},_updateCallLink:function(yc){var zc=this._getNode('videoCallLink');if(x.isOnline()){var ad=this._getCanonicalUserID(),bd='fbid:'+ad;pa.get(bd,function(cd){if(ob.availableForCall(ad)){kb.set(zc,tb._("Start a video call with {firstname}",{firstname:cd.short_name}));this._updateCallBackLinks(this._tabElem,true);}else{kb.set(zc,tb._("{firstname} is currently unavailable for video calling",{firstname:cd.short_name}));this._hideVideoCallouts();this._updateCallBackLinks(this._tabElem,false);}}.bind(this));}else{kb.set(zc,"You must be online to make a call.");this._hideVideoCallouts();this._updateCallBackLinks(document.body,false);}},_updateCallBackLinks:function(yc,zc){var ad=da.scry(yc,'a.callBackLink');if(zc){ad.forEach(z.show);}else ad.forEach(z.hide);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(yc){if(yc==q.OFFLINE){da.setContent(this._privacyLink,"Go online");}else{var zc=this._getCanonicalUserID(),ad='fbid:'+zc;pa.get(ad,function(bd){var cd=null;if(yc==q.BLOCKED){cd=tb._("Turn On Chat for {name}",{name:bd.short_name});}else cd=tb._("Turn Off Chat for {name}",{name:bd.short_name});da.setContent(this._privacyLink,cd);}.bind(this));}},_unsubscribeToThread:function(){if(xa.isEmptyLocalThread(this._threadID)){vc.inform('unsubscribed',this._threadID);}else{var yc=na.constructLogMessageObject(ra.CHAT_WEB,this._threadID,ma.UNSUBSCRIBE,{});na.sendMessage(yc);}return true;},_initializeUploader:function(yc){this._subscriptionsHandler.addSubscriptions(yc.subscribe(['all-uploads-completed','upload-canceled'],function(){rc(this);}.bind(this)),yc.subscribe('dom-updated',function(){sc(this);}.bind(this)),yc.subscribe('submit',function(){this._getNode('input').focus();}.bind(this)));},_initializeAutoSendPhotoUploader:function(){this._photoUploader=new p(this._tabTemplate.getNode('photoAttachButtonForm'),this._tabTemplate.getNode('photoFileInput'),this._tabTemplate.getNode('photoAttachID'));var yc={};tc(this,'submit',cb.UPLOAD_START);tc(this,'all-uploads-completed',cb.ALL_UPLOADS_DONE);tc(this,'all-uploads-failed',cb.CLIENT_ERROR);this._subscriptionsHandler.addSubscriptions(this._photoUploader.subscribe('submit',function(zc,ad){lc(this,'',[],function(bd){yc[ad.upload_id]=bd;if(ad.preview_attachments.length>0){bd.has_attachment=true;bd.preview_attachments=ad.preview_attachments;}bd.client_state=oa.DO_NOT_SEND_TO_SERVER;bd.status=ja.RESENDING;na.sendMessage(bd);});this._getNode('input').focus();}.bind(this)),this._photoUploader.subscribe('all-uploads-failed',function(zc,ad){var bd=yc[ad.upload_id];delete yc[ad.upload_id];na.deleteMessages(bd.thread_id,[bd.message_id]);}.bind(this)),this._photoUploader.subscribe('all-uploads-completed',function(zc,ad){var bd=yc[ad.upload_id];delete yc[ad.upload_id];bd.image_ids=ad.image_ids;bd.client_state=oa.SEND_TO_SERVER;na.sendMessage(bd);var cd=ad.image_ids.length||ad.attachments.length;jc(this,cd);}.bind(this)),g.subscribe('ChatPhotoEditor/save'+this._threadID,function(zc,ad){this._photoUploader.uploadFile(ad);}.bind(this)));},_stickerSelected:function(yc){lc(this,'',[],function(zc){zc.has_attachment=true;zc.sticker_id=yc;na.sendMessage(zc);this.focus();}.bind(this));},_emoticonView:null});e.exports=vc;});
__d("ChatNewMessageHandler",["ChatActivity","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('ChatTabModel'),i=b('ChatTabView'),j=b('JSLogger'),k=b('MercuryAssert'),l=b('MercuryBrowserAlerts'),m=b('MercuryUnseenState').get(),n=j.create('chat_new_message'),o={_raiseTab:function(p,q){var r=h.getTab(p),s=false;if(r){s=r.raised;}else{h.raiseTab(p,false);s=true;}q.to_new_tab=!r;q.to_raised_tab=!!s;},_notify:function(p,q,r){var s=i.get(p);r.view_is_visible=s&&s.isVisible();r.view_is_focused=s&&s.isFocused();if(!r.view_is_visible)n.log('message_to_hidden');r.is_active=g.isActive();l.messageReceived(q);},_promoteTab:function(p,q,r){if(r&&!r[p]&&q)h.promoteThreadInPlaceOfThread(p,q);},newMessage:function(p,q,r,s){k.isThreadID(p);var t={thread_id:p,message_id:q.message_id};this._raiseTab(p,t);this._promoteTab(p,r,s);this._notify(p,q,t);n.log('message',t);}};l.subscribe('before-alert',function(p,event){var q=event.threadID,r=i.get(q),s=h.getTab(q);if(s&&s.raised&&r&&r.isVisible()&&r.isFocused()&&r.tryMarkAsRead()){m.markThreadSeen(q);event.cancelAlert();}});e.exports=o;});
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('ChatTabModel'),i=b('MercuryThreads').get(),j={};function k(l){var m=i.getCanonicalUserInThread(l);if(m)g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};});
__d("ChatTabPolicy",["ChatBehavior","FBDesktopPlugin","JSLogger","MercuryActionTypeConstants","MercuryAssert","MercuryParticipants","MercuryParticipantTypes","MercurySourceType","MercuryThreadMode","MercuryThreadMuter","MercuryUnseenState","MessagingTag","PresencePrivacy","ShortProfiles"],function(a,b,c,d,e,f){var g=b('ChatBehavior'),h=b('FBDesktopPlugin'),i=b('JSLogger'),j=b('MercuryActionTypeConstants'),k=b('MercuryAssert'),l=b('MercuryParticipants'),m=b('MercuryParticipantTypes'),n=b('MercurySourceType'),o=b('MercuryThreadMode'),p=b('MercuryThreadMuter'),q=b('MercuryUnseenState').get(),r=b('MessagingTag'),s=b('PresencePrivacy'),t=b('ShortProfiles'),u=i.create('tab_policy');function v(w,x){q.markThreadSeen(w,x);}e.exports={messageIsAllowed:function(w,x,y){var z=w.thread_id,aa=x.message_id;k.isThreadID(z);k.isParticipantID(x.author);var ba;if(p.isThreadMuted(w)){ba={thread_id:z,message_id:aa,mute_settings:w.mute_settings};u.log('message_thread_muted',ba);return;}if(w.mode==o.OBJECT_ORIGINATED){ba={thread_id:z,message_id:aa,mode:w.mode};u.log('message_object_originated',ba);return;}if(x.source==n.EMAIL||x.source==n.TITAN_EMAIL_REPLY){ba={thread_id:z,message_id:aa,source:x.source};u.log('message_source_not_allowed',ba);return;}var ca=l.getUserID(x.author);if(!ca){u.log('message_bad_author',{thread_id:z,message_id:aa,user:ca});return;}if(x.action_type!=j.USER_GENERATED_MESSAGE){ba={thread_id:z,message_id:aa,type:x.action_type};u.log('message_non_user_generated',ba);return;}if(w.is_canonical_user&&!g.notifiesUserMessages()){u.log('message_jabber',{thread_id:z,message_id:aa});v(z,true);return;}if(w.is_canonical&&!w.canonical_fbid){u.log('message_canonical_contact',{thread_id:z,message_id:aa});return;}if(h.shouldSuppressMessages()){u.log('message_desktop',{thread_id:z,message_id:aa});return;}if(w.folder!=r.INBOX){u.log('message_folder',{thread_id:z,message_id:aa,folder:w.folder});return;}var da=l.getUserID(l.user);t.getMulti([ca,da],function(ea){if(!s.allows(ca)){u.log('message_privacy',{thread_id:z,message_id:aa,user:ca});return;}var fa=ea[ca].employee&&ea[da].employee;if(!fa&&ea[ca].type!==m.FRIEND){u.log('message_non_friend',{thread_id:z,message_id:aa,user:ca});return;}y();});}};});
__d("ChatTabViewSelector",["Event","Arbiter","CSS","DataStore","DOM","MenuDeprecated","MercuryThreadInformer","MercuryThreads","NubController","ChatTabTemplates","MercuryThreadMetadataRenderer","Toggler","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('MenuDeprecated'),m=b('MercuryThreadInformer').get(),n=b('MercuryThreads').get(),o=b('NubController'),p=b('ChatTabTemplates'),q=b('MercuryThreadMetadataRenderer').get(),r=b('Toggler'),s=b('copyProperties');function t(u){var v=p[':fb:chat:tab:selector'].build(),w=v.getRoot(),x=v.getNode('menu'),y=k.find(x,'.uiMenuInner'),z={},aa=new o().init(w);i.hide(w);k.insertBefore(u,w);function ba(ea){var fa=0;for(var ga in z){var ha=z[ga],ia=n.getThreadMetaNow(ga),ja=ha.getNode('unreadCount'),ka=(ia&&ia.unread_count)||0;fa+=ka;if(ka>9)ka='+';i.conditionClass(ja,'invisible_elem',!ka);k.setContent(ja,ka);}var la=v.getNode('numMessages');i.conditionShow(la,fa);k.setContent(la,fa);}this.setTabData=function(ea){z={};if(ea.length<1){i.hide(w);return;}i.show(w);k.empty(y);ea.forEach(function(fa){var ga=p[':fb:chat:tab:selector:item'].build();z[fa.id]=ga;var ha=ga.getNode('content');q.renderAndSeparatedParticipantList(fa.id,ha);k.prependContent(y,ga.getRoot());j.set(ga.getRoot(),'threadID',fa.id);var ia=ga.getNode('closeButton');g.listen(ia,'click',function(event){t.inform('selector/close-tab',fa.id);event.kill();});});aa.flyoutContentChanged();k.setContent(v.getNode('numTabs'),ea.length);ba();};function ca(event,ea){if(ea.menu!=x)return;var fa=j.get(ea.item,'threadID');t.inform('selected',fa);r.hide(w);}function da(event,ea){l.register(x);}l.subscribe('select',ca.bind(this));r.listen('show',w,function(){h.inform('layer_shown',{type:'ChatTabSelector'});da();});r.listen('hide',w,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});m.subscribe('threads-updated',ba);}s(t,new h());e.exports=t;});
__d("ChatTabController",["ChatTabPresence","ChatTypeaheadBehavior","Arbiter","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabMessagesView","ChatTabModel","ChatTabPolicy","ChatTabView","ChatTabViewSelector","JSLogger","MercuryParticipants","MercuryThreadInformer","MercuryThreads","MercuryUnseenState","Style","UserAgent","VideoCallCore"],function(a,b,c,d,e,f){b('ChatTabPresence');b('ChatTypeaheadBehavior');var g=b('Arbiter'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatNewMessageHandler'),k=b('ChatTabMessagesView'),l=b('ChatTabModel'),m=b('ChatTabPolicy'),n=b('ChatTabView'),o=b('ChatTabViewSelector'),p=b('JSLogger'),q=b('MercuryParticipants'),r=b('MercuryThreadInformer').get(),s=b('MercuryThreads').get(),t=b('MercuryUnseenState').get(),u=b('Style'),v=b('UserAgent'),w=b('VideoCallCore'),x=i.get('tab_auto_close_timeout')||7200000,y=p.create('tab_controller');function z(la){s.changeThreadReadStatus(la,true);aa(la);}function aa(la){t.markThreadSeen(la);}function ba(la,ma,na){var oa=l.get().tabs;la+=ma?1:-1;while(la>=0&&la<oa.length){var pa=oa[la],qa=n.get(pa.id);if(qa&&qa.isVisible()&&(!na||pa.raised)){qa.focus();return true;}la+=ma?1:-1;}return false;}function ca(la,ma,na){var oa=ma.shouldPromoteOnRaise(la);g.inform("chat/promote-tab",la);if(oa){l.raiseAndPromoteTab(la,true,na);}else l.raiseTab(la,true,na);var pa=n.get(la);pa&&pa.focus();}function da(la,ma,na){var oa=na.getMaxTabsToShow(),pa=l.indexOf(la);n.get(la).onBeforeClose();l.closeTabAndDemote(la,oa-2,ma);return pa;}function ea(la){var ma=Object.keys(la.getTabsToShow()||{}),na=1*60,oa=null,pa=Infinity;for(var qa=0;qa<ma.length;qa++){var ra=ma[qa],sa=s.getThreadMetaNow(ra);if(!n.get(ra).hasEmptyInput()||!sa)continue;var ta=(l.getServerTime()-sa.timestamp)/1000;if(!sa.timestamp||(sa.timestamp&&sa.timestamp<pa&&ta>na)){oa=sa.thread_id;pa=sa.timestamp;}}return oa;}function fa(la){o.subscribe('selected',function(na,oa){ca(oa,la);});g.subscribe('chat/open-tab',function(na,oa){ca(oa.thread_id,la,oa.signature_id);});g.subscribe('page_transition',function(na,oa){l.closeFragileTabs();});n.subscribe('read',function(event,na){z(na);});h.subscribe('idle',function(na,oa){if(oa>x){var pa=l.get().tabs;pa.forEach(function(qa){var ra=qa.id;s.getThreadMeta(ra,function(sa){if(!sa.unread_count){y.log('autoclose_idle_seen',{thread_id:ra,idleness:oa});l.closeTab(ra,'autoclose_idle_seen');}});});}});n.subscribe('nub-activated',function(na,oa){ca(oa,la);});n.subscribe('lower-activated',function(na,oa){l.lowerTab(oa);var pa=n.get(oa);pa&&pa.focus();});n.subscribe('focus-tab',function(na,oa){var pa=l.getTab(oa);if(pa&&pa.raised)ca(oa,la);});function ma(na,oa){w.showOutgoingCallDialog(oa.userID,oa.clickSource);l.lowerTab(oa.threadID);}n.subscribe('video-call-clicked',ma);k.subscribe('video-call-clicked',ma);k.subscribe('interaction-with-tab',function(na,oa){var pa=l.getTab(oa);pa&&pa.raised&&aa(oa);});n.subscribe('closed-tab',function(na,oa){y.log('close_view',{thread_id:oa});da(oa,'close_view',la);return false;});n.subscribe('thread-deleted',function(na,oa){y.log('close_thread_deleted',{thread_id:oa});da(oa,'close_thread_deleted',la);return false;});n.subscribe('unsubscribed',function(na,oa){y.log('close_view_unsubscribed',{thread_id:oa});da(oa,'close_view_unsubscribed',la);return false;});n.subscribe('esc-pressed',function(na,oa){y.log('close_esc',{thread_id:oa});var pa=da(oa,'close_esc',la);(function(){ba(pa-1,true,true)||ba(pa,false,true);}).defer();});o.subscribe('selector/close-tab',function(na,oa){y.log('close_chat_from_selector',{thread_id:oa});da(oa,'close_chat_from_selector',la);});r.subscribe('messages-received',function(na,oa){for(var pa in oa){var qa=oa[pa];for(var ra=0;ra<qa.length;ra++){var sa=qa[ra];if(sa.author!=q.user){if(!sa.is_unread){y.log('message_already_read',{action_id:sa.action_id,thread_id:sa.thread_id});continue;}s.getThreadMeta(pa,function(ta){m.messageIsAllowed(ta,sa,function(){var ua=la.hasRoomForRaisedTab()?undefined:ea(la);j.newMessage(pa,sa,ua,la.getTabsToShow());});});}}}});r.subscribe('thread-read-changed',function(na,oa){for(var pa in oa)if(!oa[pa].mark_as_read){y.log('autoclose_marked_unread',{thread_id:pa});l.closeTab(pa,'autoclose_marked_unread');}});n.subscribe('tab-pressed',function(na,oa){return !ba(l.indexOf(oa.id),oa.shiftPressed);});g.subscribe(p.DUMP_EVENT,function(na,oa){oa.chat_controller={auto_close_timeout:x};});}if(v.firefox()){var ga=function(){return u.get(document.body,'overflowX')+' '+u.get(document.body,'overflowY');},ha=ga(),ia=function(){var la=ga();if(la!==ha){ha=la;g.inform('overflow-applied-to-body');}};if('MutationObserver' in window){var ja=new MutationObserver(ia),ka={attributes:true,attributeFilter:['class','style']};ja.observe(document.documentElement,ka);}else document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style'))ia();},false);}e.exports=fa;});
__d("ChatTabViewCoordinator",["Arbiter","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","VideoCallCore"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatTabModel'),i=b('ChatTabView'),j=b('ChatTabViewSelector'),k=b('CSS'),l=b('VideoCallCore');function m(n,o){var p=new j(n),q={},r=false;function s(){var w=h.get(),x={};w.tabs.forEach(function(z){x[z.id]=1;});for(var y in q)if(!x[y]){q[y].destroy();delete(q[y]);}t(w);u(w);}function t(w){var x=null;w.tabs.forEach(function(y){var z=y.id,aa=false;if(!q[z]){q[z]=new i(z,y.server_id,y.signatureID);aa=true;}else q[z].updateSignatureID(y.signatureID);if(aa||!q[z].nextTabIs(x)){var ba=q[z].getScrollTop();if(x){q[z].insertBefore(x);}else q[z].appendTo(n);if(ba)q[z].setScrollTop(ba);}x=q[z];});}function u(w){var x=o.getTabsToShow(w),y=[],z=false;w.tabs.forEach(function(aa){if(!x[aa.id]){q[aa.id].setVisibleState(false,aa.raised);y.push(aa);}});w.tabs.forEach(function(aa){if(x[aa.id]){q[aa.id].setVisibleState(true,aa.raised);z|=aa.raised;}});p.setTabData(y);v(z);}function v(w){if(!w&&r){g.inform('layer_hidden',{type:'ChatTab'});r=false;}else if(w&&!r){g.inform('layer_shown',{type:'ChatTab'});r=true;}}if(l.isSupported())k.addClass(n,'videoCallEnabled');o.subscribe('tabs-changed',s);s();}e.exports=m;});
__d("TabsViewport",["Arbiter","ArbiterMixin","ChatTabModel","Dock","DOM","DOMDimensions","Event","Parent","Vector","ViewportBounds","areObjectsEqual","copyProperties","csx","shield"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatTabModel'),j=b('Dock'),k=b('DOM'),l=b('DOMDimensions'),m=b('Event'),n=b('Parent'),o=b('Vector'),p=b('ViewportBounds'),q=b('areObjectsEqual'),r=b('copyProperties'),s=b('csx'),t=b('shield'),u=164,v=264;function w(x){this._root=x;var y=this._recalculateWidth.bind(this);m.listen(window,'resize',y);j.subscribe('resize',y);g.subscribe(['LitestandSidebar/expand','LitestandSidebar/collapse'],y);g.subscribeOnce(['sidebar/initialized','LitestandSidebar/initialized'],y,g.SUBSCRIBE_NEW);i.subscribe('chat/tabs-changed',t(this._recalculateTabs,this,true));this._recalculateWidth();this._initialized=true;}r(w.prototype,h,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var x=w._getAvailableDockWidth(this._root),y=Math.max(1,Math.floor(x/v)),z=y!=this._maxShown;if(!this._viewState||z||x<=this._viewState.usedWidth||x>this._viewState.widthToShowNext){this._availableWidth=x;this._maxShown=y;this._viewState=null;this._recalculateTabs(z);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(x){var y=w._getTabsToShow(i.get(),this._availableWidth);if(x||!q(this._viewState,y)){this._viewState=y;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},hasRoomForRaisedTab:function(){return this._availableWidth-this._viewState.usedWidth>v;},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},shouldPromoteOnRaise:function(x){if(!this._viewState.tabsToShow[x])return true;if(this._viewState.nextToHide!=x)return false;var y=i.getTab(x),z=y&&y.raised;return !z&&(this._availableWidth-this._viewState.usedWidth<100);}});r(w,{_getAvailableDockWidth:function(x){var y=l.getViewportWithoutScrollbarDimensions().width;y-=p.getLeft()+p.getRight();y-=50;var z=n.byClass(x,'fbDock'),aa=k.find(z,"._56ox"),ba=o.getElementDimensions(aa).x;y-=ba;var ca=k.find(z,"._56oy");ba+=o.getElementDimensions(ca).x;var da=o.getElementDimensions(z),ea=da.x-ba;y-=ea;y-=15;return Math.max(y,0);},_getTabsToShow:function(x,y){y=Math.max(y,v+1);function z(oa){return oa.raised?v:u;}var aa=JSON.parse(JSON.stringify(x.tabs)),ba=-1,ca=null;if(x.promoted)aa.forEach(function(oa,pa){if(oa.id===x.promoted){ba=pa;ca=oa;}});var da=0,ea=0,fa=!ca;aa.forEach(function(oa,pa){var qa=z(oa);oa.leftmostOffset=da+v;da+=qa;if(oa.leftmostOffset<y)ea++;fa|=pa==ba;oa.alreadyPlacedPromoted=fa;});function ga(oa,pa,qa){var ra={};for(var sa=0;sa<pa;sa++){var ta=oa[sa];if(!ta.alreadyPlacedPromoted&&sa==pa-1){ra[qa]=true;}else ra[ta.id]=true;}return ra;}var ha=ga(aa,ea,x.promoted),ia=ga(aa,ea-1,x.promoted),ja=null;for(var ka in ha)if(!ia[ka])ja=ka;var la=aa[ea-1],ma=la?la.leftmostOffset:0,na=Infinity;if(ea<aa.length)na=aa[ea].leftmostOffset;return {nextToHide:ja,tabsToShow:ha,usedWidth:ma,widthToShowNext:na};}});e.exports=w;});