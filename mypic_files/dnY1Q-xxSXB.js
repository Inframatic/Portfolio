/*!CK:1470035909!*//*1375796932,178195489*/

if (self.CavalryLogger) { CavalryLogger.start_js(["r8\/hs"]); }

__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",MOBILE:"source:mobile",MESSENGER:"source:messenger",EMAIL:"source:email"};});
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,CURRENT_YEAR:3,OTHER_YEAR:4,MONTH_AGO:2};});
__d("MessagingEvent",[],function(a,b,c,d,e,f){e.exports={UNSUBSCRIBE:"unsubscribe",DELIVERY_RECEIPT:"delivery_receipt",REPORT_SPAM_MESSAGES:"report_spam_messages",DELIVER_FAST_PAST:"deliver_fast_path",DELETE_MESSAGES:"delete_messages",READ_RECEIPT:"read_receipt",SENT_PUSH:"sent_push",READ:"read",CHANGE_MUTE_SETTINGS:"change_mute_settings",ERROR:"error",UNMARK_SPAM:"unmark_spam",UNREAD:"unread",DELIVER_LOG:"deliver_log",DELIVER:"deliver",READ_ALL:"read_all",TAG:"tag",MORE_THREADS:"more_threads",DELETE:"delete",REPORT_SPAM:"report_spam",SUBSCRIBE:"subscribe"};});
__d("AvailableListConstants",[],function(a,b,c,d,e,f){var g={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,LEGACY_OVERLAY_OFFLINE:-1,LEGACY_OVERLAY_ONLINE:0,LEGACY_OVERLAY_IDLE:1,legacyStatusMap:{'0':2,'1':1,'-1':0,'2':3},reverseLegacyStatusMap:{0:-1,1:1,2:0,3:2}};a.AvailableListConstants=e.exports=g;});
__d("RangedCallbackManager",["CallbackManagerController","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('CallbackManagerController'),h=b('copyProperties'),i=b('createObjectFrom'),j=function(k,l,m){this._resources=[];this._reachedEndOfArray=false;this._error=false;this._existingIDs={};this._controller=new g(this._constructCallbackArg.bind(this));this._getValueHandler=k;this._compareValuesHandler=l;this._skipOnStrictHandler=m;};h(j.prototype,{executeOrEnqueue:function(k,l,m,n){return this._controller.executeOrEnqueue({start:k,limit:l},m,{strict:!!n});},unsubscribe:function(k){this._controller.unsubscribe(k);},getUnavailableResources:function(k){var l=this._controller.getRequest(k),m=[];if(l&&!this._reachedEndOfArray){var n=l.request,o=this._filterForStrictResults(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;},addResources:function(k){k.forEach(function(l){if(!this._existingIDs[l]){this._existingIDs[l]=true;this._resources.push(l);this._error=null;}}.bind(this));this.resortResources();this._controller.runPossibleCallbacks();},addResourcesWithoutSorting:function(k,l){var m=this._resources.slice(0,l);m=m.concat(k);m=m.concat(this._resources.slice(l));this._resources=m;h(this._existingIDs,i(k,true));this._error=null;this._controller.runPossibleCallbacks();},removeResources:function(k){k.forEach(function(l){if(this._existingIDs[l]){this._existingIDs[l]=false;var m=this._resources.indexOf(l);if(m!=-1)this._resources.splice(m,1);}}.bind(this));},removeAllResources:function(){this._resources=[];this._existingIDs={};},resortResources:function(){this._resources=this._resources.sort(function(k,l){return this._compareValuesHandler(this._getValueHandler(k),this._getValueHandler(l));}.bind(this));},setReachedEndOfArray:function(){if(!this._reachedEndOfArray){this._reachedEndOfArray=true;this._error=null;this._controller.runPossibleCallbacks();}},hasReachedEndOfArray:function(){return this._reachedEndOfArray;},setError:function(k){if(this._error!==k){this._error=k;this._controller.runPossibleCallbacks();}},getError:function(k,l,m){var n=this._filterForStrictResults({strict:m});return k+l>n.length?this._error:null;},hasResource:function(k){return this._existingIDs[k];},getResourceAtIndex:function(k){return this._resources[k];},getAllResources:function(){return this._resources.concat();},getCurrentArraySize:function(){return this._resources.length;},_filterForStrictResults:function(k){var l=this._resources;if(k&&k.strict&&this._skipOnStrictHandler)l=l.filter(this._skipOnStrictHandler);return l;},_constructCallbackArg:function(k,l){var m=this._filterForStrictResults(l);if(!this._reachedEndOfArray&&!this._error&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this._error:null;return [n,o];}},getElementsUntil:function(k){var l=[];for(var m=0;m<this._resources.length;m++){var n=this._getValueHandler(this._resources[m]);if(this._compareValuesHandler(n,k)>0)break;l.push(this._resources[m]);}return l;}});e.exports=j;});
__d("formatDate",["DateFormatConfig","fbt","invariant"],function(a,b,c,d,e,f){var g=b('DateFormatConfig'),h=b('fbt'),i=b('invariant'),j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=["January","February","March","April","May","June","July","August","September","October","November","December"],n=['',"st","nd","rd","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","th","st","nd","rd","th","th","th","th","th","th","th","st"];function o(r,s,t){t=t||{};if(!s||!r)return '';if(typeof r==='string')r=parseInt(r,10);if(typeof r==='number')r=new Date(r*1000);i(r instanceof Date);var u;if(t.skipLocalization||q()){u=s;}else{i(g.formats[s]);u=g.formats[s];}var v=t.utc?'getUTC':'get',w=r[v+'Date'](),x=r[v+'Day'](),y=r[v+'Month'](),z=r[v+'FullYear'](),aa=r[v+'Hours'](),ba=r[v+'Minutes'](),ca=r[v+'Seconds'](),da=r[v+'Milliseconds'](),ea='';for(var fa=0;fa<u.length;fa++){var ga=u.charAt(fa);switch(ga){case '\\':fa++;ea+=u.charAt(fa);break;case 'd':ea+=p(w,2);break;case 'j':ea+=w;break;case 'S':ea+=n[w];break;case 'D':ea+=j[x];break;case 'l':ea+=k[x];break;case 'F':case 'f':ea+=m[y];break;case 'M':ea+=l[y];break;case 'm':ea+=p(y+1,2);break;case 'n':ea+=y+1;break;case 'Y':ea+=z;break;case 'y':ea+=(''+z).slice(2);break;case 'a':if(aa<12){ea+="am";}else ea+="pm";break;case 'A':if(aa<12){ea+="AM";}else ea+="PM";break;case 'g':ea+=(aa===0||aa===12)?12:aa%12;break;case 'G':ea+=aa;break;case 'h':if(aa===0||aa===12){ea+=12;}else ea+=p(aa%12,2);break;case 'H':ea+=p(aa,2);break;case 'i':ea+=p(ba,2);break;case 's':ea+=p(ca,2);break;case 'X':ea+=p(da,3);break;default:ea+=ga;}}return ea;}function p(r,s){r=''+r;while(r.length<s)r='0'+r;return r;}function q(){if(!window||!window.location)return false;var r=window.location.pathname,s='/intern';return r.substr(0,s.length)===s;}e.exports=o;});
__d("MercuryMessages",["Arbiter","AsyncRequest","DOM","Env","JSLogger","KeyedCallbackManager","MercuryActionTypeConstants","MercuryActionStatus","MercuryAssert","MercuryAttachmentType","MercuryGenericConstants","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryMessageSourceTags","MercuryPayloadSource","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercuryMessageIDs","MercuryParticipants","PresenceUtil","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","copyProperties","debounce","formatDate","randomInt","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('DOM'),j=b('Env'),k=b('JSLogger'),l=b('KeyedCallbackManager'),m=b('MercuryActionTypeConstants'),n=b('MercuryActionStatus'),o=b('MercuryAssert'),p=b('MercuryAttachmentType'),q=b('MercuryGenericConstants'),r=b('MercuryIDs'),s=b('MercuryLogMessageType'),t=b('MercuryMessageClientState'),u=b('MercuryMessageSourceTags'),v=b('MercuryPayloadSource'),w=b('MercurySingletonMixin'),x=b('MercurySourceType'),y=b('MercuryTimePassed'),z=b('MercuryMessageIDs'),aa=b('MercuryParticipants'),ba=b('PresenceUtil'),ca=b('RangedCallbackManager'),da=b('MercuryServerRequests'),ea=b('MercuryThreadInformer'),fa=b('MercuryThreads'),ga=b('copyProperties'),ha=b('debounce'),ia=b('formatDate'),ja=b('randomInt'),ka=b('tx');function la(db,eb){var fb=eb;if(db._localIdsMap[eb])fb=db._localIdsMap[eb];return db._messages[fb];}var ma=new l();function na(db,eb){if(eb.status===undefined)eb.status=n.UNSENT;eb.timestamp_absolute="Today";eb.message_id=eb.message_id||db.generateNewClientMessageID(eb.timestamp);var fb=aa.getIDForUser(db._fbid);eb.specific_to_list=eb.specific_to_list||[];if(eb.specific_to_list.length&&eb.specific_to_list.indexOf(fb)===-1)eb.specific_to_list.push(fb);if(!eb.thread_id){if(eb.specific_to_list.length==1){eb.thread_id='user:'+db._fbid;}else if(eb.specific_to_list.length==2){var gb=eb.specific_to_list[0]==fb?eb.specific_to_list[1]:eb.specific_to_list[0];if(r.tokenize(gb).type=='email'){eb.thread_id=q.PENDING_THREAD_ID;}else eb.thread_id=db._threads.getThreadIDForParticipant(gb);}eb.thread_id=eb.thread_id||'root:'+eb.message_id;}if(!eb.specific_to_list.length){var hb=db._serverRequests.tokenizeThreadID(eb.thread_id);if(hb.type=='user')eb.specific_to_list=['fbid:'+hb.value,fb];}}function oa(db,eb,fb,gb){var hb=za(fb)?[u.CHAT]:[],ib=Date.now(),jb=ia(ib,'g:ia'),kb={action_type:eb,thread_id:gb,author:aa.getIDForUser(db._fbid),author_email:null,coordinates:null,timestamp:ib,timestamp_absolute:(new Date(ib)).toLocaleDateString(),timestamp_relative:jb,timestamp_time_passed:y.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,spoof_warning:false,source:fb,source_tags:hb};return kb;}function pa(db){switch(db){case v.UNKNOWN:case v.SERVER_INITIAL_DATA:case v.SERVER_FETCH_THREAD_INFO:case v.SERVER_THREAD_SYNC:return true;}return false;}function qa(db){return db&&db.substr(0,6)==='server';}function ra(db,eb){if(!db._threadsToMessages[eb])db._threadsToMessages[eb]=new ca(function(fb){return la(db,fb).timestamp;},function(fb,gb){return gb-fb;});return db._threadsToMessages[eb];}function sa(db){var eb=[];return JSON.stringify(db,function(fb,gb){if(typeof gb==='object'&&gb!==null){if(i.isNode(gb))return '<'+gb.nodeName+'>';if(eb.indexOf(gb)!==-1)return 'CIRCULAR';eb.push(gb);}return gb;});}g.subscribe(k.DUMP_EVENT,function(db,eb){var fb={},gb={},hb=ua._getInstances();for(var ib in hb){fb[ib]={};for(var jb in hb[ib]._messages){var kb=hb[ib]._messages[jb];if(Object.keys(kb).length===0)continue;var lb=kb.thread_id;fb[ib][lb]=fb[ib][lb]||{};fb[ib][lb][kb.message_id]=JSON.parse(sa(kb));}gb[ib]=ga({},hb[ib]._localIdsMap);}eb.messaging=eb.messaging||{};eb.messaging.local_message_ids=gb;eb.messaging.messages=fb;});function ta(db,eb,fb){eb.forEach(function(gb){var hb=ra(db,gb);hb.setReachedEndOfArray();db._threadInformer.reorderedMessages(gb,fb);});}function ua(db){this._fbid=db;this._serverRequests=da.getForFBID(this._fbid);this._threadInformer=ea.getForFBID(this._fbid);this._threads=fa.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(eb,fb){var gb=(fb.actions||[]).filter(function(ib){var jb=ib.action_type;return (ib.is_forward||ib.thread_id)&&(jb==m.LOG_MESSAGE||jb==m.USER_GENERATED_MESSAGE||jb==m.SEND_MESSAGE||jb==m.CLEAR_CHAT||jb==m.DELETE_THREAD||jb==m.DELETE_MESSAGES);}),hb=pa(fb.payload_source);if(qa(fb.payload_source))gb.forEach(function(ib){if(!ib.is_forward){var jb=this._threads.getThreadMetaNow(ib.thread_id);if(jb)ib.is_cleared=ib.timestamp<jb.chat_clear_time;}}.bind(this));this.handleUpdates(gb,hb,fb.payload_source,fb.from_client);if(fb.end_of_history)ta(this,fb.end_of_history,fb.payload_source);}.bind(this));}ga(ua.prototype,{getMessagesFromIDs:function(db){return (db||[]).map(la.curry(this)).filter(function(eb){return eb;});},hasLoadedNMessages:function(db,eb){var fb=ra(this,db);return fb.hasReachedEndOfArray()||fb.getCurrentArraySize()>=eb;},hasLoadedExactlyNMessages:function(db,eb){var fb=ra(this,db);return fb.getCurrentArraySize()==eb;},getThreadMessagesRange:function(db,eb,fb,gb,hb,ib){var jb=ra(this,db),kb=function(qb){gb(va(this,qb));}.bind(this),lb=jb.executeOrEnqueue(eb,fb,kb),mb=jb.getUnavailableResources(lb),nb=this._failedHistoryFetchThreads[db];if(mb.length&&!nb){var ob=(this._titanMessagesCount[db]||0)-(this._localTitanMessagesCount[db]||0),pb=mb.length+(this._localTitanMessagesCount[db]||0);this._serverRequests.fetchThreadMessages(db,ob,pb,hb,ib);}else this._failedHistoryFetchThreads[db]=false;return lb;},getThreadMessagesSinceTimestamp:function(db,eb){var fb=ra(this,db),gb=fb.getElementsUntil(eb);return va(this,gb);},hasLoadedAllMessages:function(db){return ra(this,db).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(db){var eb=ra(this,db).getAllResources();return va(this,eb);},unsubscribe:function(db,eb){o.isThreadID(eb);var fb=ra(this,eb);fb.unsubscribe(db);},addAttachmentData:function(db,eb,fb){var gb=la(this,db);if(gb){var hb=gb.attachments.indexOf(eb);if(hb!=-1){gb.attachments[hb]=fb;this._threadInformer.updatedMessage(gb.thread_id,gb.message_id,'attach');}}else{if(!this._attachmentData[db])this._attachmentData[db]=[];this._attachmentData[db].push({attach_key:eb,data:fb});}},handleUpdates:function(db,eb,fb,gb){var hb,ib={},jb={};for(var kb=0;kb<db.length;kb++){var lb=db[kb];if(lb.is_forward||fb==v.SERVER_SEARCH){if(!this._messages[lb.message_id]){this._messages[lb.message_id]=lb;ab(this,lb);}continue;}if(lb.client_state===t.SEND_TO_SERVER){this._messages[lb.message_id]=lb;ab(this,lb);continue;}var mb=lb.action_type;if(mb==m.SEND_MESSAGE){var nb=lb.client_message_id;if(nb&&this._localIdsMap[nb]&&lb.status){if(lb.status==n.UNCONFIRMED){if(!jb[lb.thread_id])jb[lb.thread_id]=[];jb[lb.thread_id].push(lb.client_message_id);}else if(!ib[lb.thread_id])ib[lb.thread_id]=[];var ob=la(this,lb.client_message_id),pb=ob.status;ob.status=lb.status;if(lb.status===n.SUCCESS||lb.error_data)ob.error_data=lb.error_data;if(lb.status==n.SUCCESS){this.updateLocalMessage(lb,fb);if(lb.client_thread_id==q.PENDING_THREAD_ID){ob.thread_id=lb.thread_id;ib[lb.thread_id].push(ob.message_id);ma.setResource(ob.message_id,ob.thread_id);}}if(typeof pb!='undefined'||lb.status==n.FAILED_UNKNOWN_REASON||lb.status==n.UNABLE_TO_CONFIRM||lb.status==n.SUCCESS||lb.status==n.ERROR)this._threadInformer.updatedMessage(lb.thread_id,la(this,lb.client_message_id).message_id,fb);}continue;}else if(mb==m.DELETE_THREAD){ra(this,lb.thread_id).removeAllResources();continue;}else if(mb==m.DELETE_MESSAGES){var qb=lb.message_ids.map(function(xb){return la(this,xb).message_id;}.bind(this));hb=ra(this,lb.thread_id);hb.removeResources(qb);this._threadInformer.reorderedMessages(lb.thread_id,fb);continue;}else if(mb==m.LOG_MESSAGE){if(lb.log_message_type==s.SERVER_ERROR)this._failedHistoryFetchThreads[lb.thread_id]=true;}else if(mb==m.CLEAR_CHAT){var rb=ra(this,lb.thread_id).getAllResources();rb.map(la.curry(this)).forEach(function(xb){xb.is_cleared=true;});continue;}var sb=la(this,lb.message_id);if((lb.threading_id&&this._localIdsMap[lb.threading_id])||(sb&&!sb.is_forward))continue;if(!ib[lb.thread_id])ib[lb.thread_id]=[];ib[lb.thread_id].push(lb.message_id);this._messages[lb.message_id]=lb;ab(this,lb);if(lb.threading_id&&lb.threading_id!=lb.message_id)z.addServerID(lb.threading_id,lb.message_id);if(!eb)this._threadInformer.receivedMessage(lb);}for(var tb in ib){hb=ra(this,tb);var ub=hb.getAllResources(),vb=ub.filter(function(xb){var yb=this._messages[xb];return yb.action_type==m.LOG_MESSAGE&&yb.log_message_type==s.SERVER_ERROR;}.bind(this));hb.removeResources(vb);wa(this,tb,ib[tb]);if(gb)xa(this,tb,ib[tb]);if(eb){hb.addResources(ib[tb]);this._threadInformer.reorderedMessages(tb,fb);}else hb.addResourcesWithoutSorting(ib[tb].reverse(),0);this._threadInformer.updatedThread(tb);}var wb=Object.keys(jb);if(wb.length)this._serverRequests.requestMessageConfirmation(jb);},sendMessage:function(db,eb,fb){eb=eb||Function.prototype;na(this,db);this._localIdsMap[db.message_id]=db.message_id;if(db.thread_id=='root:'+db.message_id)ra(this,db.thread_id).setReachedEndOfArray();this._serverRequests.sendNewMessage(db,fb);if(db.thread_id==q.PENDING_THREAD_ID){this._messages[db.message_id]=db;return ma.executeOrEnqueue(db.message_id,eb);}else eb(db.thread_id);},isFirstMessage:function(db){var eb=ra(this,db.thread_id);if(eb.getCurrentArraySize()===0)return false;var fb=eb.getResourceAtIndex(eb.getCurrentArraySize()-1),gb=la(this,fb).message_id,hb=la(this,db.message_id).message_id;return eb.hasReachedEndOfArray()&&gb==hb;},unsubscribeSend:function(db){ma.unsubscribe(db);},resendMessage:function(db,eb){var fb=ga({},db);fb.status=n.RESENDING;fb.timestamp=Date.now();fb.message_id=db.message_id;this._messages[db.message_id]=fb;var gb=ra(this,db.thread_id);gb.resortResources([db.message_id]);this.sendMessage(fb,null,eb);this._threadInformer.reorderedMessages(db.thread_id,v.CLIENT_SEND_MESSAGE);},deleteMessages:function(db,eb){if(eb.length){var fb=ra(this,db),gb=fb.getCurrentArraySize()==eb.length&&fb.hasReachedEndOfArray();this._serverRequests.deleteMessages(db,eb,gb);}},markMessagesSpam:function(db,eb){if(eb.length){var fb=ra(this,db),gb=fb.getCurrentArraySize()==eb.length&&fb.hasReachedEndOfArray();if(gb){this._serverRequests.markThreadSpam(db);}else this._serverRequests.markMessagesSpam(db,eb);}},updateLocalMessage:function(db,eb){var fb=db.message_id,gb=db.client_message_id;this._localIdsMap[gb]=fb;this._messages[fb]=this._messages[gb];z.addServerID(gb,fb);this._messages[gb]={};var hb=la(this,gb);if(db.timestamp)hb.timestamp=db.timestamp;if(db.attachments&&db.attachments.length){hb.raw_attachments=null;hb.attachments=db.attachments;ab(this,hb,fb);}if(db.log_message_data)hb.log_message_data=db.log_message_data;if(ya(hb))this._localTitanMessagesCount[hb.thread_id]--;},constructUserGeneratedMessageObject:function(db,eb,fb,gb){var hb=oa(this,m.USER_GENERATED_MESSAGE,eb,fb);hb.body=db;hb.has_attachment=false;hb.html_body=false;hb.attachments=[];hb.specific_to_list=gb||[];return hb;},constructLogMessageObject:function(db,eb,fb,gb){var hb=oa(this,m.LOG_MESSAGE,db,eb);hb.log_message_type=fb;hb.log_message_data=gb;return hb;},generateNewClientMessageID:function(db){var eb=db+':'+(ja(0,4294967295)+1)+'-'+ba.getSessionID();return '<'+eb+'@mail.projektitan.com>';},getNumberLocalMessages:function(db){return this._localTitanMessagesCount[db]||0;}});ga(ua,w,{addAttachmentData:function(db,eb,fb,gb){gb=gb||j.user;ua.getForFBID(gb).addAttachmentData(db,eb,fb);}});function va(db,eb){var fb=eb.map(la.curry(db));return fb.reverse();}function wa(db,eb,fb){var gb=fb.filter(function(hb){return ya(la(db,hb));});if(!db._titanMessagesCount[eb])db._titanMessagesCount[eb]=0;db._titanMessagesCount[eb]+=gb.length;}function xa(db,eb,fb){var gb=fb.filter(function(hb){return ya(la(db,hb));});if(!db._localTitanMessagesCount[eb])db._localTitanMessagesCount[eb]=0;db._localTitanMessagesCount[eb]+=gb.length;}function ya(db){var eb=db.action_type;if(eb==m.USER_GENERATED_MESSAGE)return true;switch(db.log_message_type){case s.SUBSCRIBE:case s.UNSUBSCRIBE:case s.SERVER_ERROR:case s.LIVE_LISTEN:return false;default:return true;}}function za(db){switch(db){case x.CHAT_WEB:case x.CHAT_JABBER:case x.CHAT_IPHONE:case x.CHAT_MEEBO:case x.CHAT_ORCA:case x.CHAT_TEST:case x.CHAT:case x.DESKTOP:return true;default:return false;}}function ab(db,eb,fb){fb=fb||eb.message_id;var gb=db._attachmentData[fb];if(gb){gb.forEach(function(hb){var ib=eb.attachments.indexOf(hb.attach_key);if(ib!==-1)eb.attachments[ib]=hb.data;});delete db._attachmentData[fb];}else if(!eb.is_forward&&bb(db,eb)){db._messagesNeedingAttachmentData[fb]=true;cb(db);}}function bb(db,eb){if(!eb||!eb.attachments)return false;for(var fb=0;fb<eb.attachments.length;fb++){var gb=eb.attachments[fb];if(typeof gb==='string'&&gb.indexOf(p.SHARE)===0)return true;}var hb=eb.forward_message_ids||[];for(fb=0;fb<hb.length;fb++){var ib=la(db,hb[fb]);if(bb(db,ib))return true;}return false;}var cb=ha(function(db){var eb={};for(var fb in db._messagesNeedingAttachmentData){var gb=la(db,fb);if(bb(db,gb))eb[fb]=true;}var hb=Object.keys(eb);if(hb.length)new h('/ajax/mercury/attachments/fetch_shares.php').setData({message_ids:hb}).setAllowCrossPageTransition(true).send();db._messagesNeedingAttachmentData={};},0,this,true);e.exports=ua;});
__d("ChatOpenTab",["Arbiter","Banzai","Bootloader","ChatVisibility","Event","MercuryIDs","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Banzai'),i=b('Bootloader'),j=b('ChatVisibility'),k=b('Event'),l=b('MercuryIDs'),m=b('MercuryMessages').get(),n=b('MercuryServerRequests').get(),o=b('MercuryThreads').get(),p='messaging_tracking';function q(u){o.getThreadMeta(u,function(){g.inform('chat/open-tab',{thread_id:u});});}function r(u,v,w,x){k.listen(u,'click',function(y){if(x(v,w))return;return y.kill();});}function s(u,v,w){var x={referrer:u||'',message_thread_id:v,message_view:'chat',timestamp_send:Date.now()};if(w!==undefined)x.message_target_ids=[w];h.post(p,x,{delay:0,retry:true});}var t={openEmptyTab:function(u,v){if(!window.Chat||!j.isOnline())return true;i.loadModules(['ChatTabModel'],function(w){var x=w.getEmptyTab();if(!x){x='root:'+m.generateNewClientMessageID(Date.now());o.createNewLocalThread(x,[]);}q(x);s(v,x);});},listenOpenEmptyTab:function(u,v){r(u,null,v,t.openEmptyTab);},openThread:function(u,v){if(l.isValid(u)){q(u);}else n.getClientThreadID(u,q);s(v,u);},listenOpenThread:function(u,v,w){r(u,v,w,t.openThread);},openUserTab:function(u,v){var w=o.getCanonicalThreadToUser(u);q(w.thread_id);s(v,w.thread_id,u);},listenOpenUserTab:function(u,v,w){r(u,v,w,t.openUserTab);}};e.exports=t;});
__d("LastMobileActiveTimes",["tx"],function(a,b,c,d,e,f){var g=b('tx'),h=0,i={};function j(n){if(!h||!n)return '';var o=h-n,p=Math.floor(o/60),q=Math.floor(p/60),r=Math.floor(q/24);if(p<=1){return g._("{count}m",{count:1});}else if(p<60){return g._("{count}m",{count:p});}else if(q<24){return g._("{count}h",{count:q});}else if(r<3){return g._("{count}d",{count:r});}else return '';}function k(n,o){i[n]=o;}function l(n){if(n in i){return i[n];}else return 0;}var m={update:function(n,o){h=o/1000;for(var p in n)k(p,n[p]);},getShortDisplay:function(n){return j(l(n));}};e.exports=m;});
__d("SplitImage.react",["React","Image.react","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('Image.react'),i=b('cx'),j=g.createClass({displayName:'SplitImage',render:function(){var k=this.props.size;return this.transferPropsTo(g.DOM.div({className:"_55lt",style:{width:k,height:k}},this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var k=this.props.srcs,l=Array.isArray(k);if(!l||k.length==1)return this.renderOne(l?k[0]:k);return k.length==2?this.renderTwo(k):this.renderThree(k);},renderOne:function(k){return (h({src:k,width:this.props.size,height:this.props.size}));},renderTwo:function(k){var l=this.props.size,m=Math.floor(l/2),n=-Math.floor(m/2),o=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.DOM.div(null,g.DOM.div({className:"_55lu",style:{width:m}},h({src:k[0],width:l,height:l,style:{marginLeft:n}})),g.DOM.div({className:o,style:{width:m}},h({src:k[1],width:l,height:l,style:{marginLeft:n}}))));},renderThree:function(k){var l=this.props.size,m=Math.floor(l/3*2),n=-Math.floor((l-m)/2),o=Math.floor(l/2),p=l-m,q=-Math.floor((o-p)/2),r=(("_55lu")+(this.props.border?' '+"_57pl":'')),s=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.DOM.div(null,g.DOM.div({className:r,style:{width:m}},h({src:k[0],width:l,height:l,style:{marginLeft:n}})),g.DOM.div({className:s,style:{width:p,height:o}},h({src:k[1],width:o,height:o,style:{marginLeft:q}})),g.DOM.div({className:"_55lu",style:{width:p,height:o}},h({src:k[2],width:o,height:o,style:{marginLeft:q}}))));}});e.exports=j;});
__d("loadImage",[],function(a,b,c,d,e,f){function g(h,i){var j=new Image();j.onload=function(){i(j.width,j.height,j);};j.src=h;}e.exports=g;});
__d("PixelzFocus",[],function(a,b,c,d,e,f){var g={search:function(h,i){var j=0,k=h.length-1;while(j<=k){var l=j+Math.floor((k-j)/2),m=h[l];if(m>i){k=l-1;}else if(m<i){j=l+1;}else return l;}return Math.min(j,k);},forceSpecificPoint:function(h,i,j){var k=1e-09,l=g.search(h,i-j-k)+1,m=g.search(h,i+j);return h.slice(l,m+1);},findBiggestSets:function(h,i){var j=[],k=-1;for(var l=0;l<h.length;++l){var m=h[l],n=l,o=g.search(h,m+i),p=o-n;if(p>k)j=[];if(p>=k){k=p;j.push({low:n,high:o});}}return j;},getBestSet:function(h,i,j){var k=-1,l=null;for(var m=0;m<i.length;++m){var n=i[m],o=h[n.low],p=h[n.high],q=o+(p-o)/2,r=Math.min(o-(q-j),(q+j)-p);if(r>k){k=r;l=n;}}return l;},getFocusFromSet:function(h,i){var j=h[i.low],k=h[i.high];return j+(k-j)/2;},clampFocus:function(h,i){var j=i/2,k=1-(i/2);if(h<j)return j;if(h>k)return k;return h;},convertFromCenterToCSS:function(h,i){if(Math.abs(1-i)<1e-05)return 0;return (h-i/2)/(1-i);},convertFromCSSToCenter:function(h,i){return h*(1-i)+i/2;},getVisible:function(h,i){if(h<i)return h/i;return i/h;},getHidden:function(h,i){return 1-g.getVisible(h,i);},focusHorizontally:function(h,i){return h<i;},convertVectorFromCenterToCSS:function(h,i,j){var k=g.focusHorizontally(i,j),l;if(k){l=h.x/100;}else l=h.x/100;var m=g.convertFromCenterToCSS(l,g.getVisible(i,j));if(k){return {x:m,y:0};}else return {x:0,y:m};},getCropRect:function(h,i,j){var k=g.focusHorizontally(i,j),l=g.getVisible(i,j);if(k){var m=(1-l)*h.x;return {left:m,top:0,width:l,height:1};}else{var n=(1-l)*h.y;return {left:0,top:n,width:1,height:l};}}};e.exports=g;});
__d("Pixelz.react",["arrayContains","copyProperties","cx","invariant","loadImage","React","ReactPropTypes","PixelzFocus"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('copyProperties'),i=b('cx'),j=b('invariant'),k=b('loadImage'),l=b('React'),m=b('ReactPropTypes'),n=b('PixelzFocus'),o=l.createClass({displayName:'Pixelz',propTypes:{width:m.number,height:m.number,resizeMode:m.oneOf(['contain','cover','stretch']),alt:m.string,letterbox:m.bool,borderRadius:m.number,insetBorderColor:m.string,animated:m.bool,upscale:m.bool,cropRect:function(p,q,r){var s=p[q],t=('Invalid prop `'+q+'` supplied to `'+r+'`, expected a rectangle with values normalized '+'between 0 and 1');j(s.left>=0);j(s.top>=0);j(s.width>=0);j(s.height>=0);j(s.left+s.width<=1);j(s.top+s.height<=1);},focus:function(p,q,r){var s=p[q],t=('Invalid prop `'+q+'` supplied to `'+r+'`, expected either a {x, y, type} vector where type '+'is `css` or `center` or an array of {x, y} vectors. All the vectors '+'have with values normalized between 0 and 1');if(Array.isArray(s)){for(var u=0;u<s.length;++u){j(s[u].x>=0&&s[u].x<=1);j(s[u].y>=0&&s[u].y<=1);}}else{if(!s.type)s.type='css';j(s.x>=0&&s.x<=1);j(s.y>=0&&s.y<=1);j(g(['center','css'],s.type));}}},getDefaultProps:function(){return {resizeMode:'cover',alt:'',letterbox:true,upscale:true,cropRect:{width:1,height:1,top:0,left:0},focus:{x:.5,y:.5,type:'css'}};},getInitialState:function(){return {srcDimensions:{}};},getSrcDimensions:function(){var p=this.props.src,q=this.state.srcDimensions[p];if(q)return q;k(p,function(r,s){var t={};t[p]={width:r,height:s};this.setState({srcDimensions:t});}.bind(this));return null;},getCropSrcDimensions:function(){var p=this.getSrcDimensions();return {width:p.width*this.props.cropRect.width,height:p.height*this.props.cropRect.height};},getUpscaleCropDimensions:function(){var p=this.getCropSrcDimensions(),q=p.width/p.height,r=this.props.width/this.props.height;if(this.props.width&&this.props.height&&this.props.resizeMode==='stretch')return {width:this.props.width,height:this.props.height};if((!this.props.width&&this.props.height)||((this.props.resizeMode==='contain')!==(q>=r)))return {width:this.props.height*q,height:this.props.height};if(this.props.width)return {width:this.props.width,height:this.props.width/q};return p;},getCropDimensions:function(){var p=this.getUpscaleCropDimensions(),q=this.getCropSrcDimensions();if(!this.props.upscale)return {width:Math.min(p.width,q.width),height:Math.min(p.height,q.height)};return p;},getCropAspectRatio:function(){var p=this.getCropDimensions();return p.width/p.height;},getContainerDimensions:function(){if(this.props.letterbox&&this.props.width&&this.props.height)return {width:this.props.width,height:this.props.height};return this.getCropDimensions();},getContainerAspectRatio:function(){var p=this.getContainerDimensions();return p.width/p.height;},getContainerPosition:function(){return {left:0,top:0};},getFocus:function(){var p=this.props.focus;if(!Array.isArray(p)&&p.type==='css')return {x:p.x,y:p.y};var q=this.getContainerAspectRatio(),r=this.getCropAspectRatio(),s=n.getVisible(q,r),t=n.focusHorizontally(q,r),u;if(!Array.isArray(p)){u=n.convertFromCenterToCSS(t?p.x:p.y,s);}else{var v=p.map(function(y){return t?y.x:y.y;});v.sort();var w=n.findBiggestSets(v,s),x=n.getBestSet(v,w,s);u=n.getFocusFromSet(v,x);}return {x:t?u:.5,y:t?.5:u};},getCropPosition:function(){var p=this.getCropDimensions(),q=this.getContainerDimensions(),r=this.getFocus();return {left:r.x*(q.width-p.width),top:r.y*(q.height-p.height)};},getScaleDimensions:function(){var p=this.getCropDimensions();return {width:p.width/this.props.cropRect.width,height:p.height/this.props.cropRect.height};},getScalePosition:function(){var p=this.getScaleDimensions();return {left:-p.width*this.props.cropRect.left,top:-p.height*this.props.cropRect.top};},getClipCropRectangle:function(){var p=this.getContainerDimensions(),q=this.getCropDimensions(),r=this.getContainerPosition(),s=this.getCropPosition(),t=Math.max(r.left,s.left),u=Math.max(r.top,s.top),v=Math.min(r.top+p.height,s.top+q.height),w=Math.min(r.left+p.width,s.left+q.width);return {left:t,top:u,width:w-t,height:v-u};},getClipCropPosition:function(){var p=this.getClipCropRectangle();return {left:p.left,top:p.top};},getClipCropDimensions:function(){var p=this.getClipCropRectangle();return {width:p.width,height:p.height};},getClipScalePosition:function(){var p=this.getScalePosition(),q=this.getClipCropPosition(),r=this.getCropPosition();return {left:p.left+(r.left-q.left),top:p.top+(r.top-q.top)};},getClipScaleDimensions:function(){return this.getScaleDimensions();},areDimensionsEqual:function(p,q){return p.width===q.width&&p.height===q.height;},shouldAddAllNodesAndStyles:function(){return this.props.animated;},hasCrop:function(){if(this.shouldAddAllNodesAndStyles())return true;var p=this.getContainerDimensions(),q=this.getClipCropDimensions(),r=this.getClipScaleDimensions();if(this.areDimensionsEqual(p,q)||this.areDimensionsEqual(q,r))return false;return true;},hasContainer:function(){if(this.shouldAddAllNodesAndStyles()||this.hasInsetBorder())return true;var p=this.getContainerDimensions(),q=this.getClipScaleDimensions();if(this.areDimensionsEqual(p,q))return false;return true;},hasInsetBorder:function(){return this.shouldAddAllNodesAndStyles()||this.props.insetBorderColor;},applyPositionStyle:function(p,q){if(this.shouldAddAllNodesAndStyles()||q.left)p.left=Math.round(q.left);if(this.shouldAddAllNodesAndStyles()||q.top)p.top=Math.round(q.top);},applyDimensionsStyle:function(p,q){p.width=Math.round(q.width);p.height=Math.round(q.height);},applyBorderRadiusStyle:function(p){if(this.shouldAddAllNodesAndStyles()||this.props.borderRadius)p.borderRadius=this.props.borderRadius||0;},getScaleStyle:function(){var p={},q=this.getClipCropDimensions(),r=this.getClipScaleDimensions();if(this.shouldAddAllNodesAndStyles()||!this.areDimensionsEqual(q,r)){this.applyPositionStyle(p,this.getClipScalePosition());}else this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipScaleDimensions());this.applyBorderRadiusStyle(p);return p;},getCropStyle:function(){var p={};this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipCropDimensions());this.applyBorderRadiusStyle(p);return p;},getInsetBorderStyle:function(){var p={borderColor:this.props.insetBorderColor||'transparent'};this.applyPositionStyle(p,this.getClipCropPosition());this.applyDimensionsStyle(p,this.getClipCropDimensions());this.applyBorderRadiusStyle(p);return p;},getContainerStyle:function(){var p={};this.applyDimensionsStyle(p,this.getContainerDimensions());this.applyBorderRadiusStyle(p);return p;},getScale:function(){var p=this.getScaleStyle(),q=p.width,r=p.height;p=h({},p);delete p.width;delete p.height;return this.transferPropsTo(l.DOM.img({alt:this.props.alt,className:(("_56wb")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),src:this.props.src,style:p,width:q,height:r}));},getCrop:function(){var p=this.getScale();if(!this.hasCrop())return p;return (l.DOM.div({className:(("_56ma")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getCropStyle()},p));},getInsetBorder:function(){if(!this.hasInsetBorder())return null;return (l.DOM.div({className:(("_56lv")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getInsetBorderStyle()}));},getContainer:function(){var p=this.getCrop();if(!this.hasContainer())return p;var q=this.getInsetBorder();return (l.DOM.div({className:(("_56jj")+(this.shouldAddAllNodesAndStyles()?' '+"_56t5":'')),style:this.getContainerStyle()},p,q));},render:function(){var p=this.getSrcDimensions();if(!p)return l.DOM.span(null);return this.getContainer();}});e.exports=o;});
__d("legacy:cookie",["Cookie"],function(a,b,c,d){var e=b('Cookie');a.getCookie=e.get;a.setCookie=e.set;a.clearCookie=e.clear;},3);
__d("ModalMask",["DOM"],function(a,b,c,d,e,f){var g=b('DOM'),h=null,i=0,j={show:function(){i++;if(!h){h=g.create('div',{id:'modalMaskOverlay'});g.appendContent(document.body,h);}},hide:function(){if(i){i--;if(!i&&h){g.remove(h);h=null;}}}};e.exports=j;});
__d("WebMessengerPermalinkConstants",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(i,j){return (j||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+g.encodeComponent(g.encodeComponent(i));},getThreadIDFromURI:function(i){var j=i.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(j){var k=g.decodeComponent(g.decodeComponent(j[2]));return k;}},getURIPathForIDOrVanity:function(i,j){if(i.match('^'+h.overriddenVanities+'$'))i='.'+i;return (j||h.BASE_PATH)+'/'+i;},getUserIDOrVanity:function(i){var j=i.match(h.BASE_PATH+'.*/([^/]+)/?$'),k=j&&j[1],l=h.overriddenVanities;if(!k||k.match('^'+l+'$')){return false;}else if(k.match('^\\.'+l+'$')){return k.substr(1);}else return k;}};e.exports=h;});
__d("MercuryErrorInfo",["MercuryErrorType","tx"],function(a,b,c,d,e,f){var g=b('MercuryErrorType'),h=b('tx'),i={getMessage:function(j){var k="This message failed to send.";if(i.isConnectionError(j)){k="Unable to connect to Facebook. This message failed to send. ";}else if(j.description)k=j.description;return k;},isConnectionError:function(j){if(j&&j.type==g.TRANSPORT)return j.code===1001||j.code===1004||j.code===1006;return false;}};e.exports=i;});
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryGlobalActionType","MercuryPayloadSource","MessagingReliabilityLogger","MessagingEvent","MessagingTag","MercuryParticipants","PresenceUtil","MercuryServerRequests","MercuryThreadInformer","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryActionTypeConstants'),j=b('MercuryGlobalActionType'),k=b('MercuryPayloadSource'),l=b('MessagingReliabilityLogger'),m=b('MessagingEvent'),n=b('MessagingTag'),o=b('MercuryParticipants'),p=b('PresenceUtil'),q=b('MercuryServerRequests').get(),r=b('MercuryThreadInformer').get(),s=b('copyProperties');function t(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.message){l.addEntry('channel_receive','invalid_data');return;}var ka=ja.obj.message,la={author:ka.mercury_author_id,author_email:ka.mercury_author_email,body:ka.body,subject:ka.subject,has_attachment:ka.has_attachment,attachments:ka.attachments,html_body:ka.html_body,thread_id:ka.tid,message_id:ka.mid,coordinates:ka.mercury_coordinates,spoof_warning:ka.mercury_spoof_warning,source:ka.mercury_source,source_tags:ka.mercury_source_tags,threading_id:ka.threading_id,timestamp:ka.timestamp,timestamp_absolute:ka.timestamp_absolute,timestamp_relative:ka.timestamp_relative,timestamp_time_passed:ka.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:ka.is_unread,action_id:ka.action_id,is_forward:false,forward_count:ka.forward_count||ka.forward,forward_message_ids:ka.forward_msg_ids,location_text:ka.location_text,folder:ja.obj.folder},ma=[s({},la)];ma=ma.concat(ka.forward_actions||[]);var na=k.CLIENT_CHANNEL_MESSAGE;q.handleUpdateWaitForThread({actions:ma,payload_source:na},ka.tid);if(!ka.is_unread&&ka.mercury_author_id===o.user){var oa={};oa[ka.tid]=ja.obj.folder;u(h.getArbiterType('messaging'),{obj:{event:m.READ,tids:[ka.tid],folder_info:oa,timestamp:ka.timestamp}});}l.addEntry('channel_receive','success',[la.thread_id,la.message_id,p.getSessionID()]);}function u(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.tids)return;var ka=[],la=ja.obj.event==m.READ;ja.obj.tids.forEach(function(ma){ka.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_id:ma,mark_as_read:la,timestamp:ja.obj.timestamp||0,folder:ja.obj.folder_info[ma]});});q.handleUpdate({actions:ka,payload_source:k.CLIENT_CHANNEL_MESSAGE});}function v(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.tids)return;var ka=[];ja.obj.tids.forEach(function(la){ka.push({action_type:i.DELETE_THREAD,action_id:null,thread_id:la});});q.handleUpdate({actions:ka,payload_source:k.CLIENT_CHANNEL_MESSAGE});}function w(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.tids||!ja.obj.mids)return;var ka=ja.obj.tids[0],la={action_type:i.DELETE_MESSAGES,action_id:null,thread_id:ka,message_ids:ja.obj.mids};q.handleUpdate({actions:[la],threads:[ja.obj.updated_thread],payload_source:k.CLIENT_CHANNEL_MESSAGE});}function x(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||!ja.obj.folder)return;var ka={action_type:j.MARK_ALL_READ,action_id:ja.obj.action_id,folder:ja.obj.folder};q.handleUpdate({global_actions:[ka]});}function y(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj.tids)return;var ka=k.CLIENT_CHANNEL_MESSAGE;ja.obj.tids.forEach(function(la){var ma={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:la,archived:ja.obj.state};q.handleUpdateWaitForThread({actions:[s({},ma)],payload_source:ka},la);});}function z(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj.tids)return;var ka=k.CLIENT_CHANNEL_MESSAGE,la;ja.obj.tids.forEach(function(ma){if(ja.obj.event==m.TAG){la=ja.obj.tag;}else la=ja.obj.marked_as_spam?n.SPAM:n.INBOX;var na={action_type:i.CHANGE_FOLDER,action_id:null,thread_id:ma,new_folder:la};q.handleUpdateWaitForThread({actions:[s({},na)],payload_source:ka},ma);});}function aa(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj.tag)return;switch(ja.obj.tag){case n.ACTION_ARCHIVED:y(ia,ja);break;case n.INBOX:case n.OTHER:z(ia,ja);break;}}function ba(ia,ja){if(ia!=h.getArbiterType('inbox')||!ja.obj||!ja.obj.seen_timestamp)return;q.handleUpdate({message_counts:[{seen_timestamp:ja.obj.seen_timestamp,folder:n.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:n.INBOX}],payload_source:k.CLIENT_CHANNEL_MESSAGE});}function ca(ia,ja){if(ia!=h.getArbiterType('mercury')||!ja.obj)return;r.synchronizeInforms(function(){var ka=ja.obj,la=[];(ka.actions||[]).forEach(function(ma){var na=i.USER_GENERATED_MESSAGE;if(ma.action_type==i.LOG_MESSAGE){var oa=k.CLIENT_CHANNEL_MESSAGE;q.handleUpdateWaitForThread({actions:[s({},ma)],payload_source:oa},ma.thread_id);}else if(ma.action_type!=na)la.push(ma);});ka.actions=la;ka.payload_source=k.CLIENT_CHANNEL_MESSAGE;q.handleUpdate(ka);});}function da(ia,ja){q.handleRoger(ja.obj);}function ea(ia,ja){if(ia!=h.getArbiterType('messaging')||!ja.obj||ja.obj.mute_settings===undefined||!ja.obj.thread_id)return;var ka=i.CHANGE_MUTE_SETTINGS,la=[{action_type:ka,action_id:null,thread_id:ja.obj.thread_id,mute_settings:ja.obj.mute_settings}];q.handleUpdate({actions:la,payload_source:k.CLIENT_CHANNEL_MESSAGE});}function fa(ia,ja){switch(ja.obj.event){case m.DELIVER:t(ia,ja);break;case m.READ:case m.UNREAD:u(ia,ja);break;case m.READ_ALL:x(ia,ja);break;case m.DELETE:v(ia,ja);break;case m.DELETE_MESSAGES:w(ia,ja);break;case m.TAG:aa(ia,ja);break;case m.REPORT_SPAM:z(ia,ja);break;case m.READ_RECEIPT:da(ia,ja);break;case m.CHANGE_MUTE_SETTINGS:ea(ia,ja);break;}}var ga=[],ha={turnOn:function(){if(!ga.length){var ia={mercury:ca,messaging:fa,inbox:ba};for(var ja in ia)ga.push(g.subscribe(h.getArbiterType(ja),ia[ja]));}},turnOff:function(){if(ga.length){ga.forEach(g.unsubscribe);ga=[];}}};ha.turnOn();e.exports=ha;});
__d("MercuryRoger",["ArbiterMixin","MercuryActionStatus","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('MercuryActionStatus'),i=b('MercuryServerRequests').get(),j=b('copyProperties'),k={},l={getSeenBy:function(m,n){if(!m)return [];var o=[],p=k[m.thread_id],q=h.SUCCESS;for(var r in p)if(p[r]>m.timestamp&&(m.status===undefined||m.status===q)&&(!n||r!=m.author))o.push(r);return o;},getSeenTimestamp:function(m,n){var o=k[m];return o?o[n]:null;}};j(l,g);i.subscribe('update-roger',function(m,n){for(var o in n){if(!k[o])k[o]={};for(var p in n[o]){var q=k[o][p],r=n[o][p];if(!q||r>q)k[o][p]=r;}}if(n)l.inform('state-changed',n);});e.exports=l;});
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryMessages","MercuryRoger","MercuryThreadInformer","MercuryThreads","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('LiveTimer'),i=b('MercuryActionStatus'),j=b('MercuryConfig'),k=b('MercuryMessages').get(),l=b('MercuryRoger'),m=b('MercuryThreadInformer').get(),n=b('MercuryThreads').get(),o=b('copyProperties'),p=b('setTimeoutAcrossTransitions'),q={},r={},s=j['roger.seen_delay'],t=o({getSeenBy:function(x,y){if(r[x])return [];if(!q[x]){var z=n.getThreadMetaNow(x);if(z)q[x]={thread_id:x,author:z.participants[0],timestamp:z.timestamp};}return l.getSeenBy(q[x],y);}},g);function u(x){var y=false;k.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=t.getSeenBy(x);if(r[x]){clearTimeout(r[x]);delete r[x];}var da=ba+s,ea=da-Date.now();if(ea>0)r[x]=p(function(){delete r[x];v(x);},ea);q[x]=aa;var fa=t.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;t.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){t.inform('state-changed',y);break;}}l.subscribe('state-changed',function(x,y){for(var z in y)!r[z]&&v(z);});m.subscribe('messages-received',w);m.subscribe('messages-reordered',w);m.subscribe('messages-updated',w);e.exports=t;});
__d("MercuryFilters",["MessagingTag","arrayContains"],function(a,b,c,d,e,f){var g=b('MessagingTag'),h=b('arrayContains'),i=[g.UNREAD],j={ALL:'all',getSupportedFilters:function(){return i.concat();},isSupportedFilter:function(k){return h(i,k);}};e.exports=j;});
__d("MercuryOrderedThreadlist",["JSLogger","MercuryActionTypeConstants","MercuryFilters","MercuryFolders","MercuryPayloadSource","MercurySingletonMixin","MessagingTag","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","copyProperties"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=b('MercuryActionTypeConstants'),i=b('MercuryFilters'),j=b('MercuryFolders'),k=b('MercuryPayloadSource'),l=b('MercurySingletonMixin'),m=b('MessagingTag'),n=b('RangedCallbackManager'),o=b('MercuryServerRequests'),p=b('MercuryThreadInformer'),q=b('MercuryThreads'),r=b('arrayContains'),s=b('copyProperties'),t=g.create('ordered_threadlist_model'),u=i.getSupportedFilters().concat([i.ALL,m.GROUPS]),v=j.getSupportedFolders();function w(ga,ha,ia,ja){var ka=[],la=false,ma=false,na=(ha||[]).filter(function(ua){var va=ua.filter||i.ALL;return (ua.folder==ia||(!ua.folder&&ia==m.INBOX))&&va==ja;}),oa=ga._threadlistOrderMap[ia][ja].getAllResources(),pa;na.forEach(function(ua){ka=ka.concat(ua.thread_ids);if(ua.error){if(ua.end>oa.length)ma=ua.error;}else{var va=ua.end-ua.start;if(ua.thread_ids.length<va)la=true;}if(!pa||ua.end>pa)pa=ua.end;});aa(ga,ka,ia,ja);if(la){ga._threadlistOrderMap[ia][ja].setReachedEndOfArray();}else if(ma){ga._threadlistOrderMap[ia][ja].setError(ma);}else{var qa=ga._threadlistOrderMap[ia][ja].getCurrentArraySize();if(pa&&qa<pa){var ra={},sa=oa.concat(ka),ta=sa.filter(function(ua){var va=ra[ua];ra[ua]=true;return va;});if(ta.length){t.warn('duplicate_threads',{folder:ia,expected_final_size:pa,actual_final_size:qa,duplicate_thread_ids:ta});ga._serverRequests.fetchThreadlistInfo(pa,ta.length,ia,ja==i.ALL?null:ja);}}}}function x(ga,ha){v.forEach(function(ia){u.forEach(function(ja){w(ga,ha,ia,ja);});});}function y(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]={to_add:[],to_remove:[],to_remove_if_last_after_add:{}};});});ha.forEach(function(ja){if(ja.is_forward)return;var ka=ja.thread_id,la=ba(ga,ka),ma=ca(ga,ka);function na(){ma.forEach(function(pa){ia[la][pa].to_add.push(ka);if(!ga._threadlistOrderMap[la][pa].hasReachedEndOfArray()&&!ga._threadlistOrderMap[la][pa].hasResource(ka))ia[la][pa].to_remove_if_last_after_add[ka]=true;});}function oa(pa){if(r(u,pa))if(r(ma,pa)){ia[la][pa].to_add.push(ka);}else ia[la][pa].to_remove.push(ka);}if(!la){if(ja.action_type===h.CHANGE_FOLDER||ja.action_type===h.CHANGE_ARCHIVED_STATUS)v.forEach(function(pa){if(pa!==la)u.forEach(function(qa){ga._threadlistOrderMap[pa][qa].removeResources([ka]);});});return;}switch(ja.action_type){case h.DELETE_THREAD:ma.forEach(function(pa){ia[la][pa].to_remove.push(ka);});break;case h.CHANGE_ARCHIVED_STATUS:case h.CHANGE_FOLDER:na();break;case h.CHANGE_READ_STATUS:oa(m.UNREAD);break;case h.USER_GENERATED_MESSAGE:case h.LOG_MESSAGE:ma.forEach(function(pa){if(da(ga,ka,la,pa))ia[la][pa].to_add.push(ka);});break;}});v.forEach(function(ja){u.forEach(function(ka){var la=ga._threadlistOrderMap[ja][ka];aa(ga,ia[ja][ka].to_add,ja,ka);for(var ma=la.getCurrentArraySize()-1;ma>=0;ma--){var na=la.getResourceAtIndex(ma);if(!ia[ja][ka].to_remove_if_last_after_add[na])break;ia[ja][ka].to_remove.push(na);}la.removeResources(ia[ja][ka].to_remove);});});}function z(ga,ha){var ia={};v.forEach(function(ja){ia[ja]={};u.forEach(function(ka){ia[ja][ka]=[];});});ha.forEach(function(ja){var ka=ba(ga,ja.thread_id),la=ca(ga,ja.thread_id);if(ka)la.forEach(function(ma){if(da(ga,ja.thread_id,ka,ma))ia[ka][ma].push(ja.thread_id);});});v.forEach(function(ja){u.forEach(function(ka){if(ia[ja][ka].length>0)aa(ga,ia[ja][ka],ja,ka);});});}function aa(ga,ha,ia,ja){ja=ja||i.ALL;ga._threadlistOrderMap[ia][ja].addResources(ha);v.forEach(function(ka){if(ka!=ia)ga._threadlistOrderMap[ka][ja].removeResources(ha);});}function ba(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=null;if(!ia){ja='No thread metadata';}else if(!ia.folder)ja='No thread folder';if(ja){var ka={error:ja,tid:ha};t.warn('no_thread_folder',ka);return null;}var la=ia.folder;if(ia.is_archived)la=m.ACTION_ARCHIVED;if(ga._threadlistOrderMap[la]){return la;}else return null;}function ca(ga,ha){var ia=ga._threads.getThreadMetaNow(ha),ja=[i.ALL];if(!ia){var ka={error:'no_thread_metadata',tid:ha};t.warn('no_thread_metadata',ka);return [];}if(ia.unread_count)ja.push(m.UNREAD);if(!ia.is_canonical)ja.push(m.GROUPS);return ja;}function da(ga,ha,ia,ja){var ka=ga._threads.getThreadMetaNow(ha);return ka&&ka.timestamp&&ba(ga,ha)==ia&&r(ca(ga,ha),ja);}function ea(ga){this._fbid=ga;this._serverRequests=o.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._threads=q.getForFBID(this._fbid);this._threadlistOrderMap={};v.forEach(function(ha){this._threadlistOrderMap[ha]={};u.forEach(function(ia){this._threadlistOrderMap[ha][ia]=new n(function(ja){return this._threads.getThreadMetaNow(ja).timestamp;}.bind(this),function(ja,ka){return ka-ja;},this._serverRequests.canLinkExternally.bind(this._serverRequests));}.bind(this));}.bind(this));this._serverRequests.subscribe('update-threadlist',function(ha,ia){if(!fa(ia))return;var ja=ia.ordered_threadlists;if(ja&&ja.length){x(this,ja);}else{var ka=(ia.actions||[]).filter(function(la){return la.thread_id;});z(this,ia.threads||[]);y(this,ka);}this._threadInformer.updatedThreadlist();}.bind(this));}s(ea.prototype,{getThreadlist:function(ga,ha,ia,ja,ka,la){return this.getFilteredThreadlist(ga,ha,ia,i.ALL,ja,ka,la);},getFilteredThreadlist:function(ga,ha,ia,ja,ka,la,ma){var na=this._threadlistOrderMap[ia][ja],oa=na.executeOrEnqueue(ga,ha,ka,la),pa=na.getUnavailableResources(oa),qa=na.getError(ga,ha,la);if(pa.length||qa){if(na.getCurrentArraySize()<ga){var ra={start:ga,limit:ha,filter:ja,resources_size:na.getCurrentArraySize()};t.warn('range_with_gap',ra);}na.setError(false);this._serverRequests.fetchThreadlistInfo(na.getCurrentArraySize(),pa.length,ia,ja==i.ALL?null:ja,ma);}return oa;},getThreadlistUntilTimestamp:function(ga,ha,ia){ia=ia||i.ALL;return this._threadlistOrderMap[ha][ia].getElementsUntil(ga);},unsubscribe:function(ga,ha,ia){ia=ia||i.ALL;this._threadlistOrderMap[ha][ia].unsubscribe(ga);}});s(ea,l);function fa(ga){switch(ga.payload_source){case k.CLIENT_CHANGE_ARCHIVED_STATUS:case k.CLIENT_CHANGE_READ_STATUS:case k.CLIENT_CHANGE_FOLDER:case k.CLIENT_CHANNEL_MESSAGE:case k.CLIENT_DELETE_MESSAGES:case k.CLIENT_DELETE_THREAD:case k.CLIENT_SEND_MESSAGE:case k.SERVER_SEND_MESSAGE:case k.SERVER_CONFIRM_MESSAGES:case k.SERVER_FETCH_THREADLIST_INFO:case k.SERVER_THREAD_SYNC:return true;case k.SERVER_INITIAL_DATA:return ga.ordered_threadlists;default:return false;}}e.exports=ea;});
__d("MercuryUnseenState",["Arbiter","TimestampConverter","JSLogger","KeyedCallbackManager","MercuryActionTypeConstants","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","MercuryServerRequests","MercuryThreadInformer","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('TimestampConverter'),i=b('JSLogger'),j=b('KeyedCallbackManager'),k=b('MercuryActionTypeConstants'),l=b('MercurySingletonMixin'),m=b('MercuryThreadlistConstants'),n=b('MessagingTag'),o=b('MercuryServerRequests'),p=b('MercuryThreadInformer'),q=b('copyProperties'),r=b('createObjectFrom'),s=m.MAX_UNSEEN_COUNT,t='unseen_thread_hash',u='unseen_thread_list',v=i.create('mercury_unseen_state');function w(ja){this._fbid=ja;this._serverRequests=o.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._initialUnseenCount=0;this._lastSeenTimestamp=0;this._maxCount=false;this._unseenResources=new j();this._serverRequests.subscribe('update-unseen',function(ka,la){ba(this,la);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(ka,la){ha(this,la);}.bind(this));}q(w.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){v.error('unguarded_unseen_count_fetch',{});return 0;}return aa(this);},exceedsMaxCount:function(){return this._maxCount||(aa(this)>s);},markAsSeen:function(){if(aa(this)>0||this._maxCount){this._serverRequests.markSeen();ca(this,h.convertActionIDToTimestamp(this._serverRequests.getLastActionID()),[]);}},markThreadSeen:function(ja,ka){var la={};la[ja]=null;ea(this,la,ka);}});q(w,l);function x(ja,ka){ja._unseenResources.setResource(t,ka);ja._unseenResources.setResource(u,Object.keys(ka));}function y(ja,ka){var la=ja._unseenResources.executeOrEnqueue(t,ka),ma=ja._unseenResources.getUnavailableResources(la);if(ma.length)ja._serverRequests.fetchUnseenThreadIDs();}function z(ja){return ja._unseenResources.getResource(t);}function aa(ja){var ka=ja._unseenResources.getResource(u);if(ka){return ka.length;}else return ja._initialUnseenCount;}function ba(ja,ka){var la=ia(ka);if(ka.unseen_thread_ids){ka.unseen_thread_ids.forEach(function(wa){if(wa.folder!=n.INBOX)return;var xa=ga(ja,wa.thread_ids),ya=ja._lastSeenTimestamp;if(la&&la.seen_timestamp)ya=la.seen_timestamp;ca(ja,ya,xa);if(la&&la.unseen_count>s)ja._maxCount=true;});}else if(la&&la.seen_timestamp){ja._lastSeenTimestamp=la.seen_timestamp;if(la.unseen_count>s){ja._maxCount=true;x(ja,{});}else{ja._initialUnseenCount=la.unseen_count;if(ja._initialUnseenCount===0)x(ja,{});}}else{if(ja._maxCount)return;var ma=ka.actions;if(!ma||!(ma.length))return;var na={},oa={};for(var pa=0;pa<ma.length;pa++){var qa=ma[pa];if(qa.is_forward)continue;var ra=qa.action_type,sa=qa.action_id,ta=qa.thread_id?qa.thread_id:qa.server_thread_id,ua=qa.folder===undefined||qa.folder==n.INBOX;if(!ua)continue;if(ra==k.USER_GENERATED_MESSAGE||ra==k.LOG_MESSAGE){var va=h.isGreaterThan(sa,na[ta]);if(qa.is_unread&&(!na[ta]||va))na[ta]=sa;}else if(ra==k.CHANGE_READ_STATUS&&qa.mark_as_read)oa[ta]=sa;}da(ja,na);ea(ja,oa);}}function ca(ja,ka,la){var ma=z(ja);if(ma===undefined||ka>ja._lastSeenTimestamp||ja._maxCount){ja._lastSeenTimestamp=ka;la=la||[];if(la.length<=s)ja._maxCount=false;var na={},oa=z(ja)||{};for(var pa in oa)if(oa[pa]!==true){var qa=oa[pa];if(fa(ja,qa))na[pa]=qa;}var ra=q(r(la,true),na);x(ja,ra);ja._threadInformer.updatedUnseenState();}}function da(ja,ka){if(ja._maxCount)return;var la={},ma=false;for(var na in ka){var oa=ka[na];if(fa(ja,oa)){la[na]=oa;ma=true;}}if(!ma)return;y(ja,function(pa){for(var qa in la){var ra=la[qa];if(!pa[qa]&&fa(ja,ra))pa[qa]=la[qa];}x(ja,pa);ja._threadInformer.updatedUnseenState();});}function ea(ja,ka,la){var ma=false;for(var na in ka){ma=true;break;}if(ma)y(ja,function(oa){var pa=false;for(var qa in ka){var ra=ka[qa],sa=h.isGreaterThan(ra,oa[qa]);if(oa[qa]&&(!ra||sa)){delete oa[qa];pa=true;}}if(pa){x(ja,oa);ja._threadInformer.updatedUnseenState();if(la&&aa(ja)===0)ja._serverRequests.markSeen();}});}function fa(ja,ka){var la=h.convertActionIDToTimestamp(ka);return la>ja._lastSeenTimestamp;}function ga(ja,ka){return ka.map(ja._serverRequests.convertThreadIDIfAvailable.bind(ja._serverRequests));}function ha(ja,ka){var la=z(ja);if(!la)return;for(var ma in ka){var na=ka[ma];if(la[ma]){la[na]=la[ma];delete la[ma];}}x(ja,la);}function ia(ja){var ka=(ja.message_counts||[]);for(var la=0;la<ka.length;la++)if(ka[la].folder==n.INBOX)return ka[la];return null;}g.subscribe(i.DUMP_EVENT,function(ja,ka){ka.messaging=ka.messaging||{};ka.messaging.unseen={};ka.messaging.unseen_max_count={};ka.messaging.unseen_time={};var la=w._getInstances();for(var ma in la){ka.messaging.unseen[ma]=q({},z(la[ma]));ka.messaging.unseen_max_count[ma]=la[ma]._maxCount;ka.messaging.unseen_time[ma]=la[ma]._lastSeenTimestamp;}});e.exports=w;});
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MessagingTag","MercuryStatusTemplates","Tooltip","URI","WebMessengerPermalinkConstants","cx","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryActionStatus'),k=b('MercuryErrorInfo'),l=b('MessagingTag'),m=b('MercuryStatusTemplates'),n=b('Tooltip'),o=b('URI'),p=b('WebMessengerPermalinkConstants'),q=b('cx'),r=b('tx'),s={renderParticipantListWithNoThreadName:function(u,v,w,x,y,z){var aa={callback:true,check_length:true,show_unread_count:true};z=z||{};var ba={};for(var ca in z)if(aa[ca]){ba[ca]=z[ca];delete z[ca];}var da=w.map(function(ia){return x[ia];}),ea=this.renderRawParticipantList(u,da,w.length,z);ea=this.renderRawTitleWithUnreadCount(ea,ba.show_unread_count?v.unread_count:0);var fa=z.abbr_mode,ga={};for(var ha in z)ga[ha]=z[ha];ga.abbr_mode=true;y.forEach(function(ia){var ja=y.length>1?this._cloneIfDOMElement(ea):ea;i.setContent(ia,ja);if(ba.check_length&&!fa&&ia.scrollWidth>ia.clientWidth){var ka=this.renderRawParticipantList(u,da,w.length,ga),la=this.renderRawTitleWithUnreadCount(ka,ba.show_unread_count?v.unread_count:0);i.setContent(ia,la);}}.bind(this));ba.callback&&ba.callback(ea);},renderRawParticipantList:function(u,v,w,x){var y={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};x=x||{};var z=null;if(x.names_renderer){z=x.names_renderer(v);}else z=v.map(function(ca){return ca.name;});var aa=null;if(z.length===0){if(!u){aa="New Message";}else aa="No Participants";}else if(z.length==1){aa=z[0];}else if(z.length==2){var ba={participant1:z[0],participant2:z[1]};if(x.last_separator_uses_and){aa=r._("{participant1} and {participant2}",ba);}else aa=r._("{participant1}, {participant2}",ba);}else if(x.last_separator_uses_and){if(x.abbr_mode){aa=r._("{participant1} and {others_link}",{participant1:z[0],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-1})});}else if(z.length==3){aa=r._("{participant1}, {participant2} and {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2} and {others_link}",{participant1:z[0],participant2:z[1],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-2})});}else if(z.length==3){aa=r._("{participant1}, {participant2}, {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:z[0],participant2:z[1],participant3:z[2],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-3})});if(Array.isArray(aa))aa=i.create('span',{},aa);return aa;},renderRawTitleWithUnreadCount:function(u,v){var w=u;if(v&&v>1)w=i.create('span',{},r._("{conversation_title} ({unread_count})",{conversation_title:u,unread_count:v}));return w;},renderRawParticipantCount:function(u,v){var w=v.render_subset,x;if(!w){x=v.count>1?r._("{num} people",{num:v.count}):"1 person";}else x=v.count>1?r._("{others_count} others",{others_count:v.count}):"1 other";return x;},renderShortNames:function(u){if(u.length==1)return [u[0].name];return u.map(function(v){return v.short_name;});},getUserCanonicalTitanURL:function(u,v,w){var x=new o().setSubdomain('www'),y=u.substr(u.indexOf(':')+1);x.setPath(t(w)+'/'+y);v&&v(x.toString());return x.toString();},getTitanURLWithServerID:function(u,v,w){var x=new o().setSubdomain('www');x.setPath(p.getURIPathForThreadID(u,t(w)));v&&v(x.toString());return x.toString();},renderUserCanonicalTitanLink:function(u,v,w,x){var y=this.getUserCanonicalTitanURL(u,null,x);v.setAttribute('href',y);w&&w();},renderTitanLinkWithServerID:function(u,v,w,x){var y=this.getTitanURLWithServerID(u,null,x);v.setAttribute('href',y);w&&w();},renderStatusIndicator:function(u,v,w){var x;if(u==j.RESENDING){x=this.renderResendIndicator();}else if(u!==undefined&&u!=j.UNSENT&&u!=j.UNCONFIRMED&&u!=j.SUCCESS)x=this.renderErrorIndicator(v,w);return x;},renderResendIndicator:function(){return m[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(u,v){if(!u)return null;var w=m[':fb:mercury:error-indicator'].render(),x=u.is_transient,y=k.getMessage(u);if(x)if(k.isConnectionError(u)){y=r._("{message} Check your network connection or click to try again.",{message:y});}else y=r._("{message} Click to send again.",{message:y});n.set(w,y,'above','center');if(v&&x){g.listen(w,'click',v);w.setAttribute('tabindex','0');h.addClass(w,"_55q-");}return w;},_cloneIfDOMElement:function(u){if(u.cloneNode){return u.cloneNode();}else return u;}};function t(u){var v=p.BASE_PATH;if(u&&u!=l.INBOX)v+='/'+u;return v;}e.exports=s;});
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryParticipants","MercuryDelayedRoger","MercuryThreads"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('MercuryParticipants'),k=b('MercuryDelayedRoger'),l=b('MercuryThreads').get(),m={},n={updateOnSeenChange:function(p,q){m[p.tagName]=true;h.set(p,'thread-id',q.thread_id);g.addClass(p,'seenByListener');o(p,q);}};function o(p,q){var r=q.participants.filter(function(t){return t!==j.user;}),s=q.participants.length>0&&q.participants[0]===j.user;g.conditionClass(p,'repliedLast',s);g.conditionClass(p,'seenByAll',s&&k.getSeenBy(q.thread_id).length===r.length);}k.subscribe('state-changed',function(p,q){for(var r in m){var s=i.scry(document.body,r+'.seenByListener');for(var t=0;t<s.length;t++){var u=s[t],v=h.get(u,'thread-id');if(q[v])l.getThreadMeta(v,function(w){o(u,w);});}}});e.exports=n;});
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","HTML","JSLogger","MercuryAttachment","MercuryAttachmentType","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadMetadataRawRenderer","MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","MercurySeenByAll","MercuryServerRequests","SplitImage.react","Style","MercuryThreadlistIconTemplates","MercuryThreads","Tooltip","URI","arrayContains","createArrayFrom","copyProperties","cx","formatDate","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Emoji'),j=b('HTML'),k=b('JSLogger'),l=b('MercuryAttachment'),m=b('MercuryAttachmentType'),n=b('MercuryMessageSourceTags'),o=b('MercurySingletonMixin'),p=b('MercuryThreadMetadataRawRenderer'),q=b('MercuryParticipants'),r=b('MercuryParticipantsConstants'),s=b('Pixelz.react'),t=b('React'),u=b('MercurySeenByAll'),v=b('MercuryServerRequests'),w=b('SplitImage.react'),x=b('Style'),y=b('MercuryThreadlistIconTemplates'),z=b('MercuryThreads'),aa=b('Tooltip'),ba=b('URI'),ca=b('arrayContains'),da=b('createArrayFrom'),ea=b('copyProperties'),fa=b('cx'),ga=b('formatDate'),ha=b('tx'),ia=k.create('wm_timestamp');function ja(pa){this._fbid=pa;this._serverRequests=v.getForFBID(pa);this._threads=z.getForFBID(pa);}ea(ja,o);ea(ja.prototype,{renderTimestamp:function(pa,qa,ra,sa){if(sa){if(!qa){ia.warn('no_title');qa=(new Date(sa)).toLocaleDateString();}pa.setAttribute('title',qa);pa.setAttribute('data-utime',sa/1000);if(!ra){ia.warn('no_display');ra=ga(new Date(sa),'g:ia');}h.setContent(pa,ra);g.show(pa);}},renderMessageSourceTags:function(pa,qa,ra,sa){var ta='',ua='',va='';if(ca(ra,n.MESSENGER)){ta="Sent from Messenger";ua=new ba('/mobile/messenger');va="_9g";}else if(ca(ra,n.MOBILE)){ta="Sent from Mobile";ua=new ba('/mobile/');va="_9j";}else if(ca(ra,n.CHAT)){ta="Sent from chat";va="_9h";}else if(ca(ra,n.EMAIL)){if(sa){ta=ha._("Sent from {email}",{email:sa});}else ta="Sent from email";va="_9i";}if(va){aa.set(pa,ta);g.addClass(qa,va);if(ua){pa.setAttribute('href',ua);}else pa.removeAttribute('href');}else g.hide(pa);},renderMessageLocation:function(pa,qa,ra){var sa=ba('/ajax/messaging/hovercard/map.php').setQueryData(ra);pa.setAttribute('data-hovercard',sa);g.removeClass(pa,"_b9");g.show(qa);},renderSpoofWarning:function(pa,qa,ra){if(qa){g.addClass(pa,"_sa");aa.set(pa,ha._("Unable to confirm {name_or_email} as the sender.",{name_or_email:ra.name}));}},renderChatSpoofWarning:function(pa,qa,ra){if(qa)h.appendContent(pa,ha._("Unable to confirm {name_or_email} as the sender.",{name_or_email:ra.name}));},renderCoreThreadlist:function(pa,qa,ra,sa,ta){sa=sa||{};this.renderThreadImage(pa,qa.getNode('image'));var ua=qa.getNode('accessibleName'),va=[qa.getNode('name')];if(ua)va.push(ua);oa(this,pa,va,sa);if(pa.folder&&ta)na(qa.getNode('folderBadge'),pa.folder);var wa=qa.getNode('timestamp');this.renderTimestamp(wa,pa.timestamp_absolute,pa.timestamp_relative,pa.timestamp);this.renderSnippet(pa,qa.getNode('snippet'));la(qa,pa);ra(qa,pa);},renderAndSeparatedParticipantList:function(pa,qa,ra){ra=ra||{};ra.last_separator_uses_and=true;this._threads.getThreadMeta(pa,function(sa){oa(this,sa,qa,ra);}.bind(this));},renderSnippet:function(pa,qa){var ra=false,sa=h.create('span');g.addClass(sa,'MercuryRepliedIndicator');h.appendContent(qa,sa);u.updateOnSeenChange(sa,pa);var ta=pa.snippet;if(ta){if(pa.snippet_has_attachment)h.appendContent(qa,h.create('span',{className:'MercuryAttachmentIndicator'}));if(pa.is_forwarded_snippet)h.appendContent(qa,h.create('strong',{className:"_55q_"},"Forwarded Message:"));if(ta.substr(0,4)=='?OTR'){ta="[encrypted message]";}else ta=ta.replace(/\r\n|[\r\n]/g," ");ta=j(i.htmlEmojiAndEmote(ta));}else{if(pa.is_forwarded_snippet)h.appendContent(qa,h.create('strong',{className:"_55q_"},"Forwarded Message"));if(pa.snippet_has_attachment&&pa.snippet_attachments&&pa.snippet_attachments.length){ra=true;ta=h.create('span');ma(this,pa,ta);}}var ua=pa.participants.length;if(pa.is_subscribed)ua--;if(!ra&&pa.snippet_sender&&q.getIDForUser(this._fbid)!=pa.snippet_sender&&ua>1){q.get(pa.snippet_sender,function(va){if(va.short_name){h.appendContent(qa,ha._("{name}: {conversation_snippet}",{name:va.short_name,conversation_snippet:ta}));}else h.appendContent(qa,ta);});}else h.appendContent(qa,ta);},getTitanURL:function(pa,qa,ra){if(pa.substr(0,pa.indexOf(':'))=='user'){p.getUserCanonicalTitanURL(pa,qa,ra);}else this._serverRequests.getServerThreadID(pa,function(sa){p.getTitanURLWithServerID(sa,qa,ra);});},renderTitanLink:function(pa,qa,ra,sa){if(pa.substr(0,pa.indexOf(':'))=='user'){p.renderUserCanonicalTitanLink(pa,qa,ra,sa);}else this._serverRequests.getServerThreadID(pa,function(ta){p.renderTitanLinkWithServerID(ta,qa,ra,sa);});},renderThreadImage:function(pa,qa){if(pa.image_src){var ra=s({height:r.BIG_IMAGE_SIZE,resizeMode:'cover',src:pa.image_src,width:r.BIG_IMAGE_SIZE});t.renderComponent(ra,qa);return;}var sa=q.getIDForUser(this._fbid),ta=[],ua=pa.participants.filter(function(va){return va!=sa;});if(!ua.length){ta=[sa];}else if(ua.length==1){ta=[ua[0]];}else ta=ua.slice(0,3);this.renderParticipantImages(ta,qa);},renderParticipantImages:function(pa,qa){q.getOrderedBigImageMulti(pa,function(ra){var sa=w({srcs:ra,border:true,size:r.BIG_IMAGE_SIZE});t.renderComponent(sa,qa);});},renderParticipantList:function(pa,qa,ra,sa){return p.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(pa),qa,ra,sa);},renderThreadNameAndParticipantList:function(pa,qa,ra,sa){var ta=p.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(pa),qa,ra,sa),ua=this._threads.getThreadMetaNow(pa);if(!ua.name)return ta;return ha._("{conversation_name} [with {participant_list}]",{conversation_name:ua.name,participant_list:ta});},renderParticipantCount:function(pa,qa){return p.renderRawParticipantCount(this._serverRequests.getServerThreadIDNow(pa),qa);}});function ka(pa){if(!pa.snippet_attachments)return [];return pa.snippet_attachments.filter(function(qa){return qa.attach_type===m.PHOTO;});}function la(pa,qa){var ra=ka(qa);if(ra.length===0)return;var sa=ra[0].thumbnail_url;if(!sa)return;var ta=(ra.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',ua=pa.getNode(ta);if(!ua)return;var va=h.find(ua,'i');x.set(va,'background-image','url('+sa+')');g.show(ua);}function ma(pa,qa,ra){var sa=qa.snippet_sender&&q.getIDForUser(pa._fbid)==qa.snippet_sender,ta=function(ya){if(!qa.snippet_sender||sa){ya(null);return;}q.get(qa.snippet_sender,function(za){ya(za.short_name);});},ua=ka(qa),va=ua.length==qa.snippet_attachments.length,wa=qa.snippet_attachments.length===1&&qa.snippet_attachments[0].metadata&&qa.snippet_attachments[0].metadata.type=='fb_voice_message',xa=qa.snippet_attachments.length===1&&qa.snippet_attachments[0].attach_type===m.STICKER;ta(function(ya){var za=null;if(va){var ab=y[':fb:mercury:attachment-icon-text'].build().getRoot();if(ua.length===1){za=sa?"You sent a photo.":ha._("{name} sent a photo.",{name:ya});}else za=sa?ha._("You sent {num_photos} photos.",{num_photos:ua.length}):ha._("{name} sent {num_photos} photos.",{name:ya,num_photos:ua.length});g.addClass(ab,l.getAttachIconClass(ua[0].icon_type));h.appendContent(ab,za);h.appendContent(ra,ab);}else if(wa){var bb=y[':fb:mercury:attachment-icon-text'].build().getRoot();za=sa?"You sent a voice message.":ha._("{name} sent a voice message.",{name:ya});g.addClass(bb,l.getAttachIconClass(qa.snippet_attachments[0].icon_type));h.appendContent(bb,za);h.appendContent(ra,bb);}else if(xa){za=sa?"You sent a sticker.":ha._("{name} sent a sticker.",{name:ya});h.appendContent(ra,za);}else qa.snippet_attachments.filter(function(cb){return cb.attach_type==m.FILE||cb.attach_type==m.PHOTO;}).forEach(function(cb){var db=y[':fb:mercury:attachment-icon-text'].build().getRoot();h.appendContent(db,cb.name);g.addClass(db,l.getAttachIconClass(cb.icon_type));h.appendContent(ra,db);});});}function na(pa,qa){da(pa).forEach(function(ra){h.setContent(ra,qa);});}function oa(pa,qa,ra,sa){ra=da(ra);if(qa.name){var ta=p.renderRawTitleWithUnreadCount(qa.name,sa.show_unread_count?qa.unread_count:0);ra.forEach(function(va){h.setContent(va,ta);});sa.callback&&sa.callback(ta);return;}var ua=qa.participants;if(qa.participants.length>1)ua=qa.participants.filter(function(va){return va!=q.getIDForUser(pa._fbid);});q.getMulti(ua,function(va){p.renderParticipantListWithNoThreadName(pa._serverRequests.getServerThreadIDNow(qa.thread_id),qa,ua,va,ra,sa);});}e.exports=ja;});
__d("escapeRegex",[],function(a,b,c,d,e,f){function g(h){return h.replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1");}e.exports=g;});
__d("MercuryThreadSearchUtils",["escapeRegex","TokenizeUtil"],function(a,b,c,d,e,f){var g=b('escapeRegex'),h=b('TokenizeUtil'),i={wordsInString:function(j){return (j||'').split(/\s+/).filter(function(k){return k.trim().length>0;});},anyMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(k(j[l]))return true;return false;},allMatchPredicate:function(j,k){for(var l=0;l<j.length;l++)if(!k(j[l]))return false;return true;},queryWordMatchesAnyNameWord:function(j,k){var l=new RegExp('\\b'+g(j),'i');return this.anyMatchPredicate(k,function(m){var n=h.parse(m).flatValue;return l.test(n);});},queryMatchesName:function(j,k){var l=this.wordsInString(j),m=this.wordsInString(k);return this.allMatchPredicate(l,function(n){return this.queryWordMatchesAnyNameWord(n,m);}.bind(this));}};e.exports=i;});
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__d("Poller",["ArbiterMixin","AsyncRequest","Cookie","Env","copyProperties","emptyFunction","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('Cookie'),j=b('Env'),k=b('copyProperties'),l=b('emptyFunction'),m=b('mixin'),n=m(g);for(var o in n)if(n.hasOwnProperty(o)&&o!=="_metaprototype")q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(t){this._config=k({clearOnQuicklingEvents:true,setupRequest:l,interval:null,maxRequests:Infinity,dontStart:false},t);if(!this._config.dontStart)this.start();}q.prototype.start=function(){if(this._polling)return this;this._requests=0;this.request();return this;};q.prototype.stop=function(){this._cancelRequest();return this;};q.prototype.mute=function(){this._muted=true;return this;};q.prototype.resume=function(){if(this._muted){this._muted=false;if(!this._handle&&this._polling)return this.request();}return this;};q.prototype.skip=function(){this._skip=true;return this;};q.prototype.reset=function(){return this.stop().start();};q.prototype.request=function(){this._cancelRequest();this._polling=true;if(!s())return this._done();if(this._muted)return this;if(++this._requests>this._config.maxRequests)return this._done();var t=new h(),u=false;t.setInitialHandler(function(){return !u;});this._cancelRequest=function(){u=true;this._cleanup();}.bind(this);t.setFinallyHandler(r.bind(this));t.setInitialHandler=l;t.setFinallyHandler=l;this._config.setupRequest(t,this);if(this._skip){this._skip=false;r.bind(this).defer();}else t.send();return this;};q.prototype.isPolling=function(){return this._polling;};q.prototype.isMuted=function(){return this._muted;};q.prototype.setInterval=function(t){if(t){this._config.interval=t;this.start();}};q.prototype.getInterval=function(){return this._config.interval;};q.prototype._cleanup=function(){if(this._handle)clearTimeout(this._handle);this._handle=null;this._cancelRequest=l;this._polling=false;};q.prototype._done=function(){this._cleanup();this.inform('done',{sender:this});return this;};q.MIN_INTERVAL=2000;k(q.prototype,{_config:null,_requests:0,_muted:false,_polling:false,_skip:false,_cancelRequest:l});function r(){if(!this._polling)return;if(this._requests<this._config.maxRequests){var t=this._config.interval;t=typeof t==='function'?t(this._requests):t;this._handle=this.request.bind(this).defer((t>q.MIN_INTERVAL)?t:q.MIN_INTERVAL,this._config.clearOnQuicklingEvents);}else this._done();}function s(){return j.user==i.get('c_user');}e.exports=q;});
__d("SystemEvents",["Arbiter","Env","ErrorUtils","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('ErrorUtils'),j=b('UserAgent'),k=b('copyProperties'),l=new g(),m=[],n=1000;setInterval(function(){for(var w=0;w<m.length;w++)m[w]();},n,false);function o(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var p=h.user,q=navigator.onLine;function r(){if(!q){q=true;l.inform(l.ONLINE,q);}}function s(){if(q){q=false;l.inform(l.ONLINE,q);}}if(j.ie()){if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=r;document.body.onoffline=s;});}else m.push(function(){(navigator.onLine?r:s)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}var t=p;m.push(function(){var w=o();if(t!=w){l.inform(l.USER,w);t=w;}});var u=Date.now();function v(){var w=Date.now(),x=w-u,y=x<0||x>10000;u=w;if(y)l.inform(l.TIME_TRAVEL,x);return y;}m.push(v);m.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});k(l,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(w){return (w||o())==p;},isOnline:function(){return j.chrome()||q;},checkTimeTravel:v});e.exports=l;});
__d("setIntervalAcrossTransitions",[],function(a,b,c,d,e,f){function g(h,i){return setInterval(h,i,false);}e.exports=g;});
__d("PresenceCookieManager",["Cookie","Dcode","ErrorUtils","Env","JSLogger","PresenceUtil","URI","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Dcode'),i=b('ErrorUtils'),j=b('Env'),k=b('JSLogger'),l=b('PresenceUtil'),m=b('URI'),n=b('PresenceInitialData'),o=n.cookieVersion,p=n.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=h.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===j.user))return t;}catch(y){u.warn('getcookie_error');}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v)return;var z={v:o,time:w(),user:j.user};for(var aa in r)z[aa]=i.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+h.encode(ba);if(l.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=m.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;});
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","copyProperties","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ErrorUtils'),i=b('JSLogger'),j=b('PresenceCookieManager'),k=b('copyProperties'),l=b('debounceAcrossTransitions'),m=b('setIntervalAcrossTransitions'),n=b('PresenceInitialData'),o=n.cookiePollInterval||2000,p=[],q=[],r=null,s=null,t=0,u=null,v=0,w=['sb2','t2','lm2','uct2','tr','tw','at','wml'],x=i.create('presence_state');function y(){return j.getSubCookie('state');}function z(){t=Date.now();j.store();da(s);}var aa=l(z,0);function ba(ia){if(typeof ia=='undefined'||isNaN(ia)||ia==Number.POSITIVE_INFINITY||ia==Number.NEGATIVE_INFINITY)ia=0;return ia;}function ca(ia){var ja={};if(ia){w.forEach(function(ma){ja[ma]=ia[ma];});if(t<ia.ut)x.error('new_cookie',{cookie_time:ia.ut,local_time:t});}ja.ut=t;for(var ka=0,la=p.length;ka<la;ka++)h.applyWithGuard(p[ka],null,[ja]);s=ja;return s;}function da(ia){v++;t=ba(ia.ut);if(!r)r=m(ga,o);s=ia;if(u===null)u=ia;for(var ja=0,ka=q.length;ja<ka;ja++)h.applyWithGuard(q[ja],null,[ia]);v--;}function ea(ia){if(ia&&ia.ut)if(t<ia.ut){return true;}else if(ia.ut<t)x.error('old_cookie',{cookie_time:ia.ut,local_time:t});return false;}function fa(){var ia=y();if(ea(ia))s=ia;return s;}function ga(){var ia=y();if(ea(ia))da(ia);}j.register('state',ca);g.subscribe(i.DUMP_EVENT,function(ia,ja){ja.presence_state={initial:k({},u),state:k({},s),update_time:t,sync_paused:v,poll_time:o};});(function(){var ia=fa();if(ia){da(ia);}else{x.debug('no_cookie_initial');da(ca());return;}})();var ha={doSync:function(ia){if(v)return;if(ia){z();}else aa();},registerStateStorer:function(ia){p.push(ia);},registerStateLoader:function(ia){q.push(ia);},get:function(){return fa();},getInitial:function(){return u;},verifyNumber:ba};e.exports=ha;});
__d("legacy:adware-scanner",["AdwareScaner"],function(a,b,c,d){a.AdwareScaner=b('AdwareScaner');},3);
__d("TypingDetector",["Event","function-extensions","ArbiterMixin","Input","Run","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('ArbiterMixin'),i=b('Input'),j=b('Run'),k=b('copyProperties'),l=b('createObjectFrom'),m=b('emptyFunction');function n(o){this._input=o;this._ignoreKeys={};}n.INACTIVE=0;n.TYPING=1;n.QUITTING=2;k(n.prototype,h,{_timeout:7000,_currentState:n.INACTIVE,init:function(){this.init=m;this.reset();g.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=n.INACTIVE;},setIgnoreKeys:function(o){this._ignoreKeys=l(o);},_onunload:function(){if(this._currentState==n.TYPING)this._transition(n.QUITTING);},_update:function(event){var o=g.getKeyCode(event),p=this._currentState;if(!this._ignoreKeys[o])if(i.getValue(this._input).trim().length===0){if(p==n.TYPING)this._transition(n.INACTIVE);}else if(p==n.TYPING){this._recordKeystroke();}else if(p==n.INACTIVE){this._transition(n.TYPING);this._recordKeystroke();}},_transition:function(o){this.reset();this._currentState=o;this.inform('change',o);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=this._checkTyping.bind(this).defer(this._timeout);},_checkTyping:function(){var o=this._lastKeystrokeTime+this._timeout,p=Date.now();if(p>o){this._transition(n.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=this._checkTyping.bind(this).defer(o-p+10);}}});e.exports=n;});
__d("URLMatcher",[],function(a,b,c,d,e,f){var g='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',h='\u2000-\u206F\u00ab\u00bb\uff08\uff09',i='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',j='(?:(?:ht|f)tps?)://',k='(?:(?:'+i+'[.]){3}'+i+')',l='\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]',m='(?:\\b)www\\d{0,3}[.]',n='[^\\s'+g+h+']',o='(?:(?:(?:[.:\\-_%@]|'+n+')*'+n+')|'+l+')',p='(?:[.][a-z]{2,4})',q='(?::\\d+){0,1}',r='(?=[/?#])',s='(?:'+'(?:'+j+o+q+')|'+'(?:'+k+q+')|'+'(?:'+l+q+')|'+'(?:'+m+o+p+q+')|'+'(?:'+o+p+q+r+')'+')',t='[/#?]',u='\\([^\\s()<>]+\\)',v='[^\\s()<>?#]+',w=new RegExp(s,'im'),x='^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]',y=new RegExp(x,'im'),z='(?:'+'(?:'+t+')'+'(?:'+'(?:'+u+'|'+v+')*'+')*'+')*',aa=new RegExp('('+'(?:'+s+')'+'(?:'+z+')'+')','im'),ba=new RegExp('('+'(?:'+j+o+q+')|'+'(?:'+m+o+p+q+')'+')'),ca=/[\s'";]/,da=new RegExp(t,'im'),ea=new RegExp('[\\s!"#%&\'()*,-./:;<>?@[\\]^_`{|}\u00ab\u00bb\u2000-\u206F\uff08\uff09]','im'),fa=new RegExp('[\\s()<>?#]','im'),ga=new RegExp('\\s()<>'),ha=function(oa){if(oa&&oa.indexOf('@')!=-1){return (ba.exec(oa))?oa:null;}else return oa;},ia=function(oa){return ja(oa,aa);},ja=function(oa,pa){var qa=(pa.exec(oa)||[])[1]||null;return ha(qa);},ka=function(oa){return w.exec(oa);},la=function(oa){return !ca.test(oa.charAt(oa.length-1));},ma=function(oa){do{var pa=w.exec(oa);if(!pa)return null;var qa=false;if(pa[0][0]==='['&&pa.index>0&&oa[pa.index-1]==='@'){var ra=y.exec(pa[0]);if(ra){qa=true;oa=oa.substr(pa.index+ra[0].length);}}}while(qa);var sa=oa.substr(pa.index+pa[0].length);if(sa.length===0||!(da.test(sa[0])))return ha(pa[0]);var ta=0,ua=0,va=1,wa=0,xa=ua;for(var ya=1;ya<sa.length;ya++){var za=sa[ya];if(xa===ua){if(za==='('){wa=wa+1;xa=va;}else if(da.test(za)||!(ea.test(za))){ta=ya;}else if(fa.test(za))break;}else if(za==='('){wa=wa+1;}else if(za===')'){wa=wa-1;if(wa===0){xa=ua;ta=ya;}}else if(ga.test(za))break;}return ha(pa[0]+sa.substring(0,ta+1));},na={};na.permissiveMatch=ia;na.matchToPattern=ja;na.matchHost=ka;na.trigger=la;na.match=ma;e.exports=na;});