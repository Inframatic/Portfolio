/*!CK:2073120697!*//*1375847434,173220387*/

if (self.CavalryLogger) { CavalryLogger.start_js(["mUaOO"]); }

__d("legacy:UIControllerRegistry",[],function(a,b,c,d){a.__UIControllerRegistry=a.__UIControllerRegistry||{};},3);
__d("UIIntentionalStreamRefresh",["Arbiter","LiveTimer","Run","UIIntentionalStreamMessage","UserActivity","coalesce","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('LiveTimer'),i=b('Run'),j=b('UIIntentionalStreamMessage'),k=b('UserActivity'),l=b('coalesce'),m=b('copyProperties');function n(o,p){this.isAutoRefreshing=false;this.lastRefresh=Date.now();n.instance=this;this.setAutoRefreshConfig(o);this.updateConfigHandler=g.subscribe(j.UPDATE_AUTOREFRESH_CONFIG,this.updateAutoRefreshConfig.bind(this));this.updateRefreshTimeHandler=g.subscribe(j.UPDATE_LAST_REFRESH_TIME,this.updateLastRefreshTime.bind(this));i.onLeave(this.unload.bind(this));this.userActivity();this.uaToken=k.subscribe(this.userActivity.bind(this));this.autoRefreshInterval=setInterval(this.checkAutoPageRefresh.bind(this),this.checkAutoRefreshTimeInterval);this.activeRefreshInterval=setInterval(this.checkActiveRefresh.bind(this),this.checkActiveRefreshTimeInterval);this.enableAutoRefresh(p);g.subscribe(j.UPDATE_STREAM,h.loop.bind(h,true));g.subscribe(j.REFRESH_STREAM,h.loop.bind(h,true));}m(n,{DISABLE_AUTOREFRESH_TIME:4*60*1000,CHECK_AUTOREFRESH_INTERVAL:5*60*1000,AUTOREFRESH_INACTIVE_TIME:30*60*1000,CHECK_ACTIVE_REFRESH_TIME:5*60*1000,ACTIVE_REFRESH_TIME:30*1000});m(n.prototype,{updateAutoRefreshConfig:function(o,p){if(o==j.UPDATE_AUTOREFRESH_CONFIG)this.setAutoRefreshConfig(p);},updateLastRefreshTime:function(o){if(o==j.UPDATE_LAST_REFRESH_TIME)this.lastRefresh=Date.now();},setAutoRefreshConfig:function(o){o=o||{};var p=24*60*60*1000;if(!this.storyInterval)this.storyInterval=l(o.story_interval,null);this.allowAutoRefresh=l(o.allow_auto_refresh,false);this.inactiveThreshold=l(o.inactive_threshold,0);this.activeRefreshTime=l(o.fast_refresh_rate,p);this.inactiveRefreshTime=l(o.slow_refresh_rate,p);this.allowPolling=l(o.allow_polling,false);this.refreshFactor=l(o.refresh_factor,10);this.minRefreshInterval=l(o.min_refresh_interval,60*1000);this.activeRefresh=l(o.active_refresh,false);this.checkActiveRefreshTimeInterval=l(o.check_active_refresh_interval,n.CHECK_ACTIVE_REFRESH_TIME);this.activeRefreshTimeInterval=l(o.active_refresh_interval,n.ACTIVE_REFRESH_TIME);this.disableAutoRefreshTime=l(o.disable_autorefresh_time,n.DISABLE_AUTOREFRESH_TIME);this.checkAutoRefreshTimeInterval=l(o.check_autorefresh_time_interval,n.CHECK_AUTOREFRESH_INTERVAL);this.autoRefreshInactiveTime=l(o.autorefresh_inactive_time,n.AUTOREFRESH_INACTIVE_TIME);return this;},unload:function(){this.enableAutoRefresh(false);this.cleanupRefreshInterval();k.unsubscribe(this.uaToken);this.updateConfigHandler&&this.updateConfigHandler.unsubscribe();this.updateRefreshTimeHandler&&this.updateRefreshTimeHandler.unsubscribe();},userActivity:function(){var o=this.isInactive();this.lastActivity=Date.now();this.isAutoRefreshing=true;if(o&&this.canAutoRefresh())this.runAutoRefresh();return true;},isInactive:function(){return this.getMSSinceLastActivity()>this.inactiveThreshold;},getMSSinceLastActivity:function(){return Date.now()-this.lastActivity;},getMSSinceLastRefresh:function(){return Date.now()-this.lastRefresh;},getRefreshInterval:function(){if(this.isInactive()){return this.inactiveRefreshTime;}else if(this.storyInterval!=null){var o=this.storyInterval*this.refreshFactor;return Math.max(o,this.activeRefreshTime);}else return this.activeRefreshTime;},canAutoRefresh:function(){return this.isAutoRefreshing&&this.allowAutoRefresh;},cancelUpdate:function(){if(this.updateTask){clearTimeout(this.updateTask);this.updateTask=null;}},runUpdatePoll:function(){this.updateTask=null;if(this.canAutoRefresh())this.runAutoRefresh();},runAutoRefresh:function(){var o=50;if(this.getMSSinceLastRefresh()>=this.minRefreshInterval-o)g.inform(j.UPDATE_STREAM);this.schedulePoll(this.getRefreshInterval());},schedulePoll:function(o){this.cancelUpdate();if(this.allowPolling)this.updateTask=setTimeout(this.runUpdatePoll.bind(this),o);},enableAutoRefresh:function(o,p){this.isAutoRefreshing=o;if(o){var q=p?0:this.getRefreshInterval();this.schedulePoll(q);}else this.cancelUpdate();},checkAutoPageRefresh:function(){if(!this.allowAutoRefresh)return;if(this.isAutoRefreshing&&(this.getMSSinceLastActivity()>this.disableAutoRefreshTime))this.isAutoRefreshing=false;if(this.getMSSinceLastRefresh()<this.autoRefreshInactiveTime)return;var o=this.getMSSinceLastActivity();if(o>this.autoRefreshInactiveTime)g.inform(j.REFRESH_STREAM,{});},checkActiveRefresh:function(){if(!this.allowAutoRefresh)return;if(this.getMSSinceLastRefresh()<this.activeRefreshTimeInterval)return;if(this.getMSSinceLastActivity()<this.activeRefreshTimeInterval)g.inform(j.UPDATE_STREAM);},cleanupRefreshInterval:function(){if(this.autoRefreshInterval){clearInterval(this.autoRefreshInterval);this.autoRefreshInterval=null;}if(this.activeRefreshInterval){clearInterval(this.activeRefreshInterval);this.activeRefreshInterval=null;}}});e.exports=n;});
__d("UIIntentionalStream",["Animation","Arbiter","AsyncRequest","AsyncResponse","CSS","DataStore","DOM","DOMScroll","Event","HTML","JSLogger","NavigationMessage","OnVisible","PageTransitions","Run","ScrollAwareDOM","Style","UIIntentionalStreamMessage","UIIntentionalStreamRefresh","UIPagelet","URI","Vector","$","clickRefAction","coalesce","copyProperties","createArrayFrom","ge","isEmpty","merge","reportData","startsWith","userAction"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncResponse'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('DOMScroll'),o=b('Event'),p=b('HTML'),q=b('JSLogger'),r=b('NavigationMessage'),s=b('OnVisible'),t=b('PageTransitions'),u=b('Run'),v=b('ScrollAwareDOM'),w=b('Style'),x=b('UIIntentionalStreamMessage'),y=b('UIIntentionalStreamRefresh'),z=b('UIPagelet'),aa=b('URI'),ba=b('Vector'),ca=b('$'),da=b('clickRefAction'),ea=b('coalesce'),fa=b('copyProperties'),ga=b('createArrayFrom'),ha=b('ge'),ia=b('isEmpty'),ja=b('merge'),ka=b('reportData'),la=b('startsWith'),ma=b('userAction');function na(){h.subscribe(x.SET_AUTO_INSERT,oa);}function oa(qa,ra){if(qa!=x.SET_AUTO_INSERT)return;var sa=pa.instance;if(sa)sa.pauseAutoInsert=ra.pause;}function pa(qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab){if(!qa)throw new Error('UIIntentionalStream instantiated with no root.');fa(this,{id:qa.id,root:qa,instanceName:ra,newest:sa,oldest:ta,oldestMR:ta,shouldShowHidden:false,defaultFilter:ua,currentFilterKey:za,sourceType:va,lastSeenTime:ab,hasPendingRefresh:false,pauseAutoInsert:false,error:m.scry(qa,'div.UIIntentionalStream_Error')[0],pager:m.scry(qa,'div.uiMorePager')[0],filterNullState:m.scry(qa,'div.friendListFilterNullState')[0],streamContent:m.find(qa,'.UIIntentionalStream_Content'),requestNum:0,scrollLoadCount:1,maxScrollLoadCount:1,scrollPosition:0,lastViewStateID:0,cachedScrollQID:0,jslog:q.create('stream'),scrollListener:null});this.addScrollTrace('init',{});u.onLeave(this.unload.bind(this));if(!pa.instances)pa.instances={};pa.instances[ra]=this;pa.instance=this;na();this.setupSubscriptions();}fa(pa.prototype,{subscribeToComposerPublish:function(){this.subscriptions.push(h.subscribe('composer/publish',function(event,qa){var ra=ca(qa.composer_id).getAttribute('data-location');if(ra==='maincolumn'&&qa.streamStory)this.addComposerContent(qa.streamStory,500);}.bind(this)));},setupSubscriptions:function(){this.subscriptions=[];this.subscribeToComposerPublish();this.subscriptions.push(h.subscribe(x.UPDATE_STREAM,this.updateStream.bind(this)));this.subscriptions.push(h.subscribe(x.REFRESH_STREAM,this.refreshStream.bind(this)));this.scrollListener=o.listen(window,'scroll',this.checkFirstScroll.bind(this));this.checkFirstScroll();u.onLoad(this.checkFirstStory.bind(this));},tearDownSubscriptions:function(){if(!this.subscriptions)return;this.subscriptions.forEach(h.unsubscribe);this.subscriptions=null;if(this.scrollListener){this.scrollListener.remove();this.scrollListener=null;}},unload:function(){this.addScrollTrace('unload',{});h.inform(x.UNLOAD);this.tearDownSubscriptions();pa.instance=null;pa.instances[this.instanceName]=null;this.clearScrollLoader(true);window.disableScrollLoad=null;y.instance&&y.instance.unload();},_getUpdateInsertType:function(){return pa.REFRESH_PREPEND;},updateStream:function(qa){if(qa!=x.UPDATE_STREAM||this.hasPendingRefresh||this.isAutoRefreshPaused())return;this.loadNewer({showLoader:false,ignoreSelf:true,insertType:this._getUpdateInsertType()});},clearScrollLoader:function(qa){if(this.currentScrollListener){this.currentScrollListener.remove();this.currentScrollListener=null;}if(qa||this.scrollLoadCount>=this.maxScrollLoadCount)window.disableScrollLoad=true;},loadOlderPosts:function(qa){var ra={filter:this.getCurrentFilterKey(),oldest:this.oldest,oldestMR:this.oldestMR,last_seen_time:this.lastSeenTime,scroll_count:this.scrollLoadCount,scroll_position:this.scrollPosition,last_viewstate_id:this.lastViewStateID,cached_scroll_qid:this.cachedScrollQID};this.homeloadID&&(ra.homeload_id=this.homeloadID);ra=ja(ra,qa);this.loadWithParams(ra);},loadWithParams:function(qa){var ra=m.scry(this.root,'div.fbStreamPager.hasMorePosts')[0];if(ra){if(k.hasClass(ra,'async_saving'))return;k.addClass(ra,'async_saving');}this.addScrollTrace('loadwithparams',qa);z.loadFromEndpoint('MoreStoriesPagelet','home_stream',qa,{append:true,usePipe:true});},setScrollLoadCount:function(qa){this.maxScrollLoadCount=qa;},setHomeloadID:function(qa){this.homeloadID=qa;},loadMoreOnScroll:function(qa,ra){if(window.disableScrollLoad)return;var sa=function(){if(window.disableScrollLoad)return;var va=a.ArbiterMonitor;if(va){da('scroll',null,null,'FORCE',{gt:{ua_id:'stream:scroll:auto'}}).set_namespace('stream');var wa=ma('stream').uai('scroll','stream:scroll:auto');va.initUA(wa);}var xa={delay_load_count:ra};this.loadOlderPosts(xa);}.bind(this),ta=m.scry(this.root,'ul.uiStream li.genericStreamStory');if(!ta.length)return;this.addScrollTrace('loadmoreonscroll',{});var ua=ta[ta.length-qa-1];if(ua){this.currentScrollListener=new s(ua,sa,null,0);}else sa();},updateTimeRange:function(qa,ra){if(!this.newest||this.newest<qa){this.newest=qa;this.addScrollTrace('update_newest',{newest:this.newest});}if(!this.oldest||(ra&&(ra<this.oldest))){this.oldest=ra;this.addScrollTrace('update_oldest',{oldest:this.oldest});}},updateOldestMR:function(qa){if(!this.oldestMR||qa<this.oldestMR){this.oldestMR=qa;this.addScrollTrace('update_oldestmr',{oldestmr:this.oldestMR});}},updateScrollPosition:function(qa){this.scrollPosition=qa;this.addScrollTrace('update_scrollposition',{scrollposition:this.scrollPosition});},updateLastViewStateID:function(qa){this.lastViewStateID=qa;this.addScrollTrace('update_lastviewstateid',{lastviewstateid:this.lastViewStateID});},updateCachedScrollQID:function(qa){this.cachedScrollQID=qa;this.addScrollTrace('update_cachedscrollqid',{qid:this.cachedScrollQID});},getID:function(){return this.id;},getCurrentFilterKey:function(){if(this.currentFilterKey)return this.currentFilterKey;var qa=aa.getMostRecentURI().getQueryData();if(qa&&qa.sk){this.currentFilterKey=qa.sk;}else if(qa&&qa.filter){this.currentFilterKey=qa.filter;}else if(this.defaultFilter)this.currentFilterKey=this.defaultFilter;return this.currentFilterKey;},resetFilterKey:function(qa){this.currentFilterKey=qa;},loadOlder:function(qa){qa=qa||{};if(!this.oldest)return;var ra=this.getCurrentParams();ra.oldest=this.oldest;this.refresh(pa.REFRESH_APPEND,ra,qa);return this;},loadNewer:function(qa){if(!this.newest)return;qa=qa||{};var ra=this.getCurrentParams();ra.newest=this.newest;if(qa.ignoreSelf)ra.ignore_self=true;ra.load_newer=true;var sa=ea(qa.insertType,pa.REFRESH_PREPEND);this.refresh(sa,ra,qa);return this;},checkFirstStory:function(){this.logFirstStory('first_story_load');},checkFirstScroll:function(){if(this.scrollListener&&ba.getScrollPosition().y>0){this.scrollListener.remove();this.scrollListener=null;this.logFirstStory('first_scrolling');}},logFirstStory:function(qa){if(!ha('home_stream')||!ha('home_stream').childElementCount||!ha('home_stream').children[0].getAttribute('data-ft'))return;var ra=ha('home_stream').children[0].getAttribute('data-ft'),sa=JSON.parse(ra);if(!(("mf_story_key" in sa)&&("qid" in sa)))return;var ta={mf_story_key:sa.mf_story_key,qid:sa.qid};ka(qa,{ft:ta});},getCurrentParams:function(){var qa={},ra=aa.getMostRecentURI().getQueryData();ra.filter=this.getCurrentFilterKey();var sa=this.getValidParams();if(sa){sa.forEach(function(ta){qa[ta]=ra[ta];});}else qa=ra;return qa;},setHomeFilter:function(qa){this._homeFilter=qa;},setHomeFilterLoading:function(qa){if(this._homeFilter)this._homeFilter.setLoading(qa);},refresh:function(qa,ra,sa){h.inform(x.UPDATE_LAST_REFRESH_TIME);this.homeloadID&&(ra.homeload_id=this.homeloadID);this.addScrollTrace('refresh',{type:qa,data:ra,kwargs:sa});this.currentFilterKey=ra.filter;if(ra.filter==pa.FEED_FILTER_KEY_DUAL_NEWS_FEED){this.currentFilterKey=this.defaultFilter;}else if(pa.isHighlightsFilter(ra.filter)||ra.filter===pa.FEED_FILTER_KEY_NEWS_FEED)this.defaultFilter=this.currentFilterKey;sa=sa||{};var ta=++this.requestNum,ua=ea(sa.showLoader,true),va=this.instanceName,wa=function(ab){pa.getInstance(va).handleResponse(ta,qa,ab,sa);},xa=function(ab){pa.getInstance(va).handleError(ta,qa,ab,sa);},ya=function(ab){pa.getInstance(va).handleFinally(qa,ra.filter,ab);};if(!(ra.request_type=qa))ra.request_type='none';if(ra.filter){sa.show_hidden=ra.show_hidden?ra.show_hidden:false;}else sa.show_hidden=this.shouldShowHidden;ra=fa(this.getCurrentParams(),ra);this.hasPendingRefresh=true;var za=new i().setURI(this.getEndpoint()).setReadOnly(true).setOption('retries',0).setMethod(this.getRefreshMethod()).setData(ra).setHandler(wa).setErrorHandler(xa).setFinallyHandler(ya);if(qa==pa.REFRESH_APPEND&&ua)za.setStatusElement(this.pager);za.send();if(qa==pa.REFRESH_TRANSITION){if(this.pager)this.pager.style.display='none';this.clearScrollLoader();this.oldest=this.newest=null;}if(ua)this.setHomeFilterLoading(true);},addComposerContent:function(qa,ra){if(this.isOnNewsFeedFilter())k.addClass(qa,'uiStreamBoulderHighlight');this.addContentPrepend(qa,ra);},addContentPrepend:function(qa,ra){if(qa.length){ga(qa).reverse().forEach(function(xa){this.addContentPrepend(xa,ra);}.bind(this));return;}var sa,ta=ba.getScrollPosition().y,ua=ba.getElementPosition(this.streamContent).y,va=this.scrollOnPrepend&&ta>=ua;if(va){var wa=function(xa){var ya=m.find(xa,'^li.uiStreamStory');if(!ya)return;l.set(ya,'origHeight',ya.offsetHeight);o.listen(xa,'load',function(){var za=l.get(ya,'origHeight');if(ya.offsetHeight!=za){window.scrollBy(0,ya.offsetHeight-za);l.set(ya,'origHeight',ya.offsetHeight);}});};sa=g.insert.curry(this.streamContent,qa,(function(xa,ya){m.prependContent(this.streamContent,ya);h.inform('reflow');window.scrollBy(0,ya.offsetHeight);m.scry(ya,'img').forEach(wa);}).bind(this));}else sa=(function(){w.set(qa,'opacity',0);v.prependContent(this.streamContent,qa);h.inform('reflow');new g(qa).from('opacity',0).to('opacity',1).duration(400).ondone(function(){h.inform(x.UPDATE_HTML_CONTENT);}).go();}).bind(this);if(ra){k.hide(qa);m.appendContent(document.body,qa);setTimeout(function(){k.show(qa);sa();},ra);}else sa();},addContentAppend:function(qa){m.appendContent(this.streamContent,qa);},handleResponse:function(qa,ra,sa,ta){this.addScrollTrace('handle_response',{requestnum:qa,type:ra,kwargs:ta});ta=ta||{};var ua=sa.getPayload();this.filterNullState&&m.remove(this.filterNullState);if(ia(ua))return;if(ua.autoRefreshConfig)h.inform(x.UPDATE_AUTOREFRESH_CONFIG,ua.autoRefreshConfig);this.setHomeFilterLoading(false);if(ra==pa.REFRESH_EXPAND){var va=m.find(ca(ta.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.hide(va);k.removeClass(va,'UIIntentionalStory_CollapsedStoriesLoading');}if(this.error)this.error.style.display='none';if(qa!=this.requestNum)return;if('show_hidden' in ta)this.shouldShowHidden=ta.show_hidden;if('newestStoryTime' in ua&&ua.newestStoryTime>this.newest)this.newest=ua.newestStoryTime;if(ra!=pa.REFRESH_PREPEND){if('oldestStoryTime' in ua&&(!this.oldest||ua.oldestStoryTime<this.oldest))this.oldest=ua.oldestStoryTime;if('scrollPosition' in ua)this.scrollPosition=ua.scrollPosition;if('lastViewStateID' in ua)this.lastViewStateID=ua.lastViewStateID;if('oldestMRStoryTime' in ua)this.oldestMR=ua.oldestMRStoryTime;if('cachedScrollQID' in ua){this.cachedScrollQID=ua.cachedScrollQID;}else this.cachedScrollQID=0;}if(ua.html){var wa=p(ua.html).getNodes();switch(ra){case pa.REFRESH_PREPEND:this.addContentPrepend(wa);break;case pa.REFRESH_APPEND:this.addContentAppend(wa);this.clearScrollLoader(true);break;case pa.REFRESH_TRANSITION:m.setContent(this.streamContent,wa);this.scrollLoadCount=1;if(!ta.noScroll)n.scrollTo(new ba(0,0,"document"),false);break;case pa.REFRESH_EXPAND:m.insertAfter(ca(ta.expandStoryID),wa);break;case pa.DELAYED_STREAM:this.addContentAppend(wa);break;}h.inform(x.UPDATE_HTML_CONTENT);}},handleError:function(qa,ra,sa,ta){if(qa!=this.requestNum)return;this.setHomeFilterLoading(false);var ua=sa.getError();if(ua==1357001)j.defaultErrorHandler(sa);if(ra==pa.REFRESH_EXPAND){var va=m.find(ca(ta.expandStoryID),'div.UIIntentionalStory_CollapsedStories');k.removeClass(va,'UIIntentionalStory_CollapsedStoriesLoading');}if(!ta.delayLoadCount&&ra!=pa.REFRESH_PREPEND&&this.error)w.set(this.error,'display','block');},handleFinally:function(qa,ra){if(qa==pa.REFRESH_TRANSITION){t.transitionComplete();h.inform(r.NAVIGATION_COMPLETED);}this.hasPendingRefresh=false;},getValidParams:function(){return pa.VALID_PARAMS;},getEndpoint:function(){return pa.ENDPOINT;},getRefreshMethod:function(){return pa.REFRESH_METHOD;},isOnNewHighlights:function(){var qa=this.getCurrentFilterKey();return (pa.isHighlightsFilter(qa)||(qa==pa.FEED_FILTER_KEY_DUAL_NEWS_FEED&&pa.isHighlightsFilter(this.defaultFilter)));},isLiveStreamBox:function(){var qa=this.getCurrentFilterKey();return qa&&qa.indexOf(pa.FEED_FILTER_KEY_LIVE_STREAM_BOX)===0;},isOnNewsFeedFilter:function(){var qa=this.getCurrentFilterKey();return (qa==pa.FEED_FILTER_KEY_NEWS_FEED||pa.isHighlightsFilter(qa)||qa==pa.FEED_FILTER_KEY_DUAL_NEWS_FEED);},isAutoRefreshPaused:function(){if(this.isOnNewHighlights()||this.isLiveStreamBox())return false;return this.pauseAutoInsert;},addScrollTrace:function(qa,ra){this.jslog.debug(qa,ra);},refreshStream:function(qa,ra){if(qa!=x.REFRESH_STREAM)return;var sa=this.getCurrentFilterKey(),ta={filter:sa},ua={filter:sa};ra.noScroll&&(ua.noScroll=1);this.refresh(pa.REFRESH_TRANSITION,ta,ua);},getNewest:function(){return this.newest;}});fa(pa,{ANIMATION_DURATION:300,REFRESH_METHOD:'GET',REFRESH_TRANSITION:1,REFRESH_PREPEND:2,REFRESH_APPEND:3,REFRESH_EXPAND:5,DELAYED_STREAM:6,FEED_FILTER_KEY_NEW_HIGHLIGHTS:'h',FEED_FILTER_KEY_NEWS_FEED:'lf',FEED_FILTER_KEY_DUAL_NEWS_FEED:'nf',FEED_FILTER_KEY_LIVE_STREAM_BOX:'pub',VALID_PARAMS:['filter','show_hidden'],ENDPOINT:'/ajax/intent.php',getInstance:function(qa){return pa.instances[qa];},isHighlightsFilter:function(qa){if(!qa)return false;return la(qa,pa.FEED_FILTER_KEY_NEW_HIGHLIGHTS);},getStoriesByAssoc:function(qa){return m.scry(pa.instance.root,'div.aid_'+qa);}});e.exports=pa;});
__d("FutureHomeSideNav",["Arbiter","AsyncRequest","Class","CSS","DOM","DOMPosition","Event","FutureSideNav","FutureSideNavItem","FutureSideNavSection","NavigationMessage","Parent","UIIntentionalStream","UIPagelet","copyProperties","emptyFunction","ge","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Class'),j=b('CSS'),k=b('DOM'),l=b('DOMPosition'),m=b('Event'),n=b('FutureSideNav'),o=b('FutureSideNavItem'),p=b('FutureSideNavSection'),q=b('NavigationMessage'),r=b('Parent'),s=b('UIIntentionalStream'),t=b('UIPagelet'),u=b('copyProperties'),v=b('emptyFunction'),w=b('ge'),x=b('tx');function y(){this.parent.construct(this);}i.extend(y,n);u(y.prototype,{init:function(){this.parent.init.apply(this,arguments);this.ajaxPipe=true;this.seeAllEndpoint="/ajax/home/generic.php";this.typeSections={favorites:'pinnedNav',profiles:'pinnedNav',apps:'appsNav',groups:'groupsNav',pages:'pagesNav',lists:'listsNav',interests:'interestsNav',connect_apps:'connectNav'};this.switchingFromTitanFixedFrame=false;this._arbiterSubscriptions.push(g.subscribe('titan_fixed_frame_changed',this.handleFixedFrameChanged.bind(this)),g.subscribe(q.NAVIGATION_FAVORITE_UPDATE,this.updateFavorite.bind(this)),g.subscribe(q.NAVIGATION_FIRST_RESPONSE,this.navigationFirstResponse.bind(this)));this._ensureHover('homeSideNav');},initMoreLink:function(ba){this._eventHandlers.push(m.listen(ba,'click',this._showMoreSections.bind(this,ba)));},_showMoreSections:function(ba){var ca=k.scry(this.root,'div.belowThreshold');j.hide(ba);ca.forEach(function(da){j.removeClass(da,'belowThreshold');});},handleFixedFrameChanged:function(ba,ca,da){if(ca){var ea=function(fa,ga){var ha=l.getElementPosition(w(ga)).y;t.loadFromEndpoint(fa,ga,{fixed_frame:ca,selected_key:da,v_pos:ha});};ea('PinnedNavigationPagelet','pagelet_pinned_nav');ea('BookmarkNavigationPagelet','pagelet_bookmark_nav');if(w('chatFriendsOnline'))j.hide(w('chatFriendsOnline'));}else this.switchingFromTitanFixedFrame=true;},handlePageTransition:function(ba){if(this.switchingFromTitanFixedFrame){this.switchingFromTitanFixedFrame=false;return false;}else return this.parent.handlePageTransition(ba);},_initSection:function(ba){var ca=this.parent._initSection(ba);for(var da in this.typeSections){var ea=this.typeSections[da];if(ca.id==ea){var fa=k.scry(ca.node,'h4.navHeader')[0];if(fa){var ga='\/bookmarks\/('+da+')(\/)?';ca.seeall=this._initItem({node:fa,id:ca.id,endpoint:this.seeAllEndpoint,key:['bookmarks'],path:[{regex:ga}]});}}}return ca;},_constructItem:function(ba,ca){return new aa(ba,ca);},_constructSection:function(ba){return new z(ba);},getSection:function(ba){return this.typeSections[ba]&&this.sections[this.typeSections[ba]];},_getItemForKey:function(ba){var ca=this.parent._getItemForKey("nf");if(ca&&ca.matchKey(ba)){return ca;}else return this.parent._getItemForKey(ba);},_isCurrentPath:function(ba){return ((ba.getDomain()===this.uri.getDomain())&&(ba.getPath()==='/'||ba.getPath()==='/home.php'));},_handleMenuClick:function(ba,ca,da,event){if(j.hasClass(da,'favorite')){g.inform(q.NAVIGATION_FAVORITE_UPDATE,{key:ca.numericKey,favorite:!ba.equals(this.getSection("favorites")),movetop:j.hasClass(da,'movetop')});}else this.parent._handleMenuClick(ba,ca,da,event);},removeItemByKey:function(ba){g.inform(q.NAVIGATION_ITEM_REMOVED,ba);this.parent.removeItemByKey(ba);},toggleItemByKey:function(ba,ca){var da=this.getNodeForKey(ba);if(!ca){g.inform(q.NAVIGATION_ITEM_HIDDEN,ba);da&&j.hide(da);}else da&&j.show(da);var ea=this._getItemForKey(ba);this.getSection(ea.type).refresh();},removeItem:function(ba){var ca=this.getSection(ba.type);this.parent.removeItem(ba);ca.refresh();},updateFavorite:function(ba,ca){var da=this._findItem(function(ma){return ma.matchKey(ca.key)&&ma.canFavorite();}),ea=this.getSection("favorites"),fa=v,ga=ca.favorite?ea.addEndpoint:ea.removeEndpoint;if(ca.movetop)ga=ea.editEndpoint;if(!da&&(ca.favorite||ca.movetop)){if(ca.movetop)var ha=k.scry(this.root,'.expandableSideNav'),ia=ha&&ha.length&&j.hasClass(ha[0],'expandedMode');fa=function(){t.loadFromEndpoint('PinnedNavigationPagelet','pagelet_pinned_nav',{expanded:ia});};}else if(!da){fa=function(){t.loadFromEndpoint('BookmarkNavigationPagelet','pagelet_bookmark_nav');};}else{if(ca.movetop){j.show(da.node);this.moveItem(ea,da);var ja=r.byClass(da.node,'uiSideNav');if(ja&&ja.childNodes.length){var ka=r.byClass(k.scry(ja,'.sortableItem')[0],'sideNavItem');k.insertBefore(ka,da.node);j.removeClass(da.node,'hidden');}}else{var la=this.getSection(da.type);if(ca.favorite){j.show(da.node);this.moveItem(ea,da);da.showFavorite();}else if(!la.equals(ea)){this.moveItem(la,da,true);da.hideFavorite();}else this.removeItem(da);la.refresh();}ea.refresh();ca.key=da.numericKey;g.inform('NavigationMessage.FAVORITES_UPDATED');}new h().setURI(ga).setData({id:ca.key,movetop:ca.movetop}).setHandler(fa).send();},_doPageTransition:function(ba,ca){this._unloadStreams();var da=this.parent._doPageTransition(ba,ca);if(da&&(ba.type=='groups'||ba.type=='lists'||ba.type=='interests')){ba.setCount(0);ba.hideUnreadDot();}return da;},_unloadStreams:function(){var ba=window.UIIntentionalStream&&s.instances,ca=['nile','global','friends','blade'];ba&&ca.forEach(function(da){ba[da]&&ba[da].unload();});},navigationFirstResponse:function(){this.setSelected(this.loading);}});function z(ba){this.parent.construct(this,ba);this.editEndpoint='/ajax/bookmark/edit/';this.addEndpoint='/ajax/bookmark/add/';this.removeEndpoint='/ajax/bookmark/delete/';}i.extend(z,p);u(z.prototype,{refresh:function(){var ba=k.scry(this.node,'li.sideNavItem'),ca=k.scry(this.node,'div.actionLinks'),da=ba.some(j.shown);j.conditionShow(k.find(this.node,'h4.navHeader'),da);ca.length&&j.conditionShow(ca[0],da);}});function aa(ba,ca){this.parent.construct(this,ba,ca);}i.extend(aa,o);u(aa.prototype,{canFavorite:function(){return !!this._getFavoriteLabel();},showFavorite:function(){k.setContent(this._getFavoriteLabel(),"Remove from Favorites");},hideFavorite:function(){k.setContent(this._getFavoriteLabel(),"Add to Favorites");},hideUnreadDot:function(){var ba=k.scry(this.node,'img.unreadDot')[0];ba&&j.hide(ba);},_getFavoriteLabel:function(){return k.scry(this.node,'li.favorite span.itemLabel')[0];}});e.exports=y;});
__d("legacy:home-side-nav-future-js",["FutureHomeSideNav"],function(a,b,c,d){a.FutureHomeSideNav=b('FutureHomeSideNav');},3);
__d("getActiveElement",[],function(a,b,c,d,e,f){function g(){try{return document.activeElement;}catch(h){return null;}}e.exports=g;});
__d("FeedBaseKeyboardController",["$","Arbiter","CSS","DOM","DOMScroll","DOMQuery","Event","Focus","Keys","NavigationMessage","Parent","Run","SubscriptionsHandler","Vector","ViewportBounds","copyProperties","ge","getActiveElement","isAsyncScrollQuery","throttle"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('DOMScroll'),l=b('DOMQuery'),m=b('Event'),n=b('Focus'),o=b('Keys'),p=b('NavigationMessage'),q=b('Parent'),r=b('Run'),s=b('SubscriptionsHandler'),t=b('Vector'),u=b('ViewportBounds'),v=b('copyProperties'),w=b('ge'),x=b('getActiveElement'),y=b('isAsyncScrollQuery'),z=b('throttle'),aa=74,ba=75,ca=76,da=67,ea=79,fa;function ga(ia){this.root=ia;this.init();}function ha(){fa=i.hasClass(document.documentElement,'tinyViewport')?0:g('pagelet_bluebar').offsetTop+g('pagelet_bluebar').offsetHeight;}ha.defer();m.listen(window,'resize',z(ha));v(ga.prototype,{getStories:function(){},getParentStory:function(ia){},isStory:function(ia){},isHoldoutStory:function(ia){},getHeadline:function(ia){},getPreviousStory:function(ia){},getNextStory:function(ia){},setSelected:function(ia){},clickLike:function(){},clickComment:function(){},openAttachment:function(){},getScrollOffset:function(){return 10;},getAnimationLength:function(ia){return Math.min(Math.abs(t.getElementPosition(ia).y-u.getTop()-document.body.scrollTop),400);},findTop:function(){var ia=this.getStories();for(var ja=0;ja<ia.length;ja++)if(t.getElementPosition(ia[ja]).y>t.getScrollPosition().y)return ia[ja];},onLeave:function(){this.subscriptions&&this.subscriptions.release();},init:function(){r.onLeave(this.onLeave.bind(this));this.subscriptions=new s();this.subscriptions.addSubscriptions(h.subscribe(p.NAVIGATION_BEGIN,this.onLeave.bind(this)),m.listen(document,'keydown',function(ia){var ja=m.getKeyCode(ia);if(ia.getModifiers().any)return true;var ka=x();if(ka&&i.shown(ka)){var la=this.getParentStory(ka);if(ja!=aa&&ja!=ba&&!la)return true;if(ja!=o.ESC&&this.isInteractive(ka))return true;}switch(ja){case aa:this.vert(1);break;case ba:this.vert(-1);break;case ca:this.clickLike();break;case da:this.clickComment();break;case o.RETURN:if(this.selected.id=='pagelet_composer'||w('pagelet_composer',this.selected)){var ma=j.scry(this.selected,'textarea')[0];ma&&n.set(ma);}else this.clickComment();break;case ea:this.openAttachment();break;case o.ESC:var na=this.findTop();na&&this.setFocused(na);break;default:return;}this.hasUsedKeyboard=true;ia.preventDefault();}.bind(this)),m.listen(document,'focusin',function(ia){var ja=ia.getTarget(),ka=this.getParentStory(ja);if(ka&&(this.selected!=ka)){this.setSelected(ka);if(!this.isInteractive(ja))this.setFocused(ka);}}.bind(this)));},click:function(ia){if(!this.selected)return;var ja;for(var ka=0,la=arguments.length;ka<la;ka++){ja=j.scry(this.selected,arguments[ka])[0];if(ja&&i.shown(ja)){ja.click();return;}}},vert:function(ia){var ja;if(this.selected){if(this.selected.id=='pagelet_composer'){ja=ia>0?this.getStories()[0]:null;if(this.isHoldoutStory(ja))ja=this.getPreviousStory(ja);}else ja=ia>0?this.getNextStory(this.selected):(this.getPreviousStory(this.selected)||w('pagelet_composer'));if(!ja){return;}else if(!l.isElementNode(ja)){i.removeClass(this.selected,'selectedStorySimple');this.selected=ja;return this.vert(ia);}}if(!ja||q.byClass(ja,'hidden_elem')||!j.contains(document,ja)){ja=this.findTop();if(ja&&ia<0)ja=this.getPreviousStory(ja);if(this.isHoldoutStory(ja))ja=this.getPreviousStory(ja);}if(!ja)return;this.anim&&this.anim.stop();var ka=(Date.now()-(this.lastScroll||0)>30),la=this.setFocused.bind(this,ja);if(y()){ka=false;la();la=null;}this.anim=k.scrollTo(ja,ka?this.getAnimationLength(ja):0,false,t.getViewportDimensions().y-fa-this.getScrollOffset(),la);this.setSelected(ja);this.lastScroll=Date.now();},isInteractive:function(ia){return ((ia.nodeName=='INPUT')||(ia.nodeName=='BUTTON')||(ia.nodeName=='TEXTAREA')||(ia.nodeName=='A')||!!q.byAttribute(ia,'contenteditable'));},setTabindexOnHeadline:function(ia,ja){if(this.isStory(ia)){var ka=this.getHeadline(ia);if(ka)ka.tabIndex=ja;}},setFocused:function(ia){if(this.isStory(ia)){var ja=this.getHeadline(ia);ja&&n.set(ja);}}});e.exports=ga;});
__d("FeedKeyboardController",["Class","CSS","DOM","DOMQuery","FeedBaseKeyboardController","Parent","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('Class'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('FeedBaseKeyboardController'),l=b('Parent'),m=b('copyProperties'),n=b('csx');function o(p){this.parent.construct(this,p);}g.extend(o,k);m(o.prototype,{getStories:function(){return i.scry(this.root,'li.uiStreamStory');},getParentStory:function(p){if(!i.contains(this.root,p))return;return l.byClass(p,'uiStreamStory');},isStory:function(p){return h.hasClass(p,'uiStreamStory');},getHeadline:function(p){return j.scry(p,'h5.uiStreamHeadline')[0];},clickLike:function(){this.click('.UFILikeLink');},clickComment:function(){this.click('.comment_link');},openAttachment:function(){this.click(".uiStreamAttachments ._5dec",'.uiStreamAttachments a.uiVideoThumb','.uiStreamAttachments a.shareText','.uiStreamAttachments a[rel="theater"]','.uiStreamAttachments .shareMediaLink');},isHoldoutStory:function(p){return !!p&&h.hasClass(p,'holdoutAdStory');},isRelevantStory:function(p){return j.isElementNode(p)&&!this.isHoldoutStory(p);},getPreviousStory:function(p){var q=p.previousSibling;while(q&&!this.isRelevantStory(q))q=q.previousSibling;return q;},getNextStory:function(p){var q=p.nextSibling;while(q&&!this.isRelevantStory(q))q=q.nextSibling;return q;},setSelected:function(p){var q=j.scry(p,'.selectedStoryIndicator');if(!q.length)i.prependContent(p,i.create('div',{'class':'selectedStoryIndicator'}));this.selected&&this.setTabindexOnHeadline(this.selected,'-1');this.setTabindexOnHeadline(p,'0');this.selected&&h.removeClass(this.selected,'selectedStorySimple');this.selected=p;h.addClass(this.selected,'selectedStorySimple');}});e.exports=o;});
__d("FeedScrollLogger",["Arbiter","BanzaiNectar","Bootloader","Event","FeedScrollLoggerConfig","Run","ScubaSample","SubscriptionsHandler","Vector","throttle"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('BanzaiNectar'),i=b('Bootloader'),j=b('Event'),k=b('FeedScrollLoggerConfig'),l=b('Run'),m=b('ScubaSample'),n=b('SubscriptionsHandler'),o=b('Vector'),p=b('throttle'),q,r;function s(){var v=o.getScrollPosition().y;if(v<r)return;t(v);r=v+k.log_spacing;}function t(v){var w=new m('feed_scroll');w.addNormal('qrt_version',k.qrt_version);w.addInteger('y',v);w.flush();h.log('feed_scroll','scroll',{y:v,homeload_id:q});}var u={init:function(v,w){q=v;r=100;var x=new n();x.addSubscriptions(j.listen(window,'scroll',p(s,250)));var y=x.release.bind(x);if(w){i.loadModules(['LitestandMessages'],function(z){x.addSubscriptions(g.subscribe(z.FILTER_SWITCH_BEGIN,y));});}else i.loadModules(['NavigationMessage'],function(z){x.addSubscriptions(g.subscribe(z.NAVIGATION_BEGIN,y));});l.onLeave(y);}};e.exports=u;});
__d("FeedTrackingAsync",["Event","collectDataAttributes","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('collectDataAttributes'),i=b('copyProperties');function j(){g.listen(document.documentElement,'AsyncRequest/send',function(event){var k=event.getTarget(),l=event.getData().request,m=l.getData(),n=h(k,['ft']);i(m,n);});}e.exports={init:j};});
__d("MercuryLeftNavCountControl",["Arbiter","CSS","DOM","MercuryThreadlistConstants","MessagingTag","MercuryThreadInformer","MercuryUnreadState","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('MercuryThreadlistConstants'),k=b('MessagingTag'),l=b('MercuryThreadInformer').get(),m=b('MercuryUnreadState').get(),n=b('copyProperties'),o,p,q=function(r,s){o=r;p=s;this.render();this.listenerToken=l.subscribe('unread-updated',this.render.bind(this));this.subscriptions=[g.subscribe('onload/exit',this.cleanup.bind(this))];};n(q.prototype,{render:function(){var r=m.exceedsMaxCount(k.INBOX);if(r){i.setContent(o,j.MAX_UNREAD_COUNT);}else{var s=m.getUnreadCount(k.INBOX);i.setContent(o,s.toString());h.conditionClass(o.parentNode,'hidden_elem',s<=0);}i.setContent(p,r?'+':'');},cleanup:function(){this.subscriptions.forEach(g.unsubscribe);l.unsubscribe(this.listenerToken);}});e.exports=q;});
__d("MercuryLeftNav",["DOM","MercuryServerRequests","MercuryLeftNavCountControl"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryServerRequests').get(),i=b('MercuryLeftNavCountControl');function j(k,l){h.handleUpdate(l);var m=g.scry(k,'span.countValue')[0],n=g.scry(k,'span.maxCountIndicator')[0];new i(m,n);}e.exports=j;});
__d("startMessagingNavCountUpdater",["Class","CounterDisplay","DOM","FutureSideNav","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Class'),h=b('CounterDisplay'),i=b('DOM'),j=b('FutureSideNav'),k=b('copyProperties'),l=b('createArrayFrom');function m(o){var p=j.getInstance().getNodeForKey('inbox');if(!p)return;var q=j.getInstance().getNodeForKey('other'),r=i.scry(q,'span.count')[0],s=i.scry(r,'span.countValue')[0],t=i.scry(r,'span.maxCountIndicator')[0];new n('other_unseen',s,r,null,null,true).setMaxCounter(o,t);}function n(){this._maxValue=null;this._maxIndicatorNode=null;var o=[this].concat(l(arguments));return this.parent.construct.apply(this.parent,o);}g.extend(n,h);k(n.prototype,{setMaxCounter:function(o,p){this._maxValue=o;this._maxIndicatorNode=p;},paint:function(){var o=this._maxValue&&this._count>this._maxValue,p=o?this._maxValue:this._count;if(this._maxIndicatorNode){i.setContent(this._maxIndicatorNode,o?'+':'');}else if(o)p=p+'+';i.setContent(this._valueNode,p);this._toggleNodes();}});e.exports=m;});
__d("legacy:messaging-nav-count",["startMessagingNavCountUpdater"],function(a,b,c,d){a.startMessagingNavCountUpdater=b('startMessagingNavCountUpdater');},3);
__d("ViewportTracking",["Arbiter","Banzai","DOMDimensions","DOMPosition","Event","NavigationMessage","Run","Style","SubscriptionsHandler","UIIntentionalStreamMessage","Vector","clickRefAction","collectDataAttributes","copyProperties","debounce","throttle"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Banzai'),i=b('DOMDimensions'),j=b('DOMPosition'),k=b('Event'),l=b('NavigationMessage'),m=b('Run'),n=b('Style'),o=b('SubscriptionsHandler'),p=b('UIIntentionalStreamMessage'),q=b('Vector'),r=b('clickRefAction'),s=b('collectDataAttributes'),t=b('copyProperties'),u=b('debounce'),v=b('throttle'),w=97,x='vpv';function y(){}y.prototype.init=function(z){this.useBanzai=!!z.banzai;this.readStoryIDs={};this.minSizeToBeVisible=200;this.minSizeToBeVisibleForTimetracking=200;this.timetrackingThrottlingInterval=100;this.cachedAllStories=null;this.isTimetrackingEnabled=0;this.storyEnteredVPTimestamp={};this.getDataFromConfig(z);this.isLoose=!!z.is_loose;this.maxScrollPosition=0;if(z.tracking_duration_config){this.minSizeToBeVisibleForTimetracking=z.tracking_duration_config.min_height_to_be_visible;this.timetrackingThrottlingInterval=z.tracking_duration_config.timetracking_throttling_interval;}var aa,ba=u(this.fireTimer,this.getTimeout(),this);if(this.isLoose){this.minSizeToBeVisible=0;aa=v(function(){this.maxScrollPosition=Math.max(this.maxScrollPosition,q.getScrollPosition().y);ba();}.bind(this));}else aa=ba;this.fireTimer();var ca=v(this.updateTimeTrackingData.bind(this,false),this.timetrackingThrottlingInterval);this.subscriptions=new o();this.subscriptions.addSubscriptions(this._getScrollListener(aa),k.listen(window,'resize',aa),g.subscribe(p.UPDATE_HTML_CONTENT,aa),g.subscribe(l.NAVIGATION_BEGIN,this.cleanup.bind(this)));if(this.isTimetrackingEnabled){this.updateTimeTrackingData(false);this.subscriptions.addSubscriptions(this._getScrollListener(ca));}m.onLeave(this.cleanup.bind(this));};y.prototype._getScrollListener=function(z){return k.listen(window,'scroll',z);};y.prototype.cleanup=function(){if(this.subscriptions){this.subscriptions.release();this.subscriptions=null;}this.updateTimeTrackingData(true);};y.prototype.fireTimer=function(){this.getStoriesInView().forEach(this.markStoryRead.bind(this));};y.prototype.addVisibleStoriesTimestamps=function(z,aa){var ba={};for(var ca=0,da=z.length;ca<da;ca++){var ea=this.getStoryID(z[ca]);ba[ea]=true;if(ea in this.storyEnteredVPTimestamp)continue;this.storyEnteredVPTimestamp[ea]={ts:aa,story:z[ca]};}return ba;};y.prototype.removeTimestampsOfStoriesNotInView=function(z,aa){for(var ba in this.storyEnteredVPTimestamp)if(!(ba in z)){this.recordTimeStoryWasInView(this.storyEnteredVPTimestamp[ba].story,this.storyEnteredVPTimestamp[ba].ts,aa);delete this.storyEnteredVPTimestamp[ba];}};y.prototype.updateTimeTrackingData=function(z){if(!this.storyEnteredVPTimestamp)this.storyEnteredVPTimestamp={};var aa=Date.now(),ba={},ca;if(!z)ba=this.getAllStoriesInView();ca=this.addVisibleStoriesTimestamps(ba,aa);this.removeTimestampsOfStoriesNotInView(ca,aa);};y.prototype.getStoriesInView=function(){var z=this.getAllStories(),aa=[],ba=false;for(var ca=0;ca<z.length;ca++){var da=z[ca],ea=this.getStoryID(da);if(this.hasBeenVisible(ea))continue;if(this.isVisible(da)){aa.push(da);ba=true;}else if(ba)break;}return aa;};y.prototype.getAllStoriesFromCache=function(){if(this.cachedAllStories===null)this.cachedAllStories=this.getAllStories();return this.cachedAllStories;};y.prototype.invalidateAllStoriesCache=function(){this.cachedAllStories=null;};y.prototype.getAllStoriesInView=function(){var z=this.getAllStoriesFromCache(),aa=[],ba=false,ca=0,da=z.length,ea=1;if(this._indexOfLastVisibleStoryOnPreviousPass>da/2){ca=da-1;da=-1;ea=-ea;}for(var fa=ca;fa!=da;fa+=ea){var ga=z[fa];if(this._isVisible(ga,false,this.minSizeToBeVisibleForTimetracking)){aa.push(ga);ba=true;}else if(ba){this._indexOfLastVisibleStoryOnPreviousPass=fa-ea;break;}}return aa;};y.prototype.getTimetrackingDataToLog=function(z,aa,ba){var ca={evt:w,vpvd_start_timestamp:aa,vpvd_time_delta:ba-aa,story_height:i.getElementDimensions(z).height};return {ft:ca};};y.prototype.recordTimeStoryWasInView=function(z,aa,ba){if(this.isTimetrackingEnabled){var ca=this.getTimetrackingDataToLog(z,aa,ba);this.sendDataToLog(z,ca);}};y.prototype.hasBeenVisible=function(z){return z in this.readStoryIDs;};y.prototype.isVisible=function(z){return this._isVisible(z,this.isLoose,this.minSizeToBeVisible);};y.prototype._isVisible=function(z,aa,ba){var ca=q.getScrollPosition().y,da=i.getViewportDimensions().height,ea=j.getElementPosition(z),fa=i.getElementDimensions(z),ga=da+this.maxScrollPosition-ca;if(!ea.x&&!ea.y&&!fa.x&&!fa.y)return false;if(aa&&ea.y<ga)return true;var ha=Math.max(ea.y,0),ia=Math.min(ea.y+fa.height,da),ja=Math.min(fa.height,ba);return (ia-ha)>=ja;};y.prototype.sendDataToLog=function(z,aa){if(this.useBanzai){var ba=s(z,['ft']);t(aa.ft,ba.ft);delete aa.ei;h.post('feed_tracking',aa);}else r(x,z,null,'FORCE',aa);};y.prototype.markStoryRead=function(z){var aa=this.getStoryID(z);if(!aa||this.hasBeenVisible(aa))return;this.readStoryIDs[aa]=true;var ba=this.getDataToLog(z);this.sendDataToLog(z,ba);};e.exports=y;});
__d("collectSubtreeData",[],function(a,b,c,d,e,f){function g(i,j,k,l,m){if(i.offsetWidth===0&&i.offsetHeight===0)return m;var n={};if(i.getAttribute)for(r=0;r<j.length;r++){t=j[r];var o=i.getAttribute(k[t]);if(o){n[t]={};var p=JSON.parse(o);for(var q in l)if(p[q]!==undefined){n[t][q]=true;if(m[t]===undefined)m[t]={};if(m[t][q]===undefined)m[t][q]=[];if(l[q].length>0)m[t][q].push(l[q]);m[t][q].push('('+p[q]);}}}for(var r=0;r<i.childNodes.length;r++){var s=i.childNodes[r];g(s,j,k,l,m);}for(var t in n)for(var u in n[t]){var v=m[t][u][m[t][u].length-1];if(v.length>0&&v.charAt(0)=='('){m[t][u][m[t][u].length-1]=v.substr(1);}else m[t][u].push(')');}return m;}function h(i,j){var k={};for(var l=0;l<j.length;++l)k[j[l]]='data-'+j[l];var m={tn:"","tn-debug":","},n={};g(i,j,k,m,n);for(var o in n)for(var p in n[o])n[o][p]=n[o][p].join('');return n;}e.exports=h;});
__d("recordTNTreeData",["collectSubtreeData"],function(a,b,c,d,e,f){var g=b('collectSubtreeData');function h(i,j){var k={},l=g(i,['ft']);for(var m in l.ft){k[m+'_tree']=l.ft[m];if(m==='tn-debug')i.setAttribute('tn-debug_subtree',l.ft[m]);}k.evt_value=i.offsetHeight;if(j)k.offset=Math.max(0,i.offsetTop-j.offsetTop);return k;}e.exports=h;});
__d("PubcontentFeedChainingController",["Arbiter","AsyncRequest","DOM","PageLikeButton","UFIFeedbackTargets"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('DOM'),j=b('PageLikeButton'),k=b('UFIFeedbackTargets'),l='pubcontentFeedChainingWrapper',m='/ajax/pubcontent/feed_chaining',n='page_story_like_action';o.init=function(p){if(!this.$PubcontentFeedChainingController0)this.$PubcontentFeedChainingController0=new o(p);};function o(p){this.config=p;this.chainedSourceIDs={};this.ufisWithExpansionBlockedOnce={};g.subscribe(j.LIKED,this.onFan.bind(this));}o.prototype.onFan=function(p,q){this.$PubcontentFeedChainingController2(q.profile_id,q.origin,q.target);};o.onExplicitLike=function(p,q){if(!this.$PubcontentFeedChainingController0)return;k.getFeedbackTarget(p,function(r,s){if(s.isownerpage){var t=this.$PubcontentFeedChainingController0.$PubcontentFeedChainingController2(s.actorid,n,r);if(t)this.$PubcontentFeedChainingController0.ufisWithExpansionBlockedOnce[p]=true;}}.bind(this,q));};o.prototype.$PubcontentFeedChainingController3=function(p){var q=i.scry(p,"^.storyInnerContent");if(q.length!==1)return;var r=q[0],s=i.scry(r,"div[role='article']");if(s.length===1)r=s[0];return r;};o.prototype.$PubcontentFeedChainingController2=function(p,q,r){if(!p||!r||!q||!(q in this.config)||p in this.chainedSourceIDs)return false;var s=Math.random();if(s>this.config[q].rate)return;var t=this.$PubcontentFeedChainingController3(r);if(!t)return;this.chainedSourceIDs[p]=true;var u=i.appendContent(t,i.create('div',{id:l}));new h().setURI(m).setData({page_id:p,origin:q}).setRelativeTo(u[0]).send();return true;};o.ufiExpansionBlockedOnce=function(p){if(!this.$PubcontentFeedChainingController0)return false;var q=this.$PubcontentFeedChainingController0.ufisWithExpansionBlockedOnce[p];this.$PubcontentFeedChainingController0.ufisWithExpansionBlockedOnce[p]=false;return q;};e.exports=o;});
__d("StreamViewportTracking",["Arbiter","Class","DOM","ViewportTracking","UIIntentionalStreamMessage","$","copyProperties","ge","recordTNTreeData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('DOM'),j=b('ViewportTracking'),k=b('UIIntentionalStreamMessage'),l=b('$'),m=b('copyProperties'),n=b('ge'),o=b('recordTNTreeData'),p=51;function q(){this.parent.construct(this);}h.extend(q,j);m(q.prototype,{init:function(r){this.parent.init(r);this.subscriptions.addSubscriptions(g.subscribe(k.UPDATE_LAST_REFRESH_TIME,this.invalidateAllStoriesCache.bind(this)),g.subscribe(k.UNLOAD,this.updateTimeTrackingData.bind(this,true)));},getDataFromConfig:function(r){this.recordTNTree=r.record_tn_tree;this.timeout=r.record_delay;this.isTimetrackingEnabled=!!r.is_timetracking_enabled;},getTimeout:function(){return this.timeout;},getAllStories:function(){var r=i.scry(l('home_stream'),'.uiStreamStory');return r.filter(function(s){return s.getAttribute('data-ft');});},getStoryID:function(r){var s=JSON.parse(r.getAttribute('data-ft'));return s.mf_story_key;},getDataToLog:function(r){var s={};if(this.recordTNTree){var t=n('home_stream');s=o(r,t);}s.evt=p;return {ft:s};}});e.exports.init=function(r){q.instance=new q();q.instance.init(r);};e.exports.getInstance=function(){return q.instance;};});
__d("legacy:UIIntentionalStream",["UIIntentionalStream"],function(a,b,c,d){a.UIIntentionalStream=b('UIIntentionalStream');},3);
__d("legacy:UIIntentionalStream-message",["UIIntentionalStreamMessage"],function(a,b,c,d){a.UIIntentionalStreamMessage=b('UIIntentionalStreamMessage');},3);
__d("legacy:UIIntentionalStreamRefresh",["UIIntentionalStreamRefresh"],function(a,b,c,d){a.UIIntentionalStreamRefresh=b('UIIntentionalStreamRefresh');},3);