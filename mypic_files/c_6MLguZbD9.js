/*!CK:776496423!*//*1375705729,178130529*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ub7g\/"]); }

__d("BlackbirdUpsellConstants",[],function(a,b,c,d,e,f){e.exports={ACTION_UPSELL:"upsell",CLICK_TYPE_DISMISS_PROMO:"dismiss_promo",ACTION_EDUCATE:"educate",CLICK_TYPE_ENABLE_CHAT:"enable_chat",CLICK_TYPE_OPEN_SETTINGS:"open_settings"};});
__d("AsyncLoader",["copyProperties","AsyncRequest","BaseAsyncLoader"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('AsyncRequest'),i=b('BaseAsyncLoader');function j(k,l){this._endpoint=k;this._type=l;}g(j.prototype,i.prototype);j.prototype.send=function(k,l,m,n,o){new h(k).setData({ids:l}).setHandler(n).setErrorHandler(o).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();};e.exports=j;});
__d("ChatFavoriteList",["AsyncRequest","arrayContains","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('arrayContains'),i=b('emptyFunction'),j=false,k=[],l=[],m=false;function n(){var r=k.join(',');new g('/ajax/chat/favorite_list.php').setData({favorite_list:r}).setHandler(i).setErrorHandler(i).send();}function o(r){return r.toString();}function p(r){if(k.length!=r.length)return true;for(var s=0;s<r.length;s++)if(k[s]!==r[s].toString())return true;return false;}var q={isEditMode:function(){var r=null;d(['ChatSidebar'],function(s){r=s;});return j&&r&&r.isEnabled();},toggleEditMode:function(){j=!j;if(j)l=k.slice();},get:function(){if(j){return l.slice();}else return k.slice();},isFavored:function(r){return h(l,r.toString());},init:function(r){k=r.slice().map(o);l=k.slice();},toggleID:function(r){if(!j)return;r=r.toString();var s=l.indexOf(r);if(s>=0){l.splice(s,1);}else l.push(r);m=true;},hasChanged:function(){if(m){m=false;return true;}return false;},updateList:function(r){if(!j)return;l=r.map(o);},save:function(){if(p(l)){k=l;n();}}};e.exports=q;});
__d("ChatContexts",[],function(a,b,c,d,e,f){var g={};function h(k){var l=k?k.subtext:'';return l;}function i(k,l){g[k]=l;}var j={get:function(k){if(k in g){return g[k];}else return null;},update:function(k){for(var l in k)i(l,k[l]);},getShortDisplay:function(k){return h(j.get(k));}};e.exports=j;});
__d("ServerTime",["PresenceInitialData"],function(a,b,c,d,e,f){var g=b('PresenceInitialData'),h;function i(k){h=Date.now()-k;}i(g.serverTime);var j={get:function(){return Date.now()-h;},getSkew:function(){return h;},update:function(k){i(k);}};e.exports=j;});
__d("PresenceStatus",["AvailableListConstants","ChatConfig","ChatVisibility","Env","PresencePrivacy","ServerTime","createObjectFrom"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatVisibility'),j=b('Env'),k=b('PresencePrivacy'),l=b('ServerTime'),m=b('createObjectFrom'),n={},o={},p={},q={},r={},s={resetPresenceData:function(){n={};r={};q={};},reset:function(){s.resetPresenceData();o={};p={};},get:function(t){if(t==j.user)return i.isOnline()?g.ACTIVE:g.OFFLINE;var u=g.OFFLINE;if(t in n)u=n[t];if(!k.allows(t))u=g.OFFLINE;if(u==g.OFFLINE)if(o[t])u=g.MOBILE;return u;},isBirthday:function(t){return p[t];},getGroup:function(t){if(!h.get('chat_group_presence',0))return g.OFFLINE;return t.some(function(u){if(u==j.user)return false;return (s.get(u)===g.ACTIVE);})?g.ACTIVE:g.OFFLINE;},set:function(t,u,v,w){if(t==j.user)return false;switch(u){case g.OFFLINE:case g.IDLE:case g.ACTIVE:case g.MOBILE:break;default:return false;}var x=s.get(t)!=u;if(v){q[t]=l.get();r[t]=w;}n[t]=u;return x;},setMobileFriends:function(t){o=m(t);},setBirthdayFriends:function(t){p=m(t);},getOnlineIDs:function(){var t,u=[];for(t in n)if(s.get(t)===g.ACTIVE)u.push(t);return u;},getAvailableIDs:function(){var t=s.getOnlineIDs(),u;for(u in o){if(n[u])continue;t.push(u);}return t;},getOnlineCount:function(){return s.getOnlineIDs().length;},getPresenceStats:function(){var t=0,u=0,v=0,w=0,x=0;for(var y in n){t+=1;switch(s.get(y)){case g.OFFLINE:u+=1;break;case g.IDLE:v+=1;break;case g.ACTIVE:w+=1;break;case g.MOBILE:x+=1;break;default:break;}}return {total:t,offline:u,idle:v,active:w,mobile:x};},getDebugInfo:function(t){return {id:t,presence:n[t],overlaySource:r[t],overlayTime:q[t],mobile:o[t]};}};e.exports=s;});
__d("PresencePoller",["AvailableListConstants","AvailableListInitialData","BanzaiODS","ChannelImplementation","ChatContexts","ChatFavoriteList","ChatVisibility","Env","JSLogger","LastMobileActiveTimes","Poller","PresenceStatus","PresenceUtil","ServerTime","ShortProfiles","UserActivity","copyProperties","debounceAcrossTransitions"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('AvailableListInitialData'),i=b('BanzaiODS'),j=b('ChannelImplementation').instance,k=b('ChatContexts'),l=b('ChatFavoriteList'),m=b('ChatVisibility'),n=b('Env'),o=b('JSLogger'),p=b('LastMobileActiveTimes'),q=b('Poller'),r=b('PresenceStatus'),s=b('PresenceUtil'),t=b('ServerTime'),u=b('ShortProfiles'),v=b('UserActivity'),w=b('copyProperties'),x=b('debounceAcrossTransitions'),y=5,z='/ajax/chat/buddy_list.php',aa=1800000,ba=h.pollInterval,ca=h.lazyPollInterval,da=h.lazyThreshold,ea=o.create('available_list'),fa='presence_poller';i.setEntitySample(fa,.01);function ga(ha){this.$PresencePoller0=ha;this.$PresencePoller1=false;this.$PresencePoller2=h.chatNotif;this.$PresencePoller3=new q({interval:ba,setupRequest:this.$PresencePoller4.bind(this),clearOnQuicklingEvents:false,dontStart:true});this.$PresencePoller5=Date.now();this.$PresencePoller6=Date.now();this.$PresencePoller7=Date.now();this.$PresencePoller8=h.updateTime;this.$PresencePoller9=false;this.$PresencePollera=0;if(h.favoriteList)l.init(h.favoriteList);this.$PresencePollerb('available_initial_data',h.updateTime,h.availableList,h.lastActiveTimes,h.mobileFriends,h.birthdayFriends);v.subscribe(function(ia,ja){if(ja.idleness>ba)this.forceUpdate();}.bind(this));}ga.prototype.start=function(){this.$PresencePoller3.start.bind(this.$PresencePoller3).defer();};ga.prototype.forceUpdate=function(){if(!this.$PresencePoller9)this.$PresencePoller3.request();};ga.prototype.getIsUserIdle=function(){return this.$PresencePoller1;};ga.prototype.getWebChatNotification=function(){return this.$PresencePoller2;};ga.prototype.getCallback=function(){return this.$PresencePoller0;};ga.prototype.$PresencePollerc=function(){return x(function(){this.$PresencePoller0(g.ON_AVAILABILITY_CHANGED);}.bind(this),0)();};ga.prototype.$PresencePollerb=function(ha,ia,ja,ka,la,ma){this.$PresencePoller8=ia;if(!Array.isArray(ja)){r.resetPresenceData();for(var na in ja)r.set(na,ja[na].a,false,ha);}if(ka)p.update(ka,ia);if(la)r.setMobileFriends(la);if(ma)r.setBirthdayFriends(ma);this.$PresencePollerc();};ga.prototype.$PresencePoller4=function(ha){if(j.isShutdown()||!m.isOnline()){this.$PresencePoller3.skip();i.bumpEntityKey(fa,'skip.offline');return;}if(Date.now()-this.$PresencePoller5<ba){this.$PresencePoller3.skip();i.bumpEntityKey(fa,'skip.recent');return;}i.bumpEntityKey(fa,'request');this.$PresencePoller5=Date.now();var ia=(Date.now()-this.$PresencePoller7>aa),ja=u.getCachedProfileIDs().join(",");this.$PresencePoller9=true;ha.setHandler(this.$PresencePollerd.bind(this)).setErrorHandler(this.$PresencePollere.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:n.user,cached_user_info_ids:ja,fetch_mobile:ia}).setURI(z).setAllowCrossPageTransition(true);};ga.prototype.$PresencePollerd=function(ha){var ia=ha.getPayload(),ja=ia.buddy_list;if(!ja){this.$PresencePollere(ha);return;}i.bumpEntityKey(fa,'response');this.$PresencePoller9=false;this.$PresencePollerf();this.$PresencePoller6=Date.now();t.update(ia.time);this.$PresencePollera=0;this.$PresencePollerg();var ka=ja.userInfos;if(ka)u.setMulti(ka);var la=ja.chatContexts;la&&k.update(la);this.$PresencePoller1=ja.userIsIdle;if(ja.chatNotif!==undefined){this.$PresencePoller2=ja.chatNotif;this.$PresencePoller0(g.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller2);}this.$PresencePollerb('buddy_list_poller',ia.time,ja.nowAvailableList,ja.last_active_times,ja.mobile_friends,ja.todays_birthdays);};ga.prototype.$PresencePollere=function(ha){i.bumpEntityKey(fa,'error');if(s.checkMaintenanceError(ha))return;this.$PresencePoller9=false;this.$PresencePollera++;if(this.$PresencePollera++>=y)this.$PresencePoller0(g.ON_UPDATE_ERROR);};ga.prototype.$PresencePollerg=function(){var ha=v.isActive(da)?ba:ca;i.bumpEntityKey(fa,'period.'+ha);this.$PresencePoller3.setInterval(ha);};ga.prototype.$PresencePollerf=function(){var ha=Date.now(),ia=ha-this.$PresencePoller6;ea.log('buddylist_presence_stats',w({duration:ia},r.getPresenceStats()));};e.exports=ga;});
__d("AvailableList",["function-extensions","Arbiter","ArbiterMixin","AsyncRequest","AvailableListConstants","ChannelImplementation","ChannelConstants","ChatConfig","ChatFavoriteList","JSLogger","PresencePoller","PresencePrivacy","PresenceStatus","ShortProfiles","TypingDetector","copyProperties","debounceAcrossTransitions","emptyFunction"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('AvailableListConstants'),k=b('ChannelImplementation').instance,l=b('ChannelConstants'),m=b('ChatConfig'),n=b('ChatFavoriteList'),o=b('JSLogger'),p=b('PresencePoller'),q=b('PresencePrivacy'),r=b('PresenceStatus'),s=b('ShortProfiles'),t=b('TypingDetector'),u=b('copyProperties'),v=b('debounceAcrossTransitions'),w=b('emptyFunction'),x=u({},j,h);x.subscribe([j.ON_AVAILABILITY_CHANGED,j.ON_UPDATE_ERROR],function(ea,fa){g.inform(ea,fa);});var y=v(function(){x.inform(j.ON_AVAILABILITY_CHANGED);},0);function z(ea,fa,ga,ha){var ia=r.set(ea,fa,ga,ha);if(ia)y();}function aa(ea){var fa=ea.payload.availability||{};for(var ga in fa)z(ga,fa[ga],true,'mercury_tabs');}function ba(ea){var fa=x.getDebugInfo(ea),ga=(fa.presence==j.ACTIVE),ha=new i('/ajax/mercury/tabs_presence.php').setData({target_id:ea,to_online:ga,presence_source:fa.overlaySource,presence_time:fa.overlayTime}).setHandler(aa).setErrorHandler(w).setAllowCrossPageTransition(true).send();}function ca(ea,fa){fa.chat_config=m.getDebugInfo();fa.available_list_debug_info={};x.getAvailableIDs().forEach(function(ga){fa.available_list_debug_info[ga]=x.getDebugInfo(ga);});fa.available_list_poll_interval=x._poller&&x._poller.getInterval();}var da=new p(function(event){x.inform(event);});u(x,{get:function(ea){return r.get(ea);},updateForID:function(ea){ba(ea);},getWebChatNotification:function(){return da.getWebChatNotification();},isUserIdle:function(){return da.getIsUserIdle();},isReady:function(){return true;},set:function(ea,fa,ga){z(ea,fa,true,ga);},update:function(){da.forceUpdate();},isIdle:function(ea){return x.get(ea)==j.IDLE;},getOnlineIDs:function(){return r.getOnlineIDs();},getAvailableIDs:function(){return r.getAvailableIDs();},getOnlineCount:function(){return r.getOnlineCount();},getDebugInfo:function(ea){var fa=r.getDebugInfo(ea),ga=s.getNow(ea);if(ga)fa.name=ga.name;return fa;}});da.start();g.subscribe(o.DUMP_EVENT,ca);g.subscribe(l.getArbiterType('favorite_list'),function(ea,fa){var ga=fa.obj,ha=ga.value?ga.value.split(','):[];n.init(ha);y();});q.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],y);k.subscribe([k.CONNECTED,k.RECONNECTING,k.SHUTDOWN,k.MUTE_WARNING,k.UNMUTE_WARNING],y);g.subscribe(l.getArbiterType('buddylist_overlay'),function(ea,fa){var ga=fa.obj.overlay;for(var ha in ga)x.set(ha,ga[ha].a,ga[ha].s||'channel');});g.subscribe([l.getArbiterType('typ'),l.getArbiterType('ttyp')],function(ea,fa){var ga=fa.obj;if(ga.st===t.TYPING){var ha=ga.from;x.set(ha,j.ACTIVE,'channel-typing');}});a.AvailableList=e.exports=x;});
__d("BlackbirdUpsell",["Event","Arbiter","AsyncRequest","LegacyContextualDialog","DOM","LayerDestroyOnHide","LayerHideOnTransition","PresencePrivacy","copyProperties","BlackbirdUpsellConfig","BlackbirdUpsellConstants","BlackbirdUpsellTemplates"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('LegacyContextualDialog'),k=b('DOM'),l=b('LayerDestroyOnHide'),m=b('LayerHideOnTransition'),n=b('PresencePrivacy'),o=b('copyProperties'),p=b('BlackbirdUpsellConfig'),q=b('BlackbirdUpsellConstants'),r=b('BlackbirdUpsellTemplates'),s='/ajax/chat/blackbird/update_clicks.php',t='/ajax/chat/blackbird/update_impressions.php',u='/ajax/chat/blackbird/dismiss.php',v=235,w=null,x=null,y=false,z=false;function aa(){}o(aa,{shouldShow:function(){if(this._dialogDismissed)return false;if(this.isEducation()){return !p.EducationDismissed&&p.EducationImpressions<p.EducationImpressionLimit;}else return !!p.UpsellGK&&!p.UpsellDismissed&&p.UpsellImpressions<p.UpsellImpressionLimit&&p.FriendCount>=p.UpsellMinFriendCount;},isEducation:function(){return p.TimeOffline<=p.EducationTimeOfflineThresdhold;},getOfflineContent:function(){if(this.isEducation()){return this._getEducationContent();}else return this._getUpsellContent();},_getEducationContent:function(){ga();var ka=r[':fb:chat:blackbird:offline-educate'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ja(q.CLICK_TYPE_OPEN_SETTINGS);da();});return ka.getRoot();},_getUpsellContent:function(){fa();var ka=r[':fb:chat:blackbird:upsell'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ia(q.CLICK_TYPE_OPEN_SETTINGS);ca();});var ma=ka.getNode('enableChatButton');g.listen(ma,'click',function(){ia(q.CLICK_TYPE_ENABLE_CHAT);ca();});return ka.getRoot();},getBlackbirdContent:function(ka){ga();switch(ka){case n.ONLINE:return r[':fb:chat:blackbird:most-friends-educate'].build().getRoot();case n.OFFLINE:return r[':fb:chat:blackbird:some-friends-educate'].build().getRoot();}},showOfflineDialog:function(ka){this.showDialog(ka,this.getOfflineContent.bind(this));},showBlackbirdDialog:function(ka,la){this.showDialog(ka,this.getBlackbirdContent.curry(la));},showDialog:function(ka,la){!w&&this._constructDialog();k.setContent(x,la());w.setContext(ka);w.show();},hide:function(){if(w&&w.isShown())w.hide();},dismiss:function(){this.hide();if(this.isEducation()){da();}else ca();},registerDismissClick:function(){if(this.isEducation()){ja(q.CLICK_TYPE_DISMISS_PROMO);}else ia(q.CLICK_TYPE_DISMISS_PROMO);},isVisible:function(){return z&&!y;},_constructDialog:function(){var ka=r[':fb:chat:blackbird:dialog-frame'].build();x=ka.getNode('dialogContent');w=new j();w.init(ka.getRoot());w.setPosition('above').setWidth(v).setFixed(true).disableBehavior(l).disableBehavior(m);g.listen(ka.getNode('dialogCloseButton'),'click',this.dismiss.bind(this));g.listen(ka.getNode('dialogCloseButton'),'click',this.registerDismissClick.bind(this));}});function ba(ka,la){if(!y&&z){y=true;n.inform('privacy-user-presence-changed');var ma=new i(u);ma.setData({source:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){y=false;});ma.send();}}function ca(){ba(q.ACTION_UPSELL,p.UpsellImpressions);}function da(){ba(q.ACTION_EDUCATE,p.EducationImpressions);}function ea(ka,la){if(!z){z=true;var ma=new i(t);ma.setData({action:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){z=false;});ma.send();}}function fa(){ea(q.ACTION_UPSELL,p.UpsellImpressions);}function ga(){ea(q.ACTION_EDUCATE,p.EducationImpressions);}function ha(ka,la,ma,na){var oa=new i(s);oa.setData({action:ka,impressions:ma,source:la,time_offline:na});oa.send();}function ia(ka){ha(ka,q.ACTION_UPSELL,p.UpsellImpressions,p.TimeOffline);}function ja(ka){ha(ka,q.ACTION_EDUCATE,p.EducateImpressions,p.TimeOffline);}h.subscribe('chat/advanced-settings-dialog-opened',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-online',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-offline',aa.dismiss.bind(aa));e.exports=aa;});
__d("ChatImpressionLogger",["AvailableList","AsyncSignal","ChatConfig","ChatVisibility","Poller"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('AsyncSignal'),i=b('ChatConfig'),j=b('ChatVisibility'),k=b('Poller'),l=null,m=null,n={init:function(o){l=o;var p=i.get('chat_impression_logging_periodical',0);if(p){var q=i.get('periodical_impression_logging_config.interval');m=new k({interval:q,setupRequest:this.logImps.bind(this),clearOnQuicklingEvents:false});}this.init=function(){};},logImps:function(o){if(!j.isOnline())return;var p={source:'periodical_imps'},q=l.getCachedSortedList(),r=[];for(var s=0;s<q.length;s++)r[s]=g.get(q[s]);p.sorted_list=q.toString();p.list_availability=r.toString();o.setURI('/ajax/chat/imps_logging.php').setData(p);},getOrderedList:function(){return l;},logImpressions:function(o){var p=[],q=[];if(i.get('chat_impression_logging_with_click')){p=l.getCachedSortedList();for(var r=0;r<p.length;r++)q[r]=g.get(p[r]);}o.sorted_list=p.toString();o.list_availability=q.toString();new h('/ajax/chat/ct.php',o).send();}};e.exports=n;});
__d("ChatTypeaheadConstants",[],function(a,b,c,d,e,f){var g={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',HEADER_TYPE:'header'};e.exports=g;});
__d("Chat",["Arbiter","AvailableList","ChatImpressionLogger","ChatTypeaheadConstants","MercuryParticipantTypes"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('ChatImpressionLogger'),j=b('ChatTypeaheadConstants'),k=b('MercuryParticipantTypes');function l(q,r){var s=r&&r.source;if(s&&s==='ordered_list'||s==='more_online_friends'||s==='online_friends'||s==='recent_threads_in_divebar_new'||s==='recent_threads_in_divebar'||s==='presence'||s==='typeahead'){r.viewport_width=document.body.clientWidth;r.target=q;r.target_presence=h.get(q);i.logImpressions(r);}}var m={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function n(q,r){g.subscribe(m[q],function(event,s){r(s);});}function o(){return (Math.random()*2147483648|0).toString(16);}var p={openTab:function(q,r,s){if(window.External&&window.External.Chat&&window.External.Chat.openWindow)window.External.Chat.openWindow(q);l.curry(q,s).defer();d(['MercuryThreads'],function(t){if(!r||r===k.FRIEND||r===j.FRIEND_TYPE||r===j.USER_TYPE){var u=t.get().getCanonicalThreadToUser(q),v=o();g.inform('chat/open-tab',{thread_id:u.thread_id,signature_id:v});return;}if(r===j.THREAD_TYPE)d(['ChatOpenTab'],function(w){if(q){w.openThread(q);}else w.openEmptyTab();});});},openBuddyList:function(){n('buddyListNub',function(q){q.show();n('sidebar',function(r){r.enable();});});},closeBuddyList:function(){n('buddyListNub',function(q){q.hide();});},toggleSidebar:function(){n('sidebar',function(q){q.toggle();});},goOnline:function(q){d(['ChatVisibility'],function(r){r.goOnline(q);});},isOnline:function(){var q=null;d(['ChatVisibility'],function(r){q=r;});return q&&q.isOnline();}};a.Chat=e.exports=p;},3);
__d("ChatFavoriteNux",["AsyncRequest"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=null,i=false,j={tryShow:function(k){if(h&&!i){h.setContext(k);h.show();i=true;}},tryHide:function(){if(h&&i){h.hide();h=null;}},registerDialog:function(k){h=k;if(k)k.subscribe('confirm',this.dismissDialog);},dismissDialog:function(){if(h){new g('/ajax/chat/dismiss_favorite_nux.php').send();h.hide();h=null;}}};e.exports=j;});
__d("ChatGroupThreadsController",["ArbiterMixin","ChatConfig","InitialMultichatList","MercuryOrderedThreadlist","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MessagingTag","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatConfig'),i=b('InitialMultichatList'),j=b('MercuryOrderedThreadlist').get(),k=b('MercuryServerRequests').get(),l=b('MercuryThreadInformer').get(),m=b('MercuryThreads').get(),n=b('MessagingTag'),o=b('copyProperties'),p,q=[],r=h.get('max_sidebar_multichats',3);function s(x){var y=m.getThreadMetaNow(x);return y&&!y.is_canonical&&m.canReply(x);}var t=i.payload;if(t){k.handleUpdate(t);var u=t.threads||[];q=u.map(function(x){return x.thread_id;});}if(q.length){var v=m.getThreadMetaNow(q[q.length-1]);p=v&&(v.timestamp-1);}if(!p)p=Date.now();var w={};o(w,g,{getThreadIDs:function(){var x=0;return q.filter(function(y){return x<r&&s(y)&&++x;});}});l.subscribe('threadlist-updated',function(){q=j.getThreadlistUntilTimestamp(p,n.INBOX,n.GROUPS).filter(s);w.inform('update');});e.exports=w;});
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('JSLogger'),j=b('PresenceUtil'),k=b('copyProperties'),l=i.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=k(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===j.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(i.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;});
__d("ChatSidebarConstants",[],function(a,b,c,d,e,f){var g={LITESTAND_IMAGE_SIZE:24,LITESTAND_BLENDED_SIZE:32,IMAGE_SIZE:28};e.exports=g;});
__d("ChatSidebarItem.react",["AvailableListConstants","ChatConfig","ChatFavoriteList","ChatSidebarConstants","Image.react","Link.react","React","SplitImage.react","cx","ix"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatFavoriteList'),j=b('ChatSidebarConstants'),k=b('Image.react'),l=b('Link.react'),m=b('React'),n=b('SplitImage.react'),o=b('cx'),p=b('ix'),q=9,r=m.createClass({displayName:'ChatSidebarItem',render:function(){var s=(("_55ln")+(this.props.context?' '+"_55lo":'')+(this.props.unreadCount&&h.get('litestand_buddylist_count')?' '+"_5bom":'')),t;if(this.props.litestandSidebar)t=m.DOM.div({'aria-label':this.props.name,className:"_4_vf",'data-hover':"tooltip",'data-tooltip-position':"right"});return (l({className:s,href:this.props.href,onClick:this.props.onClick,rel:"ignore"},m.DOM.div({className:"_55lp"},this.renderFavorite(),m.DOM.div({className:"_56p9"},this.renderImage(),m.DOM.div({className:"_568w"})),m.DOM.div({className:"_5bon"},this.renderBirthday(),this.renderUnreadCount(),this.renderStatus()),m.DOM.div({className:"_55lr"},this.props.name),m.DOM.div({className:"_55ls"},this.props.context)),t));},renderFavorite:function(){if(this.props.isAdded===undefined)return null;var s=null;if(this.props.litestandSidebar){s=this.props.isAdded?p('/images/litestand/bookmarks/sidebar/remove.png'):p('/images/litestand/bookmarks/sidebar/add.png');}else s=this.props.isAdded?p('/images/chat/delete.png'):p('/images/chat/add.png');var t=(("_568x")+(!this.props.showEditButton?' '+"hidden_elem":''));return (m.DOM.div({className:t,onClick:this.props.onEditClick},k({className:"_568y",src:s})));},renderImage:function(){var s=this.props.imageSize||j.IMAGE_SIZE;return n({size:s,srcs:this.props.images});},renderUnreadCount:function(){var s=this.props.unreadCount;if(!s||!h.get('litestand_buddylist_count'))return null;var t=(("_5boo")+(s>q?' '+"_5bop":''));if(s>q)s=q+'+';return (m.DOM.div({className:t},s));},renderStatus:function(){var s=this.getStatusSrc();if(!s)return null;if(this.props.unreadCount&&h.get('litestand_blended_sidebar')&&h.get('litestand_buddylist_count'))return;var t=h.get('divebar_favorite_list',0)&&i.isEditMode();if(t)return;return (m.DOM.div({className:"_568z"},m.DOM.div({className:"_568-"},this.props.statusTime),k({className:"_568_",src:s})));},renderBirthday:function(){if(!this.props.birthday)return null;return (k({className:"_5dv3",src:p('/images/gifts/icons/cake_icon.png')}));},getStatusSrc:function(){switch(this.props.status){case g.ACTIVE:case g.IDLE:if(this.props.litestandSidebar)return h.get('litestand_blended_sidebar')?p('/images/litestand/sidebar/blended/online.png'):p('/images/litestand/sidebar/online.png');return p('/images/chat/status/online.png');case g.MOBILE:if(this.props.litestandSidebar)return h.get('litestand_blended_sidebar')?p('/images/litestand/sidebar/blended/pushable.png'):p('/images/litestand/sidebar/pushable.png');return p('/images/chat/status/mobile.png');}return null;}});e.exports=r;});
__d("ChatSidebarThread.react",["ChatSidebarItem.react","WebMessengerPermalinkConstants","React","MercuryThreadMetadataRawRenderer"],function(a,b,c,d,e,f){var g=b('ChatSidebarItem.react'),h=b('WebMessengerPermalinkConstants'),i=b('React'),j=b('MercuryThreadMetadataRawRenderer'),k=i.createClass({displayName:'ChatSidebarThread',render:function(){var n=this.props.name,o=l(this.props.threadID,this.props.participants),p=n?o:undefined,q=h.getURIPathForThreadID(this.props.threadID),r=m(this.props.image,this.props.participants),s=n?n:o;return (g({context:p,href:{url:q},imageSize:this.props.imageSize,images:r,litestandSidebar:this.props.litestandSidebar,name:s,status:this.props.status,unreadCount:this.props.unreadCount}));}});function l(n,o){return j.renderRawParticipantList(n,o,o.length,{names_renderer:j.renderShortNames});}function m(n,o){if(n)return n;return o.map(function(p){return p.image_src;});}e.exports=k;});
__d("ChatSidebarThreadlist.react",["ChatConfig","ChatGroupThreadsController","ChatSidebarConstants","ChatSidebarItem.react","ChatSidebarThread.react","MercuryServerRequests","MercuryThreads","MercuryParticipants","PresenceStatus","React","copyProperties","cx","fbt","ix"],function(a,b,c,d,e,f){var g=b('ChatConfig'),h=b('ChatGroupThreadsController'),i=b('ChatSidebarConstants'),j=b('ChatSidebarItem.react'),k=b('ChatSidebarThread.react'),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get(),n=b('MercuryParticipants'),o=b('PresenceStatus'),p=b('React'),q=b('copyProperties'),r=b('cx'),s=b('fbt'),t=b('ix'),u=p.createClass({displayName:'ChatSidebarThreadlist',render:function(){var v=this.state.threadData,w=this.state.participantData,x=i.IMAGE_SIZE,y=t('/images/chat/sidebar/newGroupChat.png');if(this.props.litestandSidebar){x=g.get('litestand_blended_sidebar')?i.LITESTAND_BLENDED_SIZE:i.LITESTAND_IMAGE_SIZE;y=g.get('litestand_blended_sidebar')?t('/images/litestand/sidebar/blended/new_group_chat.png'):t('/images/chat/sidebar/newGroupChatLitestand.png');}var z="New Group Chat...";z=g.get('divebar_group_new_button_name',z);var aa=[];if(this.props.showNewGroupsButton)aa.push(p.DOM.li({className:(("_56yg")+(' '+"_56yj")+(this.props.offlineItems?' '+"_570-":'')),key:"new"},j({images:y,imageSize:x,litestandSidebar:this.props.litestandSidebar,name:z})));var ba={};for(var ca in v){var da=v[ca],ea=da.participants.map(function(ia){return (w||{})[ia];}).filter(function(ia){return ia;}),fa=da.participants.map(function(ia){return n.getUserID(ia);}),ga=fa.sort().join('|');if(!ba[ga]&&ea.length){ba[ga]=1;var ha=l.getServerThreadIDNow(ca);aa.push(p.DOM.li({className:(("_5a58")+(' '+"_56yg")+(this.props.offlineItems?' '+"_570-":'')),'data-serverthreadid':ha,'data-threadid':ca,key:ca},k({image:da.image_src,imageSize:x,litestandSidebar:this.props.litestandSidebar,name:da.name,participants:ea,status:o.getGroup(fa),threadID:ca,unreadCount:da.unread_count})));}}return p.DOM.ul(null,aa);},getInitialState:function(){return {};},componentWillMount:function(){var v=function(){this.setState(this._calculateState());}.bind(this);this.token=h.subscribe('update',v);v();},componentWillUnmount:function(){this.token&&this.token.unsubscribe();this.token=null;},_calculateState:function(){var v=false,w={},x={},y=h.getThreadIDs(),z=y.length;y.forEach(function(ba){m.getThreadMeta(ba,function(ca){x[ba]=ca;n.getMulti(ca.participants,function(da){delete da[n.user];if(v){this.setState(this._calculateState());}else q(w,da);z--;}.bind(this));}.bind(this));}.bind(this));if(z===0){return {threadData:x,participantData:w};}else{v=true;var aa=this.state||{};return {threadData:q(aa.threadData,x),participantData:q(aa.participantData,w)};}}});e.exports=u;});
__d("OrderedFriendsList",["AvailableList","ChatConfig","createArrayFrom","ShortProfiles","InitialChatFriendsList"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('ChatConfig'),i=b('createArrayFrom'),j=b('ShortProfiles'),k=[],l={},m=[],n={contains:function(o){return o in l;},compare:function(o,p){var q=n.getRank(o),r=n.getRank(p);if(q!==r)return q-r;var s=j.getNowUnsafe(o),t=j.getNowUnsafe(p),u=((s||{}).name||'~').toLowerCase(),v=((t||{}).name||'~').toLowerCase();if(u!==v)return u<v?-1:1;return 0;},getList:function(){if(h.get('chat_web_ranking_with_presence'))n.reRank();var o=i(k);o=o.filter(function(p){var q=j.getNowUnsafe(p);return !q||q.type=="friend";});return o;},getRank:function(o){return o in l?l[o]:k.length;},reRank:function(){var o={},p={};m.forEach(function(r,s){var t=r.substr(0,r.length-2),u=r.substring(r.length-1);if(typeof(p.uid)=='undefined'){if(typeof(o.uid)=='undefined')o[t]=g.get(t);var v=o[t];if(v==u)p[s]=t;}});k=[];for(var q in p)k.push(p[q]);k.forEach(function(r,s){l[r]=s;});}};(function(){var o=b('InitialChatFriendsList');k=o.list.length?o.list:[];if(h.get('chat_web_ranking_with_presence')){m=k.slice();n.reRank();}k.forEach(function(p,q){l[p]=q;});})();e.exports=a.OrderedFriendsList||n;});
__d("ChatOrderedList",["Animation","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","CSS","ChannelImplementation","Chat","ChatConfig","ChatContexts","ChatFavoriteList","ChatFavoriteNux","ChatGroupThreadsController","ChatOrderedListHover","ChatQuietLinks","ChatSidebarThreadlist.react","ChatTypeaheadConstants","ChatVisibility","DOM","DataStore","Ease","Event","ImageSourceRequest","ImageSourceType","ix","JSLogger","JSXDOM","LastMobileActiveTimes","MercuryParticipantTypes","MercuryThreadInformer","MercuryThreads","OrderedFriendsList","Parent","PhotoResizeModeConst","PresencePrivacy","PresenceStatus","React","Rect","ShortProfiles","Style","Tooltip","TokenizeUtil","URI","Vector","XHPTemplate","copyProperties","createObjectFrom","csx","cx","debounceAcrossTransitions","guid","requestAnimationFrame","runAfterScrollingStops","shield","throttle","tx"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncDialog'),k=b('AsyncRequest'),l=b('AvailableList'),m=b('AvailableListConstants'),n=b('Bootloader'),o=b('CSS'),p=b('ChannelImplementation').instance,q=b('Chat'),r=b('ChatConfig'),s=b('ChatContexts'),t=b('ChatFavoriteList'),u=b('ChatFavoriteNux'),v=b('ChatGroupThreadsController'),w=b('ChatOrderedListHover'),x=b('ChatQuietLinks'),y=b('ChatSidebarThreadlist.react'),z=b('ChatTypeaheadConstants'),aa=b('ChatVisibility'),ba=b('DOM'),ca=b('DataStore'),da=b('Ease'),ea=b('Event'),fa=b('ImageSourceRequest'),ga=b('ImageSourceType'),ha=b('ix'),ia=b('JSLogger'),ja=b('JSXDOM'),ka=b('LastMobileActiveTimes'),la=b('MercuryParticipantTypes'),ma=b('MercuryThreadInformer').get(),na=b('MercuryThreads').get(),oa=b('OrderedFriendsList'),pa=b('Parent'),qa=b('PhotoResizeModeConst'),ra=b('PresencePrivacy'),sa=b('PresenceStatus'),ta=b('React'),ua=b('Rect'),va=b('ShortProfiles'),wa=b('Style'),xa=b('Tooltip'),ya=b('TokenizeUtil'),za=b('URI'),ab=b('Vector'),bb=b('XHPTemplate'),cb=b('copyProperties'),db=b('createObjectFrom'),eb=b('csx'),fb=b('cx'),gb=b('debounceAcrossTransitions'),hb=b('guid'),ib=b('requestAnimationFrame'),jb=b('runAfterScrollingStops'),kb=b('shield'),lb=b('throttle'),mb=b('tx'),nb=r.get('chat_ranked_by_coefficient',0),ob=null,pb,qb,rb=9;function sb(zb,ac,bc,cc,dc,ec){this._isSidebar=zb;this._isLitestand=r.get('litestand',0)||r.get('test_litestand_sidebar',0);this._isLitestandSidebar=this._isSidebar&&this._isLitestand;this._isLeftCollapsedSidebar=!!pa.byClass(ac,"_5ap0");this._root=ac;this._itemsMap={};this._isVisible=false;this._excludedIds={};this._numTopFriends=5;this._hasRendered=false;this._preventRendering=false;this._hoverController=null;this._template=bc;this._messageTemplate=cc;this._favoriteMode=r.get('divebar_favorite_list',0);this._contextualDialog=dc;this._cachedItemHeight=null;this._cachedItemPadding=null;if(ec&&ba.scry(ec,"._54y_").length){o.show(ec);this._pymk=ec;}this._usePlaceholder=this._isLitestand&&this._isSidebar;if(r.get('groups_in_divebar')){this._groupThreadsNode=ja.li({className:"_56yf"});this._updateGroupThreads();this._groupsList=this._favoriteMode&&ba.find(this._root,"._56yh");}if(this._favoriteMode){this._favoriteSidebar=ba.find(this._root,"._42g5");this._editButton=ba.scry(this._root,"._57m9 ._54sl")[0];this._favoriteList=ba.find(this._root,"._54sm");this._activeNowList=ba.find(this._root,"._54sn");this._activeNowLabel=ba.scry(this._root,"._42g9")[0];if(this._activeNowLabel)this._activeNowArea=pa.byClass(this._activeNowLabel,"_57yh");}this._orderedList=ba.find(this._root,'.fbChatOrderedList');this._scrollableOrderedList=pa.byClass(this._root,'scrollableOrderedList');this._chatSidebar=pa.byClass(this._root,'fbChatSidebar');this._scrollableArea=pa.byClass(this._root,'scrollable');ea.listen(this._root,'click',this._onClick.bind(this));ea.listen(this._root,'mouseenter',this._mouseEnter.bind(this));ea.listen(this._root,'mouseleave',this._mouseLeave.bind(this));if(this._editButton){ea.listen(this._editButton,'click',this.toggleEditMode.bind(this));h.subscribe(['LitestandSidebarBookmarks/close','LitestandSidebar/collapse'],this._onEditEnd.bind(this));}h.subscribe(['LitestandSidebar/collapse','LitestandSidebar/expand'],function(event){if(this._isLitestandSidebar)this.getHoverController().setPaused(event==='LitestandSidebar/collapse');this.render();}.bind(this));l.subscribe(m.ON_AVAILABILITY_CHANGED,kb(this.update,this));ra.subscribe('privacy-changed',kb(this.update,this));p.subscribe([p.CONNECTED,p.RECONNECTING,p.SHUTDOWN,p.MUTE_WARNING,p.UNMUTE_WARNING],kb(this.update,this));this.inform('initialized',this,h.BEHAVIOR_PERSISTENT);this.render();h.subscribe(ia.DUMP_EVENT,function(fc,gc){gc.chat_lists=gc.chat_lists||{sorted_list:this.getCachedSortedList(),ordered_list:oa.getList(),available_list:sb.getAvailableList(this._excludedIds),excluded_list:this._excludedIds};}.bind(this));h.subscribe('ChatOrderedList/itemHeightChange',function(){this._cachedItemHeight=null;this._cachedItemPadding=null;}.bind(this));this._renderUnreadCount=r.get('divebar_message_count');if(this._renderUnreadCount)ma.subscribe('threads-updated',function(fc,gc){for(var hc in gc){var ic=na.getCanonicalUserInThread(hc);if(!this._renderedTopUsers||!(ic in this._renderedTopUsers)||!this._itemsMap[ic])continue;na.getThreadMeta(hc,function(jc){var kc=jc&&jc.unread_count;this._updateUnreadCount(ic,kc);}.bind(this));}}.bind(this));}function tb(zb,ac){var bc=ub(zb,ac);if(bc!==0)return bc;if(!nb){var cc=xb(zb,ac);if(cc!==0)return cc;}return oa.compare(zb,ac);}function ub(zb,ac){var bc=ra.allows(zb),cc=ra.allows(ac);if(bc!==cc)return bc?-1:1;return 0;}var vb={};function wb(zb){return vb[zb]||(vb[zb]=ya.flatten(zb));}function xb(zb,ac){var bc=va.getNowUnsafe(zb),cc=va.getNowUnsafe(ac),dc=wb((bc||{}).name||'~'),ec=wb((cc||{}).name||'~');if(dc!==ec)return dc<ec?-1:1;return 0;}function yb(zb,ac){var bc=l.get(zb)===m.MOBILE,cc=l.get(ac)===m.MOBILE;if(bc!==cc)return cc?-1:1;return xb(zb,ac);}cb(sb,{CONTEXT_CLASSES:{nearby:"_56xw",visiting:"_56xx",neighbourhood:"_56xy",listening:"_56xz"},getSortedList:function(zb,ac){var bc=oa.getList().filter(function(ec){return !(ec in zb)&&ra.getFriendVisibility(ec)!==ra.BLACKLISTED;}),cc=[];if(!aa.isOnline()){Array.prototype.push.apply(cc,bc);}else{if(ra.getOnlinePolicy()===ra.ONLINE_TO_WHITELIST)bc=this._filterByWhitelist(bc);if(r.get('chat_web_ranking_with_presence')){Array.prototype.push.apply(cc,bc);}else cc=this._splitOutTopFriends(bc,ac);}cc=cc.slice(0,ac);if(cc.length===ac){var dc=sb.getAvailableList(cc.concat(zb)).length;dc&&cc.splice(-1);}if(!r.get('chat_web_ranking_with_presence'))cc.sort(tb);ob=cc.slice();return cc;},_filterByWhitelist:function(zb){var ac=zb,bc={},cc,dc;zb=[];for(cc=0;cc<ac.length;++cc){dc=ac[cc];if(ra.allows(dc)){bc[dc]=true;zb.push(dc);}}var ec=ra.getWhitelist();for(cc=0;cc<ec.length;++cc){dc=ec[cc];if(!(dc in bc))zb.push(dc);}for(cc=0;cc<ac.length;++cc){dc=ac[cc];if(!ra.allows(dc))zb.push(dc);}return zb;},_splitOutTopFriends:function(zb,ac){var bc=[],cc=[],dc=r.get('ordered_list.top_friends',0),ec=r.get('ordered_list.top_mobile',0),fc=ac,gc=zb.length;for(var hc=0;hc<gc&&fc>0;hc++){var ic=zb[hc],jc=l.get(ic),kc=jc===m.ACTIVE;if(kc||(jc===m.MOBILE&&hc<ec)||hc<dc){bc.push(ic);kc&&fc--;}else cc.push(ic);}if(hc<gc)Array.prototype.push.apply(cc,zb.slice(hc));if(bc.length<ac)Array.prototype.push.apply(bc,cc);return bc;},getAvailableList:function(zb){var ac;if(r.get('divebar_show_mobile_more_friends')||r.get('divebar_show_mobile_more_friends_alphabetical'))ac=l.getAvailableIDs();if(!ac)ac=l.getOnlineIDs();return ac.filter(function(bc){return !(bc in zb);});},_pause:function(){qb=true;},_unpause:function(){qb=false;},_registerToggleRenderItem:function(zb){ea.listen(zb,'click',function(){qb=!qb;o.conditionClass(zb,'checked',qb);});}});cb(sb.prototype,i,{getAllNodes:function(){var zb={},ac=ba.scry(this._root,"li._42fz");for(var bc=0;bc<ac.length;bc++){var cc=ca.get(ac[bc],'id');if(cc)zb[cc]=ac[bc];}return zb;},getShowingUsers:function(){return ba.scry(this._root,"li._42fz,li._5a58").map(this.getUserForNode);},getUserForNode:function(zb){return ca.get(zb,'id')||ca.get(zb,'serverthreadid');},getHoverController:function(){if(!this._hoverController){this._hoverController=new w(this,this._contextualDialog);if(this._isLitestandSidebar&&this._isLitestandSidebarCollapsed())this._hoverController.setPaused(true);}return this._hoverController;},_isLitestandSidebarCollapsed:function(){if(this._isLeftCollapsedSidebar)return true;if(pb)return !pb.isExpanded();n.loadModules(['LitestandSidebar'],function(zb){pb=zb;});return o.hasClass(document.documentElement,"_4kdq");},getPaddingOffset:function(){return this._favoriteMode?24:8;},_calculateItemMeasurements:function(){var zb=this._orderedList,ac=this._template.build(),bc=ac.getRoot();ba.setContent(ac.getNode('name'),'test');if(this._favoriteSidebar){zb=this._favoriteList;o.addClass(this._favoriteSidebar,"_4zmr");}bc.style.visibility='hidden';ba.appendContent(zb,bc);this._cachedItemHeight=ab.getElementDimensions(bc).y;this._cachedItemPadding=wa.getFloat(ac.getNode('anchor'),'padding')||0;ba.remove(bc);if(this._favoriteSidebar)o.removeClass(this._favoriteSidebar,"_4zmr");},getItemHeight:function(){if(this._cachedItemHeight===null)this._calculateItemMeasurements();return this._cachedItemHeight;},getItemPadding:function(){if(this._cachedItemPadding===null)this._calculateItemMeasurements();return this._cachedItemPadding;},_updateGroupThreads:function(){if(this._groupThreadsNode){var zb=ra.getVisibility(),ac=y({offlineItems:p.disconnected()||!zb,litestandSidebar:this._isSidebar&&this._isLitestand&&!r.get('test_old_divebar'),showNewGroupsButton:r.get('divebar_has_new_groups_button',false)});ta.renderComponent(ac,this._groupThreadsNode);}},_placeholderUpdate:function(){if(!this._usePlaceholder||!this._scrollContainer)return;var zb=this._root.offsetTop-this._scrollContainer.scrollTop;this._scrollContainerHeight=this._scrollContainerHeight||this._scrollContainer.offsetHeight;var ac=this.getItemHeight(),bc=Math.ceil(this._scrollContainerHeight/ac),cc=zb<0?Math.max(Math.floor(-zb/ac)-bc,0):0,dc=cc+bc+bc;this._cachedItems=this._cachedItems||ba.scry(this._root,"li._42fz");for(var ec=0,fc=this._cachedItems.length;ec<fc;ec++)o.conditionClass(this._cachedItems[ec],"_50zv",ec<cc||ec>dc);},_getListItem:function(zb,ac){var bc=this._itemsMap[zb];if(!bc)return;var cc=l.get(zb),dc=sa.isBirthday(zb),ec=ra.allows(zb)&&!p.disconnected();if(bc.buttonNode===undefined){bc.buttonNode=ba.scry(bc.node,"._54sk")[0];bc.contextNode=ba.find(bc.node,"._52zk");bc.timeNode=ba.scry(bc.node,'.active_time')[0];bc.statusNodes=ba.scry(bc.node,'img.status');}o.conditionClass(bc.node,"_42f-",ac);o.conditionClass(bc.node,"_54sj",ac);o.conditionClass(bc.node,"_52s3",this._isLitestand&&ac);if(bc.buttonNode)if(!this._isLitestand){o.conditionClass(bc.buttonNode,"_42f_",ac);o.conditionClass(bc.buttonNode,"_42g0",!ac);}var fc={active:false,mobile:false,birthday:false};fc.active=cc===m.ACTIVE;fc.mobile=cc===m.MOBILE;fc.birthday=dc;if(fc.mobile){var gc=ka.getShortDisplay(zb);if(bc.timeNode&&bc.lastActiveTime!==gc){bc.lastActiveTime=gc;ba.setContent(bc.timeNode,gc);}}else if(bc.lastActiveTime){bc.lastActiveTime=null;ba.empty(bc.timeNode);}for(var hc in fc)o.conditionClass(bc.node,hc,fc[hc]&&ec);o.conditionClass(bc.node,'invis',!ec);var ic=o.hasClass(document.documentElement,'highContrast');bc.statusNodes.forEach(function(jc){if(cc===m.ACTIVE&&ec){jc.alt="Online";if(ic)jc.src=ha('/images/chat/status/online.png');}else if(cc===m.MOBILE&&ec){jc.alt="Mobile";if(ic)jc.src=ha('/images/chat/status/mobile.png');}else{jc.alt='';if(ic)jc.src=ha('/images/spacer.gif');}});this._applyContext(zb,bc);return bc.node;},getRoot:function(){return this._root;},getSortedList:function(zb){return sb.getSortedList(zb||this._excludedIds,this._numTopFriends);},getCachedSortedList:function(zb){if(ob==null)ob=this.getSortedList(zb);return ob;},toggleFavoriteSidebar:function(zb,ac){function bc(ec,fc){o.conditionShow(fc,ec);var gc=pa.byClass(fc,'uiContextualLayerPositioner');gc&&o.conditionShow(gc,ec);}o.conditionShow(this._orderedList,!zb);if(this._favoriteSidebar)o.conditionShow(this._favoriteSidebar,zb);var cc=ba.scry(this._scrollableOrderedList||this._root,"._42i3");cc.forEach(bc.curry(zb));var dc=ba.scry(this._scrollableOrderedList||this._root,"._56yi");dc.length&&bc(ac,dc[0]);},hide:function(){if(!this._isVisible)return;this._isVisible=false;u.tryHide();o.hide(this._scrollableOrderedList||this._root);this.inform('hide');},_onFavoriteOrderChange:function(){var zb=this.sortableGroup.getOrder();t.updateList(zb);t.save();},_getFavoriteItems:function(){var zb=[],ac=t.get();for(var bc=0;bc<ac.length;bc++){var cc=this._itemsMap[ac[bc]];if(cc)zb.push(cc.node);}return zb;},_getChatTabOpenLogData:function(zb){var ac=o.hasClass(document.documentElement,'sidebarMode'),bc={mode:ac?'sidebar':'chatNub',typehead:false};if(this._scrollableArea&&this._scrollContainer){var cc=ab.getElementPosition(this._scrollableArea,'viewport').y,dc=ab.getElementPosition(zb,'viewport').y,ec=this._scrollContainer.scrollTop;if(dc>cc){bc.visible_slot=Math.round((dc-cc)/32);var fc=Math.round(ec/32);bc.global_slot=bc.visible_slot+fc;}}if(ac){bc.sidebar_height=this._chatSidebar&&this._chatSidebar.clientHeight;if(this._scrollContainer)bc.buddylist_height=this._scrollContainer.clientHeight;}return bc;},_resetFavoriteBounds:function(){var zb=t.get(),ac=zb.length;if(ac){var bc=zb[0],cc=zb[ac-1],dc=this._itemsMap[bc],ec=this._itemsMap[cc],fc=new ua(ab.getElementPosition(dc.node).y,0,ab.getElementPosition(ec.node).y+ab.getElementDimensions(ec.node).y,0);this.sortableGroup.setBoundingBox(fc);}},_createSortableGroup:function(){if(this.sortableGroup)this.sortableGroup.destroy();n.loadModules(['SortableGroup'],function(zb){this.sortableGroup=new zb().setBeforeGrabCallback(this._resetFavoriteBounds.bind(this)).setOrderChangeHandler(this._onFavoriteOrderChange.bind(this));if(this._isLitestand)this.sortableGroup.gutter=1;var ac=this._getFavoriteItems();for(var bc=0;bc<ac.length;bc++){var cc=ac[bc];this.sortableGroup.addSortable(ca.get(cc,'id'),cc);}}.bind(this));},toggleEditMode:function(){u.dismissDialog();t.toggleEditMode();if(t.isEditMode()){this._createSortableGroup();ba.setContent(this._editButton,"DONE");o.addClass(this._favoriteSidebar,"_4-d6");this.inform('editStart');}else this._onEditEnd();},_onEditEnd:function(){if(t.isEditMode())t.toggleEditMode();ba.setContent(this._editButton,"EDIT");o.removeClass(this._favoriteSidebar,"_4-d6");this.inform('editEnd');},_onClick:function(event){var zb=event.getTarget(),ac=pa.byTag(zb,'li');if(t.isEditMode()){var bc=pa.byClass(zb,"_54sk");if(bc&&ac){var cc=ca.get(ac,'id');if(cc){t.toggleID(cc);t.save();}this.update();}event.prevent();return false;}if(ac){if(o.hasClass(ac,'blackbirdWhitelist')){var dc=new za('/ajax/chat/privacy/settings_dialog.php').addQueryData({ref:'whitelist_separator'});j.send(new k(dc));event.prevent();return false;}var ec=ca.get(ac,'id'),fc=o.hasClass(ac,"_56yg");if(ec||fc){var gc=this._getChatTabOpenLogData(ac),hc=o.hasClass(document.documentElement,'sidebarMode'),ic=ra.getOnlinePolicy()===ra.ONLINE_TO_WHITELIST,jc=ic?'white_list':'ordered_list';if(fc){ec=ac.getAttribute('data-threadid');jc=ec?'recent_threads_in_divebar':'recent_threads_in_divebar_new';}else if(hc&&this._favoriteMode&&!ic){while(ac.parentNode){ac=ac.parentNode;if(o.hasClass(ac,"_42g8")){jc='more_online_friends';break;}if(o.hasClass(ac,"_42g7"))break;}}else while(ac.previousSibling){ac=ac.previousSibling;if(o.hasClass(ac,"_554m")){if(o.hasClass(ac,'moreOnlineFriends')){jc='more_online_friends';break;}if(o.hasClass(ac,'blackbirdWhitelist')){jc='blackbird_offline_section';break;}}}gc.source=jc;var kc=fc?z.THREAD_TYPE:la.FRIEND;q.openTab(ec,kc,gc);this.inform('click',{id:ec});}else if(o.hasClass(ac,"_554m")&&pa.byClass(zb,"_554n")){this.scrollTo(ac);}else if(o.hasClass(ac,"_55nf"))return;return false;}},_mouseEnter:function(){this._preventRendering=true;},_mouseLeave:function(){this._preventRendering=false;},setExcludedIds:function(zb){this._excludedIds=db(zb||[]);},setNumTopFriends:function(zb){if(zb!==this._numTopFriends){this._numTopFriends=zb;this.render();}},_getOfflineToSectionItems:function(){var zb='subheader-text-'+hb(),ac=ba.create('a',{href:'#','aria-describedby':zb},ba.tx._("Edit")),bc=[],cc=ba.tx._("MORE FRIENDS");bc.push(ja.li({className:"_554m"},ja.div({className:"_554o"},ja.div({className:"_554n"},ja.span({className:"_554p"},cc),ja.div({className:"_554q"},ja.span({className:"_554r"}))))));bc.push(ja.li({className:"_554m blackbirdWhitelist"},ja.div({className:"_554o"},ja.div({className:"fbChatOrderedList/separatorInner"},ja.div({className:"fbChatOrderedList/separatorSubheader"},ja.span({id:zb,className:"_554t"},mb._("These friends can't see you on chat. {=link}",{'=link':ac})))))));return bc;},_renderOrderedList:function(){if(!this._isVisible||(this._preventRendering&&this._hasRendered)||qb)return;this._hasRendered=true;this._cachedItems=null;var zb=[],ac,bc,cc=false,dc=false,ec=r.get('divebar_has_new_groups_button',false),fc=o.hasClass(document.documentElement,'sidebarMode'),gc=ra.getVisibility(),hc=ra.getOnlinePolicy()===ra.ONLINE_TO_WHITELIST,ic=this._isLitestandSidebar&&this._isLitestandSidebarCollapsed(),jc=r.get('groups_in_divebar');jc&&this._updateGroupThreads();var kc=jc&&v.getThreadIDs().length,lc=fc&&this._favoriteMode&&gc&&!hc;if(lc&&jc&&kc&&this._groupThreadsNode){ba.setContent(this._groupsList,this._groupThreadsNode);x.nukeLinks(this._groupThreadsNode);x.nukeLinks(this._favoriteList);this.inform('render');}var mc=lc&&this._groupThreadsNode&&this._groupsList,nc=mc&&kc,oc=this._isLitestand&&!pa.byClass(this._root,"_4w59");if(mc&&(kc||oc&&ec)){ba.setContent(this._groupsList,this._groupThreadsNode);o.show(this._groupsList);x.nukeLinks(this._favoriteList);this.inform('render');}else this._groupsList&&o.hide(this._groupsList);var pc=kc||0;if(ec&&(nc||!lc))pc++;var qc=[],rc,sc;if(lc){this._chatSidebar&&o.addClass(this._chatSidebar,'fbSidebarFavoriteList');qc=t.get();if(ic)qc=qc.slice(0,Math.max(0,this._numTopFriends-pc));for(rc=0,sc=qc.length;rc<sc;rc++){ac=qc[rc];bc=this._getListItem(ac,true);if(bc){zb.push(bc);}else{dc=true;this._renderListItem(ac,this.update.bind(this));}}}this.toggleFavoriteSidebar(lc,nc);var tc=ic?1:0,uc=sb.getSortedList(db(qc),Math.max(0,this._numTopFriends-qc.length-pc+tc));if(lc){if(qc.length&&uc.length){var vc=ba.create('li',{className:"_42g3"});zb.push(vc);}}else if(kc||ec)this._groupThreadsNode&&zb.push(this._groupThreadsNode);var wc=ra.getVisibility()&&ra.getOnlinePolicy()==ra.ONLINE_TO_WHITELIST;for(var xc=0,yc=uc.length;xc<yc;xc++){ac=uc[xc];if(wc)if(!ra.allows(ac)){if(xc+2>=uc.length)break;wc=false;var zc=this._getOfflineToSectionItems();zb.push(zc[0]);zb.push(zc[1]);yc-=2;}bc=this._getListItem(ac);if(bc){zb.push(bc);}else this._renderListItem(ac,this.render.bind(this));}if(lc){ba.setContent(this._favoriteList,zb);if(zb.length)x.nukeLinks(this._favoriteList);this.inform('render');}var ad;if(ic){ad=[];}else ad=sb.getAvailableList(this._excludedIds);var bd=qc.concat(uc),cd=db(bd);ad=ad.filter(function(kd){return !(kd in cd);});if(this._renderUnreadCount){var dd=[];if(this._renderedTopUsers){var ed=Object.keys(this._renderedTopUsers).filter(function(kd){return !(kd in cd);});ed.forEach(function(kd){this._updateUnreadCount(kd,0);}.bind(this));bd.forEach(function(kd){if(!(kd in this._renderedTopUsers))dd.push(kd);}.bind(this));}else dd=bd;dd.forEach(function(kd){na.getThreadMeta(na.getThreadIdForUser(kd),function(ld){this._updateUnreadCount(kd,ld&&ld.unread_count);}.bind(this));}.bind(this));this._renderedTopUsers=cd;}if(r.get('divebar_show_mobile_more_friends_alphabetical')){ad.sort(xb);}else ad.sort(yb);var fd="MORE FRIENDS";if(lc){zb=[];}else if(ad.length&&zb.length){var gd;if(this._isLitestand){gd=ja.span(null,ja.span({className:"_554u"},fd," · ",ad.length),ja.span({className:"_554v"}," +",ad.length));}else gd=mb._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':fd,'=count':ad.length});if(this._pymk){cc=true;zb.push(this._pymk);}zb.push(ja.li({className:"_554m moreOnlineFriends"},ja.div({className:"_554o"},ja.div({className:"_554n"},ja.span({className:"_554p"},gd),ja.div({className:"_554q"},ja.span({className:"_554r"}))))));}for(rc=0,sc=ad.length;rc<sc;rc++){ac=ad[rc];bc=this._getListItem(ac);if(bc){zb.push(bc);}else this._renderListItem(ac,this.render.bind(this));}if(!uc.length&&!ad.length&&!pc){var hd=this._messageTemplate.render(),id=bb.getNode(hd,'message');ba.setContent(id,"No one is available to chat.");zb.push(hd);}if(zb.length){if(lc){o.show(this._activeNowList);if(this._activeNowLabel){var jd;o.show(this._activeNowArea);if(this._isLitestand){jd=ja.span(null,ja.span({className:"_554u"},fd," · ",ad.length),ja.span({className:"_554v"}," +",ad.length));}else jd=mb._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':"ACTIVE NOW",'=count':ad.length});ba.setContent(this._activeNowLabel,jd);}ba.setContent(this._activeNowList,zb);x.nukeLinks(this._activeNowList);}else{if(this._pymk&&!cc)zb.push(this._pymk);ba.setContent(this._orderedList,zb);if(this._pymk){x.removeMessagesHrefs(this.getRoot());}else x.nukeLinks(this.getRoot());}this.inform('render');this._placeholderUpdate();if(!this._renderingAfterScroll){this._renderingAfterScroll=true;this.render=gb(jb.curry(this._renderOrderedList.bind(this),'ChatOrderedList/render',true),300);}}else if(lc){o.hide(this._activeNowList);if(this._activeNowArea)o.hide(this._activeNowArea);}if(lc){this._editButton&&u.tryShow(this._editButton);}else u.tryHide();if(lc&&!dc)if(t.isEditMode()&&t.hasChanged())this._createSortableGroup();},render:function(){this.render=gb(this._renderOrderedList.bind(this),300);this.render();},_renderListItem:function(zb,ac){va.get(zb,function(bc){var cc=this._template.render(),dc=bb.getNode(cc,'profile-photo');if(r.get('chat_use_client_side_image_requests',0)){var ec=this._isLitestand?24:28;new fa().setFBID(bc.id).setType(ga.PROFILE_PICTURE).setDimensions(ec,ec).setResizeMode(qa.COVER).setCallback(function(jc){dc.setAttribute('src',jc.uri);}).send();}else dc.setAttribute('src',bc.thumbSrc);var fc=bb.getNode(cc,'name');ba.setContent(fc,bc.name);var gc=bb.getNode(cc,'accessible-name');ba.setContent(gc,bc.name);var hc=bb.getNode(cc,'anchor');hc.setAttribute('href','/messages/'+zb);var ic=bb.getNode(cc,'tooltip');ic&&xa.set(ic,bc.name,'right');ca.set(cc,'id',zb);this._itemsMap[zb]={node:cc};ac&&ac(cc);}.bind(this));},_updateUnreadCount:function(zb,ac){var bc=this._itemsMap[zb];if(!bc)return;if(this._isSidebar){this._unreadMessages=this._unreadMessages||{};if(!!ac){this._unreadMessages[zb]=true;}else delete this._unreadMessages[zb];h.inform('buddylist-nub/updateCount',{count:Object.keys(this._unreadMessages).length});}bc.unreadCount=bc.unreadCount||ba.find(bc.node,"._550_");ac=ac?ac:0;ba.setContent(bc.unreadCount,ac>rb?rb+'+':ac);o.conditionClass(bc.unreadCount,"_550z",ac>rb);o.conditionClass(bc.node,"_550-",ac);},show:function(){if(this._isVisible)return;this._isVisible=true;o.show(this._scrollableOrderedList||this._root);this.render();this.inform('show');},isVisible:function(){return this._isVisible;},update:function(){this._hasRendered=false;if(!this._renderRequest)this._renderRequest=ib(function(){this.render();this._renderRequest=null;}.bind(this));},setScrollContainer:function(zb){if(ba.contains(zb,this._root)){this._scrollContainer=zb;if(this._usePlaceholder){ea.listen(zb,'scroll',lb.acrossTransitions(this._placeholderUpdate.bind(this)));ea.listen(window,'resize',lb.acrossTransitions(function(){this._scrollContainerHeight=null;this._placeholderUpdate();}.bind(this),250));}}},scrollTo:function(zb){if(!this._scrollContainer)return;var ac=this._scrollContainer.scrollHeight,bc=this._scrollContainer.clientHeight,cc=this._scrollContainer.scrollTop,dc=Math.min(zb.offsetTop,ac-bc);if(cc!==dc){var ec=this._isLitestand?600:Math.abs(dc-cc)/this._scrollContainer.clientHeight*500,fc=this._isLitestand?da.easeOutExpo:g.ease.end;new g(this._scrollContainer).to('scrollTop',dc).ease(fc).duration(ec).go();}},_applyContext:function(zb,ac){var bc=s.getShortDisplay(zb)||'';if(ac.contextNode){ba.setContent(ac.contextNode,bc);o.conditionClass(ac.node,"_52zj",bc);var cc=s.get(zb),dc=cc?cc.type:null;for(var ec in sb.CONTEXT_CLASSES){var fc=(ec===dc),gc=sb.CONTEXT_CLASSES[ec]||"_56x-";o.conditionClass(ac.contextNode,gc,fc);}}}});e.exports=sb;});
__d("TypingDetectorController",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","PresencePrivacy","ShortProfiles","TypingDetector","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChannelConnection'),k=b('ChatVisibility'),l=b('Keys'),m=b('PresencePrivacy'),n=b('ShortProfiles'),o=b('TypingDetector'),p=b('copyProperties'),q=b('emptyFunction'),r=b('shield');function s(u){if(!k.isOnline())return false;if(u){var v=n.getNow(u);return v&&v.type=="friend"&&m.allows(u);}return true;}function t(u,v,w,x,y){this.userID=u;this.input=v;this.source=w;this.threadID=y;this.remoteState=o.INACTIVE;this.notifyTimer=null;x=x||{};this.notifyDelay=x.notifyDelay||this.notifyDelay;this._typingDetector=new o(v);this._typingDetector.init(x);this._typingDetector.subscribe('change',this._stateChange.bind(this));}p(t.prototype,{notifyDelay:1000,setUserAndThread:function(u,v){if(this.userID!==u||this.threadID!==v){this.resetState();this.userID=u;this.threadID=v;}},setIgnoreEnter:function(u){var v=u?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(v);},resetState:function(){this.remoteState=t.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;},_stateChange:function(u,v){if(v!=o.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=r(this._notifyState,this,v).defer(this.notifyDelay,false);}else this._notifyState(v,true);},_notifyState:function(u,v){if(!this.userID&&!this.threadID)return;var w=this.userID,x=s(w);if(x&&u!=this.remoteState){this.remoteState=u;if(j.disconnected())return;var y={typ:u,to:w,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,w)).setErrorHandler(q).setData(y).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!v).send();}},_onTypResponse:function(u,v){var w=v.getPayload()||{};if(w.offline)h.set(u,i.OFFLINE,'typing_response');}});e.exports=t;});
__d("BlendedChatSidebar",["Arbiter","ArbiterMixin","Event","Style","SubscriptionsHandler","TinyViewport","Vector","mixin","queryThenMutateDOM"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Event'),j=b('Style'),k=b('SubscriptionsHandler'),l=b('TinyViewport'),m=b('Vector'),n=b('mixin'),o=b('queryThenMutateDOM'),p=n(h);for(var q in p)if(p.hasOwnProperty(q)&&q!=="_metaprototype")s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t){this.$BlendedChatSidebar0=t;this.onViewportUpdate();l.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){if(l.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$BlendedChatSidebar1=new k();this.$BlendedChatSidebar1.addSubscriptions(i.listen(window,'scroll',t),g.subscribe('dom-scroll',t));}else{if(this.$BlendedChatSidebar2!==0){j.set(this.$BlendedChatSidebar0,'margin-top','0');this.$BlendedChatSidebar2=0;}this.$BlendedChatSidebar1&&this.$BlendedChatSidebar1.release();}};s.prototype.onScroll=function(){o(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'BlendedChatSidebar/scroll');};s.prototype.updateScrollPosition=function(){this.$BlendedChatSidebar3=m.getScrollPosition().y;this.$BlendedChatSidebar4||(this.$BlendedChatSidebar4=this.$BlendedChatSidebar0.offsetHeight);};s.prototype.resizeSidebar=function(){var t=-Math.max(Math.min(this.$BlendedChatSidebar3,this.$BlendedChatSidebar4),0);j.set(this.$BlendedChatSidebar0,'margin-top',t+'px');if(t!=this.$BlendedChatSidebar2){this.$BlendedChatSidebar2=t;this.inform('resized',t);}};s.prototype.getOffset=function(){return this.$BlendedChatSidebar2;};e.exports=s;});
__d("ChatTypeaheadBehavior",["Chat","ChatConfig","ChatFavoriteList","CSS","DOM","Rect","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Chat'),h=b('ChatConfig'),i=b('ChatFavoriteList'),j=b('CSS'),k=b('DOM'),l=b('Rect'),m=b('copyProperties'),n=b('tx');function o(p){this._typeahead=p;}m(o.prototype,{_subscriptions:null,enable:function(){var p=this._typeahead;this._subscriptions=[p.subscribe('focus',function(){p.getData().refreshData();}),p.subscribe('blur',function(q){p.getCore().reset();}),p.subscribe('respond',function(q,r){if(r.value&&r.value===p.getCore().getValue()){if(!r.results.length){var s=h.get('divebar_typeahead_group_fof',0);if(s&&!r.isAsync)return;var t=k.create('div',{className:'noResults'},"Friend not found.");k.setContent(p.getView().getElement(),t);}j.addClass(p.getElement(),'hasValue');}}),p.subscribe('reset',function(){j.removeClass(p.getElement(),'hasValue');}),p.subscribe('select',function(q,r){if(i.isEditMode()){i.toggleID(r.selected.uid);i.save();}else{var s=j.hasClass(document.documentElement,'sidebarMode'),t={mode:s?'sidebar':'chatNub',source:'typeahead',type:r.selected.type,typeahead:true};g.openTab(r.selected.uid,r.selected.type,t);}}),p.subscribe('highlight',function(q,r){if(r.index>=0){var s=p.getView().getItems()[r.index];if(s){var t=new l(s),u=s.offsetParent,v=t.boundWithin(new l(u)).getPositionVector();t.getPositionVector().sub(v).scrollElementBy(u);}}})];},disable:function(){this._subscriptions.forEach(function(p){this._typeahead.unsubscribe(p);}.bind(this));this._subscriptions=null;}});e.exports=o;});
__d("ChatTypeaheadCore",["function-extensions","Class","Event","Keys","TypeaheadCore","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Class'),h=b('Event'),i=b('Keys'),j=b('TypeaheadCore'),k=b('copyProperties'),l=b('emptyFunction'),m=b('shield');function n(o){this.parent.construct(this,o);}g.extend(n,j);k(n.prototype,{init:function(o,p,q){this.parent.init(o,p,q);this.informBeginActive=false;this.informEndActive=false;this.data.subscribe('respond',function(){if(this.informBeginActive){this.informBeginActive=false;this.inform('sidebar/typeahead/active',true);}else if(this.informEndActive){this.informEndActive=false;this.inform('sidebar/typeahead/active',false);}}.bind(this));},handleTab:l,keydown:function(event){var o=h.getKeyCode(event);if(o===i.ESC){m(this.reset,this).defer();return event.kill();}return this.parent.keydown(event);},checkValue:function(){var o=this.getValue(),p=this.value;if(o==p)return;if(p&&!o){this.typeaheadActive=false;this.informEndActive=true;}else if(!p&&o){this.typeaheadActive=true;this.informBeginActive=true;this.inform('sidebar/typeahead/preActive');}this.parent.checkValue();}});e.exports=n;});
__d("ChatTypeaheadDataSource",["Class","DataSource","Env","JSLogger","MercuryParticipantTypes","OrderedFriendsList","Run","ShortProfiles","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DataSource'),i=b('Env'),j=b('JSLogger'),k=b('MercuryParticipantTypes'),l=b('OrderedFriendsList'),m=b('Run'),n=b('ShortProfiles'),o=b('copyProperties');function p(q){q=q||{};q.kanaNormalization=true;this.parent.construct(this,q);this.persistOnRefresh=q.persistOnRefresh!==false;this.showOfflineUsers=!!q.showOfflineUsers;this._jslog=j.create('chat_typeahead');this._jslog.log('created');}g.extend(p,h);o(p.prototype,{init:function(){this._jslog.log('init');this.parent.init();this._update();},bootstrap:function(){this._jslog.log('bootstrap');this.parent.bootstrap();if(this.showOfflineUsers){this._jslog.log('show_offline_users');this._jslog.log('ensured_short_profiles');if(n.hasAll()){this._update();}else{this._jslog.log('fetch_all_short_profiles');n.fetchAll();this.inform('activity',{activity:true});var q=n.subscribe('updated',function(){this.inform('activity',{activity:false});this._update();}.bind(this));if(!this.persistOnRefresh)m.onLeave(function(){n.unsubscribe(q);});}}},_update:function(){d(['AvailableList'],function(q){var r=this.value;this.dirty();var s=n.getCachedProfileIDs(),t=s.filter(function(v){var w=n.getNow(v);return w.type===k.FRIEND;});t.sort(l.compare);var u=[];t.forEach(function(v){if(v==i.user)return;var w=q.get(v);if(!this.showOfflineUsers&&w!==q.ACTIVE)return;var x=n.getNow(v),y=x.additionalName;if(x.hasOwnProperty('searchTokens'))y=y!==null?y+" "+x.searchTokens.join(" "):x.searchTokens.join(" ");u.push({uid:v,text:x.name,tokens:y,localized_text:x.name,additional_text:x.additionalName,photo:x.thumbSrc,type:x.type});}.bind(this));if(u.length)this.addEntries(u);this.value=r;if(r)this.query(r);}.bind(this));},refreshData:function(){d(['AvailableList'],function(q){q.update();}.bind(this));}});e.exports=p;});
__d("ChatSidebarHeader.react",["React","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('cx'),i=g.createClass({displayName:'ReactChatSidebarHeader',render:function(){return (g.DOM.div({className:"_55ob"},g.DOM.div({className:"_55oc"},this.props.name)));}});e.exports=i;});
__d("ChatSidebarUser.react",["ChatFavoriteList","WebMessengerPermalinkConstants","ChatConfig","React","ChatSidebarItem.react"],function(a,b,c,d,e,f){var g=b('ChatFavoriteList'),h=b('WebMessengerPermalinkConstants'),i=b('ChatConfig'),j=b('React'),k=b('ChatSidebarItem.react'),l=j.createClass({displayName:'ChatSidebarUser',render:function(){var m=h.getURIPathForIDOrVanity(this.props.userID),n=g.isFavored(this.props.userID),o=function(){g.toggleID(this.props.userID);}.bind(this),p=i.get('divebar_favorite_list',0)?n:undefined;return (k({href:{url:m},imageSize:this.props.imageSize,images:this.props.image,litestandSidebar:this.props.litestandSidebar,isAdded:p,showEditButton:g.isEditMode(),name:this.props.name,onEditClick:o,status:this.props.status,birthday:this.props.birthday,statusTime:this.props.statusTime,context:this.props.context}));}});e.exports=l;});
__d("ChatTypeaheadRenderer",["AvailableListConstants","ChatConfig","ChatSidebarConstants","ChatSidebarHeader.react","ChatSidebarThread.react","ChatSidebarUser.react","ChatTypeaheadConstants","DOM","LastMobileActiveTimes","MercuryParticipants","PresenceStatus","React"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatSidebarConstants'),j=b('ChatSidebarHeader.react'),k=b('ChatSidebarThread.react'),l=b('ChatSidebarUser.react'),m=b('ChatTypeaheadConstants'),n=b('DOM'),o=b('LastMobileActiveTimes'),p=b('MercuryParticipants'),q=b('PresenceStatus'),r=b('React'),s={};function t(z,aa){if(!(z in s))s[z]=n.create('li');r.renderComponent(aa,s[z]);return s[z];}function u(z){return t(z.text,j({name:z.text}));}function v(){if(h.get('litestand',0)&&!h.get('test_old_divebar'))return h.get('litestand_blended_sidebar')?i.LITESTAND_BLENDED_SIZE:i.LITESTAND_IMAGE_SIZE;return i.IMAGE_SIZE;}function w(z){var aa=z.mercury_thread.participants.map(function(ba){return p.getUserID(ba);});return t(z.uid,k({image:z.mercury_thread.image_src,imageSize:v(),litestandSidebar:h.get('litestand',0)&&!h.get('test_old_divebar'),name:z.mercury_thread.name,participants:z.participants_to_render,status:q.getGroup(aa),threadID:z.uid}));}function x(z){var aa=q.get(z.uid),ba=(aa===g.MOBILE)?o.getShortDisplay(z.uid):null,ca=z.render_type=='non_friend'?z.subtext:null;return t(z.uid,l({image:z.photo,imageSize:v(),litestandSidebar:h.get('litestand',0),name:z.text,status:aa,birthday:q.isBirthday(z.uid),statusTime:ba,userID:z.uid,context:ca}));}function y(z,aa){if(z.type===m.HEADER_TYPE)return u(z);if(z.type==m.THREAD_TYPE)return w(z);return x(z);}e.exports=y;});
__d("ChatTypeaheadView",["arrayContains","BucketedTypeaheadView","ChatConfig","Class","ChatTypeaheadConstants","Env","MercuryThreadSearchUtils","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('BucketedTypeaheadView'),i=b('ChatConfig'),j=b('Class'),k=b('ChatTypeaheadConstants'),l=b('Env'),m=b('MercuryThreadSearchUtils'),n=b('copyProperties'),o=b('tx'),p=i.get('divebar_typeahead_group_fof',0);function q(r,s){this.parent.construct(this,r,s);this.typeObjects={};this.typeObjectsOrder=[];this.typeObjects[k.NON_FRIEND_TYPE]={uid:k.NON_FRIEND_TYPE,type:k.HEADER_TYPE,text:"FRIENDS OF FRIENDS"};this.typeObjectsOrder.push(k.NON_FRIEND_TYPE);this.typeObjects[k.THREAD_TYPE]={uid:k.THREAD_TYPE,type:k.HEADER_TYPE,text:"GROUP CONVERSATIONS"};this.typeObjectsOrder.push(k.THREAD_TYPE);this.typeObjects[k.FRIEND_TYPE]={disabled:true,uid:k.FRIEND_TYPE,type:k.HEADER_TYPE,text:"FRIENDS"};this.typeObjectsOrder.push(k.FRIEND_TYPE);}j.extend(q,h);n(q.prototype,{buildBuckets:function(r,s){if(p){s=s.reverse();s=s.filter(function(t){var u=t.render_type||t.type;if(u==='thread'){var v='fbid:'+l.user;if(!g(t.mercury_thread.participants,v))return false;var w=t.participants_to_render.some(function(y){return m.queryMatchesName(r,y.name);}),x=m.queryMatchesName(r,t.mercury_thread.name);if(!w&&!x)return false;}return true;});}s=this.parent.buildBuckets(r,s);if(!p)s=s.filter(function(t){return t&&!t.disabled;});return s;},getDefaultIndex:function(r){if(!p)return this.parent.getDefaultIndex(r);if(r.length===0)return -1;var s=r.length-1;while(!this.isHighlightable(r[s])&&s>=0)s--;return s;}});e.exports=q;});
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","ChatConfig","copyProperties","MercuryConstants","ChatSidebarCalloutData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChatConfig'),k=b('copyProperties'),l=b('MercuryConstants').ChatNotificationConstants,m=b('ChatSidebarCalloutData').isShown,n=h.getWebChatNotification(),o=m,p=true,q=k(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return n!==l.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return o;},showsTabUnreadUI:function(){if(j.get('web_messenger_suppress_tab_unread'))return p;return true;}});function r(){q.inform(q.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var s=n,t=h.getWebChatNotification();n=t;if(s!=t)r();});g.subscribe('chat/set_does_page_occlude_tabs',function(s,t){o=!!t;r();});g.subscribe('chat/set_show_tab_unread_ui',function(s,t){p=!!t;r();});e.exports=q;});
__d("ChatSidebarSheet",["Event","function-extensions","ArbiterMixin","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatVisibility","CSS","DOM","JSLogger","PresencePrivacy","React","XUIButton.react","csx","cx","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('ArbiterMixin'),i=b('BlackbirdUpsell'),j=b('ChannelConnection'),k=b('ChannelConstants'),l=b('ChatBehavior'),m=b('ChatConfig'),n=b('ChatVisibility'),o=b('CSS'),p=b('DOM'),q=b('JSLogger'),r=b('PresencePrivacy'),s=b('React'),t=b('XUIButton.react'),u=b('csx'),v=b('cx'),w=b('copyProperties'),x=b('tx'),y=q.create('sidebar_sheet');function z(ca){switch(ca){case k.HINT_AUTH:return "Your session has timed out. Please log in.";case k.HINT_CONN:return x._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});case k.HINT_MAINT:return x._("Facebook {Chat} is currently down for maintenance.",{Chat:"Chat"});default:return x._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});}}function aa(ca){var da;if(ca===null){da="Unable to connect to chat. Check your Internet connection.";}else if(ca>m.get('warning_countdown_threshold_msec')){var ea=p.create('a',{href:'#',className:'fbChatReconnectLink'},"Try again");da=p.tx._("Unable to connect to chat. {try-again-link}",{'try-again-link':ea});}else if(ca>1000){da=x._("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(ca/1000)});}else da="Unable to connect to chat. Reconnecting...";return da;}function ba(ca){this._root=ca;this._litestandOffline=p.scry(ca,"._52d2");this._message=p.find(ca,'div.fbChatSidebarMessage div.message');j.subscribe([j.CONNECTED,j.SHUTDOWN,j.RECONNECTING],this._handleConnectionChange.bind(this));j.subscribe([j.MUTE_WARNING,j.UNMUTE_WARNING],this._render.bind(this));r.subscribe('privacy-user-presence-changed',this._render.bind(this));l.subscribe(l.ON_CHANGED,this._render.bind(this));this._render();}w(ba.prototype,h,{_channelStatus:null,_channelData:null,_handleConnectionChange:function(ca,da){this._channelStatus=ca;this._channelData=da;this._render();},_showWarningTimeout:null,_warningMsgEventListener:null,_renderChannelDisconnect:function(){if(this._channelStatus===j.SHUTDOWN){return p.setContent(this._message,z(this._channelData));}else if(this._channelStatus===j.RECONNECTING){var ca=this._channelData;p.setContent(this._message,aa(ca));if(ca>1000){if(ca>m.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=g.listen(this._message,'click',function(event){if(o.hasClass(event.getTarget(),'fbChatReconnectLink')){j.reconnect();return false;}});this._showWarningTimeout=setTimeout(this._handleConnectionChange.bind(this,j.RECONNECTING,ca-1000),1000,false);}}},_goOnlineEventListener:null,_renderOffline:function(){if(this._isLitestand)return;if(this._litestandOffline&&this._litestandOffline.length)this._renderLitestandOffline();var ca='fbChatGoOnlineLink',da="Turn on chat",ea=p.create('a',{href:'#',className:ca},da),fa=p.tx._("{=Go online} to see who's available.",{'=Go online':ea});p.setContent(this._message,fa);this._goOnlineEventListener=g.listen(this._message,'click',function(event){if(o.hasClass(event.getTarget(),ca)){y.log('sidebar_go_online');n.goOnline();return false;}});},_renderLitestandOffline:function(){this._litestandOffline=this._litestandOffline[0];this._isLitestand=true;if(m.get('litestand_blended_sidebar')){s.renderComponent(t({className:"_52cx _5d9x",href:{url:'#'},label:"Turn on Chat",onClick:function(){y.log('sidebar_go_online');n.goOnline();}}),this._litestandOffline);this._litestandOffline=null;}else{s.renderComponent(s.DOM.a({className:"_52cx _52i7",href:"#",onClick:function(){y.log('sidebar_go_online');n.goOnline();}},s.DOM.i({className:"_52c_"}),s.DOM.div({className:"_52cz"},s.DOM.div({className:"_52c-"},s.DOM.i({className:"_52d1"}),s.DOM.div({className:"_52cy"},p.tx._("Turn on Chat")))),s.DOM.i({className:"_52d0"}),s.DOM.div({className:"_4_vf",'data-hover':"tooltip",'data-tooltip-alignh':"center",'data-tooltip-position':"right",'aria-label':"Turn on Chat"})),this._litestandOffline);this._litestandOffline=null;}},_renderBlackbirdUpsell:function(){p.setContent(this._message,i.getOfflineContent());},_renderBlackbird:function(ca){p.setContent(this._message,i.getBlackbirdContent(ca));},_clear:function(){if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}o.removeClass(this._root,'upsell');o.removeClass(this._root,'offline');o.removeClass(this._root,'blackbird');o.removeClass(this._root,'error');o.removeClass(this._root,'notice');p.empty(this._message);},_render:function(){this._clear();if(i.shouldShow()){if(n.hasBlackbirdEnabled()){var ca=n.isOnline()?'blackbird':'upsell';o.addClass(this._root,ca);this._renderBlackbird(r.getVisibility());}else if(!n.isOnline()){o.addClass(this._root,'upsell');this._renderBlackbirdUpsell();}}else if(!n.isOnline()){o.addClass(this._root,'offline');this._renderOffline();}else if(j.disconnected()){o.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!l.notifiesUserMessages()){o.addClass(this._root,'notice');p.setContent(this._message,"Alerts are off while you use another client to chat.");}this.inform('updated');}});e.exports=ba;});
__d("FBDesktopPlugin",["CacheStorage","DOM","Env","FBDesktopDetect","URI","Style"],function(a,b,c,d,e,f){var g=b('CacheStorage'),h=b('DOM'),i=b('Env'),j=b('FBDesktopDetect'),k=b('URI'),l=b('Style'),m=new g('localstorage','_socialfox_'),n={_plugin:'_not_checked',arbiterInform:function(o,p){var q=JSON.stringify({name:o,payload:p});this._transmitCommand('arbiterinform',q);},bringToFront:function(){this._transmitCommand('bringtofront');},dock:function(){this._transmitCommand('dock');},getPlugin:function(){if(this._plugin==='_not_checked'){this._plugin=null;if(j.isPluginInstalled()){var o=h.create('object',{id:'kiwi_plugin',type:j.mimeType});l.set(o,'width',0);l.set(o,'height',0);var p=h.create('div',{},o);l.set(p,'width',0);l.set(p,'height',0);document.body.appendChild(p);this._plugin=o;}}return this._plugin;},getUserID:function(){var o=this.getPlugin();return o&&'getUserID' in o&&o.getUserID();},getVersion:function(){var o=this.getPlugin();return o&&'getVersion' in o&&o.getVersion();},isAppRunning:function(){var o=this.getPlugin();return o&&'isAppRunning' in o&&o.isAppRunning();},launchApp:function(){var o=this.getPlugin();return o&&'launchApp' in o&&o.launchApp();},login:function(o,p){if(p&&o&&o.length>0){var q=this.getPlugin();if(q){this._transmitCommand('relogin\n'+o+'\n'+p);return;}}},logout:function(o){o=o||"0";var p=this.getPlugin();if(p)p.logout(o);},recheck:function(){if(this._plugin===null)this._plugin='_not_checked';},shouldSuppressBeeper:function(){return this.isAppRunning();},shouldSuppressMessages:function(){if(m&&m.get('connected'))return true;var o=this.getUserID();if(o){return o===i.user;}else return this.isAppRunning();},shouldSuppressSidebar:function(){var o=this.getPlugin(),p=o&&'isAppDocked' in o&&o.isAppDocked(),q=m&&m.get('active')==='true';return p||q;},transferAuthToken:function(o,p){if(o&&o.length>0){var q=this.getPlugin();if(q){q.setAccessToken(o,p);var r=setInterval(function(){q.setAccessToken(o,p);},500);setTimeout(function(){clearInterval(r);},10*1000);}}if(this.redirectHome)window.location.href=k().setPath().toString();},_transmitCommand:function(o,p){p=p||'';var q=this.getPlugin();if(q&&'transmitCommand' in q)q.transmitCommand(o,p);}};e.exports=n;});
__d("ChatSidebar",["ChatOrderedList","ChatTypeaheadBehavior","ChatTypeaheadCore","ChatTypeaheadDataSource","ChatTypeaheadRenderer","ChatTypeaheadView","Typeahead","Arbiter","ArbiterMixin","AsyncRequest","BlendedChatSidebar","Bootloader","Chat","ChatConfig","ChatHovercard","ChatImpressionLogger","ChatOptions","ChatSidebarSheet","CSS","DOM","DOMDimensions","Event","FBDesktopPlugin","JSLogger","JSXDOM","KeyEventController","OrderedFriendsList","Parent","PresencePrivacy","ScrollableArea","Style","UserAgent","ViewportBounds","copyProperties","createArrayFrom","csx","cx","debounce","emptyFunction","ge"],function(a,b,c,d,e,f){b('ChatOrderedList');b('ChatTypeaheadBehavior');b('ChatTypeaheadCore');b('ChatTypeaheadDataSource');b('ChatTypeaheadRenderer');b('ChatTypeaheadView');b('Typeahead');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('BlendedChatSidebar'),k=b('Bootloader'),l=b('Chat'),m=b('ChatConfig'),n=b('ChatHovercard'),o=b('ChatImpressionLogger'),p=b('ChatOptions'),q=b('ChatSidebarSheet'),r=b('CSS'),s=b('DOM'),t=b('DOMDimensions'),u=b('Event'),v=b('FBDesktopPlugin'),w=b('JSLogger'),x=b('JSXDOM'),y=b('KeyEventController'),z=b('OrderedFriendsList'),aa=b('Parent'),ba=b('PresencePrivacy'),ca=b('ScrollableArea'),da=b('Style'),ea=b('UserAgent'),fa=b('ViewportBounds'),ga=b('copyProperties'),ha=b('createArrayFrom'),ia=b('csx'),ja=b('cx'),ka=b('debounce'),la=b('emptyFunction'),ma=b('ge'),na,oa=false,pa=false,qa=false,ra=false,sa=false,ta=false,ua,va,wa,xa,ya,za=null,ab,bb,cb,db,eb,fb,gb=28,hb=38,ib=w.create('chat_sidebar');function jb(){if(bb)return;r.removeClass(document.documentElement,'sidebarMode');if(!ra||!sb.isVisible()){g.inform('reflow');return;}qa=false;za=null;ua.hide();xa.getCore().reset();r.hide(va);ib.rate('sidebar_hide',ra);sb.inform('sidebar/hide',sb);g.inform('sidebar/hide',sb);g.inform('reflow');}function kb(){var tb=sb.shouldShowSidebar();r.conditionClass(document.documentElement,'sidebarCapable',tb);if(sb.isEnabled()&&tb){nb();var ub;if(ab){var vb=r.hasClass(va,"_4w59");if(vb)return;fb=fb||s.find(va,"._50g0");if(ab.has_favorites_editing)eb=eb||s.scry(va,"._52s9")[0];ub=[fb];}else ub=ha(va.childNodes);var wb=mb(ub),xb=ua.getItemHeight()||32,yb=ua.getPaddingOffset()||8,zb;if(bb){if(bb.isExpanded()){yb=yb+gb;if(ab&&ab.always_show_one_see_more)yb+=xb;}if(!l.isOnline())yb+=hb;var ac=Math.floor(ua.getItemPadding()/2);zb=Math.floor((wb-yb+ac)/xb);if(!ua.isVisible())da.set(na,'height',wb+'px');}else{zb=Math.floor((wb-yb)/(xb+1));da.set(na,'height',wb+'px');}ua.setNumTopFriends(zb);var bc=Math.floor((wb-yb)/xb);if(pb())bc=(bc-2)>0?bc-2:0;xa.getData().setMaxResults(bc);sb.inform('sidebar/resized',sb);g.inform('sidebar/resized',sb);g.inform('reflow');}else jb();if(!ra){rb();ra=true;}za=null;}function lb(){if(xa&&sb.isVisible())xa.getCore().getElement().focus();}function mb(tb){if(!tb)if(ab){fb=fb||s.find(va,"._50g0");tb=[fb];}else tb=ha(va.childNodes);var ub=ya.height;if(bb&&cb)ub-=cb.getFullHeight();tb.forEach(function(vb){if(vb&&vb!==na)ub-=t.getElementDimensions(vb).height;});if(db)ub-=db.getOffset();return Math.max(0,ub);}function nb(){if(sb.isVisible())return;qa=true;za=null;r.show(va);r.addClass(document.documentElement,'sidebarMode');ua.show();ib.rate('sidebar_show',ra);sb.inform('sidebar/show',sb);g.inform('sidebar/show',sb);}function ob(){p.setSetting('sidebar_mode',sb.isEnabled(),'sidebar');new i('/ajax/chat/settings.php').setHandler(la).setErrorHandler(la).setData({sidebar_mode:sb.isEnabled()}).setAllowCrossPageTransition(true).send();}function pb(){return m.get('divebar_typeahead_group_fof',0);}function qb(){return z.getList().length<=m.get('sidebar.min_friends');}function rb(){var tb=true;if(!sb.isEnabled()){ib.log('state_not_enabled');tb=false;}if(!sb.isViewportCapable()){ib.log('state_not_shown_viewport');tb=false;}if(pa){ib.log('state_not_shown_hidden');tb=false;}if(qb()){ib.log('state_not_shown_num_friends');tb=false;}if(v.shouldSuppressSidebar()){ib.log('state_not_shown_fbdesktop');tb=false;}ib.log(tb?'state_shown':'state_not_shown');}var sb={init:function(tb,ub,vb,wb){sb.init=la;sa=true;va=tb;ua=ub;xa=vb;wa=wb;na=s.find(tb,'div.fbChatSidebarBody');bb=wb&&wb.ls_module;ab=wb&&wb.ls_config;if(bb){g.subscribe('ViewportSizeChange',function(){g.inform('ChatOrderedList/itemHeightChange');kb();});g.subscribe('Sidebar/BookmarksHeightChange',kb);k.loadModules(['LitestandSidebarBookmarksDisplay'],function(zb){cb=zb;});}else u.listen(window,'resize',kb);y.registerKey('q',function(){var zb=null;if(fb){zb=s.scry(fb,'.inputsearch')[0];}else zb=s.scry(tb,'.inputsearch')[0];if(zb){zb.focus();return false;}});new n(ub);var xb=new q(tb);xb.subscribe('updated',kb);g.subscribe('sidebar/invalidate',kb);ub.setScrollContainer(aa.byClass(ub.getRoot(),'uiScrollableAreaWrap'));ub.subscribe(['render','show','hide'],ka(function(zb){if(zb==='render'&&!ta){ta=true;sb.inform('sidebar/chatRendered',null,g.BEHAVIOR_PERSISTENT);}var ac=ub.getRoot(),bc=ca.getInstance(ac);bc&&bc.adjustGripper();}));ub.subscribe(['editStart','editEnd'],function(zb){r.conditionClass(xa.getView().element,"_4-d6",zb=='editStart');});if(ea.firefox()>=17)u.listen(window,'storage',function(zb){if(zb.key=='_socialfox_active'&&zb.oldValue!=zb.newValue)kb();});g.subscribe('chat/option-changed',function(zb,ac){if(ac.name=="sidebar_mode"){oa=!!p.getSetting('sidebar_mode');kb();}});vb.getCore().subscribe('sidebar/typeahead/active',sb.updateOnActiveTypeahead);vb.subscribe('reset',function(){if(!vb.getCore().getValue()&&!ua.isVisible())sb.updateOnActiveTypeahead(null,false);});if(bb){vb.getCore().subscribe('sidebar/typeahead/preActive',function(zb,ac){if(oa&&xa.getView().isVisible()){g.inform(zb,ac);}else kb();});}else g.subscribe('buddylist-nub/initialized',function(zb,ac){u.listen(ac.getButton(),'click',function(event){sb.enable();return !sb.shouldShowSidebar();});});oa=!!p.getSetting('sidebar_mode');ea.ie()&&u.listen(tb,'click',function(zb){if(aa.byClass(zb.getTarget(),"_57du"))lb();});ba.subscribe('privacy-user-presence-changed',kb);kb();o.init(ua);if(!bb)fa.addRight(sb.getVisibleWidth);sb.inform('sidebar/initialized',sb,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',sb,g.BEHAVIOR_PERSISTENT);if(m.get('litestand_blended_sidebar')){var yb=s.find(tb,"._5fhf");db=new j(yb);db.subscribe('resized',kb);}},updateOnActiveTypeahead:function(tb,ub){if(!qa)return;if(ub){ua.hide();if(bb){r.addClass(va,"_5384");var vb=mb();if(eb)vb+=t.getElementDimensions(eb).height;da.set(na,'height',vb+'px');}}else{ua.show();if(bb){da.set(na,'height','auto');r.removeClass(va,"_5384");g.inform('sidebar/typeahead/active',false);kb();}else kb();}},isInitialized:function(){return ra;},disable:function(){if(!sb.isEnabled())return;oa=false;ob();jb();},enable:function(){if(sb.isEnabled())return;oa=true;ob();kb();lb.defer();},forceEnsureLoaded:function(){if(sa)return;if(ma('pagelet_sidebar'))return;d(['UIPagelet'],function(tb){var ub=x.div({id:"pagelet_sidebar"});s.appendContent(document.body,ub);tb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});sa=true;},ensureLoaded:function(){if(!oa)return;sb.forceEnsureLoaded();},hide:function(){if(pa)return;pa=true;jb();},unhide:function(){if(!pa)return;pa=false;kb();},getBody:function(){return na;},getRoot:function(){return va;},getVisibleWidth:function(){if(!qa||!va)return 0;if(za===null)za=va.offsetWidth;return za;},isEnabled:function(){return oa;},isViewportCapable:function(){ya=t.getViewportWithoutScrollbarDimensions();if(bb)return true;var tb=m.get('sidebar.minimum_width');return ya.width>tb;},shouldShowSidebar:function(){var tb=sb.isViewportCapable();return bb||(tb&&!pa&&(!qb()||m.get('litestand_blended_sidebar',false))&&!v.shouldSuppressSidebar());},isVisible:function(){return qa;},resize:kb,toggle:function(){if(bb){bb.toggle();}else sb.isEnabled()?sb.disable():sb.enable();},isLitestandSidebar:function(){return !!bb;}};ga(sb,h);e.exports=sb;});
__d("DropdownContextualHelpLink",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge'),i={set:function(j){var k=h('navHelpCenter');if(k!==null)g.replace(k,j);}};e.exports=i;});
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('JSLogger'),l=b('MercuryConfig'),m=b('PresenceState'),n=b('UserActivity'),o=b('copyProperties'),p=l.activity_limit||60000,q=l.idle_limit||1800000,r=l.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new h(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())u=Date.now();});g.listen(window,'focus',function(){v=true;y();});g.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});h.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;});
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryMessages","MercuryParticipants","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('MercuryMessages').get(),i=b('MercuryParticipants'),j=b('MercuryThreads').get(),k=b('tx');function l(m,n){g.isThreadID(m);j.getThreadMeta(m,function(o){h.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1];if(q&&q.author!=i.user){i.get(q.author,function(r){if(o.name){n(k._("{senderName} messaged {groupName}",{senderName:r.short_name,groupName:o.name}));}else n(k._("{name} messaged you",{name:r.short_name}));});}else n("New message!");});});}e.exports={renderDocumentTitle:l};});
__d("MercuryTimestampTracker",["MercuryActionTypeConstants","MercuryPayloadSource","MercurySingletonMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f){var g=b('MercuryActionTypeConstants'),h=b('MercuryPayloadSource'),i=b('MercurySingletonMixin'),j=b('MercuryServerRequests'),k=b('copyProperties');function l(m){this._fbid=m;this._serverRequests=j.getForFBID(this._fbid);this._lastTimestamp=0;this._serverRequests.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==h.CLIENT_SEND_MESSAGE||o.payload_source==h.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==g.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}k(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});k(l,i);e.exports=l;});
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryThreadInformer","MercuryNotificationRenderer","PresenceState","MercuryTimestampTracker"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('DocumentTitle'),i=b('JSLogger'),j=b('MercuryThreadInformer').get(),k=b('MercuryNotificationRenderer'),l=b('PresenceState'),m=b('MercuryTimestampTracker').get(),n=i.create('chat_title'),o=null,p=0,q=false;function r(){if(o){o.stop();o=null;return true;}return false;}function s(x){var y=x||m.getLastUserMessageTimestamp();if(p<=y){p=y;if(r()||q)l.doSync();}}var t={blink:function(x,y){if(!o&&p<y)k.renderDocumentTitle(x,function(z){if(!o)o=h.blink(z);});},stopBlinking:function(){s();},blinkingElsewhere:function(){q=true;}};function u(x){var y=l.verifyNumber(x.sb2);if(!y||y<=p)return null;return y;}function v(x){var y=x&&u(x);if(y){p=y;n.debug('load',p);r();q=false;}}function w(x){var y=u(x);if(!y){n.debug('store',p);x.sb2=p;q=false;}return x;}l.registerStateStorer(w);l.registerStateLoader(v);j.subscribe('thread-read-changed',function(x,y){var z=m.getLastUserMessageTimestamp(),aa=0;for(var ba in y)if(y[ba].mark_as_read&&y[ba].timestamp>=z&&y[ba].timestamp>aa)aa=y[ba].timestamp;aa&&s(aa);});g.subscribe('activity',function(){s();});(function(){var x=l.getInitial();if(x)p=u(x)||0;})();e.exports=t;});
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryParticipants","MercuryThreadMuter","MercuryThreads","MessagingTag","Sound","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatOptions'),k=b('ChatTitleBarBlinker'),l=b('MercuryParticipants'),m=b('MercuryThreadMuter'),n=b('MercuryThreads').get(),o=b('MessagingTag'),p=b('Sound'),q=b('copyProperties');p.init(['audio/ogg','audio/mpeg']);function r(t){if(j.getSetting('sound'))p.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],t,false);}var s={messageReceived:function(t){if(t.author==l.user||!t.is_unread||(t.folder!=o.INBOX&&t.folder!=o.ARCHIVED))return;var u=t.thread_id,v=h.isActive();if(v){var w=false;s.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});}n.getThreadMeta(u,function(x){var y=m.isThreadMuted(x);if(y)return;var z=t.timestamp;if(v){!w&&r(z);}else{k.blink(u,z);r(z);}k.blinkingElsewhere();}.bind(this));}};e.exports=q(s,g);});
__d("ActiveXSupport",[],function(a,b,c,d,e,f){var g=null,h={isSupported:function(){if(g!==null)return g;try{g=!!window.ActiveXObject&&!!new ActiveXObject("htmlfile");}catch(i){g=false;}return g;}};e.exports=h;});
__d("VideoCallSupport",["MercuryConfig","UserAgent"],function(a,b,c,d,e,f){var g=b('MercuryConfig'),h=b('UserAgent'),i={newVCIsSupported:function(){return g.NewVCGK&&(h.chrome()>=24||h.firefox()>=22);}};e.exports=i;});
__d("VideoCallRecordMessageDialog",["AsyncDialog","AsyncRequest","Dialog","URI","tx"],function(a,b,c,d,e,f){var g=b('AsyncDialog'),h=b('AsyncRequest'),i=b('Dialog'),j=b('URI'),k=b('tx'),l={get:function(m,n){var o="Would you like to leave a message?",p="New Message";return new i().setTitle(k._("{firstname} is Unavailable",{firstname:n})).setBody(o).setButtons([{name:'record-message',label:p},i.CANCEL]).setHandler(function(){var q=j('/ajax/messaging/composer.php').setQueryData({ids:[m],autoloadvideo:true}).toString();g.send(new h(q));});}};e.exports=l;});
__d("VideoCallCore",["Event","ActiveXSupport","Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","CSS","Dialog","MercuryConfig","UserAgent","VideoCallSupport","emptyFunction","ge","VideoCallTemplates","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ActiveXSupport'),i=b('Arbiter'),j=b('AsyncRequest'),k=b('AvailableList'),l=b('AvailableListConstants'),m=b('Bootloader'),n=b('ChannelConstants'),o=b('Cookie'),p=b('CSS'),q=b('Dialog'),r=b('MercuryConfig'),s=b('UserAgent'),t=b('VideoCallSupport'),u=b('emptyFunction'),v=b('ge');b('VideoCallTemplates');var w=[],x=[],y={isSupported:function(){if(t.newVCIsSupported())return true;if(s.windows()){if(s.ie()>=9&&!s.ie64()){return h.isSupported();}else return (s.ie()>=7&&!s.ie64())||s.firefox()>=3.6||s.chrome()>=5||s.opera()>=12;}else if(s.osx()>10.4)return (s.firefox()>=3.6||s.chrome()>=5||s.webkit()>=500||s.opera()>=12);return false;},isInstalled:function(){var ca=false;if(this.isSupported())if(z()){var da=null;try{da=new ActiveXObject('SkypeLimited.SkypeWebPlugin');ca=!!da;}catch(ea){}da=null;}else{ca=aa();if(r.VideoCallingNoJavaGK)if(ca&&s.osx()>=10.8)if(ca.description&&ca.description.charAt(0)!='v')ca=false;}return ca;},mightReloadPostInstall:function(){return s.windows();},onVideoMessage:function(ca){w.push(ca);m.loadModules(['VideoCallController'],u);},onRTCMessage:function(ca){if(t.newVCIsSupported()){x.push(ca);m.loadModules(['FBRTCCallController'],u);}},setMessageHandler:function(ca){this.onVideoMessage=ca;if(ca)while(w.length)ca(w.shift());},setRTCMessageHandler:function(ca){this.onRTCMessage=ca;if(ca)while(x.length)ca(x.shift());},availableForCall:function(ca){var da=k.get(ca);return da==l.ACTIVE||da==l.IDLE;},onProfileButtonClick:function(ca){y.startCallOrLeaveMessage(ca,'profile_button_click');},attachListenerToProfileButton:function(ca){var da=v('videoCallProfileButton');if(da){if(!y.isSupported()){p.hide(da);return;}g.listen(da,'click',function(event){y.startCallOrLeaveMessage(ca,'profile_button_click_timeline');});}},startCallOrLeaveMessage:function(ca,da){if(this.availableForCall(ca)){y.showOutgoingCallDialog(ca,da);}else b('ShortProfiles').get(ca,function(ea){b('VideoCallRecordMessageDialog').get(ca,ea.firstName).show();});},showOutgoingCallDialog:function(ca,da){var ea=da||'unknown';y.logClick(ca,ea);var fa=y.isInstalled()||r.NewVCGK?'outgoing_dialog.php':'intro.php',ga='/ajax/chat/video/'+fa+'?idTarget='+ca;new q().setAllowCrossPageTransition(true).setAsync(new j(ga)).show();},logClick:function(ca,da){new j().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:ca,clickSource:da}).setAllowCrossPageTransition(true).setErrorHandler(u).send();}};function z(){return s.ie()&&s.windows()&&!s.opera();}function aa(){if(!navigator)return null;navigator.plugins.refresh(false);var ca=navigator.mimeTypes['application/skypesdk-plugin'];return ca&&ca.enabledPlugin;}function ba(){if(!y.mightReloadPostInstall())return;var ca=o.get('vcpwn');if(ca){o.clear('vcpwn');var da=o.get('vctid');if(da){o.clear('vctid');if(o.get('vctid'))return;if(da&&y.isInstalled()){var ea='/ajax/chat/video/outgoing_dialog.php?idTarget='+da;new q().setAllowCrossPageTransition(true).setAsync(new j(ea)).show();}}}}i.subscribe(n.getArbiterType('video'),function(ca,da){y.onVideoMessage(da.obj);});i.subscribe(n.getArbiterType('webrtc'),function(ca,da){y.onRTCMessage(da.obj);});i.subscribe(n.getArbiterType('chat_event'),function(ca,da){if(da.obj.event_name=="missed-call")m.loadModules(['VideoCallController'],function(ea){ea.onMissedCallEvent(da.obj);});});ba();e.exports=y;});
__d("ChatTabModel",["function-extensions","Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","JSLogger","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceInitialData","PresenceState","PresenceUtil","areObjectsEqual","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('JSLogger'),l=b('MercuryAssert'),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o=b('MercuryTimestampTracker').get(),p=b('PresenceInitialData'),q=b('PresenceState'),r=b('PresenceUtil'),s=b('areObjectsEqual'),t=b('copyProperties'),u=[],v=null,w=null,x=null,y=null;function z(){return parseInt(p.serverTime,10);}var aa=j.get('tab_max_load_age')||3600000,ba=z()-aa,ca=0,da=20,ea=k.create('chat_tab_model'),fa=false;function ga(xa){var ya=q.verifyNumber(xa.uct2);if(!ya||typeof ya!=='number'){ea.warn('bad_cookie_version',xa.uct2);return null;}if(ya<ca||ya<ba)return null;return ya;}function ha(xa){var ya=ga(xa);if(!ya){var za={};za.old_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.old_promoted=xa&&xa.lm2;za.old_time=xa&&xa.uct2;za.old_reason=xa&&xa.tr;za.old_window=xa&&xa.tw;var ab;if(w&&xa.t2)for(var bb=0;bb<xa.t2.length;bb++){var cb=xa.t2[bb];if(cb.i===w)ab=cb.r;}var db=[];u.forEach(function(eb){if(!eb.fragile){var fb={i:eb.id,si:eb.server_id};if(eb.raised||(eb.id===w&&ab))fb.r=1;db.push(fb);}});xa.t2=db;xa.uct2=ca;xa.lm2=v;xa.tr=y;xa.tw=r.getSessionID();za.new_tabs=JSON.stringify(xa.t2);za.new_promoted=xa.lm2;za.new_time=xa.uct2;za.new_reason=xa.tr;za.new_window=xa.tw;ea.debug('store',za);}return xa;}function ia(xa){if(xa){var ya=ga(xa);if(ya&&ya!==ca){var za={};za.old_tabs=JSON.stringify(u);za.old_promoted=v;za.old_time=ca;za.old_reason=y;za.window_id=r.getSessionID();za.cookie_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.cookie_promoted=xa&&xa.lm2;za.cookie_time=xa&&xa.uct2;za.cookie_reason=xa&&xa.tr;za.cookie_window=xa&&xa.tw;ca=ya;y='load';var ab=ja(xa.t2,xa.lm2||null);za.load_result=ab;za.new_tabs=JSON.stringify(u);za.new_promoted=v;za.new_time=ca;za.new_reason=y;var event='load';if(!fa)event+='_init';ea.log(event,za);return ab;}}return false;}function ja(xa,ya){if(ka(xa,ya)){var za=u.filter(function(cb){return cb.fragile;}),ab={};v=null;u=xa.map(function(cb){var db={id:cb.i,server_id:cb.si};if(db.id==ya)v=db.id;if(w==cb.i){var eb=pa(w);if(eb!=-1){db.raised=u[eb].raised;return db;}else return null;}if(cb.r)db.raised=true;ab[db.id]=db;return db;});u=u.filter(function(cb){return cb!=null;});if(x)for(var bb in x)if(!ab[bb]||!ab[bb].raised)delete x[bb];za=za.filter(function(cb){return !ab[cb.id];});u=u.concat(za);oa();return true;}return false;}function ka(xa,ya){if(ya!=v)return true;var za=u.filter(function(cb){return !cb.fragile;});if(xa.length!=za.length)return true;for(var ab=0,bb=xa.length;ab<bb;ab++){if(xa[ab].id===w)continue;if(!s(xa[ab],za[ab]))return true;}return false;}function la(xa,ya,za){var ab=ia(q.get());if(ya===undefined||ya>ca){if(xa()){ab=true;y=za||null;na(ya);}}else ea.error('rejected',{change_time:ya,state_time:ca});ab&&ma();}function ma(){if(fa)va.inform('chat/tabs-changed',va.get());}function na(xa){if(xa===undefined)xa=Math.max(o.getLastUserMessageTimestamp()||1,ca+1);ca=xa;q.doSync();}function oa(){var xa=u.length-da;if(xa>0)u=u.filter(function(ya){return ya.raised||xa--<=0;});}function pa(xa){for(var ya=0;ya<u.length;ya++)if(u[ya].id==xa)return ya;return -1;}function qa(xa,ya){var za=n.getThreadMetaNow(xa);if(!za)return false;if(za.is_canonical_user){return sa(xa,ya);}else{var ab=ra(xa);if(ab)m.getServerThreadID(xa,function(bb){if(ta(xa,bb)){na();ma();}});return ab;}}function ra(xa){if(pa(xa)===-1){u.push({id:xa,fragile:true});ea.log('open_fragile_tab',{tabs:JSON.stringify(u),opened:xa,window_id:r.getSessionID()});return true;}return false;}function sa(xa,ya){var za=pa(xa);if(za!=-1)if(u[za].fragile){u.splice(za,1);}else{u[za].signatureID=ya;return true;}for(var ab=0;ab<=u.length;ab++)if(ab==u.length||u[ab].fragile){u.splice(ab,0,{id:xa,signatureID:ya});oa();ea.log('open_tab',{tabs:JSON.stringify(u),opened:xa,window_id:r.getSessionID()});return true;}}function ta(xa,ya){var za=pa(xa);if(za!=-1&&u[za].fragile){var ab=u[za];ab.fragile=false;ab.server_id=ya;var bb=[];u.forEach(function(cb){if(cb.id!=xa){if(ab&&cb.fragile){bb.push(ab);ab=null;}bb.push(cb);}});if(ab)bb.push(ab);u=bb;ea.log('make_permanent',{tabs:JSON.stringify(u),tab_id:xa,window_id:r.getSessionID()});return true;}return false;}function ua(xa){var ya=pa(xa);if(xa==v)v=null;if(ya!=-1){u.splice(ya,1);ea.log('close_tab',{tabs:JSON.stringify(u),closed:xa,window_id:r.getSessionID()});return true;}return false;}q.registerStateStorer(ha);q.registerStateLoader(function(xa){if(ia(xa))ma();});function va(){}t(va,h,{indexOf:function(xa){return pa(xa);},getTab:function(xa){l.isThreadID(xa);var ya=this.indexOf(xa);if(ya>-1){var za=u[ya];return t({},za);}return null;},getEmptyTab:function(){for(var xa=0;xa<u.length;xa++){var ya=u[xa].id;if(n.isNewEmptyLocalThread(ya))return ya;}return null;},getServerTime:function(){return z();},closeAllTabs:function(){if(u.length){ea.log('close_all_tabs',{closed_tabs:JSON.stringify(u),window_id:r.getSessionID()});u=[];v=null;if(x)x={};na();ma();}},closeFragileTabs:function(){var xa=[];for(var ya=0;ya<u.length;ya++)if(u[ya].fragile&&!n.isNewEmptyLocalThread(u[ya].id)){xa.push(u[ya]);u.splice(ya);ma();break;}ea.log('close_fragile_tabs',{tabs:JSON.stringify(u),fragile_closed:xa,window_id:r.getSessionID()});},closeTab:function(xa,ya){l.isThreadID(xa);var za=false;if(x){delete x[xa];za=true;}la(function(){if(ua(xa))za=true;return za;},undefined,ya);},closeTabAndDemote:function(xa,ya,za){l.isThreadID(xa);var ab=false;if(x){delete x[xa];ab=true;}la(function(){if(ua(xa)){if(v){var bb=pa(v);if(bb>ya){var cb=u.splice(bb,1)[0];u.splice(ya,0,cb);v=null;}}ab=true;}return ab;},undefined,za);},raiseTab:function(xa,ya,za){l.isThreadID(xa);var ab=false;if(x&&ya){x[xa]=true;ab=true;}if(!ya&&xa===w){ab&&ma();return;}la(function(){if(qa(xa,za))ab=true;var bb=pa(xa);if(bb!=-1&&!u[bb].raised){u[bb].raised=true;ab=true;ea.log('raise_tab',{tabs:JSON.stringify(u),raised:xa,window_id:r.getSessionID()});}return ab;});},get:function(){var xa=u.map(function(ya){var za=t({},ya);delete za.fragile;if(x)za.raised=x[za.id];return za;});return {tabs:xa,promoted:v};},openFragileTab:function(xa){l.isThreadID(xa);if(ra(xa))ma();},openTab:function(xa){l.isThreadID(xa);la(qa.curry(xa));},lowerTab:function(xa){l.isThreadID(xa);var ya=false;if(x){delete x[xa];ya=true;}la(function(){var za=pa(xa);if(za!=-1&&u[za].raised){delete u[za].raised;ea.log('lower_tab',{tabs:JSON.stringify(u),lowered:xa,window_id:r.getSessionID()});ya=true;}return ya;});},raiseAndPromoteTab:function(xa,ya,za,ab,bb){l.isThreadID(xa);var cb=false;if(x&&ya){x[xa]=true;cb=true;}if(!ya&&xa===w){cb&&ma();return;}la(function(){if(qa(xa,za))cb=true;var db=pa(xa);if(db!=-1&&(!u[db].raised||v!=xa)){u[db].raised=true;v=xa;cb=true;ea.log('raise_and_promote_tab',{tabs:JSON.stringify(u),promoted:xa,window_id:r.getSessionID()});}return cb;},ab,bb);},promoteThreadInPlaceOfThread:function(xa,ya){l.isThreadID(xa);l.isThreadID(ya);la(function(){var za=pa(xa),ab=pa(ya);if(v===ya)v=xa;var bb=u[za];u[za]=u[ab];u[ab]=bb;return true;});},squelchTab:function(xa){l.isThreadID(xa);w=xa;this.lowerTab(xa);ea.log('squelch_tab',{squelched:xa,tabs:JSON.stringify(u),window_id:r.getSessionID()});},clearSquelchedTab:function(){if(w)ea.log('unsquelch_tab',{squelched:w,tabs:JSON.stringify(u),window_id:r.getSessionID()});w=null;},persistLocalRaised:function(){if(x){la(function(){var xa=false;u.forEach(function(ya){if(ya.raised!=x[ya.id]){xa=true;if(x[ya.id]){ya.raised=true;}else delete ya.raised;}});return xa;});ea.log('persist_local_raise',{tabs:JSON.stringify(u),window_id:r.getSessionID()});}}});g.subscribe(k.DUMP_EVENT,function(xa,ya){ya.chat_tabs={promoted:v,tabs:u.map(function(za){return t({},za);}),time:ca,max_load_age:aa};});function wa(){var xa=i.ignoresRemoteTabRaise();if(xa&&!x){ea.log('start_ignore_remote_raise');x={};ma();}else if(!xa&&x){ea.log('stop_ignore_remote_raise');x=null;ma();}}i.subscribe(i.ON_CHANGED,wa);wa();ia(q.getInitial(),true);if(ca===0)ca=z()-600000;fa=true;e.exports=va;});
__d("LinkshimHandler",["Event","LinkshimAsyncLink","LinkshimHandlerConfig","URI","shield"],function(a,b,c,d,e,f){var g=b('Event'),h=b('LinkshimAsyncLink'),i=b('LinkshimHandlerConfig'),j=b('URI'),k=b('shield'),l={setUpLinkshimHandling:function(r){try{var t=j(r.getAttribute('href')),u=m(t);if(u&&n(t)){g.listen(r,'mouseover',k(h.swap,null,r,u));var v=p(t);g.listen(r,'click',function(){if(i.supports_meta_referrer){h.referrer_log(r,v,o(t).toString());}else h.swap(r,t);});}}catch(s){}}};function m(r){return r.getQueryData().u?new j(r.getQueryData().u):null;}function n(r){return r.getQueryData().hasOwnProperty('s');}function o(r){return j('/si/ajax/l/render_linkshim_log/').setSubdomain('www').setQueryData(r.getQueryData());}function p(r){var s;if(q()){s=j(r).addQueryData({render_verification:true});}else s=m(r);return s;}function q(){var r=i.render_verification_rate||0;return Math.floor(Math.random()*r+1)===r;}e.exports=l;});