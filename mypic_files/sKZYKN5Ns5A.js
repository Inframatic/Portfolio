/*!CK:3402804734!*//*1375705729,178191165*/

if (self.CavalryLogger) { CavalryLogger.start_js(["PwMQb"]); }

__d("ErrorDialog",["Dialog","emptyFunction"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('emptyFunction'),i={showAsyncError:function(j){try{return i.show(j.getErrorSummary(),j.getErrorDescription());}catch(k){alert(j);}},show:function(j,k,l,m){return (new g()).setTitle(j).setBody(k).setButtons([g.OK]).setStackable(true).setModal(true).setHandler(l||h).setButtonsMessage(m||'').show();}};e.exports=i;});
__d("ImageUtils",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent'),h={hasLoaded:function(i){if(i.naturalWidth!==undefined){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===undefined&&g.webkit()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};e.exports=h;});
__d("PhotoEverstoreLogger",["Event","AsyncRequest","copyProperties","ImageUtils"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('ImageUtils'),k={BATCH_WINDOW_MS:500,storedLog:[]};function l(){}i(l,{_log:function(n){k.storedLog.push(n);if(k.storedLog.length==1)setTimeout(m,k.BATCH_WINDOW_MS,false);},logImmediately:function(n){l._log(n);},registerForLogging:function(n){if(j.hasLoaded(n)){l._log(n.src);}else g.listen(n,'load',function(event){l._log(n.src);});}});function m(){var n=k.storedLog;k.storedLog=[];var o=JSON.stringify(n);new h().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls:o}).setMethod('POST').setOption('suppressErrorHandlerWarning',true).setOption('suppressErrorAlerts',true).send();}e.exports=l;});
__d("PhotoSessionLog",["AsyncRequest","Run","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Run'),i=b('Vector'),j=b('copyProperties');function k(){}j(k,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,source:null,buttonLikes:0,pagingAction:'',faceTagImpressions:0,cycle:false,endOfRelevant:false,relevantCount:0,initLogging:function(l){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.version=l;this.buttonLikes=0;this.pagingAction='';this.faceTagImpressions=0;this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;if(l===k.SNOWLIFT){var m=i.getViewportDimensions();this.width=m.x;this.height=m.y;}},setLogFbids:function(l){this.logIds=l;},setPhotoSet:function(l){this.set=l;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(l){this.pagingAction=l;},addFaceTagImpression:function(){this.faceTagImpressions++;},setCycle:function(l){this.cycle=l;},setEndOfRelevant:function(l){this.endOfRelevant=l;},setRelevantCount:function(l){this.relevantCount=l;},setEndMetrics:function(l){this.endMetrics=l;},setSource:function(l){this.source=l;},addPhotoView:function(l,m,n){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(l)this.fbidList.push([l.fbid,l.owner,Date.now()]);if(m)this.hiResLoads++;if(n)this.fullScreenViews[l.fbid]=true;},logEnterFullScreen:function(l){this.fullScreenViews[l]=true;},addDetailData:function(l,m){if(!this.details[l])this.details[l]={t:m.num_tags,l:m.has_location,c:m.has_caption,cm:m.comment_count,lk:m.like_count,w:m.width,h:m.height,ad:'{}',p:this.pagingAction};},updateAdData:function(l,m){if(this.details[l])this.details[l].ad=JSON.stringify(m);},logPhotoViews:function(l){if((!this.views)||(this.version===k.SNOWLIFT&&l==k.LEAVE))return;if(l!=this.AGGREGATE)this.last=true;var m={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:l?l:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version,face_imp:this.faceTagImpressions,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount,source:this.source};if(this.version===k.SNOWLIFT){var n=i.getViewportDimensions();m.width=n.x||this.width;m.height=n.y||this.height;if(this.hiResLoads>0)m.hires_loads=this.hiResLoads;if(this.last){var o=Object.keys(this.fullScreenViews).length;if(o>0)m.fullscreen=o;}}new g().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(l!=k.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(m).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});h.onUnload(function(){k.logPhotoViews(k.UNLOAD);});h.onLeave(function(){k.logPhotoViews(k.LEAVE);});e.exports=k;});
__d("PhotoViewerImage",["PhotoEverstoreLogger","URI","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('PhotoEverstoreLogger'),h=b('URI'),i=b('Vector'),j=b('copyProperties');function k(l){this._hiResDimensions=l.hiResDimensions&&i.deserialize(l.hiResDimensions);this._normalDimensions=l.normalDimensions&&i.deserialize(l.normalDimensions);this._info=l.info;this._video=l.video;this._shouldLog=l.everstoreLogThis;this._hiResSrc=l.hiResSrc;this._normalSrc=l.normalSrc;this._thumbSrc=l.thumbSrc;this._isInverted=false;this._data=l;}j(k.prototype,{getURIString:function(){return h(this._info.permalink).getUnqualifiedURI().toString();},hasHiResDimensions:function(){return !!this._hiResDimensions;},getHiResDimensions:function(){return this._hiResDimensions;},getNormalDimensions:function(){return this._normalDimensions;},getHiResSrc:function(){return this._hiResSrc;},getNormalSrc:function(){return this._normalSrc;},getThumbSrc:function(){return this._thumbSrc;},getInfo:function(){return this._info;},getPermalink:function(){return this._info.permalink;},getHighestResSrc:function(){return this._hiResSrc||this._normalSrc;},preload:function(l){if(this.getHighestResSrc())if(l&&!this._resource){this._resource=new Image();this._resource.src=this.getHighestResSrc();if(this._shouldLog)g.logImmediately(this._resource.src);}else if(!l&&!this._small){this._small=new Image();this._small.src=this._normalSrc||this._hiResSrc;if(this._shouldLog)g.logImmediately(this._small.src);}},setNormalDimensions:function(l,m){this._normalDimensions=new i(l,m);},setHiResDimensions:function(l,m){this._hiResDimensions=new i(l,m);},invertDimensions:function(){if(this.hasHiResDimensions())this._hiResDimensions=new i(this._hiResDimensions.y,this._hiResDimensions.x);this._normalDimensions=new i(this._normalDimensions.y,this._normalDimensions.x);this._isInverted=!this._isInverted;},copy:function(){return new k(this._data);}});e.exports=k;});
__d("PhotosConst",[],function(a,b,c,d,e,f){var g={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,BULK_EDITOR:3,FLASH_UPLOADER:4,HTML5_UPLOADER:10,SIZE_NORMAL:'n',PIC_NORMAL_FBX_SIZE:180};e.exports=g;});
__d("PhotosUtils",["copyProperties","Vector"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Vector');function i(){}g(i,{getNearestBox:function(j,k){var l=Infinity,m=null;for(var n in j){var o=j[n];if(o.contains(k)){var p=k.distanceTo(o.getCenter());if(p<l){l=p;m=n;}}}return m;},absoluteToNormalizedPosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.sub(l).mul(100/m.x,100/m.y);n.domain='pure';return n;},normalizedToAbsolutePosition:function(j,k){var l=h.getElementPosition(j),m=h.getElementDimensions(j),n=k.mul(m.x/100,m.y/100).add(l);n.domain='document';return n;},isFacebox:function(j){return j.match(/^face:/);},isTag:function(j){return j.match(/^tag:/);}});e.exports=i;});
__d("PhotoStreamCache",["DOM","HTML","PhotosConst","PhotoEverstoreLogger","PhotoViewerImage","Rect","UIPagelet","URI","Vector","copyProperties","createArrayFrom","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('HTML'),i=b('PhotosConst'),j=b('PhotoEverstoreLogger'),k=b('PhotoViewerImage'),l=b('Rect'),m=b('UIPagelet'),n=b('URI'),o=b('Vector'),p=b('copyProperties'),q=b('createArrayFrom'),r=b('ge');function s(){}p(s,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});p(s.prototype,{init:function(t,u,v){this.version=t;this.pageletName=u;this.pageletRootID=v;this.bufferSize=s.BUFFER_SIZE;this.fullBucketSize=s.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.usesOpaqueCursor=false;this.usesNonCircularPhotoSet=false;this.reachedLeftEnd=false;this.reachedRightEnd=false;this.leftLock=false;this.rightLock=false;this.useAjaxPipe=true;this.reset();},getUsesOpaqueCursor:function(){return this.usesOpaqueCursor;},isNonCircularPhotoSet:function(){return this.usesNonCircularPhotoSet;},setReachedLeftEnd:function(){this.reachedLeftEnd=true;},setReachedRightEnd:function(){this.reachedRightEnd=true;},hasReachedLeftEnd:function(){return this.reachedLeftEnd;},hasReachedRightEnd:function(){return this.reachedRightEnd;},nonCircularPhotoSetCanPage:function(t){if(!this.isNonCircularPhotoSet())return true;if(t<0)return this.getCursorPos()||!this.hasReachedLeftEnd();if(t>0)return (this.getLength()-1!=this.getCursorPos())||!this.hasReachedRightEnd();return true;},setUseAjaxPipe:function(t){this.useAjaxPipe=t;},reset:function(){this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;this.firstOpaqueCursor=null;},waitForInitData:function(){this.fbidList.push(s.INIT_PLACEHOLDER);},destroy:function(){this.reset();this.isActive=false;},isLoaded:function(){return this.loaded;},canPage:function(){if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;if(this.usesNonCircularPhotoSet)return true;return this.getLength()>1;},errorInCurrent:function(){if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());},getLength:function(){return this.fbidList.length;},getPhotoSet:function(){return this.photoSetQuery.set;},getPhotoSetQuery:function(){return this.photoSetQuery;},getCurrentImageData:function(){return this.getImageData(this.getCursor());},getOpaqueCursor:function(t){if(this.getImageData(t)){if(this.version===i.VIEWER_VAULTBOX)return this.getImageData(t).getInfo().opaquecursor;return this.getImageData(t).info.opaquecursor;}if(t==this.firstCursor)return this.firstOpaqueCursor;return null;},getImageData:function(t){return this.getCacheContent(t,s.IMAGE_DATA);},getCurrentHtml:function(){return this.getCacheContent(this.getCursor(),s.HTML);},getCurrentExtraData:function(){return this.getCacheContent(this.getCursor(),s.EXTRA);},getCacheContent:function(t,u){if(!t||t===s.ERROR_ID||t===s.INIT_PLACEHOLDER)return null;return this.cache[u][t];},getCursorPos:function(){return this.position;},getCursor:function(){if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;},getCursorForURI:function(t){return this.permalinkMap[t];},calculatePositionForMovement:function(t){var u=this.position+t;if(this.allLoaded){var v=this.getLength();u=(v+u%v)%v;}return u;},isValidMovement:function(t){if(!this.isLoaded()||!this.canPage())return false;var u=this.calculatePositionForMovement(t);return this.getCursor()>0||(u>=0&&u<this.getLength());},moveCursor:function(t){if(!this.isValidMovement(t))return;this.position=this.calculatePositionForMovement(t);if(t!==0)this.loadMoreIfNeccessary(t>0);},checkErrorAt:function(t){if(!this.isLoaded())return false;if(t===s.ERROR_ID)return true;return false;},getRelativeMovement:function(t){for(var u=0;u<this.getLength();u++)if(this.fbidList[u]==t)return u-this.position;return null;},preloadImages:function(t){var u,v,w=this.getLength(),x=this.cache.image,y=s.BUFFER_SIZE;if(w>y*2){u=(this.position+w-y%w)%w;v=(this.position+y)%w;}else{u=0;v=w-1;}while(u!=v){var z=this.fbidList[u];if(this.version===i.VIEWER_VAULTBOX){x[z]&&x[z].preload(t);}else if(x[z]&&x[z].url)if(t&&!x[z].resource){x[z].resource=new Image();x[z].resource.src=x[z].url;if(x[z].everstoreLogThis===true)j.logImmediately(x[z].resource.src);}else if(!t&&!x[z].small){x[z].small=new Image();x[z].small.src=x[z].smallurl||x[z].url;if(x[z].everstoreLogThis===true)j.logImmediately(x[z].small.src);}u=(u+1)%w;}},loadMoreIfNeccessary:function(t){if(this.allLoaded||(t&&this.rightLock)||(!t&&this.leftLock))return;var u=t?1:-1,v=this.position+this.bufferSize*u;if(v<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(v>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}},getEndCursor:function(t){return t?this.fbidList[this.getLength()-1]:this.fbidList[0];},calculateRelativeIndex:function(t,u,v){if(!this.totalCount)return null;var w=this.fbidList.indexOf(u),x=this.fbidList.indexOf(v);if(w===-1||x===-1)return null;var y=x-w;return (t+y+this.totalCount)%this.totalCount;},calculateDistance:function(t,u){var v=this.fbidList.indexOf(t),w=this.fbidList.indexOf(u);if(v===-1||w===-1)return null;return (w-v+this.getLength())%this.getLength();},fetch:function(t,u){var v=this.getEndCursor(u),w=p({cursor:v,version:this.version,end:this.getEndCursor(!u),fetchSize:u?t:-1*t,relevant_count:this.relevantCount,opaqueCursor:this.getOpaqueCursor(v)},this.photoSetQuery);if(this.totalCount&&this.firstCursorIndex!==null){w.total=this.totalCount;w.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,v);}var x=r(this.pageletRootID);if(!x){x=g.create('div',{id:this.pageletRootID});g.appendContent(document.body,x);}m.loadFromEndpoint(this.pageletName,x,w,{usePipe:this.useAjaxPipe,automatic:true,jsNonblock:true,crossPage:true});if(!this.useAjaxPipe)this.setUseAjaxPipe(true);},storeToCache:function(t){var u={};if(!this.isActive)return u;if('error' in t){this.processErrorResult(t.error);u.error=true;return u;}if('init' in t){this.processInitResult(t.init);u.init={logids:t.init.logids,fbid:t.init.fbid,loggedin:t.init.loggedin,fromad:t.init.fromad,disablesessionads:t.init.disablesessionads,flashtags:t.init.flashtags};}if('image' in t){this.processImageResult(t.image);u.image=true;}if('data' in t){this.processDataResult(t.data);u.data=true;}return u;},processInitResult:function(t){if(this.loaded)return;this.usesOpaqueCursor=t.usesopaquecursor;this.usesNonCircularPhotoSet=t.isnoncircularphotoset;this.loaded=true;this.photoSetQuery=t.query;if(t.bufferSize)this.bufferSize=t.bufferSize;if(t.fullBucketSize)this.fullBucketSize=t.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(t.fbid);this.rightLock=true;}else{var u=this.fbidList.indexOf(s.INIT_PLACEHOLDER);if(u!=-1)this.fbidList[u]=t.fbid;}this.firstCursor=t.fbid;this.firstOpaqueCursor=t.opaquecursor;if('initIndex' in t&&'totalCount' in t){this.firstCursorIndex=t.initIndex;this.totalCount=t.totalCount;}if(this.version==i.VIEWER_PERMALINK)this.fetch(s.INIT_BUCKET_SIZE,true);},processImageResult:function(t){for(var u in t){if(u===this.firstCursor&&t[u].everstoreLogThis)j.logImmediately(t[u].url);if(this.version===i.VIEWER_VAULTBOX){var v=t[u];this.cache.image[u]=new k(v);this.permalinkMap[this.cache.image[u].getURIString()]=u;}else{this.cache.image[u]=t[u];if(t[u].dimensions)this.cache.image[u].dimensions=o.deserialize(t[u].dimensions);if(t[u].smalldims)this.cache.image[u].smalldims=o.deserialize(t[u].smalldims);this.permalinkMap[n(t[u].info.permalink).getUnqualifiedURI().toString()]=u;}}},attachToFbidsList:function(t,u,v){if(this.allLoaded)return;if(u===-1){for(var w=t.length-1;w>=0;w--){this.fbidList.unshift(t[w]);this.position++;}this.leftLock=false;}else{for(var x=0;x<t.length;x++)this.fbidList.push(t[x]);this.rightLock=false;}if(v)this.setAllLoaded();},setAllLoaded:function(){this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);},processDataResult:function(t){for(var u in t){if(!this.cache.html[u])this.cache.html[u]={};for(var v in t[u].html){var w=t[u].html[v];if(typeof w==='string')w=h(w).getRootNode();this.cache.html[u][v]=q(w.childNodes);}if(!('extra' in t[u])){this.cache.extra[u]=null;continue;}this.cache.extra[u]={tagRects:{}};if(!Array.isArray(t[u].extra.tagRects))for(var x in t[u].extra.tagRects)if(t[u].extra.tagRects[x])this.cache.extra[u].tagRects[x]=l.deserialize(t[u].extra.tagRects[x]);Object.keys(t[u].extra).forEach(function(y){if(y=='tagRects')return;this.cache.extra[u][y]=t[u].extra[y];}.bind(this));}},processErrorResult:function(t){if(!this.isLoaded()){this.initError=true;return;}var u=t.side,v=[s.ERROR_ID];this.attachToFbidsList(v,u);},setTotalCount:function(t){this.totalCount=t;},setFirstCursorIndex:function(t){this.firstCursorIndex=t;}});e.exports=s;});
__d("PhotoViewer",["Bootloader","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('copyProperties'),i=b('emptyFunction');function j(){this.image=null;this.root=null;this.stream=null;}h(j,{bootstrap:function(k,l){g.loadModules(['PhotoSnowlift'],function(m){m.bootstrap(k,l);});}});h(j.prototype,{getEventPrefix:i.thatReturnsNull,getEventString:function(k){var l=this.getEventPrefix();if(l)return l+'.'+k;return null;},getImage:function(){return this.image;},getPosition:function(){return this.stream?this.stream.getCursor():null;},getRoot:function(){return this.root;},getSourceString:i.thatReturnsNull,getVersionConst:i.thatReturnsNull,getViewerSource:i.thatReturnsNull,getViewerSet:i.thatReturnsNull});e.exports=j;});